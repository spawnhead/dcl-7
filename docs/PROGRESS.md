# Progress

## Done
- 2026-02-22: **DEVELOPMENT_HANDOFF rewrite.** Переписан по принципам ERP PRD (brownfield clean-room): PRD-структура (Goal, Personas, Scope, User flows, FR, NFR, Acceptance Given/When/Then, Evidence, Риски), «Что уточнить у бизнеса» (18 вопросов), shadcn/ui + Tailwind, Evidence для каждого правила.
- 2026-02-13: **TASK-0092 Orders design integration.** Orders list + Order edit layout per Create Contract Redesign (OrdersRegistryPage, OrderPage); Card filters, sections, sticky footer; parity сохранён. logs/dev-task-0092-orders-design-integration-20260213-1400.md.
- 2026-02-13: **TASK-0090 Orders CERT.** Playwright 2 passed (full flow NOT skip); endpoints 2xx; Console 0. logs/qa-task-0090-orders-cert-20260213-0900.md.
- 2026-02-13: **TASK-0087 Playwright E2E smoke.** orders-smoke.spec.ts, cp-list-smoke.spec.ts; 3 passed, 1 skipped (Orders full flow BLOCKED by backend save 500). logs/qa-task-0087-playwright-smokes-20260213-0540.md.
- 2026-02-13: **TASK-0089 Orders save 500 fix.** ord_number truncation (VARCHAR 15); smoke test fixes; Playwright orders-smoke 2 passed. logs/dev-task-0089-orders-save-500-fix-20260213-0830.md.
- 2026-02-13: **TASK-0088 Orders edit/open 404 fix.** Old 8080 process killed; clean build + restart; GET /api/orders/edit/open 200. QA BLOCKED resolved. logs/dev-task-0088-orders-open-404-fix-20260213-0825.md.
- 2026-02-13: **TASK-0086 MCP rule Playwright + Chrome DevTools.** Правило 090-mcp-usage.mdc: Playwright MCP — стандартный QA/Smoke/E2E; разделение Playwright (автоматизация, регрессия, E2E) и Chrome DevTools (диагностика: консоль, сеть, perf); чеклисты и правила; без таблиц, без бинарей. logs/dev-task-0086-mcp-rule-playwright-devtools-20260213-1220.md.
- 2026-02-13: **TASK-0083 Orders AJAX grids.** Flyway V29 (dcl_ord_list_payment, dcl_ord_list_pay_sum); Backend OrderPayment/OrderPaySum, open/save; UI OrderEditPage — График оплаты + Суммы оплаты. API 200 JSON verified. logs/dev-task-0083-orders-ajax-grids-20260213-0815.md.
- 2026-02-12: **TASK-0084 Commercial Proposals list.** Backend: V26–V28 migrations, CommercialProposalsController/Service, CpListProvider (Postgres); GET lookups, POST data/page/cleanAll/block/clone. UI: CommercialProposalsPage, route /commercial-proposals, 10 filters, grid, row actions, blocked-row. Clone/Block verified via curl. logs/dev-task-0084-cp-list-20260212-2252.md.
- 2026-02-12: **TASK-0081 Legacy HAR capture.** 7 экранов: contracts, contractors, contractor_create, contractor_edit, contract_import_cp, contract_spec_create, contract_attachments. Legacy http://localhost:8082/ доступен; BLOCKED.md заменены на network.har; CONTRACTS.md обновлены. logs/qa-task-0081-legacy-har-capture-20260212-1915.md.
- 2026-02-12: **TASK-0082 Orders list Postgres-only.** OrderListProvider (dcl_order + JOINs), list + lookups из БД; OrderFilterFakeProvider удалён. logs/dev-task-0082-orders-list-postgres-only-20260212-2245.md.
- 2026-02-12: **TASK-0080 Orders create/edit 1:1.** Backend: V25 orders tables, Order/OrderProduce, OrderEditService, GET open + POST/PUT save. UI: OrderEditPage, routes /orders/new, /orders/:id/edit, кнопка «Новый заказ». Postgres-only. logs/dev-task-0080-orders-create-edit-20260212-2210.md.
- 2026-02-12: **TASK-0079 Orders and CP Spec Packs.** Three spec packs: order_edit (8 sections, 50+ fields, 10+8 endpoints), commercial_proposals (list, filters, grid, clone/block), commercial_proposal_edit (3 modes: Regular/Old Version/Minsk Store, 12+18 endpoints). All network payloads BLOCKED pending HAR capture. logs/plan-task-0079-orders-and-cp-specs-20260212-2104.md.
 - 2026-02-12: **TASK-0073 Admin Badge for Block.** Badge (999+) для поля «Блок» при adminRole/isAdmin: ContractorsPage (колонка ctr_block), ContractorEditPage/Create (колонка cpsBlock + ContactPersonsModal). logs/dev-task-0073-admin-badge-block-20260212-1645.md.
- 2026-02-12: **TASK-0072 Contractor Edit parity.** BUG-1: ctrBankProps/ctrComment in edit save payload (ContractorEditPage). BUG-2: Contact person edit modal prefill — Form key + initialValues (ContactPersonsModal). logs/dev-task-0072-contractor-edit-bank-and-contact-persons-20260212-1615.md.
- 2026-02-12: **Env unblock (Flyway).** Port 8080 freed; Postgres recreated (down -v, up -d); backend dev profile running; api-docs confirms edit/open, edit/save. logs/dev-flyway-unblock-20260212-1820.md.
- 2026-02-12: **Agent-Dev TASK-0071 Contractor Edit 1:1.** Backend GET/PUT edit/open, edit/save; ContractorEditService (Postgres); ContractorEditPage (5 tabs, returnTo, formReadOnly, roleFlags, 404). Build PASS. Env unblocked; browser verification next.
- 2026-02-12: **Agent-Plan TASK-0070 Contractor Edit Spec Pack 1:1.** docs/screens/contractor_edit/ (SNAPSHOT/CONTRACTS/ACCEPTANCE/BEHAVIOR_MATRIX/TEST_DATA_SPEC/QA_ROLE_PRESETS/payloads). Full legacy traceability to ContractorAction#edit/editCommon/process/delete. UNCONFIRMED: delete Popconfirm text, occupied check logic. logs/plan-contractor-edit-20260212-1500.md.
- 2026-02-12: **Agent-Dev TASK-0068 Global action confirmations.** Success notification с entity context; setFlashSuccess/consumeFlash; Apply/Clear/Delete feedback; rule 080. logs/dev-task-0068-global-confirmations-20260212-1300.md — Build PASS.
- 2026-02-12: **Agent-Dev TASK-0066 contractor_create Contact persons Postgres persistence.** V24 dcl_contact_person; JPA ContactPerson + Repository; save/open 1:1; integration test; MCP Evidence. logs/dev-task-0066-contact-persons-persist-20260212-1206.md — VERIFIED.
- 2026-02-12: **Agent-Dev TASK-0067 contractor_create Contact persons UX polish.** Modal: required ФИО, email/maxlen, notifyError; notifySuccess при add/edit. Build PASS. logs/dev-task-0067-contact-persons-modal-20260212-1000.md.
- 2026-02-12: **Agent Release Manager TASK-0063 Post-fix audit /contracts/new.** Diff коммитов TASK-0060/0057; подтверждены: логика/API/parity; Build PASS; open 200; lessons learned в логе. logs/audit-task-0063-claude-opus-contract-create-fix-20260212-1200.md — VERIFIED.
- 2026-02-11: **Agent-Dev TASK-0058 Contractors list grid missing fields.** V22+V23 dev seed заполняют address/phone/email/bank_props для contractors; API возвращает данные; backend mapper без изменений. logs/dev-task-0058-contractors-grid-missing-fields-20260211-2359.md — VERIFIED.
- 2026-02-09: **Agent-Dev TASK-0056 Chrome DevTools MCP.** docs/MCP_SETUP.md §2.5 §5.5, 090-mcp-usage.mdc, AGENT_TASK_REPORTS MCP Evidence. logs/dev-chrome-devtools-mcp-setup-20260209-1430.md.
- 2026-02-11: **Agent-Debug TASK-0057 contractor_create redirect regression.** NO REGRESSION. Both scenarios A/B PASS; TASK-0054 fix verified. logs/debug-task-0057-contractor-redirect-20260211-2100.md.
- 2026-02-11: **Agent-Debug TASK-0054 contractor_create wrong redirect.** returnTo path-based default (contractors for /contractors/new); save body prefer openData.returnTo. logs/debug-contractor-wrong-redirect-20260211-2025.md — VERIFIED.
- 2026-02-09: **Agent-Dev TASK-0053 Contact persons table layout.** scroll={{ x: 1300 }}, ellipsis, fixed: 'right'. logs/dev-contact-persons-table-layout-20260209-1200.md — Build PASS.
- 2026-02-11: **Agent-Dev TASK-0052 contractor_create Tabs validation UX.** Глобальные действия «Сохранить/Отмена»; validateAllTabs on Save; Badge на вкладках с ошибками; auto-switch на первую вкладку; sticky footer. logs/dev-contractor-tabs-validation-ux-20260211-2249.md — VERIFIED.
- 2026-02-11: **Agent-Dev TASK-0050 MCP UI Components.** Локальная установка ops/mcp-antd/, extract компонентов, mcp.json → node + путь; docs/MCP_SETUP.md.
- 2026-02-11: **Agent-Dev TASK-0049 Contact persons Modal UX.** Read-only table; Add/Edit via Modal; Delete + Popconfirm. ContactPersonsModal.tsx. logs/dev-contact-persons-modal-20260211-2230.md — VERIFIED.
- 2026-02-11: **Agent-Dev TASK-0048 Contractors delete + Contact persons.** Delete endpoint, Popconfirm, icons; вкладка «Контактные лица» с гридом; success feedback «Контрагент успешно сохранен». logs/dev-contractors-delete-contacts-20260211-2205.md — VERIFIED.
- 2026-02-11: **Agent-Dev TASK-0047 MCP Command Cookbook.** docs/MCP_SETUP.md §5 — Postgres/Docker/Playwright/GitHub сценарии, PASS/FAIL, Minimum MCP Evidence, copy-paste block. logs/dev-mcp-cookbook-20260211-2250.md.
- 2026-02-11: **Agent-Plan TASK-0046 Contractors list + contractor_create parity patch.** Delete Popconfirm + icons, contact persons tab parity, save success feedback. logs/plan-contractors-delete-and-contacts-parity-20260211-2153.md.
- 2026-02-11: **Agent-Dev TASK-0045 MCP setup.** docs/MCP_SETUP.md, .env.example, rule 090-mcp-usage.mdc, MCP Evidence template; no secrets. logs/dev-mcp-setup-20260211-2215.md.
- 2026-02-11: **Agent-QA TASK-0044 Contractors list parity.** **PASS.** ACCEPTANCE B1–B6 verified; Network 2xx; Console 0. logs/qa-contractors-list-20260211-2130.md.
- 2026-02-11: **Agent-Dev TASK-0043 Contractors list.** GET lookups, POST data/page/cleanAll/block; Postgres-only; UI ContractorsPage, фильтры, grid wrapper, menu Справочники→Контрагенты. logs/dev-contractors-list-20260211-2120.md — VERIFIED (implementation).
- 2026-02-11: **Agent-Dev TASK-0038 Contracts grid theme align.** Shared table wrapper; Layout.Content+app-content для Contracts; все 4 грида через wrapper; rule 081-tables-standard.mdc. logs/dev-contracts-grid-theme-align-20260211-2200.md — VERIFIED.
- 2026-02-12: **Agent-Dev TASK-0034 Global feedback notification.** notifySuccess/notifyError для save; N3a + N3a1; Skeleton min 350ms в DEV. logs/dev-notification-feedback-global-20260212-2030.md — VERIFIED.
- 2026-02-12: **Agent-Dev TASK-0032 grid dark theme parity.** Theme wrapper применён ко всем 4 гридам. logs/dev-aggrid-dark-theme-20260212-1945.md — VERIFIED.
- 2026-02-12: **Agent-Debug TASK-0031 N3a1 UX feedback guaranteed visible.** Flash mechanism (setFlashSuccess→consumeFlash); min loader 280ms; Message на целевой странице после redirect. logs/debug-n3a1-ux-feedback-visible-20260212-1800.md — VERIFIED.
- 2026-02-12: **Agent-Debug TASK-0030 N3a1 contractor_create Save + UX feedback.** Save сохраняет в Postgres; ScreenLoader при open; showLoading/showSuccess/showError при save. Backend: ctrUnp blank→null. logs/debug-n3a1-save-and-ux-feedback-20260212-1740.md — VERIFIED.
- 2026-02-12: **Agent-Plan TASK-0029 Next screen + Contractors parity plan.** Contractors list (References) выбран; spec-pack docs/screens/contractors/; план унификации create/edit. logs/plan-next-screen-contractors-20260212-1900.md.
- 2026-02-12: **Agent-Dev TASK-0026 Global Light/Dark theme toggle.** ThemeContext + ThemeProvider, ConfigProvider algorithm, Segmented в Header, localStorage persist. Build PASS. logs/dev-theme-toggle-20260212-1830.md — VERIFIED.
- 2026-02-12: **Agent-Dev TASK-0025 Global UX feedback.** Shared lib (feedback, api error normalization), ScreenLoader (Skeleton), применяется к N3a — open Skeleton, save Message.loading→success/error. Лог: logs/dev-global-ux-feedback-20260212-1815.md — VERIFIED.
- 2026-02-12: **Agent-Debug TASK-0024 N3a Save not persisting.** List использовал fake data; ContractListProvider + Postgres для getData; save → list показывает новый договор. logs/debug-n3a-save-not-persisting-20260212-1850.md — VERIFIED.
- 2026-02-12: **Agent-Debug TASK-0023 N3a contractor validation.** Form.Item+Space.Compact не передавал value в Select. Fix: nested Form.Item noStyle. logs/debug-n3a-contractor-validation-20260212-1800.md — VERIFIED.
- 2026-02-11: **Agent-Dev TASK-0022 Dev dashboard UI.** Data mode заменён на «DB Source: Live DB (Postgres)» + «Seed dataset: V21»; backend seedDataset из Flyway; FAKE_SEEDED не отображается. Лог: logs/dev-ui-devmode-livedb-20260211-1630.md — VERIFIED.
- 2026-02-11: **Agent-Debug TASK-0021 Clean restart after Postgres-only.** DB/backend/UI перезапущены; Flyway V20/V21 в flyway_schema_history; curl open/save 200; browser /contracts/new, /contractors/new открываются. logs/debug-restart-postgres-only-n3a-n3a1-20260211-1620.md — VERIFIED.
- 2026-02-11: **Agent-Dev TASK-0020 Postgres-only N3a/N3a1.** Contractor create + contract create: lookups и save из Postgres; V20 dcl_reputation, V21 dev seed; JPA entities (Contractor, Contract, Seller, Reputation, User); LastCreatedContractorHolder удалён; newContractorId via SELECT. curl: create contractor → 200; open?newContractorId=1 → contractor selected; create contract → 200. Лог: logs/dev-postgres-only-n3a-n3a1-20260211-1615.md — VERIFIED.
- 2026-02-12: **Agent-Dev TASK-0013 N3a1+N3a2 full parity.** 5 табов contractor_create, 2 таба contract_spec_create (Главная/Претензии); поля/гриды 1:1 по SNAPSHOT. Лог: logs/dev-n3a1-n3a2-full-parity-20260212-1505.md — VERIFIED.
- 2026-02-12: **Agent-Debug TASK-0011 (N3a1 contractor_create).** Save → 200; return flow: open(newContractorId) добавляет контрагента в lookup; контрагент доступен и выбран на /contracts/new. logs/debug-contractor-create-save-flow-20260212-1700.md — VERIFIED.
- 2026-02-11: **Agent-Plan TASK-0012 N3a1+N3a2 full parity spec expansion.** Полный 1:1 spec pack для `contractor_create` (5 вкладок) и `contract_spec_create` (2 вкладки, включая «Претензии») с расширением SNAPSHOT/CONTRACTS/ACCEPTANCE/BEHAVIOR_MATRIX/TEST_DATA_SPEC/QA_ROLE_PRESETS + HAR BLOCKED steps; явно зафиксирован spec gap vs dev gap. Лог: logs/plan-n3a1-n3a2-full-parity-spec-20260211-1140.md.
- 2026-02-12: **Agent-Debug TASK-0009 (N3a Save valid 400→200).** Root cause: Invalid UTF-8 (payload в CP1251); curl с UTF-8 payload → 200; CONTRACTS.md payload encoding; logs/debug-n3a-save-valid-20260212-1600.md — VERIFIED.
- 2026-02-12: **Agent-Debug TASK-0007 (N3a visual smoke).** Clean restart DB/backend/UI; все 4 страницы (/contracts/new, /contractors/new, /contracts/draft/specifications/new, /contracts/draft/attachments) открываются; нет placeholder; API 200. logs/debug-n3a-visual-smoke-20260212-1410.md — VERIFIED.
- 2026-02-12: **Agent-Dev TASK-0006 N3a missing blocks.** Плейсхолдеры убраны; таблица Спецификации + «Создать спецификацию» (N3a2); блок Прикреплённые файлы + «Прикрепить» (N3a3); кнопка «Добавить» у контрагента (N3a1). Backend: draft spec, draft attachments (session), contractors create. UI: ContractSpecCreatePage, ContractAttachmentsPage, ContractorCreatePage. Лог: logs/dev-n3a-missing-blocks-20260212-1345.md — VERIFIED.
- 2026-02-12: **Agent-Plan TASK-0005 N3a missing blocks.** Полные spec packs: contractor_create (N3a1), contract_spec_create (N3a2), contract_attachments (N3a3); N3a contract_create §6 Navigation. Лог: logs/plan-n3a-missing-blocks-specpack-20260212-1200.md.
- 2026-02-11: **Agent-Debug TASK-0004 (Grok UI not visible).** Правки Grok не были в файле; повторно применены (labelCol, Divider, секции Спецификации/Прикреплённые файлы). VERIFIED в браузере. logs/debug-grok-ui-not-visible-20260211-2320.md.
- 2026-02-11: **Agent-Plan TASK-0003 N3a parity audit.** Plan gap: кнопка «Добавить» у contractor; Dev gaps: таблица Спецификации, блок Прикреплённые файлы. Спеки пропатчены; stub packs contractor_create, contract_spec_create, contract_attachments. Лог: logs/plan-contract-create-parity-audit-20260211-2300.md.
- 2026-02-11: **Agent-Debug TASK-0001 (N3a contract_create).** Клик «Создать» не открывал форму — причина: backend 404 на create/open. Фикс: перезапуск backend. VERIFIED: /contracts → Создать → /contracts/new, форма «Создание договора», open 200. logs/debug-contract-create-navigation-20260211-2200.md, docs/AGENT_TASK_REPORTS.md.
- 2026-02-11: **Agent-Plan N3b contract_import_cp spec pack.** CONTRACTS, ACCEPTANCE, BEHAVIOR_MATRIX, TEST_DATA_SPEC, QA_ROLE_PRESETS, payloads/network.har.BLOCKED.md. Traceability: SelectFromGridAction, CommercialProposalsAction, ContractAction.importCP. Лог: logs/plan-contract-import-cp-20260211-2100.md.
- 2026-02-11: **Agent-Dev N3a contract create.** GET /api/contracts/create/open, POST /api/contracts/create/save (валидация 1:1); UI /contracts/new — ContractCreatePage (форма по SNAPSHOT, Отмена/Сохранить, редирект, field errors). Лог: logs/dev-contract-create-20260211-1135.md — VERIFIED.
- 2026-02-11: **Agent-Plan N3a contract_create spec pack complete.** SNAPSHOT/CONTRACTS/ACCEPTANCE/BEHAVIOR_MATRIX/TEST_DATA_SPEC/QA_ROLE_PRESETS + payloads. Восстановлено из legacy. Лог: logs/plan-contract-create-20260211-1900.md.
- 2026-02-11: **Agent-Plan N3 spec patch (buttons).** SNAPSHOT/ACCEPTANCE/BEHAVIOR_MATRIX/CONTRACTS обновлены; созданы docs/screens/contract_create/, contract_import_cp/ (N3a/N3b). Лог: logs/plan-contracts-buttons-patch-20260211-1700.md.
- 2026-02-11: **N3 Contracts parity gap — кнопки «Импорт из КП» и «Создать».** Agent-Orchestrator: N3 reopened; specs (ACCEPTANCE §13–14, BEHAVIOR_MATRIX) дополнены; кнопки добавлены в ContractsPage; маршруты /contracts/new, /contracts/import-cp (placeholder). Лог: logs/orchestrator-contracts-parity-gap-20260211-1600.md.
- 2026-02-10: **N3 Contracts list реализован (backend + UI).** Модуль contracts: GET lookups, POST data/page/cleanAll; FAKE_SEEDED 60 строк по TEST_DATA_SPEC; UI /contracts, меню «Договора», фильтры, грид 15 стр., next/prev, crossed-cell. Сборка и тесты backend — OK. Browser-verify не выполнен: backend не стартует из‑за Flyway (миграции 10, dev seed marker). Лог: [logs/dev-contracts-20260210-1740.md](logs/dev-contracts-20260210-1740.md) — NOT VERIFIED.
- 2026-02-10: **Orders N2 parity gaps fixed + browser verified.** contractor_for_id filter, order_by=ord_number asc/desc, UI sort dropdown; verification log: [logs/dev-orders-parity-fix-20260210-1532.log](logs/dev-orders-parity-fix-20260210-1532.log).
- 2026-02-10: **N2 spec pack ready (Orders list).** Agent-Plan: chosen N2 = Orders (Заказы); docs/screens/orders/ created: SNAPSHOT.md, CONTRACTS.md, ACCEPTANCE.md, BEHAVIOR_MATRIX.md, payloads/README.md. Traceability to OrdersAction, OrdersForm, Orders.jsp, select-orders → DCL_ORDER_FILTER, editCloneChecker, blockChecker, style-checker. CONTINUITY Key decisions updated. Verified: payloads/list-request.json, list-response.json (example shapes); CONTRACTS "How to verify" for contract/spec UNCONFIRMED.
- 2026-02-10: **Margin testability pack ready.** Agent-Plan: CONTRACTS.md — UNCONFIRMED сведены к минимуму, добавлен раздел "How to verify" (dep_id, export, serverList filter, initial empty grid). Созданы TEST_DATA_SPEC.md (детерминированные seed: справочники, 25–40 строк margin data, маячки для onlyTotal/itog_*/get_not_block/view_*/пагинация), QA_ROLE_PRESETS.md (admin, manager, manager_chief, economist — X-Dev-* заголовки). SEED_DATA_PLAN.md — секция "Margin parity dataset" со ссылкой на TEST_DATA_SPEC. QA может проверять Margin по ACCEPTANCE/BEHAVIOR_MATRIX без угадываний.
- 2026-02-10: N3 Contracts spec pack ready: SNAPSHOT/CONTRACTS/ACCEPTANCE/BEHAVIOR_MATRIX/TEST_DATA_SPEC/QA_ROLE_PRESETS/payloads (`docs/screens/contracts/*`).
- 2026-02-10: Подготовлен пакет спецификаций Agent-Plan для Margin-first dev цикла: role model, dev bypass (`X-Dev-User`/`X-Dev-Roles` + `/api/me`), seed/dataMode plan, и `/dev` dashboard contract.
- 2026-02-09: Parsed Firebird DDL and documented schema inventory + Firebird→Postgres mapping.
- 2026-02-09: Scanned legacy Struts config, web.xml, and JSPs to build code map and feature inventory.
- 2026-02-09: Drafted initial domain analysis based on DDL and legacy UI/actions.
- 2026-02-09: Added Cursor Project Rules in `.cursor/rules/` (CONTINUITY workflow, bash-only, sources of truth, Modulith, Flyway, tests, docs).
- 2026-02-09: Dev validation: logs/ created; backend build and test pass with JAVA_HOME=JDK 21; integration test skips when Docker unavailable; backend run fails without Postgres; UI npm install and npm run dev OK; generate:api requires backend. docker-compose.yml fixed. DEPLOYMENT_GUIDE updated with prerequisites.
- 2026-02-09: **Cursor Rules enforcement check.** (1) Rules: `.cursor/rules/*.mdc` present (8 files). (2) In Cursor: Settings → Project Rules — rules should be visible there. (3) In a **new chat** ask: "Какие правила активны и что ты обязан сделать в начале любого шага?" — expected: first step is "прочитать CONTINUITY.md и при необходимости обновить". (4) Practical check: added Currency backend module (Modulith: api/application/domain/infrastructure), no direct cross-module dependencies, Flyway V2 from DDL, integration test, traceability in controller. If rules do not apply: check path `.cursor/rules/`, ensure `alwaysApply: true` in key rules, and Cursor version (some builds use `.cursor/` for rules — then duplicate .mdc there).
- 2026-02-09: Captured legacy Margin screen snapshot artifacts (spec, HAR placeholder, payload examples); screenshots pending capture.
- 2026-02-09: Cursor Rules enforcement check; added Currency backend module (Modulith, Flyway V2, integration test).
- 2026-02-09: **Full E2E dev1.** Docker Desktop + Postgres (docker compose up); backend: flyway-database-postgresql, Currency SMALLINT→Short, Flyway V3/V4 (Modulith event tables); backend run OK; /v3/api-docs, /api/countries, /api/currencies verified; UI generate:api and npm run dev OK. Logs: logs/dev1-*.
- 2026-02-09: UI: Vite proxy for /api; table/grid; Countries grid shows real DB data. **Stage: development (local E2E). Production: not deployed.**
- Margin screen (Reports → Margin): route /reports/margin and menu "Отчеты → Маржа" added; placeholder page (spec missing). docs/screens/margin/ created (SNAPSHOT stub, payloads/README, IMPLEMENTATION_NOTES.md). Backend margin module and full parity blocked until SNAPSHOT and payloads from Agent-Plan.
- 2026-02-09: Merge origin/main (conflicts in CONTINUITY.md, SNAPSHOT.md resolved); margin SNAPSHOT.md full spec + payloads + network.har committed; pushed main → origin/stage.
- 2026-02-09: Margin specs finalized with CONTRACTS + ACCEPTANCE + BEHAVIOR_MATRIX; SNAPSHOT linked to new artifacts.
- 2026-02-09: **Margin parity (fake data).** Backend: margin modulith (api/application/domain/infrastructure), endpoints /api/margin/data, generate, cleanAll, export/excel, lookups (users, departments, contractors, stuff-categories, routes); MarginFakeDataProvider 250 rows; MarginExcelExport (POI); MarginIntegrationTest. UI: MarginPage full screen (filters, 5 selectors + aspects, options, Сбросить/Сформировать/Excel, grid 28 cols, toolbar limit/pageSize/Обновить/Экспорт CSV, row styles itogLine/spc_group_delivery/haveUnblockedPrc, loading/error). IMPLEMENTATION_NOTES checklist DONE/PARTIAL; logs/* placeholders. Run backend with JDK 21 + Postgres; UI with npm run dev.
- 2026-02-09: **DB parity report (Agent-DB).** Postgres (Flyway) vs Firebird DDL — PARTIAL; 2/96 domain tables; 6 blockers. logs/db-parity-20260209.log, logs/db-target-introspection.out.
- 2026-02-09: **QA parity report** (docs/screens/margin/QA_PARITY_REPORT.md): static check vs ACCEPTANCE/CONTRACTS/BEHAVIOR_MATRIX; 3 blockers (view_* not wired, onlyTotal rules, cleanAll get_not_block), 2 non-blocking diffs; dynamic/error UNCONFIRMED.

## Now
- 2026-02-12: TASK-0084 CP list реализован. Backend 2xx; Clone/Block работают; UI /commercial-proposals. Рекомендуется браузерная проверка: http://localhost:5173/commercial-proposals, Console 0.

## Done (margin-parity 2026-02-10)
- Margin parity: детерминированный dataset 35 строк (TEST_DATA_SPEC), пустая сессия при первой загрузке и после Сбросить всё; блокеры view_*, onlyTotal, cleanAll+get_not_block исправлены; lookups по TEST_DATA_SPEC/QA_ROLE_PRESETS. logs/dev-margin-parity-20260210-1200.log — VERIFIED.

## Done (dev-specs-align 2026-02-10)
- Dev infra aligned to ROLE_MODEL, DEV_BYPASS, SEED_DATA_PLAN, DEV_DASHBOARD_SPEC: dataMode по DCL_SETTING (DEV_SEED_VERSION); V11__init_dcl_setting, R__dev_seed_marker; X-Dev-Department-*; /api/me (name, department, chiefDepartment, authMode); DevStatusResponse (profile, serverTime, db.product/version); UI /dev блоки + Повторить; MarginController currentUser() hook. logs/dev-align-dev-specs-20260210-1120.log — VERIFIED.

## Done (dev-dashboard 2026-02-10)
- Dev Dashboard + Dev Identity + Data Mode: backend GET /api/dev/status, GET /api/me; CurrentUserProvider + X-Dev-User/X-Dev-Roles (@Profile("dev")); Flyway db/dev V10__dev_seed.sql, dataMode FAKE_SEEDED; UI /dev, DevDashboardPage, menu Development; DEPLOYMENT_GUIDE updated. Verification: logs/dev-dev-dashboard-20260210-1019.log — VERIFIED.

## Done (dev-debug 2026-02-09)
- Agent-Debug: проверка портов (5173/8080/5432), устранение блокеров сборки/запуска backend. Фиксы: MarginService import MarginExcelExport; MarginIntegrationTest скобка в jsonPath; перезапуск backend с JDK 21. API margin 2xx, proxy и страница margin 200. logs/dev-debug-20260209-1807.log — VERIFIED.

## Next
- Optional: в браузере открыть /dev и /reports/margin, проверить Console и Network.
- Implement missing schema objects via Flyway (per docs/DEVELOPMENT_HANDOFF.md §7).
- Открыть в браузере /reports/margin, убедиться: Console 0 ошибок, Network /api/margin/* 2xx (рекомендуется).
- Agent-Dev fixes blockers from QA report (view_* wiring, onlyTotal rules, cleanAll get_not_block).
- Replace Margin fake data with real DB queries.
- Agent-Dev Iteration 2 Units (docs/DEVELOPMENT_HANDOFF.md §7).
- Deep-dive into DAO/service for business rules and traceability.

## Risks/Questions
- (none)

## 2026-02-13 — TASK-0091 Orders/Order legacy parity docs recheck
- Revalidated legacy Struts/JSP/Forms flows for Orders list and Order edit/create from `src/main` + `struts-config.xml`.
- Rewrote docs/screens/orders and docs/screens/order_edit core parity docs (SNAPSHOT/CONTRACTS/BEHAVIOR_MATRIX/ACCEPTANCE) to strict fact-based content.
- Added HAR capture blocked instructions for both screens and task artifact log in `logs/`.

## 2026-02-13 — TASK-0094 legacy CP->Order closure flow trace
- Added orchestrator-level legacy flow map (legacy flow CP→Order→close trace; artifact removed per docs cleanup).
- Added evidence log `logs/plan-task-0094-legacy-flow-cp-to-order-close-20260213-0806.md` with commands/files/transition discovery points.
- Updated task tracking in AGENT_TASK_REPORTS and CONTINUITY.
