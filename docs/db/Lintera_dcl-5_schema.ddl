
SET SQL DIALECT 3; 

/* CREATE DATABASE 'Z:/projects/dcl_v3/db/data/SOURCE_FB4_20260113_152421.FDB' PAGE_SIZE 16384 DEFAULT CHARACTER SET UNICODE_FSS; */


/*  Generators or sequences */
CREATE GENERATOR DCL_1C_NUMBER_HISTORY_GENERATOR;
CREATE GENERATOR DCL_CUS_CODE_HISTORY_GENERATOR;
CREATE GENERATOR GEN_DCL_ACCOUNT_ID;
CREATE GENERATOR GEN_DCL_ACTION_ID;
CREATE GENERATOR GEN_DCL_ASM_LIST_PRODUCE_ID;
CREATE GENERATOR GEN_DCL_ASSEMBLE_ID;
CREATE GENERATOR GEN_DCL_ATTACHMENT_ID;
CREATE GENERATOR GEN_DCL_BLANK_ID;
CREATE GENERATOR GEN_DCL_BLANK_IMAGE_ID;
CREATE GENERATOR GEN_DCL_CATALOG_NUMBER_ID;
CREATE GENERATOR GEN_DCL_CATEGORY_ID;
CREATE GENERATOR GEN_DCL_CFC_LIST_PRODUCE_ID;
CREATE GENERATOR GEN_DCL_CFC_MESSAGE_ID;
CREATE GENERATOR GEN_DCL_COMMERCIAL_PROPOSAL_ID;
CREATE GENERATOR GEN_DCL_COMMON_BLANK_ID;
CREATE GENERATOR GEN_DCL_COMMON_BLANK_LIGHT_ID;
CREATE GENERATOR GEN_DCL_COND_FOR_CONTRACT_ID;
CREATE GENERATOR GEN_DCL_CONTACT_PERSON_ID;
CREATE GENERATOR GEN_DCL_CONTRACTOR_ID;
CREATE GENERATOR GEN_DCL_CONTRACTOR_REQUEST_ID;
CREATE GENERATOR GEN_DCL_CONTRACT_CLOSED_ID;
CREATE GENERATOR GEN_DCL_CONTRACT_ID;
CREATE GENERATOR GEN_DCL_CON_LIST_SPEC_ID;
CREATE GENERATOR GEN_DCL_CON_MESSAGE_ID;
CREATE GENERATOR GEN_DCL_COUNTRY_ID;
CREATE GENERATOR GEN_DCL_CPR_LIST_PRODUCE_ID;
CREATE GENERATOR GEN_DCL_CPR_TRANSPORT_ID;
CREATE GENERATOR GEN_DCL_CRQ_PRINT_ID;
CREATE GENERATOR GEN_DCL_CRQ_STAGE_ID;
CREATE GENERATOR GEN_DCL_CTC_LIST_ID;
CREATE GENERATOR GEN_DCL_CURRENCY_ID;
CREATE GENERATOR GEN_DCL_CURRENCY_RATE_ID;
CREATE GENERATOR GEN_DCL_CUSTOME_CODE_ID;
CREATE GENERATOR GEN_DCL_DELIVERY_REQUEST_ID;
CREATE GENERATOR GEN_DCL_DEPARTMENT_ID;
CREATE GENERATOR GEN_DCL_DLR_LIST_PRODUCE_ID;
CREATE GENERATOR GEN_DCL_FIELD_COMMENT_ID;
CREATE GENERATOR GEN_DCL_FILES_PATH_ID;
CREATE GENERATOR GEN_DCL_INF_MESSAGE_ID;
CREATE GENERATOR GEN_DCL_INSTRUCTION_ID;
CREATE GENERATOR GEN_DCL_INSTRUCTION_TYPE_ID;
CREATE GENERATOR GEN_DCL_LANGUAGE_ID;
CREATE GENERATOR GEN_DCL_LETTERHEAD_ID;
CREATE GENERATOR GEN_DCL_LOG_ID;
CREATE GENERATOR GEN_DCL_LPS_LIST_MANAGER_ID;
CREATE GENERATOR GEN_DCL_MONTAGE_ADJUSTMENT_H_ID;
CREATE GENERATOR GEN_DCL_MONTAGE_ADJUSTMENT_ID;
CREATE GENERATOR GEN_DCL_ORDER_BLANK_ID;
CREATE GENERATOR GEN_DCL_ORDER_ID;
CREATE GENERATOR GEN_DCL_ORD_LIST_PAYMENT_ID;
CREATE GENERATOR GEN_DCL_ORD_LIST_PAY_SUM_ID;
CREATE GENERATOR GEN_DCL_ORD_LIST_PRODUCE_ID;
CREATE GENERATOR GEN_DCL_ORD_MESSAGE_ID;
CREATE GENERATOR GEN_DCL_OUTGOING_LETTER_ID;
CREATE GENERATOR GEN_DCL_PAYMENT_ID;
CREATE GENERATOR GEN_DCL_PAY_LIST_SUMM_ID;
CREATE GENERATOR GEN_DCL_PAY_MESSAGE_ID;
CREATE GENERATOR GEN_DCL_PRC_LIST_PRODUCE_ID;
CREATE GENERATOR GEN_DCL_PRODUCE_COST_ID;
CREATE GENERATOR GEN_DCL_PRODUCE_ID;
CREATE GENERATOR GEN_DCL_PRODUCTION_TERM_ID;
CREATE GENERATOR GEN_DCL_PURCHASE_PURPOSE_ID;
CREATE GENERATOR GEN_DCL_PURPOSE_ID;
CREATE GENERATOR GEN_DCL_RATE_NDS_ID;
CREATE GENERATOR GEN_DCL_READY_FOR_SHIPPING_ID;
CREATE GENERATOR GEN_DCL_REPUTATION_ID;
CREATE GENERATOR GEN_DCL_ROLE_ID;
CREATE GENERATOR GEN_DCL_ROUTE_ID;
CREATE GENERATOR GEN_DCL_SELLER_ID;
CREATE GENERATOR GEN_DCL_SETTING_ID;
CREATE GENERATOR GEN_DCL_SHIPPING_ID;
CREATE GENERATOR GEN_DCL_SHP_DOC_TYPE_ID;
CREATE GENERATOR GEN_DCL_SHP_LIST_PRODUCE_ID;
CREATE GENERATOR GEN_DCL_SPC_LIST_PAYMENT_ID;
CREATE GENERATOR GEN_DCL_SPECIFICATION_IMPORT_ID;
CREATE GENERATOR GEN_DCL_SPI_LIST_PRODUCE_ID;
CREATE GENERATOR GEN_DCL_STUFF_CATEGORY_ID;
CREATE GENERATOR GEN_DCL_TERM_INCO_ID;
CREATE GENERATOR GEN_DCL_TEST_ID;
CREATE GENERATOR GEN_DCL_TIMEBOARD_ID;
CREATE GENERATOR GEN_DCL_TMB_LIST_WORK_ID;
CREATE GENERATOR GEN_DCL_UNIT_ID;
CREATE GENERATOR GEN_DCL_USER_ID;
CREATE GENERATOR GEN_DCL_USER_LINK_ID;
CREATE GENERATOR GEN_DCL_USER_SETTING_ID;

/* Domain definitions */
CREATE DOMAIN SMALLINTNN AS SMALLINT NOT NULL;
COMMIT WORK;

/* Table: DCL_1C_NUMBER_HISTORY, Owner: SYSDBA */
CREATE TABLE DCL_1C_NUMBER_HISTORY (ID INTEGER NOT NULL,
        PRD_ID INTEGER NOT NULL,
        NUMBER_1C VARCHAR(12) NOT NULL,
        DATE_CREATED TIMESTAMP NOT NULL,
PRIMARY KEY (ID));

/* Table: DCL_ACCOUNT, Owner: SYSDBA */
CREATE TABLE DCL_ACCOUNT (ACC_ID INTEGER NOT NULL,
        CTR_ID INTEGER NOT NULL,
        ACC_NAME VARCHAR(100),
        ACC_ACCOUNT VARCHAR(35),
        CUR_ID INTEGER,
        ACC_INDEX SMALLINT,
CONSTRAINT PK_DCL_ACCOUNT PRIMARY KEY (ACC_ID));

/* Table: DCL_ACTION, Owner: SYSDBA */
CREATE TABLE DCL_ACTION (ACT_ID INTEGER NOT NULL,
        ACT_NAME VARCHAR(100),
        ACT_SYSTEM_NAME VARCHAR(100) NOT NULL,
        ACT_LOGGING SMALLINT,
        ACT_CHECK_ACCESS SMALLINT,
CONSTRAINT PK_DCL_ACTION PRIMARY KEY (ACT_ID));

/* Table: DCL_ACTION_ROLE, Owner: SYSDBA */
CREATE TABLE DCL_ACTION_ROLE (ACT_ID INTEGER NOT NULL,
        ROL_ID INTEGER NOT NULL,
CONSTRAINT PK_DCL_ACTION_ROLE PRIMARY KEY (ACT_ID, ROL_ID));

/* Table: DCL_ASM_LIST_PRODUCE, Owner: SYSDBA */
CREATE TABLE DCL_ASM_LIST_PRODUCE (APR_ID INTEGER NOT NULL,
        ASM_ID INTEGER NOT NULL,
        PRD_ID INTEGER NOT NULL,
        OPR_ID INTEGER,
        APR_COUNT DECIMAL(15, 2) NOT NULL,
CONSTRAINT PK_DCL_ASM_LIST_PRODUCE PRIMARY KEY (APR_ID));

/* Table: DCL_ASSEMBLE, Owner: SYSDBA */
CREATE TABLE DCL_ASSEMBLE (ASM_ID INTEGER NOT NULL,
        ASM_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        ASM_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        ASM_NUMBER VARCHAR(20) NOT NULL,
        ASM_DATE DATE NOT NULL,
        ASM_BLOCK SMALLINT,
        ASM_COUNT INTEGER,
        PRD_ID INTEGER NOT NULL,
        OPR_ID INTEGER,
        ASM_TYPE SMALLINT NOT NULL,
        STF_ID INTEGER NOT NULL,
CONSTRAINT PK_DCL_ASSEMBLE PRIMARY KEY (ASM_ID));

/* Table: DCL_ATTACHMENT, Owner: SYSDBA */
CREATE TABLE DCL_ATTACHMENT (ATT_ID INTEGER NOT NULL,
        ATT_PARENT_ID INTEGER NOT NULL,
        ATT_PARENT_TABLE VARCHAR(32) NOT NULL,
        ATT_NAME VARCHAR(250),
        ATT_FILE_NAME VARCHAR(250),
        ATT_LINK_ID INTEGER,
        USR_ID INTEGER NOT NULL,
        ATT_CREATE_DATE TIMESTAMP NOT NULL,
CONSTRAINT PK_DCL_ATTACHMENT PRIMARY KEY (ATT_ID));

/* Table: DCL_BLANK, Owner: SYSDBA */
CREATE TABLE DCL_BLANK (BLN_ID INTEGER NOT NULL,
        BLN_TYPE SMALLINT NOT NULL,
        BLN_NAME VARCHAR(150) NOT NULL,
        LNG_ID INTEGER NOT NULL,
        BLN_CHARSET VARCHAR(20) NOT NULL,
        BLN_PREAMBLE VARCHAR(1000),
        BLN_NOTE VARCHAR(1000),
        BLN_USAGE VARCHAR(1000),
CONSTRAINT PK_DCL_BLANK PRIMARY KEY (BLN_ID));

/* Table: DCL_BLANK_IMAGE, Owner: SYSDBA */
CREATE TABLE DCL_BLANK_IMAGE (BIM_ID INTEGER NOT NULL,
        BLN_ID INTEGER NOT NULL,
        BIM_NAME VARCHAR(50) NOT NULL,
        BIM_IMAGE VARCHAR(32) NOT NULL,
CONSTRAINT PK_DCL_BLANK_IMAGE PRIMARY KEY (BIM_ID));

/* Table: DCL_CATALOG_NUMBER, Owner: SYSDBA */
CREATE TABLE DCL_CATALOG_NUMBER (CTN_ID INTEGER NOT NULL,
        STF_ID INTEGER NOT NULL,
        PRD_ID INTEGER NOT NULL,
        CTN_NUMBER VARCHAR(50) NOT NULL,
        MAD_ID INTEGER,
CONSTRAINT PK_DCL_CATALOG_NUMBER PRIMARY KEY (CTN_ID),
CONSTRAINT UNQ_DCL_CTN_PRD_ID_STF_ID UNIQUE (STF_ID, PRD_ID));

/* Table: DCL_CATEGORY, Owner: SYSDBA */
CREATE TABLE DCL_CATEGORY (CAT_ID INTEGER NOT NULL,
        PARENT_ID INTEGER,
        CAT_NAME VARCHAR(100),
CONSTRAINT PK_DCL_CATEGORY PRIMARY KEY (CAT_ID));

/* Table: DCL_CFC_LIST_PRODUCE, Owner: SYSDBA */
CREATE TABLE DCL_CFC_LIST_PRODUCE (CCP_ID INTEGER NOT NULL,
        CFC_ID INTEGER NOT NULL,
        STF_ID INTEGER NOT NULL,
        PRD_ID INTEGER NOT NULL,
        CCP_PRICE DECIMAL(15, 2),
        CCP_COUNT DECIMAL(15, 2),
        CCP_NDS_RATE DECIMAL(15, 2),
        CPR_ID INTEGER,
CONSTRAINT PK_DCL_CFC_LIST_PRODUCE PRIMARY KEY (CCP_ID));

/* Table: DCL_CFC_MESSAGE, Owner: SYSDBA */
CREATE TABLE DCL_CFC_MESSAGE (CCM_ID INTEGER NOT NULL,
        CFC_ID INTEGER,
        USR_ID INTEGER NOT NULL,
        CCM_CREATE_DATE TIMESTAMP NOT NULL,
        CCM_MESSAGE VARCHAR(256),
        CTR_ID INTEGER,
CONSTRAINT PK_DCL_CFC_MESSAGE PRIMARY KEY (CCM_ID));

/* Table: DCL_COMMERCIAL_PROPOSAL, Owner: SYSDBA */
CREATE TABLE DCL_COMMERCIAL_PROPOSAL (CPR_ID INTEGER NOT NULL,
        CPR_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        CPR_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        CPR_NUMBER VARCHAR(20) NOT NULL,
        CPR_DATE DATE NOT NULL,
        CTR_ID INTEGER NOT NULL,
        CPR_CONCERNING VARCHAR(1000),
        CPR_PREAMBLE VARCHAR(1000),
        CUR_ID INTEGER NOT NULL,
        CPR_COURSE DECIMAL(18, 8),
        CPR_NDS DECIMAL(15, 2),
        TRM_ID_PRICE_CONDITION INTEGER NOT NULL,
        CPR_COUNTRY VARCHAR(32),
        CPR_PAY_CONDITION VARCHAR(1000),
        TRM_ID_DELIVERY_CONDITION INTEGER NOT NULL,
        CPR_DELIVERY_ADDRESS VARCHAR(256),
        CPR_SUM_TRANSPORT DECIMAL(15, 2),
        CPR_DELIVERY_TERM VARCHAR(2000),
        CPR_ADD_INFO VARCHAR(3000),
        CPR_FINAL_DATE DATE,
        USR_ID INTEGER,
        CPR_PROPOSAL_RECEIVED_FLAG SMALLINTNN default 0,
        CPR_DATE_ACCEPT DATE,
        CPR_BLOCK SMALLINT,
        CPR_IMG_NAME VARCHAR(20),
        CPR_SUMM DECIMAL(15, 2),
        CPS_ID INTEGER,
        CPR_NDS_BY_STRING SMALLINT,
        CPR_SUM_ASSEMBLING DECIMAL(15, 2),
        CPR_OLD_VERSION SMALLINT,
        CPR_CHECK_PRICE SMALLINT,
        CPR_CHECK_PRICE_DATE TIMESTAMP,
        USR_ID_CHECK_PRICE INTEGER,
        CUR_ID_TABLE INTEGER NOT NULL,
        CPR_ASSEMBLE_MINSK_STORE SMALLINT,
        BLN_ID INTEGER NOT NULL,
        CPR_ALL_TRANSPORT SMALLINT,
        CPR_CONCERNING_INVOICE VARCHAR(1000),
        CPR_CAN_EDIT_INVOICE SMALLINT,
        CPR_PAY_CONDITION_INVOICE VARCHAR(1000),
        CPR_DELIVERY_TERM_INVOICE VARCHAR(2000),
        CPR_FINAL_DATE_INVOICE VARCHAR(30),
        CPR_COMMENT VARCHAR(3000),
        EXECUTOR_ID INTEGER,
        CPR_EXECUTOR_FLAG SMALLINT,
        PPS_ID INTEGER,
        CPR_REVERSE_CALC SMALLINT,
        CPS_ID_SELLER INTEGER,
        CPS_ID_CUSTOMER INTEGER,
        CPR_PREPAY_PERCENT DECIMAL(15, 2),
        CPR_PREPAY_SUM DECIMAL(15, 2),
        CPR_DELAY_DAYS INTEGER,
        CPR_NO_RESERVATION SMALLINT,
        CPR_PROVIDER_DELIVERY SMALLINT,
        CPR_PROVIDER_DELIVERY_ADDRESS VARCHAR(500),
        CPR_DELIVERY_COUNT_DAY INTEGER,
        CPR_FREE_PRICES SMALLINT,
        CPR_DONOT_CALCULATE_NETTO SMALLINT,
        CPR_PRINT_SCALE INTEGER,
        CPR_CONTRACT_SCALE INTEGER,
        CPR_INVOICE_SCALE INTEGER,
        CPR_GUARANTY_IN_MONTH INTEGER,
        CTR_ID_CONSIGNEE INTEGER,
        CPR_FINAL_DATE_ABOVE SMALLINT,
        CPR_TENDER_NUMBER VARCHAR(100),
        CPR_TENDER_NUMBER_EDITABLE CHAR(1) default '0' NOT NULL,
        CPR_PROPOSAL_DECLINED CHAR(1) default '0' NOT NULL,
CONSTRAINT PK_DCL_COMMERCIAL_PROPOSAL PRIMARY KEY (CPR_ID));

/* Table: DCL_COND_FOR_CONTRACT, Owner: SYSDBA */
CREATE TABLE DCL_COND_FOR_CONTRACT (CFC_ID INTEGER NOT NULL,
        CFC_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        CFC_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        CFC_PLACE SMALLINT,
        CFC_PLACE_DATE TIMESTAMP,
        USR_ID_PLACE INTEGER,
        CFC_EXECUTE SMALLINT,
        CFC_EXECUTE_DATE TIMESTAMP,
        USR_ID_EXECUTE INTEGER,
        CTR_ID INTEGER NOT NULL,
        CFC_DOC_TYPE SMALLINT NOT NULL,
        CFC_CON_NUMBER_TXT VARCHAR(200),
        CFC_CON_DATE DATE,
        CUR_ID INTEGER,
        CON_ID INTEGER,
        CFC_SPC_NUMBER_TXT VARCHAR(200),
        CFC_SPC_DATE DATE,
        CFC_PAY_COND VARCHAR(2500),
        CFC_DELIVERY_COND VARCHAR(2500),
        CFC_GUARANTEE_COND VARCHAR(2500),
        CFC_MONTAGE_COND VARCHAR(2500),
        CFC_DATE_CON_TO DATE,
        CFC_COUNT_DELIVERY VARCHAR(1000),
        CPS_ID_SIGN INTEGER,
        CPS_ID INTEGER,
        CFC_DELIVERY_COUNT SMALLINT,
        CFC_CUSTOM_POINT VARCHAR(500),
        PPS_ID INTEGER,
        CFC_COMMENT VARCHAR(1000),
        CFC_NEED_INVOICE SMALLINT,
        CFC_CHECK_PRICE SMALLINT,
        CFC_CHECK_PRICE_DATE TIMESTAMP,
        USR_ID_CHECK_PRICE INTEGER,
        SLN_ID INTEGER,
        CFC_ANNUL SMALLINT,
        CFC_ANNUL_DATE DATE,
        USR_ID_EDIT_ANNUL INTEGER,
        CFC_EDIT_ANNUL_DATE TIMESTAMP,
CONSTRAINT PK_DCL_COND_FOR_CONTRACT PRIMARY KEY (CFC_ID));

/* Table: DCL_CONTACT_PERSON, Owner: SYSDBA */
CREATE TABLE DCL_CONTACT_PERSON (CPS_ID INTEGER NOT NULL,
        CTR_ID INTEGER NOT NULL,
        CPS_NAME VARCHAR(200) NOT NULL,
        CPS_PHONE VARCHAR(150),
        CPS_FAX VARCHAR(150),
        CPS_BLOCK SMALLINT,
        CPS_POSITION VARCHAR(150),
        CPS_ON_REASON VARCHAR(150),
        CPS_EMAIL VARCHAR(50),
        CPS_MOB_PHONE VARCHAR(150),
        CPS_CONTRACT_COMMENT VARCHAR(300),
        CPS_FIRE SMALLINT,
CONSTRAINT PK_DCL_CONTACT_PERSON PRIMARY KEY (CPS_ID));

/* Table: DCL_CONTACT_PERSON_USER, Owner: SYSDBA */
CREATE TABLE DCL_CONTACT_PERSON_USER (CPS_ID INTEGER NOT NULL,
        USR_ID INTEGER NOT NULL,
CONSTRAINT UNQ1_DCL_CONTACT_PERSON_USER UNIQUE (CPS_ID, USR_ID));

/* Table: DCL_CONTRACT, Owner: SYSDBA */
CREATE TABLE DCL_CONTRACT (CON_ID INTEGER NOT NULL,
        CON_CREATE_DATE TIMESTAMP,
        USR_ID_CREATE INTEGER,
        CON_EDIT_DATE TIMESTAMP,
        USR_ID_EDIT INTEGER,
        CON_NUMBER VARCHAR(50) NOT NULL,
        CON_DATE DATE NOT NULL,
        CTR_ID INTEGER,
        CUR_ID INTEGER,
        CON_EXECUTED SMALLINT,
        CON_SUMM DECIMAL(15, 2),
        CON_ORIGINAL SMALLINT,
        CON_ANNUL SMALLINT,
        CON_ANNUL_DATE DATE,
        CON_COMMENT VARCHAR(5000),
        SLN_ID INTEGER,
        CON_REUSABLE SMALLINT,
        CON_FINAL_DATE DATE,
CONSTRAINT PK_DCL_CONTRACT PRIMARY KEY (CON_ID));

/* Table: DCL_CONTRACTOR, Owner: SYSDBA */
CREATE TABLE DCL_CONTRACTOR (CTR_ID INTEGER NOT NULL,
        CTR_NAME VARCHAR(200) NOT NULL,
        CTR_EMAIL VARCHAR(40),
        CTR_BANK_PROPS VARCHAR(800),
        CTR_UNP VARCHAR(15),
        CTR_FULL_NAME VARCHAR(300),
        CTR_BLOCK SMALLINT,
        CTR_CREATE_DATE TIMESTAMP,
        USR_ID_CREATE INTEGER,
        CTR_EDIT_DATE TIMESTAMP,
        USR_ID_EDIT INTEGER,
        RPT_ID INTEGER NOT NULL,
        CTR_OKPO VARCHAR(15),
        CTR_PHONE VARCHAR(100),
        CTR_FAX VARCHAR(100),
        CTR_DOUBLE_ACCOUNT SMALLINT,
        CUT_ID INTEGER NOT NULL,
        CTR_INDEX VARCHAR(20),
        CTR_REGION VARCHAR(50),
        CTR_PLACE VARCHAR(50),
        CTR_STREET VARCHAR(50),
        CTR_BUILDING VARCHAR(10),
        CTR_ADD_INFO VARCHAR(1000),
        CTR_COMMENT VARCHAR(5000),
CONSTRAINT PK_DCL_CONTRACTOR PRIMARY KEY (CTR_ID));

/* Table: DCL_CONTRACTOR_REQUEST, Owner: SYSDBA */
CREATE TABLE DCL_CONTRACTOR_REQUEST (CRQ_ID INTEGER NOT NULL,
        CRQ_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        CRQ_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        CRQ_RECEIVE_DATE DATE NOT NULL,
        CTR_ID INTEGER NOT NULL,
        CPS_ID INTEGER,
        CRQ_REQUEST_TYPE_ID INTEGER NOT NULL,
        CON_ID INTEGER,
        LPS_ID INTEGER,
        PRD_ID INTEGER,
        CRQ_NUMBER VARCHAR(15) NOT NULL,
        CRQ_DELIVER SMALLINT,
        USR_ID_MANAGER INTEGER,
        USR_ID_CHIEF INTEGER,
        USR_ID_SPECIALIST INTEGER,
        CRQ_CITY VARCHAR(50),
        CTR_ID_OTHER INTEGER,
        CRQ_NO_CONTRACT SMALLINT,
        STF_ID INTEGER,
        CRQ_SERIAL_NUM VARCHAR(100),
        CRQ_YEAR_OUT VARCHAR(100),
        CRQ_ENTER_IN_USE_DATE DATE,
        CRQ_ANNUL SMALLINT,
        CRQ_TICKET_NUMBER VARCHAR(30),
        SLN_ID INTEGER,
        CRQ_COMMENT VARCHAR(2000),
        CRQ_OPERATING_TIME DECIMAL(8, 2),
        CON_ID_FOR_WORK INTEGER,
CONSTRAINT PK_DCL_CONTRACTOR_REQUEST PRIMARY KEY (CRQ_ID));

/* Table: DCL_CONTRACTOR_USER, Owner: SYSDBA */
CREATE TABLE DCL_CONTRACTOR_USER (CTR_ID INTEGER NOT NULL,
        USR_ID INTEGER NOT NULL,
CONSTRAINT UNQ1_DCL_CONTRACTOR_USER UNIQUE (CTR_ID, USR_ID));

/* Table: DCL_CONTRACT_CLOSED, Owner: SYSDBA */
CREATE TABLE DCL_CONTRACT_CLOSED (CTC_ID INTEGER NOT NULL,
        CTC_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        CTC_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        CTC_NUMBER INTEGER NOT NULL,
        CTC_DATE DATE NOT NULL,
        CTC_BLOCK SMALLINT,
CONSTRAINT PK_DCL_CONTRACT_CLOSED PRIMARY KEY (CTC_ID));

/* Table: DCL_CON_LIST_SPEC, Owner: SYSDBA */
CREATE TABLE DCL_CON_LIST_SPEC (SPC_ID INTEGER NOT NULL,
        CON_ID INTEGER NOT NULL,
        SPC_NUMBER VARCHAR(50),
        SPC_DATE DATE,
        SPC_SUMM DECIMAL(15, 2),
        SPC_SUMM_NDS DECIMAL(15, 2),
        SPC_EXECUTED SMALLINT,
        SPC_NDS_RATE DECIMAL(15, 2),
        SPC_DELIVERY_DATE DATE,
        SPC_ADD_PAY_COND VARCHAR(5000),
        SPC_ORIGINAL SMALLINT,
        SPC_MONTAGE SMALLINT,
        SPC_GROUP_DELIVERY SMALLINT,
        SPC_DELIVERY_COND VARCHAR(5000),
        SPC_DELIVERY_TERM_TYPE SMALLINT,
        SPC_PERCENT_OR_SUM SMALLINT,
        SPC_DELIVERY_PERCENT DECIMAL(15, 2),
        SPC_DELIVERY_SUM DECIMAL(15, 2),
        SPC_PAY_AFTER_MONTAGE SMALLINT,
        SPC_ANNUL SMALLINT,
        SPC_ANNUL_DATE DATE,
        SPC_COMMENT VARCHAR(5000),
        USR_ID INTEGER,
        SPC_LETTER1_DATE DATE,
        SPC_LETTER2_DATE DATE,
        SPC_LETTER3_DATE DATE,
        SPC_COMPLAINT_IN_COURT_DATE DATE,
        SPC_ADDITIONAL_DAYS_COUNT INTEGER,
CONSTRAINT PK_DCL_CON_LIST_SPEC PRIMARY KEY (SPC_ID));

/* Table: DCL_CON_MESSAGE, Owner: SYSDBA */
CREATE TABLE DCL_CON_MESSAGE (CMS_ID INTEGER NOT NULL,
        CON_ID INTEGER,
        SPC_ID INTEGER,
        USR_ID INTEGER NOT NULL,
        CMS_CREATE_DATE TIMESTAMP NOT NULL,
        CMS_MESSAGE VARCHAR(256),
        CTR_ID INTEGER,
CONSTRAINT PK_DCL_CON_MESSAGE PRIMARY KEY (CMS_ID));

/* Table: DCL_COUNTRY, Owner: SYSDBA */
CREATE TABLE DCL_COUNTRY (CUT_ID INTEGER NOT NULL,
        CUT_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        CUT_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        CUT_NAME VARCHAR(50) NOT NULL,
CONSTRAINT PK_DCL_COUNTRY PRIMARY KEY (CUT_ID));

/* Table: DCL_CPR_LIST_PRODUCE, Owner: SYSDBA */
CREATE TABLE DCL_CPR_LIST_PRODUCE (LPR_ID INTEGER NOT NULL,
        CPR_ID INTEGER NOT NULL,
        LPR_PRODUCE_NAME VARCHAR(1000),
        LPR_PRICE_NETTO DECIMAL(15, 2),
        LPR_COUNT DECIMAL(15, 2),
        CUS_ID INTEGER,
        LPR_COEFICIENT DECIMAL(18, 8),
        LPR_CATALOG_NUM VARCHAR(50),
        STF_ID INTEGER,
        PRD_ID INTEGER,
        LPR_COMMENT VARCHAR(5000),
        LPC_ID INTEGER,
        LPR_SALE_PRICE DECIMAL(15, 2),
        LPR_SALE_COST_PARKING_TRANS DECIMAL(15, 2),
        LPR_PRICE_BRUTTO DECIMAL(15, 2),
        LPR_DISCOUNT DECIMAL(15, 2),
CONSTRAINT PK_DCL_CPR_LIST_PRODUCE PRIMARY KEY (LPR_ID));

/* Table: DCL_CPR_TRANSPORT, Owner: SYSDBA */
CREATE TABLE DCL_CPR_TRANSPORT (TRN_ID INTEGER NOT NULL,
        CPR_ID INTEGER NOT NULL,
        STF_ID INTEGER,
        TRN_SUM DECIMAL(15, 2) NOT NULL,
CONSTRAINT PK_DCL_CPR_TRANSPORT PRIMARY KEY (TRN_ID));

/* Table: DCL_CRQ_ORD_LINK, Owner: SYSDBA */
CREATE TABLE DCL_CRQ_ORD_LINK (CRQ_ID INTEGER NOT NULL,
        ORD_ID INTEGER NOT NULL);

/* Table: DCL_CRQ_PRINT, Owner: SYSDBA */
CREATE TABLE DCL_CRQ_PRINT (CRP_ID INTEGER NOT NULL,
        CRQ_ID INTEGER NOT NULL,
        CRP_RECLAMATION_DATE DATE,
        CRP_LINTERA_REQUEST_DATE DATE,
        CRP_NO_DEFECT_ACT SMALLINT,
        CRP_LINTERA_AGREEMENT_DATE DATE,
        CRP_DELIVER SMALLINT,
        CRP_NO_RECLAMATION_ACT SMALLINT,
CONSTRAINT PK_DCL_CRQ_PRINT PRIMARY KEY (CRP_ID));

/* Table: DCL_CRQ_STAGE, Owner: SYSDBA */
CREATE TABLE DCL_CRQ_STAGE (CRS_ID INTEGER NOT NULL,
        CRQ_ID INTEGER NOT NULL,
        CRS_NAME VARCHAR(500) NOT NULL,
        CRS_COMMENT VARCHAR(2000),
        CRS_PRINT SMALLINT,
CONSTRAINT PK_DCL_CRQ_STAGE PRIMARY KEY (CRS_ID));

/* Table: DCL_CTC_LIST, Owner: SYSDBA */
CREATE TABLE DCL_CTC_LIST (LCC_ID INTEGER NOT NULL,
        CTC_ID INTEGER NOT NULL,
        SPC_ID INTEGER NOT NULL,
        LCC_CHARGES DECIMAL(15, 2) NOT NULL,
        LCC_MONTAGE DECIMAL(15, 2) NOT NULL,
        LCC_TRANSPORT DECIMAL(15, 2) NOT NULL,
        LCC_UPDATE_SUM DECIMAL(15, 2) NOT NULL,
CONSTRAINT PK_DCL_CTC_LIST PRIMARY KEY (LCC_ID));

/* Table: DCL_CTC_PAY, Owner: SYSDBA */
CREATE TABLE DCL_CTC_PAY (LCC_ID INTEGER NOT NULL,
        LPS_ID INTEGER NOT NULL,
CONSTRAINT PK_DCL_CTC_PAY_LCC PRIMARY KEY (LPS_ID, LCC_ID));

/* Table: DCL_CTC_SHP, Owner: SYSDBA */
CREATE TABLE DCL_CTC_SHP (LCC_ID INTEGER NOT NULL,
        SHP_ID INTEGER NOT NULL,
CONSTRAINT PK_DCL_LCC_SHP PRIMARY KEY (SHP_ID, LCC_ID));

/* Table: DCL_CURRENCY, Owner: SYSDBA */
CREATE TABLE DCL_CURRENCY (CUR_ID INTEGER NOT NULL,
        CUR_NAME VARCHAR(10) NOT NULL,
        CUR_NO_ROUND SMALLINT,
        CUR_SORT_ORDER SMALLINT,
CONSTRAINT PK_DCL_CURRENCY PRIMARY KEY (CUR_ID));

/* Table: DCL_CURRENCY_RATE, Owner: SYSDBA */
CREATE TABLE DCL_CURRENCY_RATE (CRT_ID INTEGER NOT NULL,
        CUR_ID INTEGER NOT NULL,
        CRT_DATE DATE NOT NULL,
        CRT_RATE DECIMAL(15, 6) NOT NULL,
CONSTRAINT PK_DCL_CURRENCY_RATE PRIMARY KEY (CRT_ID));

/* Table: DCL_CUSTOM_CODE, Owner: SYSDBA */
CREATE TABLE DCL_CUSTOM_CODE (CUS_ID INTEGER NOT NULL,
        CUS_CODE VARCHAR(10) NOT NULL,
        CUS_DESCRIPTION VARCHAR(500),
        CUS_PERCENT DECIMAL(15, 2) NOT NULL,
        CUS_INSTANT TIMESTAMP NOT NULL,
        CUS_CREATE_DATE TIMESTAMP,
        CUS_ID_CREATE INTEGER,
        CUS_EDIT_DATE TIMESTAMP,
        CUS_ID_EDIT INTEGER,
        USR_CREATE_DATE TIMESTAMP,
        USR_ID_CREATE INTEGER,
        USR_EDIT_DATE TIMESTAMP,
        USR_ID_EDIT INTEGER,
        CUS_LAW_240_FLAG SMALLINT,
        CUS_BLOCK SMALLINT,
CONSTRAINT PK_DCL_CUSTOM_CODE PRIMARY KEY (CUS_ID),
CONSTRAINT PK_DCL_CUSTOM_CODE_CI UNIQUE (CUS_CODE, CUS_INSTANT));

/* Table: DCL_CUS_CODE_HISTORY, Owner: SYSDBA */
CREATE TABLE DCL_CUS_CODE_HISTORY (ID INTEGER NOT NULL,
        PRD_ID INTEGER NOT NULL,
        CUS_CODE VARCHAR(10) NOT NULL,
        DATE_CREATED TIMESTAMP NOT NULL,
CONSTRAINT PK_DCL_CUS_CODE_HISTORY PRIMARY KEY (ID));

/* Table: DCL_DELIVERY_REQUEST, Owner: SYSDBA */
CREATE TABLE DCL_DELIVERY_REQUEST (DLR_ID INTEGER NOT NULL,
        DLR_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        DLR_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        DLR_PLACE_DATE TIMESTAMP,
        USR_ID_PLACE INTEGER,
        DLR_NUMBER VARCHAR(20) NOT NULL,
        DLR_DATE DATE NOT NULL,
        DLR_FAIR_TRADE SMALLINT,
        DLR_WHEREFROM VARCHAR(100),
        DLR_COMMENT VARCHAR(5000),
        DLR_PLACE_REQUEST SMALLINT,
        DLR_INCLUDE_IN_SPEC SMALLINT,
        DLR_ANNUL SMALLINT,
        DLR_NEED_DELIVER SMALLINT,
        DLR_ORD_NOT_FORM SMALLINT,
        DLR_EXECUTED SMALLINT,
        DLR_GUARANTEE_REPAIR SMALLINT,
        DLR_MINSK SMALLINT,
CONSTRAINT PK_DCL_DELIVERY_REQUEST PRIMARY KEY (DLR_ID));

/* Table: DCL_DEPARTMENT, Owner: SYSDBA */
CREATE TABLE DCL_DEPARTMENT (DEP_ID INTEGER NOT NULL,
        DEP_NAME VARCHAR(100) NOT NULL,
CONSTRAINT PK_DCL_DEPARTMENT PRIMARY KEY (DEP_ID));

/* Table: DCL_DLR_LIST_PRODUCE, Owner: SYSDBA */
CREATE TABLE DCL_DLR_LIST_PRODUCE (DRP_ID INTEGER NOT NULL,
        DLR_ID INTEGER NOT NULL,
        PRD_ID INTEGER NOT NULL,
        OPR_ID INTEGER,
        DRP_PRICE DECIMAL(15, 2) NOT NULL,
        DRP_COUNT DECIMAL(15, 2) NOT NULL,
        STF_ID INTEGER NOT NULL,
        CTR_ID INTEGER,
        PRS_ID INTEGER,
        DRP_PURPOSE VARCHAR(500),
        SIP_ID INTEGER,
        RECEIVE_MANAGER_ID INTEGER,
        RECEIVE_DATE DATE,
        APR_ID INTEGER,
        ASM_ID INTEGER,
        DRP_MAX_EXTRA SMALLINT,
        SPC_ID INTEGER,
CONSTRAINT PK_DCL_DLR_LIST_PRODUCE PRIMARY KEY (DRP_ID));

/* Table: DCL_FIELD_COMMENT, Owner: SYSDBA */
CREATE TABLE DCL_FIELD_COMMENT (FCM_ID INTEGER NOT NULL,
        FCM_KEY VARCHAR(124) NOT NULL,
        FCM_VALUE VARCHAR(4000),
CONSTRAINT PK_DCL_FIELD_COMMENT PRIMARY KEY (FCM_ID));

/* Table: DCL_FILES_PATH, Owner: SYSDBA */
CREATE TABLE DCL_FILES_PATH (FLP_ID INTEGER NOT NULL,
        FLP_TABLE_NAME VARCHAR(32) NOT NULL,
        FLP_PATH VARCHAR(1024) NOT NULL,
        FLP_DESCRIPTION VARCHAR(200),
CONSTRAINT PK_DCL_FILES_PATH PRIMARY KEY (FLP_ID));

/* Table: DCL_INF_MESSAGE, Owner: SYSDBA */
CREATE TABLE DCL_INF_MESSAGE (INM_ID INTEGER NOT NULL,
        USR_ID INTEGER NOT NULL,
        INM_CREATE_DATE TIMESTAMP NOT NULL,
        INM_MESSAGE VARCHAR(5000),
CONSTRAINT PK_DCL_INF_MESSAGE PRIMARY KEY (INM_ID));

/* Table: DCL_INSTRUCTION, Owner: SYSDBA */
CREATE TABLE DCL_INSTRUCTION (INS_ID INTEGER NOT NULL,
        INS_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        INS_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        IST_ID INTEGER NOT NULL,
        INS_NUMBER VARCHAR(100),
        INS_DATE_SIGN DATE NOT NULL,
        INS_DATE_FROM DATE NOT NULL,
        INS_DATE_TO DATE,
        INS_CONCERNING VARCHAR(5000),
CONSTRAINT PK_DCL_INSTRUCTION PRIMARY KEY (INS_ID));

/* Table: DCL_INSTRUCTION_TYPE, Owner: SYSDBA */
CREATE TABLE DCL_INSTRUCTION_TYPE (IST_ID INTEGER NOT NULL,
        IST_NAME VARCHAR(200) NOT NULL,
CONSTRAINT PK_DCL_INSTRUCTION_TYPE PRIMARY KEY (IST_ID));

/* Table: DCL_LANGUAGE, Owner: SYSDBA */
CREATE TABLE DCL_LANGUAGE (LNG_ID INTEGER NOT NULL,
        LNG_NAME VARCHAR(32) NOT NULL,
        LNG_LETTER_ID VARCHAR(2) NOT NULL,
CONSTRAINT PK_DCL_LANGUAGE PRIMARY KEY (LNG_ID));

/* Table: DCL_LOG, Owner: SYSDBA */
CREATE TABLE DCL_LOG (LOG_ID INTEGER NOT NULL,
        ACT_ID INTEGER NOT NULL,
        USR_ID INTEGER NOT NULL,
        LOG_TIME TIMESTAMP NOT NULL,
        LOG_IP VARCHAR(20) NOT NULL,
CONSTRAINT PK_DCL_LOG PRIMARY KEY (LOG_ID));

/* Table: DCL_LPS_LIST_MANAGER, Owner: SYSDBA */
CREATE TABLE DCL_LPS_LIST_MANAGER (LMN_ID INTEGER NOT NULL,
        LPS_ID INTEGER NOT NULL,
        USR_ID INTEGER NOT NULL,
        LMN_PERCENT DECIMAL(3, 0) NOT NULL,
CONSTRAINT PK_DCL_LPS_LIST_MANAGER PRIMARY KEY (LMN_ID));

/* Table: DCL_MONTAGE_ADJUSTMENT, Owner: SYSDBA */
CREATE TABLE DCL_MONTAGE_ADJUSTMENT (MAD_ID INTEGER NOT NULL,
        STF_ID INTEGER NOT NULL,
        MAD_MACHINE_TYPE VARCHAR(1000) NOT NULL,
        MAD_COMPLEXITY VARCHAR(10) NOT NULL,
        MAD_ANNUL SMALLINT,
CONSTRAINT PK_DCL_MONTAGE_ADJUSTMENT PRIMARY KEY (MAD_ID));

/* Table: DCL_MONTAGE_ADJUSTMENT_H, Owner: SYSDBA */
CREATE TABLE DCL_MONTAGE_ADJUSTMENT_H (MADH_ID INTEGER NOT NULL,
        MAD_ID INTEGER NOT NULL,
        MAD_DATE_FROM DATE NOT NULL,
        MAD_MECH_WORK_TARIFF DECIMAL(15, 1) NOT NULL,
        MAD_MECH_WORK_RULE_MONTAGE DECIMAL(15, 1) NOT NULL,
        MAD_MECH_WORK_RULE_ADJUSTMENT DECIMAL(15, 1) NOT NULL,
        MAD_MECH_ROAD_TARIFF DECIMAL(15, 1) NOT NULL,
        MAD_MECH_ROAD_RULE DECIMAL(15, 1) NOT NULL,
        MAD_EL_WORK_TARIFF DECIMAL(15, 1) NOT NULL,
        MAD_EL_WORK_RULE_MONTAGE DECIMAL(15, 1) NOT NULL,
        MAD_EL_WORK_RULE_ADJUSTMENT DECIMAL(15, 1) NOT NULL,
        MAD_EL_ROAD_TARIFF DECIMAL(15, 1) NOT NULL,
        MAD_EL_ROAD_RULE DECIMAL(15, 1) NOT NULL,
        MAD_MECH_TOTAL DECIMAL(15, 1) NOT NULL,
        MAD_EL_TOTAL DECIMAL(15, 1) NOT NULL,
CONSTRAINT PK_DCL_MONTAGE_ADJUSTMENT_H PRIMARY KEY (MADH_ID));

/* Table: DCL_OPR_LIST_EXECUTED, Owner: SYSDBA */
CREATE TABLE DCL_OPR_LIST_EXECUTED (OPR_ID INTEGER NOT NULL,
        OPR_COUNT_EXECUTED DECIMAL(15, 2),
        OPR_DATE_EXECUTED DATE,
        OPR_FICTIVE_EXECUTED SMALLINT);

/* Table: DCL_ORDER, Owner: SYSDBA */
CREATE TABLE DCL_ORDER (ORD_ID INTEGER NOT NULL,
        ORD_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        ORD_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        ORD_NUMBER VARCHAR(15) NOT NULL,
        ORD_DATE DATE NOT NULL,
        CTR_ID INTEGER NOT NULL,
        CPS_ID INTEGER,
        ORD_CONCERNING VARCHAR(1000),
        ORD_PREAMBLE VARCHAR(1000),
        TRM_ID INTEGER,
        ORD_ADDR VARCHAR(256),
        ORD_PAY_CONDITION VARCHAR(300),
        ORD_DELIVERY_TERM VARCHAR(300),
        ORD_ADD_INFO VARCHAR(5000),
        USR_ID_DIRECTOR INTEGER,
        USR_ID_LOGIST INTEGER,
        USR_ID_DIRECTOR_RB INTEGER,
        USR_ID_CHIEF_DEP INTEGER,
        USR_ID_MANAGER INTEGER,
        CTR_ID_FOR INTEGER,
        SPC_ID INTEGER,
        STF_ID INTEGER NOT NULL,
        ORD_SENT_TO_PROD_DATE DATE,
        ORD_RECEIVED_CONF_DATE DATE,
        ORD_NUM_CONF VARCHAR(200),
        ORD_DATE_CONF DATE,
        ORD_CONF_SENT_DATE DATE,
        ORD_EXECUTED_DATE DATE,
        ORD_SUMM DECIMAL(15, 2),
        ORD_BLOCK SMALLINT,
        ORD_DELIVERY_COST_BY VARCHAR(50),
        ORD_DELIVERY_COST DECIMAL(15, 2),
        ORD_DONOT_CALCULATE_NETTO SMALLINT,
        CUR_ID INTEGER NOT NULL,
        ORD_INCLUDE_NDS SMALLINT,
        ORD_NDS_RATE DECIMAL(15, 2),
        ORD_DISCOUNT_ALL SMALLINT,
        ORD_DISCOUNT DECIMAL(15, 2),
        ORD_COUNT_ITOG_FLAG SMALLINT,
        ORD_ADD_REDUCTION_FLAG SMALLINT,
        ORD_ADD_REDUCTION DECIMAL(15, 2),
        ORD_ADD_RED_PRE_PAY_FLAG SMALLINT,
        ORD_ADD_RED_PRE_PAY DECIMAL(15, 2),
        ORD_ALL_INCLUDE_IN_SPEC SMALLINT,
        ORD_ANNUL SMALLINT,
        ORD_READY_FOR_DELIV_DATE DATE,
        ORD_IN_ONE_SPEC SMALLINT,
        ORD_COMMENT VARCHAR(3000),
        ORD_DATE_CONF_ALL SMALLINT,
        ORD_READY_FOR_DELIV_DATE_ALL SMALLINT,
        SDT_ID INTEGER,
        ORD_SHP_DOC_NUMBER VARCHAR(60),
        ORD_BY_GUARANTY SMALLINT,
        BLN_ID INTEGER NOT NULL,
        ORD_ARRIVE_IN_LITHUANIA DATE,
        ORD_SHIP_FROM_STOCK DATE,
        ORD_PRINT_SCALE INTEGER,
        ORD_LETTER_SCALE INTEGER,
        ORD_COMMENT_COVERING_LETTER VARCHAR(1000),
        SLN_ID INTEGER,
        SLN_ID_FOR_WHO INTEGER NOT NULL,
        ORD_LOGIST_SIGNATURE SMALLINT,
        ORD_DIRECTOR_RB_SIGNATURE SMALLINT,
        ORD_CHIEF_DEP_SIGNATURE SMALLINT,
        ORD_MANAGER_SIGNATURE SMALLINT,
CONSTRAINT PK_DCL_ORDER PRIMARY KEY (ORD_ID));

/* Table: DCL_ORD_LIST_PAYMENT, Owner: SYSDBA */
CREATE TABLE DCL_ORD_LIST_PAYMENT (ORP_ID INTEGER NOT NULL,
        ORD_ID INTEGER NOT NULL,
        ORP_PERCENT DECIMAL(11, 5) NOT NULL,
        ORP_SUM DECIMAL(15, 2) NOT NULL,
        ORP_DATE DATE,
CONSTRAINT PK_DCL_ORD_LIST_PAYMENT PRIMARY KEY (ORP_ID));

/* Table: DCL_ORD_LIST_PAY_SUM, Owner: SYSDBA */
CREATE TABLE DCL_ORD_LIST_PAY_SUM (OPS_ID INTEGER NOT NULL,
        ORD_ID INTEGER NOT NULL,
        OPS_SUM DECIMAL(15, 2) NOT NULL,
        OPS_DATE DATE,
CONSTRAINT PK_DCL_ORD_LIST_PAY_SUM PRIMARY KEY (OPS_ID));

/* Table: DCL_ORD_LIST_PRODUCE, Owner: SYSDBA */
CREATE TABLE DCL_ORD_LIST_PRODUCE (OPR_ID INTEGER NOT NULL,
        ORD_ID INTEGER NOT NULL,
        OPR_PRODUCE_NAME VARCHAR(1000),
        OPR_CATALOG_NUM VARCHAR(50),
        OPR_COUNT DECIMAL(15, 2),
        OPR_PRICE_BRUTTO DECIMAL(15, 2),
        OPR_DISCOUNT DECIMAL(15, 2),
        OPR_PRICE_NETTO DECIMAL(15, 2),
        OPR_SUMM DECIMAL(15, 2),
        OPR_USE_PREV_NUMBER CHAR(1),
        PRD_ID INTEGER NOT NULL,
        OPR_COMMENT VARCHAR(5000),
        DRP_PRICE DECIMAL(15, 2),
        CTR_ID INTEGER,
        SPC_ID INTEGER,
        OPR_PARENT_ID INTEGER,
        OPR_HAVE_DEPEND SMALLINT,
        DRP_MAX_EXTRA SMALLINT,
CONSTRAINT PK_DCL_ORD_LIST_PRODUCE PRIMARY KEY (OPR_ID));

/* Table: DCL_ORD_MESSAGE, Owner: SYSDBA */
CREATE TABLE DCL_ORD_MESSAGE (ORM_ID INTEGER NOT NULL,
        ORD_ID INTEGER NOT NULL,
        USR_ID INTEGER NOT NULL,
        ORM_CREATE_DATE TIMESTAMP NOT NULL,
        ORM_MESSAGE VARCHAR(256),
        PRC_ID INTEGER,
CONSTRAINT PK_DCL_ORD_MESSAGE PRIMARY KEY (ORM_ID));

/* Table: DCL_OUTGOING_LETTER, Owner: SYSDBA */
CREATE TABLE DCL_OUTGOING_LETTER (OTL_ID INTEGER NOT NULL,
        OTL_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        OTL_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        OTL_NUMBER VARCHAR(15) NOT NULL,
        OTL_DATE DATE NOT NULL,
        CTR_ID INTEGER NOT NULL,
        CPS_ID INTEGER,
        OTL_COMMENT VARCHAR(5000),
        SLN_ID INTEGER NOT NULL,
CONSTRAINT PK_DCL_OUTGOING_LETTER PRIMARY KEY (OTL_ID));

/* Table: DCL_PAYMENT, Owner: SYSDBA */
CREATE TABLE DCL_PAYMENT (PAY_ID INTEGER NOT NULL,
        PAY_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        PAY_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        PAY_DATE DATE NOT NULL,
        PAY_ACCOUNT VARCHAR(35),
        PAY_SUMM DECIMAL(15, 2) NOT NULL,
        CUR_ID INTEGER NOT NULL,
        PAY_COURSE DECIMAL(15, 6),
        CTR_ID INTEGER,
        PAY_BLOCK SMALLINT,
        PAY_COMMENT VARCHAR(500),
        PAY_COURSE_NBRB DECIMAL(15, 6),
        PAY_COURSE_NBRB_DATE DATE,
CONSTRAINT PK_DCL_PAYMENT PRIMARY KEY (PAY_ID));

/* Table: DCL_PAY_LIST_SUMM, Owner: SYSDBA */
CREATE TABLE DCL_PAY_LIST_SUMM (LPS_ID INTEGER NOT NULL,
        PAY_ID INTEGER NOT NULL,
        SPC_ID INTEGER NOT NULL,
        LPS_SUMM DECIMAL(15, 2),
        LPS_SUMM_EUR DECIMAL(15, 2),
        LPS_SUMM_OUT_NDS DECIMAL(15, 2),
CONSTRAINT PK_DCL_PAY_LIST_SUMM PRIMARY KEY (LPS_ID));

/* Table: DCL_PAY_MESSAGE, Owner: SYSDBA */
CREATE TABLE DCL_PAY_MESSAGE (PMS_ID INTEGER NOT NULL,
        PAY_ID INTEGER NOT NULL,
        USR_ID INTEGER NOT NULL,
        PMS_CREATE_DATE TIMESTAMP NOT NULL,
        PMS_MESSAGE VARCHAR(512),
        PMS_SUM DECIMAL(15, 2) NOT NULL,
        CTR_ID INTEGER,
        PMS_PERCENT DECIMAL(15, 2),
        PMS_CHECK_FOR_DELETE SMALLINT,
        PMS_UPDATED SMALLINT,
        CUR_ID INTEGER,
        PMS_NO_CURATOR SMALLINT,
CONSTRAINT PK_DCL_PAY_MESSAGE PRIMARY KEY (PMS_ID));

/* Table: DCL_PRC_CTR_FOR_CALCSTATE, Owner: SYSDBA */
CREATE TABLE DCL_PRC_CTR_FOR_CALCSTATE (LPC_ID INTEGER NOT NULL,
        PRC_ID INTEGER NOT NULL,
        CTR_ID INTEGER NOT NULL,
        CON_ID INTEGER,
        SPC_ID INTEGER,
CONSTRAINT PK_DCL_PRC_CTR_FOR_CALCSTATE PRIMARY KEY (LPC_ID));

/* Table: DCL_PRC_LIST_PRODUCE, Owner: SYSDBA */
CREATE TABLE DCL_PRC_LIST_PRODUCE (LPC_ID INTEGER NOT NULL,
        PRC_ID INTEGER NOT NULL,
        LPC_PRODUCE_NAME VARCHAR(1000),
        STF_ID INTEGER NOT NULL,
        USR_ID INTEGER,
        LPC_COUNT DECIMAL(15, 2),
        LPC_COST_ONE DECIMAL(15, 2),
        LPC_WEIGHT DECIMAL(15, 3),
        LPC_SUMM DECIMAL(15, 2),
        LPC_SUM_TRANSPORT DECIMAL(15, 2),
        LPC_CUSTOM DECIMAL(15, 2),
        PRS_ID INTEGER NOT NULL,
        PRD_ID INTEGER NOT NULL,
        LPC_COST_ONE_LTL DECIMAL(15, 2),
        OPR_ID INTEGER,
        DRP_ID INTEGER,
        SIP_ID INTEGER,
        LPC_1C_NUMBER VARCHAR(12),
        LPC_PERCENT VARCHAR(12),
        APR_ID INTEGER,
        ASM_ID INTEGER,
        LPC_COMMENT VARCHAR(1000),
        DEP_ID INTEGER,
        LPC_COST_ONE_BY DECIMAL(15, 2) NOT NULL,
        LPC_PRICE_LIST_BY DECIMAL(15, 2),
CONSTRAINT PK_DCL_PRC_LIST_PRODUCE PRIMARY KEY (LPC_ID));

/* Table: DCL_PRODUCE, Owner: SYSDBA */
CREATE TABLE DCL_PRODUCE (PRD_ID INTEGER NOT NULL,
        CAT_ID INTEGER NOT NULL,
        PRD_NAME VARCHAR(1000),
        PRD_TYPE VARCHAR(200),
        PRD_PARAMS VARCHAR(200),
        PRD_ADD_PARAMS VARCHAR(200),
        UNT_ID INTEGER,
        CUS_CODE VARCHAR(10),
        PRD_BLOCK SMALLINT,
        PRD_CREATE_DATE TIMESTAMP,
        USR_ID_CREATE INTEGER,
        PRD_EDIT_DATE TIMESTAMP,
        USR_ID_EDIT INTEGER,
        PRD_BLOCK_DATE TIMESTAMP,
        USR_ID_BLOCK INTEGER,
        PRD_MATERIAL VARCHAR(5000),
        PRD_PURPOSE VARCHAR(5000),
        PRD_SPECIFICATION VARCHAR(5000),
        PRD_PRINCIPLE VARCHAR(5000),
        PRD_NOT_CHECK_DOUBLE SMALLINT,
CONSTRAINT PK_DCL_PRODUCE PRIMARY KEY (PRD_ID));

/* Table: DCL_PRODUCE_COST, Owner: SYSDBA */
CREATE TABLE DCL_PRODUCE_COST (PRC_ID INTEGER NOT NULL,
        PRC_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        PRC_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        PRC_NUMBER VARCHAR(50) NOT NULL,
        PRC_DATE DATE NOT NULL,
        RUT_ID INTEGER NOT NULL,
        PRC_SUM_TRANSPORT DECIMAL(15, 2),
        PRC_BLOCK SMALLINT,
        PRC_COURSE_LTL_EUR DECIMAL(15, 4),
        PRC_WEIGHT DECIMAL(15, 2),
CONSTRAINT PK_DCL_PRODUCE_COST PRIMARY KEY (PRC_ID));

/* Table: DCL_PRODUCE_COST_CUSTOM, Owner: SYSDBA */
CREATE TABLE DCL_PRODUCE_COST_CUSTOM (PRC_ID INTEGER NOT NULL,
        LPC_PERCENT DECIMAL(15, 2),
        LPC_SUMM DECIMAL(15, 2),
        LPC_SUMM_ALLOCATION DECIMAL(15, 2));

/* Table: DCL_PRODUCE_LANGUAGE, Owner: SYSDBA */
CREATE TABLE DCL_PRODUCE_LANGUAGE (PRD_ID INTEGER NOT NULL,
        LNG_ID INTEGER NOT NULL,
        PRD_LNG_NAME VARCHAR(1000),
CONSTRAINT PK_DCL_PRODUCE_LANGUAGE PRIMARY KEY (PRD_ID, LNG_ID));

/* Table: DCL_PRODUCTION_TERM, Owner: SYSDBA */
CREATE TABLE DCL_PRODUCTION_TERM (PTR_ID INTEGER NOT NULL,
        OPR_ID INTEGER NOT NULL,
        PTR_COUNT DECIMAL(15, 3) NOT NULL,
        PTR_DATE DATE NOT NULL,
        PTR_COMMENT VARCHAR(900),
CONSTRAINT PK_DCL_PRODUCTION_TERM PRIMARY KEY (PTR_ID));

/* Table: DCL_PURCHASE_PURPOSE, Owner: SYSDBA */
CREATE TABLE DCL_PURCHASE_PURPOSE (PPS_ID INTEGER NOT NULL,
        PPS_NAME VARCHAR(200) NOT NULL,
CONSTRAINT PK_DCL_PURCHASE_PURPOSE PRIMARY KEY (PPS_ID));

/* Table: DCL_PURPOSE, Owner: SYSDBA */
CREATE TABLE DCL_PURPOSE (PRS_ID INTEGER NOT NULL,
        PRS_NAME VARCHAR(200) NOT NULL,
CONSTRAINT PK_DCL_PURPOSE PRIMARY KEY (PRS_ID));

/* Table: DCL_RATE_NDS, Owner: SYSDBA */
CREATE TABLE DCL_RATE_NDS (RTN_ID INTEGER NOT NULL,
        RTN_DATE_FROM DATE NOT NULL,
        RTN_PERCENT DECIMAL(15, 2),
CONSTRAINT PK_DCL_RATE_NDS PRIMARY KEY (RTN_ID));

/* Table: DCL_READY_FOR_SHIPPING, Owner: SYSDBA */
CREATE TABLE DCL_READY_FOR_SHIPPING (RFS_ID INTEGER NOT NULL,
        OPR_ID INTEGER NOT NULL,
        SDT_ID INTEGER NOT NULL,
        RFS_NUMBER VARCHAR(60) NOT NULL,
        RFS_COUNT DECIMAL(15, 3) NOT NULL,
        RFS_DATE DATE NOT NULL,
        RFS_WEIGHT DECIMAL(15, 3),
        RFS_GABARIT VARCHAR(300),
        RFS_COMMENT VARCHAR(900),
        RFS_ARRIVE_IN_LITHUANIA DATE,
        RFS_SHIP_FROM_STOCK DATE,
CONSTRAINT PK_DCL_READY_FOR_SHIPPING PRIMARY KEY (RFS_ID));

/* Table: DCL_REPUTATION, Owner: SYSDBA */
CREATE TABLE DCL_REPUTATION (RPT_ID INTEGER NOT NULL,
        RPT_LEVEL SMALLINT NOT NULL,
        RPT_DESCRIPTION VARCHAR(500) NOT NULL,
        RPT_DEFAULT_IN_CTC SMALLINT,
CONSTRAINT PK_DCL_REPUTATION PRIMARY KEY (RPT_ID));

/* Table: DCL_RESTS_IN_MINSK_TEMPORARY, Owner: SYSDBA */
CREATE TABLE DCL_RESTS_IN_MINSK_TEMPORARY (ID INTEGER,
        DATE_CREATED TIMESTAMP,
        QUANTITY DECIMAL(15, 2),
        CONTRACTOR_NAME VARCHAR(200),
        SPECIFICATION_NUMBER VARCHAR(50),
        CONTRACT_NUMBER VARCHAR(50));

/* Table: DCL_ROLE, Owner: SYSDBA */
CREATE TABLE DCL_ROLE (ROL_ID INTEGER NOT NULL,
        ROL_NAME VARCHAR(32) NOT NULL,
CONSTRAINT PK_DCL_ROLE PRIMARY KEY (ROL_ID));

/* Table: DCL_ROUTE, Owner: SYSDBA */
CREATE TABLE DCL_ROUTE (RUT_ID INTEGER NOT NULL,
        RUT_NAME VARCHAR(150) NOT NULL,
CONSTRAINT PK_DCL_ROUTE PRIMARY KEY (RUT_ID));

/* Table: DCL_SELLER, Owner: SYSDBA */
CREATE TABLE DCL_SELLER (SLN_ID INTEGER NOT NULL,
        SLN_NAME VARCHAR(100) NOT NULL,
        SLN_USED_IN_ORDER SMALLINT,
        SLN_PREFIX_FOR_ORDER VARCHAR(10),
        SLN_IS_RESIDENT SMALLINT,
CONSTRAINT PK_DCL_SELLER PRIMARY KEY (SLN_ID));

/* Table: DCL_SETTING, Owner: SYSDBA */
CREATE TABLE DCL_SETTING (STN_ID INTEGER NOT NULL,
        STN_NAME VARCHAR(100) NOT NULL,
        STN_DESCRIPTION VARCHAR(256),
        STN_VALUE VARCHAR(1000),
        STN_TYPE SMALLINT NOT NULL,
        STN_ACTION VARCHAR(100),
        STN_VALUE_EXTENDED VARCHAR(1000),
CONSTRAINT PK_DCL_SETTING PRIMARY KEY (STN_ID));

/* Table: DCL_SHIPPING, Owner: SYSDBA */
CREATE TABLE DCL_SHIPPING (SHP_ID INTEGER NOT NULL,
        SHP_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        SHP_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        SHP_NUMBER VARCHAR(50) NOT NULL,
        SHP_DATE DATE NOT NULL,
        SPC_ID INTEGER,
        SHP_SUMM_PLUS_NDS DECIMAL(15, 2) NOT NULL,
        CUR_ID INTEGER NOT NULL,
        SHP_BLOCK SMALLINT,
        CTR_ID INTEGER NOT NULL,
        SHP_DATE_EXPIRATION DATE,
        SHP_LETTER1_DATE DATE,
        SHP_LETTER2_DATE DATE,
        SHP_LETTER3_DATE DATE,
        SHP_COMPLAINT_IN_COURT_DATE DATE,
        SHP_COMMENT VARCHAR(3000),
        SHP_MONTAGE SMALLINT,
        CTR_ID_WHERE INTEGER,
        CON_ID_WHERE INTEGER,
        SHP_NOTICE_DATE DATE,
        SHP_SERIAL_NUM_YEAR_OUT SMALLINT,
        SHP_SUMM_TRANSPORT DECIMAL(15, 2),
        SHP_ORIGINAL SMALLINT,
        SHP_SUM_UPDATE DECIMAL(15, 2),
CONSTRAINT PK_DCL_SHIPPING PRIMARY KEY (SHP_ID));

/* Table: DCL_SHP_DOC_TYPE, Owner: SYSDBA */
CREATE TABLE DCL_SHP_DOC_TYPE (SDT_ID INTEGER NOT NULL,
        SDT_NAME VARCHAR(100) NOT NULL,
CONSTRAINT PK_DCL_SHP_DOC_TYPE PRIMARY KEY (SDT_ID));

/* Table: DCL_SHP_LIST_PRODUCE, Owner: SYSDBA */
CREATE TABLE DCL_SHP_LIST_PRODUCE (LPS_ID INTEGER NOT NULL,
        SHP_ID INTEGER NOT NULL,
        LPC_ID INTEGER NOT NULL,
        STF_ID INTEGER NOT NULL,
        LPS_COUNT DECIMAL(15, 2),
        LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
        LPS_ENTER_IN_USE_DATE DATE,
        LPS_MONTAGE_TIME DECIMAL(15, 1),
        LPS_MONTAGE_OFF SMALLINT,
        SHP_DATE DATE NOT NULL,
        LPS_SERIAL_NUM VARCHAR(100),
        LPS_YEAR_OUT VARCHAR(30),
        LPR_ID INTEGER,
CONSTRAINT PK_DCL_SHP_LIST_PRODUCE PRIMARY KEY (LPS_ID));

/* Table: DCL_SPC_LIST_PAYMENT, Owner: SYSDBA */
CREATE TABLE DCL_SPC_LIST_PAYMENT (SPP_ID INTEGER NOT NULL,
        SPC_ID INTEGER NOT NULL,
        SPP_PERCENT DECIMAL(11, 5) NOT NULL,
        SPP_SUM DECIMAL(15, 2) NOT NULL,
        SPP_DATE DATE,
CONSTRAINT PK_DCL_SPC_LIST_PAYMENT PRIMARY KEY (SPP_ID));

/* Table: DCL_SPECIFICATION_IMPORT, Owner: SYSDBA */
CREATE TABLE DCL_SPECIFICATION_IMPORT (SPI_ID INTEGER NOT NULL,
        SPI_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        SPI_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        SPI_NUMBER VARCHAR(100) NOT NULL,
        SPI_DATE DATE NOT NULL,
        SPI_COMMENT VARCHAR(2000),
        SPI_COURSE DECIMAL(15, 4),
        SPI_KOEFF DECIMAL(15, 3),
        SPI_ARRIVE SMALLINT,
        SPI_COST DECIMAL(15, 2) NOT NULL,
        SPI_SEND_DATE DATE,
CONSTRAINT PK_DCL_SPECIFICATION_IMPORT PRIMARY KEY (SPI_ID));

/* Table: DCL_SPI_LIST_PRODUCE, Owner: SYSDBA */
CREATE TABLE DCL_SPI_LIST_PRODUCE (SIP_ID INTEGER NOT NULL,
        SPI_ID INTEGER NOT NULL,
        DRP_ID INTEGER,
        SIP_PRICE DECIMAL(15, 2) NOT NULL,
        SIP_COUNT DECIMAL(15, 2) NOT NULL,
        SIP_COST DECIMAL(15, 2) NOT NULL,
        SIP_WEIGHT DECIMAL(15, 3),
        PRD_ID INTEGER NOT NULL,
        OPR_ID INTEGER,
        PRS_ID INTEGER NOT NULL,
        SIP_PERCENT DECIMAL(15, 2),
CONSTRAINT PK_DCL_SIP_LIST_PRODUCE PRIMARY KEY (SIP_ID));

/* Table: DCL_STUFF_CATEGORY, Owner: SYSDBA */
CREATE TABLE DCL_STUFF_CATEGORY (STF_ID INTEGER NOT NULL,
        STF_NAME VARCHAR(150) NOT NULL,
        STF_SHOW_IN_MONTAGE SMALLINT,
CONSTRAINT PK_DCL_STUFF_CATEGORY PRIMARY KEY (STF_ID));

/* Table: DCL_TERM_INCO, Owner: SYSDBA */
CREATE TABLE DCL_TERM_INCO (TRM_ID INTEGER NOT NULL,
        TRM_NAME VARCHAR(10) NOT NULL,
        TRM_NAME_EXTENDED VARCHAR(100) NOT NULL,
        TRM_ORDER_ID INTEGER NOT NULL,
CONSTRAINT PK_DCL_TERM_INCO PRIMARY KEY (TRM_ID));

/* Table: DCL_TEST, Owner: SYSDBA */
CREATE TABLE DCL_TEST (TST_ID INTEGER NOT NULL,
        TST_NAME VARCHAR(128) NOT NULL,
        TST_DECIMAL DECIMAL(15, 2),
CONSTRAINT PK_DCL_TEST PRIMARY KEY (TST_ID));

/* Table: DCL_TIMEBOARD, Owner: SYSDBA */
CREATE TABLE DCL_TIMEBOARD (TMB_ID INTEGER NOT NULL,
        USR_ID INTEGER NOT NULL,
        TMB_DATE DATE NOT NULL,
        TMB_CHECKED SMALLINT,
        TMB_CREATE_DATE TIMESTAMP NOT NULL,
        USR_ID_CREATE INTEGER NOT NULL,
        TMB_EDIT_DATE TIMESTAMP NOT NULL,
        USR_ID_EDIT INTEGER NOT NULL,
        TMB_CHECKED_DATE TIMESTAMP,
        USR_ID_CHECKED INTEGER,
CONSTRAINT PK_DCL_TIMEBOARD PRIMARY KEY (TMB_ID));

/* Table: DCL_TMB_LIST_WORK, Owner: SYSDBA */
CREATE TABLE DCL_TMB_LIST_WORK (TBW_ID INTEGER NOT NULL,
        TMB_ID INTEGER NOT NULL,
        TBW_DATE DATE NOT NULL,
        TBW_FROM TIME NOT NULL,
        TBW_TO TIME NOT NULL,
        TBW_HOURS_UPDATE DECIMAL(15, 2) NOT NULL,
        CRQ_ID INTEGER,
        TBW_COMMENT VARCHAR(2000),
CONSTRAINT PK_DCL_TMB_LIST_WORK PRIMARY KEY (TBW_ID));

/* Table: DCL_UNIT, Owner: SYSDBA */
CREATE TABLE DCL_UNIT (UNT_ID INTEGER NOT NULL,
        IS_ACCEPTABLE_FOR_CPR CHAR(1) default '1' NOT NULL,
CONSTRAINT PK_DCL_UNIT PRIMARY KEY (UNT_ID));

/* Table: DCL_UNIT_LANGUAGE, Owner: SYSDBA */
CREATE TABLE DCL_UNIT_LANGUAGE (UNT_ID INTEGER NOT NULL,
        LNG_ID INTEGER NOT NULL,
        UNT_NAME VARCHAR(150),
CONSTRAINT PK_DCL_UNIT_LANGUAGE PRIMARY KEY (LNG_ID, UNT_ID));

/* Table: DCL_USER, Owner: SYSDBA */
CREATE TABLE DCL_USER (USR_ID INTEGER NOT NULL,
        USR_CODE VARCHAR(3),
        USR_LOGIN VARCHAR(8),
        USR_PASSWD VARCHAR(64),
        DEP_ID INTEGER,
        USR_PHONE VARCHAR(50),
        USR_BLOCK SMALLINT,
        USR_RESPONS_PERSON SMALLINT,
        USR_NO_LOGIN SMALLINT,
        USR_CHIEF_DEP SMALLINT,
        USR_FAX VARCHAR(50),
        USR_EMAIL VARCHAR(100),
        USR_LOCAL_ENTRY SMALLINT,
        USR_INTERNET_ENTRY SMALLINT,
CONSTRAINT PK_DCL_USER PRIMARY KEY (USR_ID));

/* Table: DCL_USER_LANGUAGE, Owner: SYSDBA */
CREATE TABLE DCL_USER_LANGUAGE (USR_ID INTEGER NOT NULL,
        LNG_ID INTEGER NOT NULL,
        USR_SURNAME VARCHAR(20),
        USR_NAME VARCHAR(20),
        USR_POSITION VARCHAR(60),
CONSTRAINT PK_DCL_USER_LANGUAGE PRIMARY KEY (USR_ID, LNG_ID));

/* Table: DCL_USER_LINK, Owner: SYSDBA */
CREATE TABLE DCL_USER_LINK (ULN_ID INTEGER NOT NULL,
        USR_ID INTEGER NOT NULL,
        ULN_CREATE_DATE TIMESTAMP NOT NULL,
        ULN_URL VARCHAR(64) NOT NULL,
        ULN_PARAMETERS VARCHAR(128) NOT NULL,
        ULN_TEXT VARCHAR(500),
        ULN_MENU_ID VARCHAR(50) NOT NULL,
CONSTRAINT PK_DCL_USER_LINK PRIMARY KEY (ULN_ID));

/* Table: DCL_USER_ROLE, Owner: SYSDBA */
CREATE TABLE DCL_USER_ROLE (USR_ID INTEGER NOT NULL,
        ROL_ID INTEGER NOT NULL,
CONSTRAINT PK_DCL_USER_ROLE PRIMARY KEY (USR_ID, ROL_ID));

/* Table: DCL_USER_SETTING, Owner: SYSDBA */
CREATE TABLE DCL_USER_SETTING (UST_ID INTEGER NOT NULL,
        UST_NAME VARCHAR(100) NOT NULL,
        UST_DESCRIPTION VARCHAR(256),
        UST_VALUE VARCHAR(1000),
        UST_TYPE SMALLINT NOT NULL,
        UST_ACTION VARCHAR(100),
        UST_VALUE_EXTENDED VARCHAR(1000),
        USR_ID INTEGER NOT NULL,
CONSTRAINT PK_DCL_USER_SETTING PRIMARY KEY (UST_ID));

/* Table: DCL_YEAR_NUM, Owner: SYSDBA */
CREATE TABLE DCL_YEAR_NUM (DCL_YEAR INTEGER NOT NULL,
        DCL_NUM INTEGER NOT NULL,
        DCL_TABLE VARCHAR(64) NOT NULL,
CONSTRAINT PK_DCL_YEAR_NUM PRIMARY KEY (DCL_YEAR, DCL_TABLE));

/*  External Function declarations */
DECLARE EXTERNAL FUNCTION ADDHOUR
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addHour' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDMONTH
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addMonth' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDSECOND
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addSecond' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDWEEK
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addWeek' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDYEAR
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addYear' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION FLOOR
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_floor' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION INVL
INTEGER BY DESCRIPTOR, INTEGER BY DESCRIPTOR
RETURNS INTEGER BY DESCRIPTOR 
ENTRY_POINT 'idNvl' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION MOD
INTEGER, INTEGER
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_mod' MODULE_NAME 'ib_udf';


COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

/* Stored functions headers */
CREATE OR ALTER FUNCTION ADDDAY (ADATE DATE,
ADAYS INTEGER)
RETURNS DATE
AS 
BEGIN END ^
CREATE OR ALTER FUNCTION DNVL (A DOUBLE PRECISION,
B DOUBLE PRECISION)
RETURNS DOUBLE PRECISION
AS 
BEGIN END ^
CREATE OR ALTER FUNCTION STRLEN (S VARCHAR(10000) CHARACTER SET UNICODE_FSS)
RETURNS INTEGER
AS 
BEGIN END ^
CREATE OR ALTER FUNCTION SUBSTR (S VARCHAR(512) CHARACTER SET UNICODE_FSS,
POS SMALLINT,
LEN SMALLINT)
RETURNS VARCHAR(512) CHARACTER SET UNICODE_FSS
AS 
BEGIN END ^

SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;

COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

/* Stored procedures headers */
CREATE OR ALTER PROCEDURE CHECKUSERMESSAGESONDELETE AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DATE2STR (DATA DATE)
RETURNS (STRDATE VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ADD_INFO_SERVICE_GUARANTEE (LPS_ID INTEGER)
RETURNS (SHP_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_SELLER_ID INTEGER,
CON_SELLER VARCHAR(100) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ASM_COUNT_BY_PRD_ID_ASM_ID (PRD_ID INTEGER,
STF_ID INTEGER,
ORD_ID INTEGER,
ASM_ID INTEGER)
RETURNS (TRN_PRODUCE_COUNT DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ASM_LIST_PRODUCES_LOAD (ASM_ID_IN INTEGER)
RETURNS (APR_ID INTEGER,
ASM_ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
OPR_ID INTEGER,
APR_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
APR_OCCUPIED INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ASM_LIST_PRODUCE_LOAD (APR_ID_IN INTEGER)
RETURNS (APR_ID INTEGER,
ASM_ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
OPR_ID INTEGER,
APR_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
APR_OCCUPIED INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ASSEMBLE_FILTER (ASM_NUMBER_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_DATE_BEGIN_IN DATE,
ASM_DATE_END_IN DATE,
ASM_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (ASM_ID INTEGER,
ASM_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ASM_DATE DATE,
ASM_BLOCK SMALLINT,
ASM_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ASM_TYPE SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ASSEMBLE_INSERT (ASM_DATE DATE,
ASM_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_COUNT INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
OPR_ID INTEGER,
ASM_TYPE SMALLINT)
RETURNS (ASM_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ASSEMBLE_LOAD (ASM_ID_IN INTEGER)
RETURNS (ASM_ID INTEGER,
USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
ASM_CREATE_DATE TIMESTAMP,
ASM_EDIT_DATE TIMESTAMP,
ASM_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_DATE DATE,
ASM_BLOCK SMALLINT,
ASM_COUNT INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
OPR_ID INTEGER,
ASM_TYPE SMALLINT,
ASM_OCCUPIED INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
ORD_INFO VARCHAR(500) CHARACTER SET UNICODE_FSS,
ORD_INFO_CONTRACTOR_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_BEGIN_OF_NEXT_WEEK (T_INDATE TIMESTAMP)
RETURNS (T_BEGIN_OF_NEXT_WEEK TIMESTAMP)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_BLANKS_LOAD (BLN_TYPE_IN SMALLINT)
RETURNS (BLN_ID INTEGER,
BLN_TYPE SMALLINT,
BLN_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
BLN_IMAGES VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_CHARSET VARCHAR(20) CHARACTER SET UNICODE_FSS,
BLN_LANGUAGE VARCHAR(32) CHARACTER SET UNICODE_FSS,
BLN_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_NOTE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_USAGE VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_BLANK_INSERT (BLN_TYPE SMALLINT,
BLN_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
LNG_ID INTEGER,
BLN_CHARSET VARCHAR(20) CHARACTER SET UNICODE_FSS,
BLN_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_NOTE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_USAGE VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (BLN_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_BLANK_LOAD (BLN_ID_IN INTEGER)
RETURNS (BLN_ID INTEGER,
BLN_TYPE SMALLINT,
BLN_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
BLN_CHARSET VARCHAR(20) CHARACTER SET UNICODE_FSS,
LNG_ID INTEGER,
LNG_NAME VARCHAR(32) CHARACTER SET UNICODE_FSS,
BLN_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_NOTE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_USAGE VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CALCULATION_STATE (CTR_ID INTEGER,
CUR_ID INTEGER,
NOT_INCLUDE_ZERO SMALLINT,
INCLUDE_ALL_SPECS SMALLINT,
SLN_ID_IN INTEGER,
CON_ID_IN INTEGER,
NOT_SHOW_ANNUL SMALLINT,
EARLIEST_DOC_DATE DATE,
USR_ID INTEGER,
DEP_ID INTEGER)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CON_ANNUL SMALLINT,
CON_ANNUL_DATE DATE,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_ADD_PAY_COND VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_COND VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_DATE DATE,
SPC_DELIVERY_DATE_MATH DATE,
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
PAY_ID INTEGER,
PAY_DATE DATE,
PAY_SUMM DECIMAL(15, 2),
PAY_BLOCK SMALLINT,
SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_SUMM DECIMAL(15, 2),
ITOG_LINE SMALLINT,
REST_DOC_LINE SMALLINT,
SHP_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PAY_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_LINE SMALLINT,
PAY_CLOSED INTEGER,
SHP_CLOSED INTEGER,
MANAGERS VARCHAR(5000) CHARACTER SET UNICODE_FSS,
STUFF_CATEGORIES VARCHAR(5000) CHARACTER SET UNICODE_FSS,
COUNT_DAY INTEGER,
SHP_DATE_EXPIRATION DATE,
SHP_LETTER1_DATE DATE,
SHP_LETTER2_DATE DATE,
SHP_LETTER3_DATE DATE,
SHP_COMPLAINT_IN_COURT_DATE DATE,
SHP_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
SHP_ORIGINAL SMALLINT,
PAY_COMMENT VARCHAR(500) CHARACTER SET UNICODE_FSS,
SHP_NO_ACT SMALLINT,
ONLY_SPEC SMALLINT,
NO_SHIPPING SMALLINT,
PAY_DATE_EXPIRATION DATE,
ALONE_SHIPPING SMALLINT,
CON_COMMENT_FLAG INTEGER,
SPC_COMMENT_FLAG INTEGER,
DATES_FOR_PRODUCE_ON_STORAGE VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_CLOSED_CORRECT INTEGER,
GET_PAY_EXPIRATION_FROM_PROC SMALLINT,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_PAY_EXPIRATION INTEGER,
SPC_WHOSE_ID INTEGER,
SPC_WHOSE VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_ID_LIST_CON VARCHAR(200) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST_CON VARCHAR(200) CHARACTER SET UNICODE_FSS,
USR_ID_LIST_SHP VARCHAR(500) CHARACTER SET UNICODE_FSS,
CON_FINAL_DATE DATE,
CON_DAY_BEFORE_FINAL INTEGER,
CON_INCORRECT_FINAL_DATE SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CALCULATION_STATE_DEBET (CTR_ID INTEGER,
CUR_ID INTEGER,
SLN_ID INTEGER,
USR_ID INTEGER,
DEP_ID INTEGER)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CON_ANNUL SMALLINT,
CON_ANNUL_DATE DATE,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
PAY_ID INTEGER,
PAY_DATE DATE,
PAY_SUMM DECIMAL(15, 2),
SHP_ID INTEGER,
SHP_NUMBER CHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_SUMM DECIMAL(15, 2),
ITOG_LINE SMALLINT,
REST_DOC_LINE SMALLINT,
SHP_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_LINE SMALLINT,
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
MANAGERS VARCHAR(5000) CHARACTER SET UNICODE_FSS,
STUFF_CATEGORIES VARCHAR(5000) CHARACTER SET UNICODE_FSS,
COUNT_DAY INTEGER,
SHP_DATE_EXPIRATION DATE,
SHP_LETTER1_DATE DATE,
SHP_LETTER2_DATE DATE,
SHP_LETTER3_DATE DATE,
SHP_COMPLAINT_IN_COURT_DATE DATE,
SHP_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
SHP_ORIGINAL SMALLINT,
PAY_COMMENT VARCHAR(500) CHARACTER SET UNICODE_FSS,
SHP_NO_ACT SMALLINT,
CON_COMMENT_FLAG INTEGER,
SPC_COMMENT_FLAG INTEGER,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_WHOSE_ID INTEGER,
SPC_WHOSE VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_ID_LIST_CON VARCHAR(200) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST_CON VARCHAR(200) CHARACTER SET UNICODE_FSS,
USR_ID_LIST_SHP VARCHAR(500) CHARACTER SET UNICODE_FSS,
CON_FINAL_DATE DATE,
CON_DAY_BEFORE_FINAL INTEGER,
CON_INCORRECT_FINAL_DATE SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CAN_SPC_BLOCK (SPC_ID INTEGER)
RETURNS (CAN_BLOC SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CFC_MESSAGES_LOAD (USR_ID_IN INTEGER)
RETURNS (CCM_ID INTEGER,
CCM_CREATE_DATE TIMESTAMP,
CCM_MESSAGE VARCHAR(256) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CFC_PRODUCES_SELECT (CFC_ID_IN INTEGER)
RETURNS (CCP_ID INTEGER,
CFC_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
CCP_PRICE DECIMAL(15, 2),
CCP_COUNT DECIMAL(15, 2),
CCP_NDS_RATE DECIMAL(15, 2),
CPR_ID INTEGER,
CPR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
CPR_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CLOSED_RECORD_INSERT (CTC_ID INTEGER,
SPC_ID INTEGER,
LCC_CHARGES DECIMAL(15, 2),
LCC_MONTAGE DECIMAL(15, 2),
LCC_TRANSPORT DECIMAL(15, 2),
LCC_UPDATE_SUM DECIMAL(15, 2))
RETURNS (LCC_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CLOSE_CONTRACT (SPC_ID INTEGER)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_CLOSE_RESERVED_IN_CPR AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_COMMERCIAL_PROPOSAL_FILTER (CPR_NUMBER_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
CPR_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPR_DATE_BEGIN_IN DATE,
CPR_DATE_END_IN DATE,
CPR_SUMM_MIN_IN DECIMAL(15, 2),
CPR_SUMM_MAX_IN DECIMAL(15, 2),
CPR_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CPR_DEPARTMENT_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
CPR_STF_NAME_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPR_PROPOSAL_RECEIVED_FLAG_IN SMALLINT,
CPR_PROPOSAL_DECLINED_IN CHAR(1) CHARACTER SET UNICODE_FSS)
RETURNS (CPR_ID INTEGER,
CPR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
CPR_DATE DATE,
CPR_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPR_SUMM DECIMAL(15, 2),
CPR_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CPR_STF_NAME VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CPR_PROPOSAL_RECEIVED_FLAG SMALLINT,
CPR_PROPOSAL_DECLINED CHAR(1) CHARACTER SET UNICODE_FSS,
CPR_BLOCK SMALLINT,
CPR_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CPR_DEPARTMENT VARCHAR(100) CHARACTER SET UNICODE_FSS,
USR_ID_CREATE INTEGER,
CPR_CHECK_PRICE SMALLINT,
CPR_CHECK_PRICE_DATE TIMESTAMP,
CPR_CHECK_PRICE_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CPR_FINAL_DATE DATE,
CPR_ASSEMBLE_MINSK_STORE SMALLINT,
CPR_NO_RESERVATION SMALLINT,
DEP_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_COMMERCIAL_PROPOSAL_INSERT (CPR_DATE DATE,
CPR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CPS_ID INTEGER,
CPR_CONCERNING VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPR_CONCERNING_INVOICE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPR_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CUR_ID INTEGER,
CPR_COURSE DECIMAL(18, 8),
CPR_NDS DECIMAL(15, 2),
TRM_ID_PRICE_CONDITION INTEGER,
CPR_COUNTRY VARCHAR(32) CHARACTER SET UNICODE_FSS,
CPR_PAY_CONDITION VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPR_PAY_CONDITION_INVOICE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
TRM_ID_DELIVERY_CONDITION INTEGER,
CPR_DELIVERY_ADDRESS VARCHAR(256) CHARACTER SET UNICODE_FSS,
CPR_SUM_TRANSPORT DECIMAL(15, 2),
CPR_ALL_TRANSPORT SMALLINT,
CPR_DELIVERY_TERM VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CPR_DELIVERY_TERM_INVOICE VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CPR_ADD_INFO VARCHAR(3000) CHARACTER SET UNICODE_FSS,
CPR_FINAL_DATE DATE,
CPR_FINAL_DATE_INVOICE VARCHAR(30) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
EXECUTOR_ID INTEGER,
CPR_EXECUTOR_FLAG SMALLINT,
CPR_DATE_ACCEPT DATE,
BLN_ID INTEGER,
CPR_IMG_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
CPR_PROPOSAL_RECEIVED_FLAG SMALLINT,
CPR_BLOCK SMALLINT,
CPR_SUMM DECIMAL(15, 2),
CPR_NDS_BY_STRING SMALLINT,
CPR_SUM_ASSEMBLING DECIMAL(15, 2),
CPR_OLD_VERSION SMALLINT,
CUR_ID_TABLE INTEGER,
CPR_ASSEMBLE_MINSK_STORE SMALLINT,
CPR_FREE_PRICES SMALLINT,
CPR_CAN_EDIT_INVOICE SMALLINT,
CPR_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
PPS_ID INTEGER,
CPR_REVERSE_CALC SMALLINT,
CPS_ID_SELLER INTEGER,
CPS_ID_CUSTOMER INTEGER,
CPR_GUARANTY_IN_MONTH INTEGER,
CPR_PREPAY_PERCENT DECIMAL(15, 2),
CPR_PREPAY_SUM DECIMAL(15, 2),
CPR_DELAY_DAYS INTEGER,
CPR_NO_RESERVATION SMALLINT,
CPR_PROVIDER_DELIVERY SMALLINT,
CPR_PROVIDER_DELIVERY_ADDRESS VARCHAR(500) CHARACTER SET UNICODE_FSS,
CPR_DELIVERY_COUNT_DAY INTEGER,
CPR_DONOT_CALCULATE_NETTO SMALLINT,
CPR_PRINT_SCALE INTEGER,
CPR_CONTRACT_SCALE INTEGER,
CPR_INVOICE_SCALE INTEGER,
CPR_FINAL_DATE_ABOVE SMALLINT,
CTR_ID_CONSIGNEE INTEGER,
CPR_TENDER_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
CPR_TENDER_NUMBER_EDITABLE CHAR(1) CHARACTER SET UNICODE_FSS,
CPR_PROPOSAL_DECLINED CHAR(1) CHARACTER SET UNICODE_FSS)
RETURNS (CPR_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_COND_FOR_CONTRACT_FILTER (CFC_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CFC_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CFC_DATE_BEGIN_IN TIMESTAMP,
CFC_DATE_END_IN TIMESTAMP,
SLN_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
CFC_NOT_EXECUTED SMALLINT,
ANNUL_EXCLUDE SMALLINT,
CFC_NOT_PLACED SMALLINT)
RETURNS (CFC_ID INTEGER,
CFC_PLACE_DATE TIMESTAMP,
CFC_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CFC_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CFC_EXECUTE SMALLINT,
CFC_SELLER VARCHAR(100) CHARACTER SET UNICODE_FSS,
EXECUTED_AND_PLACED SMALLINT,
USR_ID INTEGER,
DEP_ID INTEGER,
CFC_CHECK_PRICE SMALLINT,
CFC_CHECK_PRICE_DATE TIMESTAMP,
CFC_CHECK_PRICE_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CFC_ANNUL SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_COND_FOR_CONTRACT_INSERT (CFC_PLACE SMALLINT,
CFC_EXECUTE SMALLINT,
SLN_ID INTEGER,
CTR_ID INTEGER,
CFC_DOC_TYPE SMALLINT,
CFC_CON_NUMBER_TXT VARCHAR(200) CHARACTER SET UNICODE_FSS,
CFC_CON_DATE DATE,
CUR_ID INTEGER,
CON_ID INTEGER,
CFC_SPC_NUMBER_TXT VARCHAR(200) CHARACTER SET UNICODE_FSS,
CFC_SPC_DATE DATE,
CFC_PAY_COND VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CFC_CUSTOM_POINT VARCHAR(500) CHARACTER SET UNICODE_FSS,
CFC_DELIVERY_COND VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CFC_GUARANTEE_COND VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CFC_MONTAGE_COND VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CFC_DATE_CON_TO DATE,
CFC_COUNT_DELIVERY VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPS_ID_SIGN INTEGER,
CPS_ID INTEGER,
CFC_DELIVERY_COUNT SMALLINT,
PPS_ID INTEGER,
CFC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CFC_NEED_INVOICE SMALLINT,
CFC_ANNUL SMALLINT,
CFC_ANNUL_DATE DATE)
RETURNS (CFC_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTACT_PERSON_INSERT (CTR_ID INTEGER,
CPS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPS_PHONE VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_MOB_PHONE VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_FAX VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_BLOCK SMALLINT,
CPS_POSITION VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_ON_REASON VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_EMAIL VARCHAR(50) CHARACTER SET UNICODE_FSS,
CPS_CONTRACT_COMMENT VARCHAR(300) CHARACTER SET UNICODE_FSS,
CPS_FIRE SMALLINT)
RETURNS (CPS_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACTOR_FILTER (CTR_NAME_IN VARCHAR(200) CHARACTER SET UNICODE_FSS)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_EMAIL VARCHAR(40) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACTOR_FILTER_FULL (CTR_NAME_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_ADDRESS_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CTR_ACCOUNT_IN VARCHAR(35) CHARACTER SET UNICODE_FSS,
CTR_EMAIL_IN VARCHAR(40) CHARACTER SET UNICODE_FSS,
CTR_UNP_IN VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_FULL_NAME_IN VARCHAR(300) CHARACTER SET UNICODE_FSS,
USR_NAME_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_ID_IN INTEGER,
DEP_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_FULL_NAME VARCHAR(300) CHARACTER SET UNICODE_FSS,
CTR_PHONE VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_FAX CHAR(100) CHARACTER SET UNICODE_FSS,
CTR_EMAIL VARCHAR(40) CHARACTER SET UNICODE_FSS,
CTR_BANK_PROPS VARCHAR(800) CHARACTER SET UNICODE_FSS,
CTR_BLOCK SMALLINT,
CTR_OCCUPIED INTEGER,
CTR_INDEX VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_REGION VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_PLACE VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_STREET VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_BUILDING VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_ADD_INFO VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACTOR_FOR_CC_FILTER (CTR_NAME_IN VARCHAR(200) CHARACTER SET UNICODE_FSS)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACTOR_INSERT (CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_FULL_NAME VARCHAR(300) CHARACTER SET UNICODE_FSS,
CUT_ID INTEGER,
CTR_INDEX VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_REGION VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_PLACE VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_STREET VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_BUILDING VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_ADD_INFO VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CTR_PHONE VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_FAX VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_EMAIL VARCHAR(40) CHARACTER SET UNICODE_FSS,
CTR_BANK_PROPS VARCHAR(800) CHARACTER SET UNICODE_FSS,
CTR_UNP VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_OKPO VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_BLOCK SMALLINT,
RPT_ID INTEGER,
CTR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (CTR_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACTOR_LOAD (CTR_ID_IN INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_FULL_NAME VARCHAR(300) CHARACTER SET UNICODE_FSS,
CUT_ID INTEGER,
CUT_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_PHONE VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_FAX CHAR(100) CHARACTER SET UNICODE_FSS,
CTR_EMAIL VARCHAR(40) CHARACTER SET UNICODE_FSS,
CTR_BANK_PROPS VARCHAR(800) CHARACTER SET UNICODE_FSS,
ACCOUNT1 VARCHAR(35) CHARACTER SET UNICODE_FSS,
ACCOUNT2 VARCHAR(35) CHARACTER SET UNICODE_FSS,
ACCOUNTVAL VARCHAR(35) CHARACTER SET UNICODE_FSS,
CTR_UNP VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_OKPO VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_DOUBLE_ACCOUNT SMALLINT,
CTR_BLOCK INTEGER,
RPT_ID INTEGER,
RPT_DESCRIPTION VARCHAR(500) CHARACTER SET UNICODE_FSS,
BYN_ACCOUNTS VARCHAR(200) CHARACTER SET UNICODE_FSS,
OTHER_ACCOUNTS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_INDEX VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_REGION VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_PLACE VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_STREET VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_BUILDING VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_ADD_INFO VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CTR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACTOR_REQUEST_FILTER (CRQ_NUMBER_IN VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID_IN INTEGER,
CRQ_EQUIPMENT_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
EXCLUDE_ANNUL SMALLINT,
CRQ_NOT_DELIVER SMALLINT,
CRQ_TICKET_NUMBER_IN VARCHAR(30) CHARACTER SET UNICODE_FSS,
SLN_ID_IN INTEGER,
CRQ_STUFF_CATEGORY_IN VARCHAR(150) CHARACTER SET UNICODE_FSS)
RETURNS (CRQ_ID INTEGER,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_RECEIVE_DATE DATE,
CRQ_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID INTEGER,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_SERIAL_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_DELIVER SMALLINT,
CRQ_ANNUL SMALLINT,
ATTACH_IDX INTEGER,
CRQ_TICKET_NUMBER VARCHAR(30) CHARACTER SET UNICODE_FSS,
CRQ_SELLER VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_CREATE_DATE TIMESTAMP,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACTOR_REQUEST_INSERT (CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_RECEIVE_DATE DATE,
CTR_ID INTEGER,
CPS_ID INTEGER,
CRQ_REQUEST_TYPE_ID INTEGER,
CON_ID INTEGER,
LPS_ID INTEGER,
PRD_ID INTEGER,
CRQ_DELIVER SMALLINT,
SLN_ID INTEGER,
USR_ID_MANAGER INTEGER,
USR_ID_CHIEF INTEGER,
USR_ID_SPECIALIST INTEGER,
CRQ_CITY VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_ID_OTHER INTEGER,
CRQ_NO_CONTRACT SMALLINT,
STF_ID INTEGER,
CRQ_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_YEAR_OUT VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_ENTER_IN_USE_DATE DATE,
CRQ_OPERATING_TIME INTEGER,
CRQ_ANNUL SMALLINT,
CRQ_TICKET_NUMBER VARCHAR(30) CHARACTER SET UNICODE_FSS,
CRQ_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CON_ID_FOR_WORK INTEGER)
RETURNS (CRQ_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACTOR_REQUEST_LOAD (CRQ_ID INTEGER)
RETURNS (USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
CRQ_CREATE_DATE TIMESTAMP,
CRQ_EDIT_DATE TIMESTAMP,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_RECEIVE_DATE DATE,
CTR_ID INTEGER,
CPS_ID INTEGER,
CRQ_REQUEST_TYPE_ID INTEGER,
CON_ID INTEGER,
LPS_ID INTEGER,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPS_ENTER_IN_USE_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CRQ_DELIVER SMALLINT,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
MANAGER_ID INTEGER,
MANAGER_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
MANAGER_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
CHIEF_ID INTEGER,
CHIEF_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
CHIEF_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPECIALIST_ID INTEGER,
SPECIALIST_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPECIALIST_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
CRQ_CITY VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_ID_OTHER INTEGER,
CTR_NAME_OTHER VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_NO_CONTRACT SMALLINT,
CRQ_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_YEAR_OUT VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_ENTER_IN_USE_DATE DATE,
STF_NAME1 VARCHAR(150) CHARACTER SET UNICODE_FSS,
CRQ_ANNUL SMALLINT,
CRQ_TICKET_NUMBER VARCHAR(30) CHARACTER SET UNICODE_FSS,
SHP_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_SELLER_ID INTEGER,
CON_SELLER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CRQ_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_OPERATING_TIME INTEGER,
CON_ID_FOR_WORK INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACTS_CLOSED_LOAD (CTC_ID_IN INTEGER)
RETURNS (LCC_ID INTEGER,
CTC_ID INTEGER,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_ORIGINAL SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_GROUP_DELIVERY SMALLINT,
SPC_ORIGINAL SMALLINT,
SUM_OUT_NDS_EUR DECIMAL(15, 2),
LCC_CHARGES DECIMAL(15, 2),
LCC_MONTAGE DECIMAL(15, 2),
LCC_UPDATE_SUM DECIMAL(15, 2),
HAVE_UNBLOCKED_PRC SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACT_CLOSED_FILTER (CTC_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTC_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTC_DATE_BEGIN_IN DATE,
CTC_DATE_END_IN DATE,
CTC_NOT_BLOCK_IN SMALLINT)
RETURNS (CTC_ID INTEGER,
CTC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTC_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTC_DATE DATE,
CTC_BLOCK SMALLINT,
USR_ID_CREATE INTEGER,
CON_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SHOW_WARN SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACT_CLOSED_INSERT (CTC_DATE DATE,
CTC_BLOCK SMALLINT)
RETURNS (CTC_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACT_FILTER (CON_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_DATE_BEGIN_IN DATE,
CON_DATE_END_IN DATE,
CON_SUMM_MIN_IN DECIMAL(15, 2),
CON_SUMM_MAX_IN DECIMAL(15, 2),
CON_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_EXECUTED_IN SMALLINT,
ORIDINAL_ABSENT SMALLINT,
SLN_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_SUMM DECIMAL(15, 2),
CON_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CON_EXECUTED SMALLINT,
CON_USER VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CON_REMINDER SMALLINT,
CON_ANNUL SMALLINT,
SPC_COUNT INTEGER,
ATTACH_IDX INTEGER,
USR_ID_LIST VARCHAR(200) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_REUSABLE SMALLINT,
CON_FINAL_DATE DATE,
CON_ORIGINAL SMALLINT,
SPC_NUMBERS_NO_ORIGINAL VARCHAR(1000) CHARACTER SET UNICODE_FSS,
DAY_BEFORE_FINAL INTEGER,
NO_DELIVERY_DATE SMALLINT,
INCORRECT_FINAL_DATE SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACT_FOR_CC_FILTER (CTR_ID INTEGER)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACT_FOR_CONTRACTOR (CTR_ID INTEGER,
CUR_ID_IN INTEGER,
CON_NUMBER_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
ALL_CON SMALLINT,
ONLY_REUSABLE SMALLINT,
CON_FINAL_DATE_AFTER DATE)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
SLN_IS_RESIDENT SMALLINT,
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
CON_REUSABLE SMALLINT,
CON_FINAL_DATE DATE,
CON_ANNUL SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CONTRACT_INSERT (CON_DATE DATE,
CTR_ID INTEGER,
CUR_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_EXECUTED SMALLINT,
CON_SUMM DECIMAL(15, 2),
CON_ORIGINAL SMALLINT,
CON_ANNUL SMALLINT,
CON_ANNUL_DATE DATE,
CON_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SLN_ID INTEGER,
CON_REUSABLE SMALLINT,
CON_FINAL_DATE DATE)
RETURNS (CON_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CON_LIST_SPECS_LOAD (CON_ID_IN INTEGER)
RETURNS (SPC_ID INTEGER,
CON_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_SUMM_NDS DECIMAL(15, 2),
SPC_EXECUTED SMALLINT,
SPC_NDS_RATE DECIMAL(15, 2),
SPC_DELIVERY_DATE DATE,
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_ORIGINAL SMALLINT,
SPC_MONTAGE SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
SPC_DELIVERY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_TERM_TYPE SMALLINT,
SPC_PERCENT_OR_SUM SMALLINT,
SPC_DELIVERY_PERCENT DECIMAL(15, 2),
SPC_DELIVERY_SUM DECIMAL(15, 2),
SPC_PAY_AFTER_MONTAGE SMALLINT,
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
SPC_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
USR_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_OCCUPIED INTEGER,
SPC_OCCUPIED_IN_PAY_SHP INTEGER,
SPC_IN_CTC INTEGER,
PAYED_SUMM DECIMAL(15, 2),
PAYED_DATE DATE,
ATTACHMENTS_COUNT INTEGER,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_ADDITIONAL_DAYS_COUNT INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CON_LIST_SPEC_INSERT (CON_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_SUMM_NDS DECIMAL(15, 2),
SPC_NDS_RATE DECIMAL(15, 2),
SPC_EXECUTED SMALLINT,
SPC_DELIVERY_DATE DATE,
SPC_DELIVERY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_TERM_TYPE SMALLINT,
SPC_PERCENT_OR_SUM SMALLINT,
SPC_DELIVERY_PERCENT DECIMAL(15, 2),
SPC_DELIVERY_SUM DECIMAL(15, 2),
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_ORIGINAL SMALLINT,
SPC_MONTAGE SMALLINT,
SPC_PAY_AFTER_MONTAGE SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
SPC_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_ADDITIONAL_DAYS_COUNT INTEGER)
RETURNS (SPC_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CON_LIST_SPEC_LOAD (SPC_ID_IN INTEGER)
RETURNS (SPC_ID INTEGER,
CON_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_SUMM_NDS DECIMAL(15, 2),
SPC_EXECUTED SMALLINT,
SPC_NDS_RATE DECIMAL(15, 2),
SPC_DELIVERY_DATE DATE,
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_ORIGINAL SMALLINT,
SPC_MONTAGE SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
SPC_DELIVERY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_TERM_TYPE SMALLINT,
SPC_PERCENT_OR_SUM SMALLINT,
SPC_DELIVERY_PERCENT DECIMAL(15, 2),
SPC_DELIVERY_SUM DECIMAL(15, 2),
SPC_PAY_AFTER_MONTAGE SMALLINT,
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
SPC_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
USR_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_OCCUPIED INTEGER,
SPC_OCCUPIED_IN_PAY_SHP INTEGER,
SPC_IN_CTC INTEGER,
PAYED_SUMM DECIMAL(15, 2),
PAYED_DATE DATE,
ATTACHMENTS_COUNT INTEGER,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_ADDITIONAL_DAYS_COUNT INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CON_MESSAGES_LOAD (USR_ID_IN INTEGER)
RETURNS (CMS_ID INTEGER,
CMS_CREATE_DATE TIMESTAMP,
CMS_MESSAGE VARCHAR(256) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_COUNTRY_INSERT (CUT_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (CUT_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CPR_LIST_PRODUCES_LOAD (CPR_ID_IN INTEGER,
CPR_DATE TIMESTAMP)
RETURNS (LPR_ID INTEGER,
CPR_ID INTEGER,
LPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
LPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPR_PRICE_BRUTTO DECIMAL(15, 2),
LPR_DISCOUNT DECIMAL(15, 2),
LPR_PRICE_NETTO DECIMAL(15, 2),
LPR_COUNT DECIMAL(15, 2),
CUS_ID INTEGER,
CUS_CODE VARCHAR(10) CHARACTER SET UNICODE_FSS,
CUS_PERCENT DECIMAL(15, 2),
LPR_COEFICIENT DECIMAL(18, 8),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
LPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
LPC_ID INTEGER,
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
LPR_SALE_PRICE DECIMAL(15, 2),
LPR_SALE_COST_PARKING_TRANS DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(6) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CPR_LIST_PRODUCE_LOAD (LPR_ID_IN INTEGER,
CPR_DATE TIMESTAMP)
RETURNS (LPR_ID INTEGER,
CPR_ID INTEGER,
LPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
LPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPR_PRICE_BRUTTO DECIMAL(15, 2),
LPR_DISCOUNT DECIMAL(15, 2),
LPR_PRICE_NETTO DECIMAL(15, 2),
LPR_COUNT DECIMAL(15, 2),
CUS_ID INTEGER,
CUS_CODE VARCHAR(10) CHARACTER SET UNICODE_FSS,
CUS_PERCENT DECIMAL(15, 2),
LPR_COEFICIENT DECIMAL(18, 8),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
LPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
LPC_ID INTEGER,
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
LPR_SALE_PRICE DECIMAL(15, 2),
LPR_SALE_COST_PARKING_TRANS DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(6) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CPR_TRANSPORTS_LOAD (CPR_ID_IN INTEGER)
RETURNS (TRN_ID INTEGER,
CPR_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
TRN_SUM DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CPR_TRANSPORT_LOAD (TRN_ID_IN INTEGER)
RETURNS (TRN_ID INTEGER,
CPR_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
TRN_SUM DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CURRENCIES_RATES_FOR_DATE (COURSE_DATE DATE)
RETURNS (CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
CRT_ID INTEGER,
CRT_RATE DECIMAL(15, 6))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CURRENCY_RATE_FOR_DATE (CUR_ID INTEGER,
COURSE_DATE DATE)
RETURNS (CRT_ID INTEGER,
CRT_RATE DECIMAL(15, 6),
CRT_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CURRENCY_RATE_MIN_DATE RETURNS (CRT_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CURRENT_WORKS_FILTER (CRQ_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID_IN INTEGER,
CRQ_EQUIPMENT_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CRQ_STUFF_CATEGORY_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
ORD_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (CRQ_ID INTEGER,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID INTEGER,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_CREATE_DATE TIMESTAMP,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
MANAGER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_SUM DECIMAL(15, 2),
ORD_SENT_TO_PROD_DATE DATE,
EXECUTED_DATES VARCHAR(500) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CURRENT_WORK_ADD_INFO (ORD_ID INTEGER)
RETURNS (SPI_SEND_DATES VARCHAR(1000) CHARACTER SET UNICODE_FSS,
COST_PRODUCES_DATES VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SHIP_NUMBERS_DATES VARCHAR(3000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_CUSTOM_CODE_FILTER (CUS_CODE_IN VARCHAR(520) CHARACTER SET UNICODE_FSS)
RETURNS (CUS_ID INTEGER,
CUS_CODE VARCHAR(10) CHARACTER SET UNICODE_FSS,
CUS_DESCRIPTION VARCHAR(500) CHARACTER SET UNICODE_FSS,
CUS_PERCENT DECIMAL(15, 2),
CUS_BLOCK SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_DECODE_ID_LIST (PAR_IDS VARCHAR(1024) CHARACTER SET UNICODE_FSS)
RETURNS (INT_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_DELETE_CONTRACT_CLOSED (CTC_ID INTEGER)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_DELETE_DUPLICATE_CTN (OLD_STF_ID INTEGER,
NEW_STF_ID INTEGER)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_DELIVERY_REQUEST_FILTER (DLR_NUMBER_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
DLR_DATE_BEGIN_IN DATE,
DLR_DATE_END_IN DATE,
DLR_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
DLR_FAIR_TRADE_IN SMALLINT,
UNEXECUTED SMALLINT,
MINSK SMALLINT,
ANNUL_EXCLUDE SMALLINT,
SPECIFICATION_NUMBERS_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (DLR_ID INTEGER,
DLR_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
DLR_DATE DATE,
DLR_FAIR_TRADE SMALLINT,
DLR_PLACE_REQUEST SMALLINT,
DLR_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
DLR_ANNUL SMALLINT,
SPECIFICATION_NUMBERS VARCHAR(5000) CHARACTER SET UNICODE_FSS,
CUSTOMERS VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CONTRACTS VARCHAR(2500) CHARACTER SET UNICODE_FSS,
ORDERS VARCHAR(2500) CHARACTER SET UNICODE_FSS,
DLR_MINSK SMALLINT,
USR_ID INTEGER,
DEP_ID INTEGER,
PRODUCE_COUNT INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_DELIVERY_REQUEST_INSERT (DLR_DATE DATE,
DLR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
DLR_FAIR_TRADE SMALLINT,
DLR_WHEREFROM VARCHAR(100) CHARACTER SET UNICODE_FSS,
DLR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
DLR_PLACE_REQUEST SMALLINT,
DLR_MINSK SMALLINT,
DLR_NEED_DELIVER SMALLINT,
DLR_ORD_NOT_FORM SMALLINT,
DLR_GUARANTEE_REPAIR SMALLINT,
DLR_INCLUDE_IN_SPEC SMALLINT,
DLR_ANNUL SMALLINT,
DLR_EXECUTED SMALLINT)
RETURNS (DLR_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_DEPARTMENT_FILTER (DEP_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_DLR_COUNT_BY_PRD_ID_DLR_ID (PRD_ID INTEGER,
STF_ID INTEGER,
ORD_ID INTEGER,
DLR_ID INTEGER)
RETURNS (TRN_PRODUCE_COUNT DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_DLR_LIST_PRODUCES_LOAD (DLR_ID_IN INTEGER)
RETURNS (DRP_ID INTEGER,
DLR_ID INTEGER,
PRD_ID INTEGER,
DRP_PRICE DECIMAL(15, 2),
DRP_COUNT DECIMAL(15, 2),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
OPR_ID INTEGER,
ASM_ID INTEGER,
APR_ID INTEGER,
SIP_ID INTEGER,
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
DRP_PURPOSE VARCHAR(500) CHARACTER SET UNICODE_FSS,
DRP_OCCUPIED INTEGER,
RECEIVE_MANAGER_ID INTEGER,
RECEIVE_MANAGER_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
RECEIVE_MANAGER_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
RECEIVE_DATE DATE,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
SPI_NUMBERS VARCHAR(500) CHARACTER SET UNICODE_FSS,
DRP_HAVE_DEPEND SMALLINT,
ORD_INFO VARCHAR(500) CHARACTER SET UNICODE_FSS,
ORD_INFO_CONTRACTOR_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_ID INTEGER,
DRP_MAX_EXTRA SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_DLR_LIST_PRODUCE_LOAD (DRP_ID_IN INTEGER)
RETURNS (DRP_ID INTEGER,
DLR_ID INTEGER,
PRD_ID INTEGER,
DRP_PRICE DECIMAL(15, 2),
DRP_COUNT DECIMAL(15, 2),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
OPR_ID INTEGER,
ASM_ID INTEGER,
APR_ID INTEGER,
SIP_ID INTEGER,
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
DRP_PURPOSE VARCHAR(500) CHARACTER SET UNICODE_FSS,
DRP_OCCUPIED INTEGER,
RECEIVE_MANAGER_ID INTEGER,
RECEIVE_MANAGER_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
RECEIVE_MANAGER_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
RECEIVE_DATE DATE,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
SPI_NUMBERS VARCHAR(500) CHARACTER SET UNICODE_FSS,
DLR_ORD_NOT_FORM SMALLINT,
DRP_HAVE_DEPEND SMALLINT,
ORD_INFO VARCHAR(500) CHARACTER SET UNICODE_FSS,
ORD_INFO_CONTRACTOR_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_ID INTEGER,
DRP_MAX_EXTRA SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_DRP_DEPENDED_LINES (ASM_ID INTEGER)
RETURNS (ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
PRD_COUNT DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_EQUIPMENT_FILTER (CON_ID_IN INTEGER,
CRQ_EQUIPMENT_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
REQ_ID INTEGER)
RETURNS (LPS_ID INTEGER,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPS_USR_ID INTEGER,
LPS_USR_FULLNAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPS_ENTER_IN_USE_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS,
LPS_OCCUPIED INTEGER,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
SHP_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_SELLER_ID INTEGER,
CON_SELLER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_EQUIPMENT_FOR_PRODUCE_LOAD (STF_ID INTEGER,
PRD_ID INTEGER)
RETURNS (CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_EQUIPMENT_GUARANTY_LOAD (LPS_ID INTEGER,
PRD_ID INTEGER)
RETURNS (CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_EQUIPMENT_PNP_LOAD (LPS_ID INTEGER)
RETURNS (CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPS_ENTER_IN_USE_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_1C_BY_PRC_ID_PRD_ID (PRD_ID INTEGER,
STF_ID INTEGER,
PRC_ID INTEGER)
RETURNS (LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ASM_LIST_FOR_ORD (ORD_ID INTEGER)
RETURNS (ASSEMBLIES VARCHAR(2500) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ASM_NUM_DATE_FOR_ORD (ORD_ID INTEGER)
RETURNS (ASM_NUM_DATE VARCHAR(40) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ATT_COUNT_FOR_SPC (SPC_ID INTEGER)
RETURNS (ATTACHMENTSCOUNT INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_BLANK_IMAGES_IN_STR (BLN_ID INTEGER)
RETURNS (BLN_IMAGES VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_CATEGORIES_FOR_TREE (CAT_ID_IN INTEGER,
CAT_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_NAME_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CUS_CODE_IN VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
NOT_BLOCKED SMALLINT,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (CAT_ID INTEGER,
IS_HAVE_PRODUCES SMALLINT,
IS_HAVE_SUBFOLDERS SMALLINT,
PRD_COUNT INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_CHILD_CATEGORIES (CAT_ID_IN INTEGER,
CAT_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_NAME_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CUS_CODE_IN VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
NOT_BLOCKED SMALLINT,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (CAT_ID INTEGER,
IS_HAVE_PRODUCES SMALLINT,
IS_HAVE_SUBFOLDERS SMALLINT,
PRD_COUNT INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_CIRC_AND_REST_FOR_PRD (PRD_ID INTEGER)
RETURNS (PRD_CIRCULATION180DAYS DECIMAL(15, 2),
REST_IN_MINSK DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_CONTRACTORS_FOR_FOR_ORD (ORD_ID INTEGER)
RETURNS (CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_CONTRACTOR_FOR_FOR_ORD (ORD_ID INTEGER,
DELIMITER VARCHAR(5) CHARACTER SET UNICODE_FSS)
RETURNS (CONTRACTORS VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_CON_NUM_FOR_DLR (DLR_ID INTEGER)
RETURNS (CON_NUM_AND_OTHER VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_COUNT_DAY (DATE1 DATE,
DATE2 DATE)
RETURNS (COUNT_DAY INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_COUNT_OPR_USED_IN_ASM (OPR_ID INTEGER)
RETURNS (OUT_COUNT DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_COUNT_REST_DRP (DLR_ID INTEGER,
DLR_NEED_DELIVER SMALLINT)
RETURNS (COUNT_REST_DRP DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_CRQ_DELIVER (CRQ_ID INTEGER)
RETURNS (CRQ_DELIVER SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_CTN_NUM_LIST_BY_PRD_ID (PRD_ID INTEGER)
RETURNS (PRODUCT_LIST VARCHAR(5000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_LIST VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_CUSTOMER_FOR_DLR (DLR_ID INTEGER)
RETURNS (CTR_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_DECODE_RESTS_IN_LIT (PRD_ID INTEGER,
STF_ID INTEGER)
RETURNS (QUANTITY DECIMAL(15, 2),
DATE_CREATED TIMESTAMP,
CONTRACTOR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPECIFICATION_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACT_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_DECODE_RESTS_IN_MINSK (PRD_ID INTEGER,
STF_ID INTEGER)
RETURNS (QUANTITY DECIMAL(15, 2),
DATE_CREATED TIMESTAMP,
CONTRACTOR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPECIFICATION_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACT_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_DOUBLE_CONTRACTOR (CTR_ID INTEGER,
PAY_ACCOUNT VARCHAR(35) CHARACTER SET UNICODE_FSS)
RETURNS (CONTRACTORS VARCHAR(800) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_DOUBLE_PRODUCES (STF_ID INTEGER)
RETURNS (DOUBLE_STR VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_MANAGERS_BY_SHP_ID (SHP_ID INTEGER)
RETURNS (MANAGER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_MANAGER_LIST_BY_SHP_ID (SHP_ID INTEGER)
RETURNS (MANAGER_LIST VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_NUM (T VARCHAR(64) CHARACTER SET UNICODE_FSS)
RETURNS (NUM INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_OCCUPIED_SHP_POS (POSITION_IDS VARCHAR(1024) CHARACTER SET UNICODE_FSS)
RETURNS (OCCUPIED_IDS VARCHAR(1024) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_OPR_ID_BY_LPC (ASM_ID_IN INTEGER,
APR_ID_IN INTEGER,
DRP_ID_IN INTEGER,
SIP_ID_IN INTEGER)
RETURNS (OPR_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_OPR_ID_FROM_ASM (ASM_ID INTEGER,
APR_ID INTEGER)
RETURNS (OPR_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ORD_CUST_INFO_FOR_ASM (ASM_ID INTEGER)
RETURNS (CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ORD_ID_BY_LPC (OPR_ID_IN INTEGER,
ASM_ID_IN INTEGER,
APR_ID_IN INTEGER,
DRP_ID_IN INTEGER,
SIP_ID_IN INTEGER)
RETURNS (ORD_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ORD_INFO_FOR_ASM (ASM_ID INTEGER)
RETURNS (ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
ORD_DATE_STR VARCHAR(20) CHARACTER SET UNICODE_FSS,
CONTRACTORS_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ORD_NUM_DATE_FOR_DLR (DLR_ID INTEGER)
RETURNS (ORD_NUM_DATE VARCHAR(40) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_PAYED_DATE (SPC_ID INTEGER,
SPC_SUMM DECIMAL(15, 2),
SPC_PERCENT_OR_SUM SMALLINT,
SPC_DELIVERY_PERCENT DECIMAL(15, 2),
SPC_DELIVERY_SUM DECIMAL(15, 2))
RETURNS (PAYED_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_PRC_LIST_FOR_ORD (ORD_ID INTEGER)
RETURNS (COST_PRODUCES VARCHAR(2500) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_PRC_NUM_DATE_FOR_DRP (DRP_ID INTEGER)
RETURNS (PRC_NUM_DATE VARCHAR(80) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_PRC_NUM_DATE_FOR_ORD (ORD_ID INTEGER)
RETURNS (PRC_NUM_DATE VARCHAR(80) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_PRC_NUM_DATE_FOR_SIP (SIP_ID INTEGER)
RETURNS (PRC_NUM_DATE VARCHAR(80) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_PRODUCES_FOR_CAT (CAT_ID_IN INTEGER,
PRD_NAME_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CUS_CODE_IN VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
NOT_BLOCKED SMALLINT,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (PRD_ID INTEGER,
PRD_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
UNT_ID INTEGER,
CUS_CODE VARCHAR(10) CHARACTER SET UNICODE_FSS,
PRD_BLOCK SMALLINT,
PRODUCT_LIST VARCHAR(5000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_LIST VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_NOT_CHECK_DOUBLE SMALLINT,
PRD_USER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_PRODUCT_LIST_BY_SHP_ID (SHP_ID INTEGER)
RETURNS (PRODUCT_LIST VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_RESERVED_COUNT_FOR_CPR (CPR_ID INTEGER,
LPC_ID INTEGER)
RETURNS (RESERVED DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_RESERVED_INFO (CPR_ID_IN INTEGER,
LPC_ID INTEGER)
RETURNS (RESERVED DECIMAL(15, 2),
RESERVED_FOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
RESERVED_END DATE,
DATE_ACCEPT DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_ASM_FOR_DLR (DLR_ID INTEGER)
RETURNS (APR_ID INTEGER,
ASM_ID INTEGER,
ASM_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_DATE DATE,
PRD_ID INTEGER,
APR_COUNT DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_ASM_FOR_PRC (PRC_ID INTEGER)
RETURNS (APR_ID INTEGER,
ASM_ID INTEGER,
ASM_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_DATE DATE,
PRD_ID INTEGER,
APR_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_DRP_FOR_PRC (PRC_ID INTEGER)
RETURNS (DRP_ID INTEGER,
DLR_ID INTEGER,
DLR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
DLR_DATE DATE,
PRD_ID INTEGER,
DRP_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_DRP_FOR_SPI (SPI_ID INTEGER)
RETURNS (DRP_ID INTEGER,
DLR_ID INTEGER,
DLR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
DLR_DATE DATE,
PRD_ID INTEGER,
DRP_COUNT DECIMAL(15, 2),
GUARANTEE SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_INFO_FROM_ORDER (OPR_ID INTEGER)
RETURNS (CONTRACTOR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPECIFICATION_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACT_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_LPC_FOR_CPR (CPR_ID INTEGER,
RUT_ID INTEGER,
LPC_1C_NUMBER_IN VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRC_DATE_MIN DATE)
RETURNS (LPC_ID INTEGER,
PRC_ID INTEGER,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_DATE DATE,
LPC_COUNT DECIMAL(15, 2),
FREE_COUNT DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
RESERVED DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_LPC_FOR_LPR (CPR_ID INTEGER,
LPC_ID INTEGER)
RETURNS (REST_LPC_COUNT DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_LPC_FOR_SHP (RUT_ID_IN INTEGER,
LPC_1C_NUMBER_IN VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRC_DATE_MIN DATE,
CTR_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRC_ID INTEGER,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_DATE DATE,
PRD_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
RUT_ID INTEGER,
LPC_COUNT DECIMAL(15, 2),
FREE_COUNT DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPR_CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
LPR_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_OPR_FOR_ASM (STF_ID INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_OPR_FOR_DLR (DLR_ID INTEGER,
USR_ID INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
CTR_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SELLER SMALLINT,
SPECIFICATION_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACT_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACTOR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_OPR_FOR_PRC (PRC_ID INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
CTR_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SELLER SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_OPR_FOR_SPI (SPI_ID INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
CTR_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
SELLER SMALLINT,
GUARANTEE SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_SIP_FOR_DLR (DLR_ID INTEGER)
RETURNS (SIP_ID INTEGER,
SPI_ID INTEGER,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
PRD_ID INTEGER,
SIP_COUNT DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_REST_SIP_FOR_PRC (PRC_ID INTEGER)
RETURNS (SIP_ID INTEGER,
SPI_ID INTEGER,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
PRD_ID INTEGER,
SIP_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ROW_SUM (SUM_PAY_CLOSED DECIMAL(15, 2),
SUMM_PLUS_NDS DECIMAL(15, 2),
SUMM_ALL DECIMAL(15, 2))
RETURNS (SUMM_ROW DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ROW_SUMM_EUR (LCC_ID INTEGER,
SUMM_PLUS_NDS FLOAT)
RETURNS (SUMM_EUR DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_ROW_SUMM_OUT_NDS (SUMM_EUR_ROW DECIMAL(15, 2),
NDS_RATE DECIMAL(15, 2))
RETURNS (SUMM_OUT_NDS DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_SPC_PAY_EXPIRATION (SPC_ID INTEGER)
RETURNS (SPC_PAY_EXPIRATION INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_SPI_LIST_FOR_ORD (ORD_ID INTEGER)
RETURNS (SPECIFICATIONS_IMPORT VARCHAR(2500) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_SPI_NUM_DATE_FOR_DRP (DRP_ID INTEGER)
RETURNS (SPI_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_SEND_DATE DATE,
SIP_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_SPI_NUM_DATE_FOR_ORD (ORD_ID INTEGER)
RETURNS (SPI_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_SEND_DATE DATE,
SIP_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_SUM_OUT_NDS_EUR (SPC_ID INTEGER)
RETURNS (SUM_OUT_NDS_EUR DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_SUM_OUT_NDS_EUR_PART (SPC_ID INTEGER,
PAY_IDS VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SHP_IDS VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (SUM_OUT_NDS_EUR DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_TIMESTAMP_BREAKDOWN (PAR_DATE1 TIMESTAMP,
PAR_DATE2 TIMESTAMP,
PAR_INTERVAL VARCHAR(32) CHARACTER SET UNICODE_FSS)
RETURNS (X_VALUE VARCHAR(40) CHARACTER SET UNICODE_FSS,
T_BEGIN TIMESTAMP,
T_END TIMESTAMP)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_TREE (CAT_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_NAME_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CUS_CODE_IN VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
NOT_BLOCKED SMALLINT,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (CAT_ID INTEGER,
CAT_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
PARENT_ID INTEGER,
IS_HAVE_PRODUCES SMALLINT,
IS_HAVE_SUBFOLDERS SMALLINT,
PRD_COUNT INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_USER_FOR_CONTRACT (CON_ID INTEGER)
RETURNS (USR_ID INTEGER,
CON_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_USR_DEP_LIST_CON (CON_ID INTEGER)
RETURNS (CON_USER VARCHAR(1000) CHARACTER SET UNICODE_FSS,
USR_ID_LIST VARCHAR(200) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_USR_FOR_SPEC_IMP (SPI_ID INTEGER)
RETURNS (USERS VARCHAR(2000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GET_USR_ID_LIST_SHP (SHP_ID INTEGER,
SPC_ID INTEGER)
RETURNS (USR_ID_LIST VARCHAR(500) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST VARCHAR(500) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GOODS_CIRCULATION (DATE_BEGIN DATE,
DATE_END DATE,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
SLN_ID_IN INTEGER,
CTR_ID_IN INTEGER)
RETURNS (LPS_ID INTEGER,
LPS_COUNT DECIMAL(15, 2),
PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
REST_IN_MINSK DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
UNIT VARCHAR(150) CHARACTER SET UNICODE_FSS,
CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GOODS_CIRCULATION_REST (PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CTR_ID_FOR_IN INTEGER)
RETURNS (PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
UNIT VARCHAR(150) CHARACTER SET UNICODE_FSS,
CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
REST_IN_MINSK DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_GOODS_REST (DATE_IN DATE,
USR_ID_IN INTEGER,
DEP_ID_IN INTEGER,
DATE_TO_IN DATE,
PURPOSE_ID_IN INTEGER,
STF_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
USR_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
UNIT VARCHAR(15) CHARACTER SET UNICODE_FSS,
LPC_COUNT DECIMAL(15, 2),
LPC_COUNT_FREE DECIMAL(15, 2),
PRC_DATE DATE,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
LESS_3_MONTH DECIMAL(15, 2),
MONTH_3_6 DECIMAL(15, 2),
MONTH_6_9 DECIMAL(15, 2),
MONTH_9_12 DECIMAL(15, 2),
MORE_12_MONTH DECIMAL(15, 2),
LPC_COUNT_FREE_TO DECIMAL(15, 2),
LESS_3_MONTH_TO DECIMAL(15, 2),
MONTH_3_6_TO DECIMAL(15, 2),
MONTH_6_9_TO DECIMAL(15, 2),
MONTH_9_12_TO DECIMAL(15, 2),
MORE_12_MONTH_TO DECIMAL(15, 2),
PURPOSE VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORDER_FOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
LPC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
DRP_PURPOSE VARCHAR(500) CHARACTER SET UNICODE_FSS,
PRODUCE_NAME_SORT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
STF_NAME_SORT VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
DLR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_INSTRUCTION_FILTER (IST_ID INTEGER,
INS_NUMBER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
INS_DATE_BEGIN_IN DATE,
INS_DATE_END_IN DATE,
SHOW_ACTIVE SMALLINT,
INS_CONCERNING_IN VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (INS_ID INTEGER,
INS_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
INS_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
INS_DATE_SIGN DATE,
INS_DATE_FROM DATE,
INS_DATE_TO DATE,
INS_CONCERNING VARCHAR(5000) CHARACTER SET UNICODE_FSS,
INS_INACTIVE INTEGER,
ATTACH_IDX INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_INSTRUCTION_INSERT (IST_ID INTEGER,
INS_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
INS_DATE_SIGN DATE,
INS_DATE_FROM DATE,
INS_DATE_TO DATE,
INS_CONCERNING VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (INS_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_INSTRUCTION_LOAD (INS_ID INTEGER)
RETURNS (USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
INS_CREATE_DATE TIMESTAMP,
INS_EDIT_DATE TIMESTAMP,
IST_ID INTEGER,
IST_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
INS_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
INS_DATE_SIGN DATE,
INS_DATE_FROM DATE,
INS_DATE_TO DATE,
INS_CONCERNING VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_IS_HAVE_EMPTY_DATE_CONF (ORD_ID INTEGER,
OPR_ID INTEGER,
ORD_DATE_CONF_ALL SMALLINT)
RETURNS (HAVE_EMPTY_DATE_CONF SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_IS_PAY_CLOSED (PAY_ID INTEGER)
RETURNS (IS_PAY_CLOSED INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_IS_SHP_CLOSED (SHP_ID INTEGER)
RETURNS (IS_SHP_CLOSED INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_IS_WARM_BY_DELIVERY_DATE (ORD_DELIVERY_DATE DATE,
SPC_DELIVERY_DATE DATE)
RETURNS (IS_WARN SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_LOG_FILTER (ACT_ID INTEGER,
USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
IP_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
DATE_BEGIN_IN DATE,
DATE_END_IN DATE)
RETURNS (LOG_ID INTEGER,
LOG_ACTION VARCHAR(100) CHARACTER SET UNICODE_FSS,
LOG_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
LOG_IP VARCHAR(20) CHARACTER SET UNICODE_FSS,
LOG_TIME TIMESTAMP)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_LOG_INSERT (USR_ID INTEGER,
ACT_ID INTEGER,
LOG_IP VARCHAR(20) CHARACTER SET UNICODE_FSS)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_LOG_INSERT_BY_ACT_SYS_NAME (ACT_SYSTEM_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
LOG_IP VARCHAR(20) CHARACTER SET UNICODE_FSS)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_MARGIN (DEP_ID_IN INTEGER,
USR_ID_IN INTEGER,
CTR_ID_IN INTEGER,
STF_ID_IN INTEGER,
RUT_ID_IN INTEGER,
DATE_BEGIN DATE,
DATE_END DATE,
CTC_BLOCK_IN SMALLINT)
RETURNS (LCC_ID INTEGER,
LPS_ID INTEGER,
CTC_ID INTEGER,
CTC_DATE DATE,
CTC_BLOCK SMALLINT,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
PAY_ID INTEGER,
PAY_DATE DATE,
PAY_COURSE DECIMAL(15, 6),
LPS_SUMM_EUR DECIMAL(15, 2),
LPS_SUMM DECIMAL(15, 2),
LPS_SUM_TRANSPORT DECIMAL(15, 2),
LPS_CUSTOM DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LCC_CHARGES DECIMAL(15, 2),
LCC_MONTAGE DECIMAL(15, 2),
LCC_TRANSPORT DECIMAL(15, 2),
LCC_UPDATE_SUM DECIMAL(15, 2),
LPS_MONTAGE_TIME DECIMAL(15, 1),
SUMM DECIMAL(15, 2),
SUMM_ZAK DECIMAL(15, 2),
MARGIN DECIMAL(15, 2),
USR_ID INTEGER,
USR_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
RUT_ID INTEGER,
RUT_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CON_ORIGINAL SMALLINT,
SPC_ORIGINAL SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
LPC_ID INTEGER,
PRD_ID INTEGER,
MONTAGE_COST DECIMAL(15, 2),
CUT_ID INTEGER,
CUT_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
HAVE_UNBLOCKED_PRC SMALLINT,
SHP_ORIGINAL SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_MARGIN1 (DEP_ID_IN INTEGER,
USR_ID_IN INTEGER,
CTR_ID_IN INTEGER,
STF_ID_IN INTEGER,
RUT_ID_IN INTEGER,
DATE_BEGIN DATE,
DATE_END DATE,
CTC_BLOCK_IN SMALLINT)
RETURNS (LPS_ID INTEGER,
CTC_DATE DATE,
CTC_BLOCK SMALLINT,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
LPS_SUMM_EUR DECIMAL(15, 2),
LPS_SUMM DECIMAL(15, 2),
LPS_SUM_TRANSPORT DECIMAL(15, 2),
LPS_CUSTOM DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LCC_CHARGES DECIMAL(15, 2),
LCC_MONTAGE DECIMAL(15, 2),
LCC_TRANSPORT DECIMAL(15, 2),
LCC_UPDATE_SUM DECIMAL(15, 2),
LPS_MONTAGE_TIME DECIMAL(15, 1),
SUMM DECIMAL(15, 2),
SUMM_ZAK DECIMAL(15, 2),
MARGIN DECIMAL(15, 2),
USR_ID INTEGER,
USR_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
RUT_ID INTEGER,
RUT_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CON_ORIGINAL SMALLINT,
SPC_ORIGINAL SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
MONTAGE_COST DECIMAL(15, 2),
CUT_ID INTEGER,
CUT_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
HAVE_UNBLOCKED_PRC SMALLINT,
SHP_ORIGINAL SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_MONTAGE_ADJUSTMENT_INSERT (STF_ID INTEGER,
MAD_MACHINE_TYPE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
RETURNS (MAD_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_MOVEMENT_LOAD (PRD_ID INTEGER,
STF_ID INTEGER,
KOEF DECIMAL(15, 5),
OPR_PARENT_ID_IN INTEGER)
RETURNS (SHP_ID INTEGER,
SHP_DATE DATE,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_PRODUCE_CNT DECIMAL(15, 2),
SHP_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
LPC_ID INTEGER,
PRC_ID INTEGER,
PRC_DATE DATE,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_PRODUCE_CNT DECIMAL(15, 2),
PRC_PRODUCE_CNT_REST DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
ASM_ID INTEGER,
DLR_ID INTEGER,
SPI_ID INTEGER,
TRN_ID INTEGER,
TRN_DATE DATE,
TRN_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
TRN_PRODUCE_CNT DECIMAL(15, 2),
TRN_PRODUCE_CNT_REST DECIMAL(15, 2),
DLR_MINSK SMALLINT,
OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
ORD_EXECUTED_DATE DATE,
ORD_PRODUCE_CNT DECIMAL(15, 2),
ORD_PRODUCE_CNT_EXECUTED DECIMAL(15, 2),
ORD_PRODUCE_CNT_REST DECIMAL(15, 2),
ORD_ANNUL SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORDERS_LOGISTICS (ORD_DATE_BEGIN DATE,
ORD_DATE_END DATE,
INCLUDE_EMPTY_DATES SMALLINT)
RETURNS (ORD_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CONF_DATE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CONF_NUM VARCHAR(200) CHARACTER SET UNICODE_FSS,
CONTACT_PERSON VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_DOC_TYPE_NUM VARCHAR(2000) CHARACTER SET UNICODE_FSS,
WEIGHT DECIMAL(15, 3),
"COMMENT" VARCHAR(3000) CHARACTER SET UNICODE_FSS,
INCLUDE_EMPTY_DATES_SORT SMALLINT,
CONF_DATE_SORT DATE,
HAVE_EMPTY_DATE_CONF SMALLINT,
ORD_RECEIVED_CONF_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORDERS_STATISTICS (DATE_BEGIN DATE,
DATE_END DATE,
DEP_ID_IN INTEGER,
STF_ID_IN INTEGER,
CTR_ID_IN INTEGER,
CTR_ID_FOR_IN INTEGER)
RETURNS (STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
ORD_SUMM DECIMAL(15, 2),
ORD_SUMM_SENT_TO_PROD DECIMAL(15, 2),
ORD_SUMM_PART_EXECUTED DECIMAL(15, 2),
ORD_SUMM_EXECUTED DECIMAL(15, 2),
ORD_SUMM_EXECUTED_BEFORE DECIMAL(15, 2),
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORDERS_UNEXECUTED RETURNS (STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
STF_NAME_SORT VARCHAR(150) CHARACTER SET UNICODE_FSS,
ORD_ID INTEGER,
ORD_DATE DATE,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_NUMBER_SORT VARCHAR(15) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRODUCE_FULL_NAME_SORT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_SORT VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_COUNT DECIMAL(15, 2),
ORD_COUNT_EXECUTED DECIMAL(15, 2),
ORD_COUNT_UNEXECUTED DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORDER_FILTER (ORD_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_CONTRACTOR_FOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_STUFF_CATEGORY_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
ORD_DATE_BEGIN_IN DATE,
ORD_DATE_END_IN DATE,
ORD_SUMM_MIN_IN DECIMAL(18, 2),
ORD_SUMM_MAX_IN DECIMAL(18, 2),
ORD_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
DEP_ID_IN INTEGER,
ORD_EXECUTED_IN SMALLINT,
ORD_READY_FOR_DELIV_IN SMALLINT,
SLN_SELLER_FOR_WHO_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
STATE_A SMALLINT,
STATE_3 SMALLINT,
STATE_B SMALLINT,
STATE_EXCLAMATION SMALLINT,
STATE_C SMALLINT,
ORD_NUM_CONF_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_ANNUL_NOT_SHOW SMALLINT,
CON_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(150) CHARACTER SET UNICODE_FSS)
RETURNS (ORD_ID INTEGER,
ORD_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
ORD_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_CONTRACTOR_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_SUMM DECIMAL(18, 2),
ORD_SENT_TO_PROD_DATE DATE,
ORD_RECEIVED_CONF_DATE DATE,
ORD_CONF_SENT_DATE DATE,
ORD_READY_FOR_DELIV_DATE DATE,
ORD_READY_FOR_DELIV SMALLINT,
ORD_EXECUTED_DATE DATE,
ORD_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_DEPARTMENT VARCHAR(100) CHARACTER SET UNICODE_FSS,
IS_WARN SMALLINT,
USR_ID_CREATE INTEGER,
ORD_BLOCK SMALLINT,
ORD_DATE_CONF DATE,
COUNT_DAY_CURR_MINUS_SENT INTEGER,
ORD_ANNUL SMALLINT,
ORD_NUM_CONF VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_ARRIVE_IN_LITHUANIA DATE,
DEP_ID INTEGER,
HAVE_EMPTY_DATE_CONF SMALLINT,
ORD_COMMENT_FLAG INTEGER,
ORD_SHIP_FROM_STOCK DATE,
ORD_LINK_TO_SPEC INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORDER_INSERT (ORD_DATE DATE,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
BLN_ID INTEGER,
CTR_ID INTEGER,
CPS_ID INTEGER,
ORD_CONCERNING VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
TRM_ID INTEGER,
ORD_ADDR VARCHAR(256) CHARACTER SET UNICODE_FSS,
ORD_PAY_CONDITION VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_DELIVERY_TERM VARCHAR(300) CHARACTER SET UNICODE_FSS,
ORD_ADD_INFO VARCHAR(5000) CHARACTER SET UNICODE_FSS,
USR_ID_DIRECTOR INTEGER,
USR_ID_LOGIST INTEGER,
USR_ID_DIRECTOR_RB INTEGER,
USR_ID_CHIEF_DEP INTEGER,
USR_ID_MANAGER INTEGER,
CTR_ID_FOR INTEGER,
SPC_ID INTEGER,
STF_ID INTEGER,
ORD_SENT_TO_PROD_DATE DATE,
ORD_RECEIVED_CONF_DATE DATE,
ORD_NUM_CONF VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_DATE_CONF DATE,
ORD_CONF_SENT_DATE DATE,
ORD_READY_FOR_DELIV_DATE DATE,
ORD_EXECUTED_DATE DATE,
ORD_BLOCK SMALLINT,
ORD_SUMM DECIMAL(15, 2),
ORD_DELIVERY_COST_BY VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_DELIVERY_COST DECIMAL(15, 2),
ORD_DONOT_CALCULATE_NETTO SMALLINT,
CUR_ID INTEGER,
ORD_INCLUDE_NDS SMALLINT,
ORD_NDS_RATE DECIMAL(15, 2),
SLN_ID_FOR_WHO INTEGER,
SLN_ID INTEGER,
ORD_DISCOUNT_ALL SMALLINT,
ORD_DISCOUNT DECIMAL(15, 2),
ORD_COUNT_ITOG_FLAG SMALLINT,
ORD_ADD_REDUCTION_FLAG SMALLINT,
ORD_ADD_REDUCTION DECIMAL(15, 2),
ORD_ADD_RED_PRE_PAY_FLAG SMALLINT,
ORD_ADD_RED_PRE_PAY DECIMAL(15, 2),
ORD_ALL_INCLUDE_IN_SPEC SMALLINT,
ORD_ANNUL SMALLINT,
ORD_IN_ONE_SPEC SMALLINT,
ORD_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
ORD_COMMENT_COVERING_LETTER VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_DATE_CONF_ALL SMALLINT,
ORD_READY_FOR_DELIV_DATE_ALL SMALLINT,
SDT_ID INTEGER,
ORD_SHP_DOC_NUMBER VARCHAR(60) CHARACTER SET UNICODE_FSS,
ORD_BY_GUARANTY SMALLINT,
ORD_SHIP_FROM_STOCK DATE,
ORD_ARRIVE_IN_LITHUANIA DATE,
ORD_PRINT_SCALE INTEGER,
ORD_LETTER_SCALE INTEGER,
ORD_LOGIST_SIGNATURE SMALLINT,
ORD_DIRECTOR_RB_SIGNATURE SMALLINT,
ORD_CHIEF_DEP_SIGNATURE SMALLINT,
ORD_MANAGER_SIGNATURE SMALLINT)
RETURNS (ORD_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORDER_LOAD_CONTRACT (ORD_ID INTEGER)
RETURNS (CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORD_LIST_PRD_LOAD_PARENT (OPR_PARENT_ID_IN INTEGER)
RETURNS (OPR_ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
OPR_COUNT_EXECUTED INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORD_LIST_PRODUCES_LOAD (ORD_ID_IN INTEGER,
CLONE SMALLINT)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
OPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
OPR_COUNT DECIMAL(15, 2),
OPR_PRICE_BRUTTO DECIMAL(15, 2),
OPR_DISCOUNT DECIMAL(15, 2),
OPR_PRICE_NETTO DECIMAL(15, 2),
OPR_SUMM DECIMAL(15, 2),
OPR_USE_PREV_NUMBER CHAR(1) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
OPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
DRP_PRICE DECIMAL(15, 2),
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
OPR_COUNT_OCCUPIED DECIMAL(15, 2),
OPR_OCCUPIED INTEGER,
SPECIFICATION_NUMBERS VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_PARENT_ID INTEGER,
OPR_HAVE_DEPEND SMALLINT,
DRP_MAX_EXTRA SMALLINT,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
SLN_IS_RESIDENT SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORD_LIST_PRODUCE_INSERT (ORD_ID INTEGER,
OPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
OPR_COUNT DECIMAL(15, 2),
OPR_PRICE_BRUTTO DECIMAL(15, 2),
OPR_DISCOUNT DECIMAL(15, 2),
OPR_PRICE_NETTO DECIMAL(15, 2),
OPR_SUMM DECIMAL(15, 2),
OPR_USE_PREV_NUMBER CHAR(1) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
DRP_PRICE DECIMAL(15, 2),
CTR_ID INTEGER,
SPC_ID INTEGER,
OPR_PARENT_ID INTEGER,
OPR_HAVE_DEPEND SMALLINT,
DRP_MAX_EXTRA SMALLINT)
RETURNS (OPR_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORD_LIST_PRODUCE_LOAD (OPR_ID_IN INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
OPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
OPR_COUNT DECIMAL(15, 2),
OPR_PRICE_BRUTTO DECIMAL(15, 2),
OPR_DISCOUNT DECIMAL(15, 2),
OPR_PRICE_NETTO DECIMAL(15, 2),
OPR_SUMM DECIMAL(15, 2),
OPR_USE_PREV_NUMBER CHAR(1) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
PRD_BLOCK SMALLINT,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
OPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
DRP_PRICE DECIMAL(15, 2),
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE VARCHAR(10) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_DATE DATE,
STF_ID INTEGER,
OPR_COUNT_OCCUPIED DECIMAL(15, 2),
OPR_OCCUPIED INTEGER,
SPECIFICATION_NUMBERS VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_PARENT_ID INTEGER,
OPR_HAVE_DEPEND SMALLINT,
DRP_MAX_EXTRA SMALLINT,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
SLN_IS_RESIDENT SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_ORD_MESSAGES_LOAD (USR_ID_IN INTEGER)
RETURNS (ORM_ID INTEGER,
ORM_CREATE_DATE TIMESTAMP,
ORM_MESSAGE VARCHAR(256) CHARACTER SET UNICODE_FSS,
CTR_NAME VARCHAR(2000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_OUTGOING_LETTER_FILTER (OTL_NUMBER_IN VARCHAR(15) CHARACTER SET UNICODE_FSS,
OTL_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
OTL_DATE_BEGIN_IN DATE,
OTL_DATE_END_IN DATE,
OTL_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
SLN_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (OTL_ID INTEGER,
OTL_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
OTL_DATE DATE,
OTL_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
ATTACH_IDX INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_OUTGOING_LETTER_INSERT (OTL_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
OTL_DATE DATE,
SLN_ID INTEGER,
CTR_ID INTEGER,
CPS_ID INTEGER,
OTL_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (OTL_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_OUTGOING_LETTER_LOAD (OTL_ID INTEGER)
RETURNS (USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
OTL_CREATE_DATE TIMESTAMP,
OTL_EDIT_DATE TIMESTAMP,
OTL_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
OTL_DATE DATE,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPS_ID INTEGER,
CPS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
OTL_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PAYMENT_FILTER (PAY_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PAY_CONTRACTOR_ID_IN INTEGER,
PAY_DATE_BEGIN_IN DATE,
PAY_DATE_END_IN DATE,
PAY_SUMM_MIN_IN DECIMAL(15, 2),
PAY_SUMM_MAX_IN DECIMAL(15, 2),
PAY_BLOCK_IN SMALLINT,
CUR_ID_IN INTEGER,
PAY_CLOSED_IN INTEGER,
PAY_ACCOUNT_IN VARCHAR(35) CHARACTER SET UNICODE_FSS)
RETURNS (PAY_ID INTEGER,
PAY_DATE DATE,
PAY_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
PAY_SUMM DECIMAL(15, 2),
PAY_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PAY_BLOCK SMALLINT,
USR_ID_CREATE INTEGER,
PAY_ACCOUNT VARCHAR(35) CHARACTER SET UNICODE_FSS,
PAY_COURSE DECIMAL(15, 6),
PAY_SUMM_EUR DECIMAL(15, 2),
DOUBLE_ACCOUNT SMALLINT,
DOUBLE_CONTRACTORS VARCHAR(800) CHARACTER SET UNICODE_FSS,
PAY_COURSE_NBRB DECIMAL(15, 6),
PAY_SUMM_EUR_NBRB DECIMAL(15, 2),
PAY_COMMENT VARCHAR(500) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PAYMENT_INSERT (PAY_DATE DATE,
PAY_ACCOUNT VARCHAR(35) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CUR_ID INTEGER,
PAY_BLOCK SMALLINT,
PAY_SUMM DECIMAL(15, 2),
PAY_COURSE DECIMAL(15, 6),
PAY_COMMENT VARCHAR(500) CHARACTER SET UNICODE_FSS,
PAY_COURSE_NBRB DECIMAL(15, 6),
PAY_COURSE_NBRB_DATE DATE)
RETURNS (PAY_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PAY_MESSAGES_LOAD (USR_ID_IN INTEGER)
RETURNS (PMS_ID INTEGER,
PMS_CREATE_DATE TIMESTAMP,
PMS_MESSAGE VARCHAR(1024) CHARACTER SET UNICODE_FSS,
PMS_SUM DECIMAL(15, 2),
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
PMS_PERCENT DECIMAL(15, 2),
PMS_UPDATED SMALLINT,
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PRC_LIST_PRODUCES_LOAD (PRC_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRC_ID INTEGER,
LPC_PRODUCE_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
LPC_COUNT DECIMAL(15, 2),
LPC_COST_ONE_LTL DECIMAL(15, 2),
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
LPC_COST_ONE DECIMAL(15, 2),
LPC_WEIGHT DECIMAL(15, 3),
LPC_SUMM DECIMAL(15, 2),
LPC_SUM_TRANSPORT DECIMAL(15, 2),
LPC_CUSTOM DECIMAL(15, 2),
LPC_PERCENT VARCHAR(12) CHARACTER SET UNICODE_FSS,
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_ID INTEGER,
DRP_ID INTEGER,
SIP_ID INTEGER,
APR_ID INTEGER,
ASM_ID INTEGER,
LPC_OCCUPIED INTEGER,
USR_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
USR_CODE VARCHAR(3) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
SPI_ID INTEGER,
DLR_ID INTEGER,
NO_ROUND SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PRC_LIST_PRODUCE_LOAD (LPC_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRC_ID INTEGER,
PRC_DATE DATE,
LPC_PRODUCE_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
LPC_COUNT DECIMAL(15, 2),
LPC_COST_ONE_LTL DECIMAL(15, 2),
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
LPC_COST_ONE DECIMAL(15, 2),
LPC_WEIGHT DECIMAL(15, 3),
LPC_SUMM DECIMAL(15, 2),
LPC_SUM_TRANSPORT DECIMAL(15, 2),
LPC_CUSTOM DECIMAL(15, 2),
LPC_PERCENT VARCHAR(12) CHARACTER SET UNICODE_FSS,
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_ID INTEGER,
DRP_ID INTEGER,
SIP_ID INTEGER,
APR_ID INTEGER,
ASM_ID INTEGER,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
SPI_ID INTEGER,
DLR_ID INTEGER,
NO_ROUND SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PROCESS_OPR_UNEXECUTED (ORD_ID INTEGER,
ORD_EXECUTED_DATE DATE)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_PRODUCE_COST_FILTER (PRC_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_ROUTE_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRC_DATE_BEGIN_IN DATE,
PRC_DATE_END_IN DATE,
NUMBER_1C_IN VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRC_BLOCK_IN SMALLINT)
RETURNS (PRC_ID INTEGER,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_ROUTE VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRC_DATE DATE,
PRC_BLOCK SMALLINT,
USR_ID_CREATE INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PRODUCE_COST_INSERT (PRC_DATE DATE,
RUT_ID INTEGER,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_BLOCK SMALLINT,
PRC_SUM_TRANSPORT DECIMAL(15, 2),
PRC_WEIGHT DECIMAL(15, 2),
PRC_COURSE_LTL_EUR DECIMAL(15, 4))
RETURNS (PRC_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PRODUCE_COST_REPORT (DATE_BEGIN DATE,
DATE_END DATE,
ONLY_BLOCK SMALLINT)
RETURNS (PRC_ID INTEGER,
PRC_DATE DATE,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ROUTE VARCHAR(150) CHARACTER SET UNICODE_FSS,
WEIGHT DECIMAL(15, 3),
TRANSPORT DECIMAL(15, 2),
CUSTOM DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PRODUCE_COST_REPORT_SUM (DATE_BEGIN DATE,
DATE_END DATE,
ONLY_BLOCK SMALLINT)
RETURNS (PRC_DATE DATE,
WEIGHT DECIMAL(15, 3),
TRANSPORT DECIMAL(15, 2),
CUSTOM DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_PRODUCE_IN_SPC_IMPORT (PRD_ID INTEGER)
RETURNS (SPC_IMPORT_COUNT_ONE SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SAVE_CFC_ECO_MSG (ECONOMIST_ROLE_ID INTEGER,
ULN_URL VARCHAR(64) CHARACTER SET UNICODE_FSS,
ULN_PARAMETERS VARCHAR(128) CHARACTER SET UNICODE_FSS,
ULN_TEXT VARCHAR(500) CHARACTER SET UNICODE_FSS,
ULN_MENU_ID VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_SAVE_CFC_MESSAGES (CFC_ID INTEGER,
CTR_ID INTEGER,
MSG VARCHAR(256) CHARACTER SET UNICODE_FSS)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_SAVE_CONTRACT_MESSAGES (CON_ID INTEGER,
SPC_ID INTEGER,
CTR_ID INTEGER,
MSG VARCHAR(256) CHARACTER SET UNICODE_FSS)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_SAVE_ORD_MESSAGES (ORD_ID INTEGER,
PRC_ID INTEGER,
MANAGER_ROLE_ID INTEGER,
MSG VARCHAR(256) CHARACTER SET UNICODE_FSS)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_SAVE_PAYMENT_MESSAGES (PAY_ID INTEGER,
MANAGER_ROLE_ID INTEGER,
MSG_RECEIVED_PAYMENT VARCHAR(50) CHARACTER SET UNICODE_FSS,
MSG_RECEIVED_PAYMENT_BY_CON VARCHAR(50) CHARACTER SET UNICODE_FSS,
MSG_FROM VARCHAR(10) CHARACTER SET UNICODE_FSS,
MSG_SPEC VARCHAR(20) CHARACTER SET UNICODE_FSS,
MSG_COMMENT VARCHAR(250) CHARACTER SET UNICODE_FSS)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_SERIAL_NUMBER_FILTER (PRD_ID_IN INTEGER,
SERIAL_NUMBER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (LPS_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SHIPPING_FILTER (SHP_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_DATE_BEGIN_IN DATE,
SHP_DATE_END_IN DATE,
SHP_SUMM_MIN_IN DECIMAL(15, 2),
SHP_SUMM_MAX_IN DECIMAL(15, 2),
SHP_BLOCK_IN SMALLINT,
SHP_CLOSED_IN INTEGER,
CUR_ID_IN INTEGER,
SLN_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_SUMM_PLUS_NDS DECIMAL(15, 2),
SHP_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
SHP_BLOCK SMALLINT,
USR_ID_CREATE INTEGER,
COUNT_DAY INTEGER,
SHP_DATE_EXPIRATION DATE,
SHP_SUMM DECIMAL(15, 2),
PAY_SUMM DECIMAL(15, 2),
NOT_SHOW_MSG SMALLINT,
SHP_CLOSED SMALLINT,
USR_ID_LIST VARCHAR(500) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST VARCHAR(500) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SHIPPING_GOODS (DATE_IN DATE,
USR_ID_IN INTEGER,
DEP_ID_IN INTEGER,
DATE_TO_IN DATE,
STF_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
USR_NAME VARCHAR(41) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
UNIT VARCHAR(15) CHARACTER SET UNICODE_FSS,
LPC_COUNT DECIMAL(15, 2),
LPC_COUNT_FREE DECIMAL(15, 2),
SHP_DATE DATE,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
LESS_3_MONTH DECIMAL(15, 2),
MONTH_3_6 DECIMAL(15, 2),
MONTH_6_9 DECIMAL(15, 2),
MONTH_9_12 DECIMAL(15, 2),
MORE_12_MONTH DECIMAL(15, 2),
LPC_COUNT_FREE_TO DECIMAL(15, 2),
LESS_3_MONTH_TO DECIMAL(15, 2),
MONTH_3_6_TO DECIMAL(15, 2),
MONTH_6_9_TO DECIMAL(15, 2),
MONTH_9_12_TO DECIMAL(15, 2),
MORE_12_MONTH_TO DECIMAL(15, 2),
DEBT_SUMM DECIMAL(15, 2),
DEBT_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PURPOSE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
LPC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
USR_SHIPPING VARCHAR(41) CHARACTER SET UNICODE_FSS,
PRODUCE_NAME_SORT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
STF_NAME_SORT VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SHIPPING_INSERT (SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_DATE_EXPIRATION DATE,
SPC_ID INTEGER,
SHP_SUMM_PLUS_NDS DECIMAL(15, 2),
CUR_ID INTEGER,
CTR_ID INTEGER,
SHP_LETTER1_DATE DATE,
SHP_LETTER2_DATE DATE,
SHP_LETTER3_DATE DATE,
SHP_COMPLAINT_IN_COURT_DATE DATE,
SHP_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
SHP_MONTAGE SMALLINT,
SHP_SERIAL_NUM_YEAR_OUT SMALLINT,
CTR_ID_WHERE INTEGER,
CON_ID_WHERE INTEGER,
SHP_NOTICE_DATE DATE,
SHP_SUMM_TRANSPORT DECIMAL(15, 2),
SHP_ORIGINAL SMALLINT,
SHP_SUM_UPDATE DECIMAL(15, 2))
RETURNS (SHP_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SHIPPING_REPORT (DATE_BEGIN DATE,
DATE_END DATE,
CTR_ID INTEGER,
NOT_INCLUDE_ZERO SMALLINT,
INCLUDE_TYPE SMALLINT)
RETURNS (SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_PRD_COUNT INTEGER,
SHP_SUMM_PLUS_NDS DECIMAL(15, 2),
SHP_SUM_NR DECIMAL(15, 2),
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SHP_CLOSED INTEGER,
CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
PRD_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_ID INTEGER,
LPS_COUNT DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LPS_SUMM_OUT_NDS DECIMAL(15, 2),
LPS_SUMM_OUT_NDS_EUR DECIMAL(15, 2),
LPS_SUMM_ZAK DECIMAL(15, 2),
MANAGER_ID INTEGER,
MANAGER VARCHAR(500) CHARACTER SET UNICODE_FSS,
DEPARTMENT VARCHAR(500) CHARACTER SET UNICODE_FSS,
LPS_SUM_TRANSPORT DECIMAL(15, 2),
LPS_CUSTOM DECIMAL(15, 2),
COUNTRY VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SHIPPING_REPORT_USER (DATE_BEGIN DATE,
DATE_END DATE,
USR_ID INTEGER,
DEP_ID INTEGER,
CTR_ID INTEGER,
NOT_INCLUDE_ZERO SMALLINT,
INCLUDE_TYPE SMALLINT)
RETURNS (SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_PRD_COUNT INTEGER,
SHP_SUMM_PLUS_NDS DECIMAL(15, 2),
SHP_SUM_NR DECIMAL(15, 2),
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SHP_CLOSED SMALLINT,
CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
PRD_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_ID INTEGER,
LPS_COUNT DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LPS_SUMM_OUT_NDS DECIMAL(15, 2),
LPS_SUMM_OUT_NDS_EUR DECIMAL(15, 2),
LPS_SUMM_ZAK DECIMAL(15, 2),
MANAGER_ID INTEGER,
MANAGER VARCHAR(50) CHARACTER SET UNICODE_FSS,
DEPARTMENT VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_SUM_TRANSPORT DECIMAL(15, 2),
LPS_CUSTOM DECIMAL(15, 2),
COUNTRY VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SHP_LIST_PRODUCE_INSERT (SHP_ID INTEGER,
STF_ID INTEGER,
LPC_ID INTEGER,
LPS_COUNT DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LPS_ENTER_IN_USE_DATE DATE,
LPS_MONTAGE_TIME DECIMAL(15, 1),
LPS_MONTAGE_OFF SMALLINT,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPR_ID INTEGER)
RETURNS (LPS_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SIP_DEPENDED_LINES (OPR_ID INTEGER,
DRP_ID INTEGER)
RETURNS (ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRD_COUNT DECIMAL(15, 2),
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SPECIFICATION_IMPORT_FILTER (SPI_NUMBER_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPI_DATE_BEGIN_IN DATE,
SPI_DATE_END_IN DATE,
SPI_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (SPI_ID INTEGER,
SPI_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
SPI_ARRIVE SMALLINT,
SPI_USERS VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SPI_COST DECIMAL(15, 2),
SPI_SEND_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SPECIFICATION_IMPORT_INSERT (SPI_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SPI_COURSE DECIMAL(15, 4),
SPI_KOEFF DECIMAL(15, 3),
SPI_ARRIVE SMALLINT,
SPI_COST DECIMAL(15, 2))
RETURNS (SPI_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SPI_COUNT_BY_PRD_ID_SPI_ID (PRD_ID INTEGER,
STF_ID INTEGER,
ORD_ID INTEGER,
SPI_ID INTEGER)
RETURNS (TRN_PRODUCE_COUNT DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SPI_LIST_PRODUCES_LOAD (SPI_ID_IN INTEGER,
USR_ID INTEGER)
RETURNS (SPI_ID INTEGER,
SIP_ID INTEGER,
DRP_ID INTEGER,
OPR_ID INTEGER,
PRD_ID INTEGER,
SIP_PRICE DECIMAL(15, 2),
SIP_COUNT DECIMAL(15, 2),
SIP_WEIGHT DECIMAL(15, 3),
SIP_PERCENT DECIMAL(15, 2),
SIP_COST DECIMAL(15, 2),
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SIP_OCCUPIED INTEGER,
DRP_PRICE DECIMAL(15, 2),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
DLR_ORD_NOT_FORM SMALLINT,
COUNT_DAY INTEGER,
HAVE_DEPEND SMALLINT,
ORD_ID INTEGER,
DRP_MAX_EXTRA SMALLINT,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_DELIVERY_DATE DATE,
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
PAY_PERSENT DECIMAL(15, 2))
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_SPI_LIST_PRODUCE_LOAD (SIP_ID_IN INTEGER)
RETURNS (SIP_ID INTEGER,
SPI_ID INTEGER,
DRP_ID INTEGER,
OPR_ID INTEGER,
PRD_ID INTEGER,
SIP_PRICE DECIMAL(15, 2),
SIP_COUNT DECIMAL(15, 2),
SIP_WEIGHT DECIMAL(15, 3),
SIP_PERCENT DECIMAL(15, 2),
SIP_COST DECIMAL(15, 2),
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SIP_OCCUPIED INTEGER,
DRP_PRICE DECIMAL(15, 2),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
DLR_ORD_NOT_FORM SMALLINT,
COUNT_DAY INTEGER,
HAVE_DEPEND SMALLINT,
ORD_ID INTEGER,
DRP_MAX_EXTRA SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_DELIVERY_DATE DATE,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_STUFF_CATEGORY_FILTER (STF_NAME_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
MONTAGE SMALLINT)
RETURNS (STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_TIMEBOARD_FILTER (TMB_DATE_IN DATE,
TMB_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (TMB_ID INTEGER,
TMB_DATE DATE,
TMB_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
TMB_CHECKED SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_TIMEBOARD_INSERT (USR_ID INTEGER,
TMB_DATE DATE,
TMB_CHECKED SMALLINT)
RETURNS (TMB_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_TIMEBOARD_LOAD (TMB_ID INTEGER)
RETURNS (USR_ID INTEGER,
TMB_DATE DATE,
TMB_CHECKED SMALLINT,
USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
TMB_CREATE_DATE TIMESTAMP,
TMB_EDIT_DATE TIMESTAMP,
TMB_CHECKED_DATE TIMESTAMP,
USR_ID_CHECKED INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_TIMEBOARD_LOAD_CHECK_IDX (USR_ID INTEGER,
TMB_DATE DATE)
RETURNS (TMB_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_TMB_LIST_WORKS_LOAD (TMB_ID_IN INTEGER)
RETURNS (TBW_ID INTEGER,
TMB_ID INTEGER,
TBW_DATE DATE,
TBW_FROM TIME,
TBW_TO TIME,
TBW_HOURS_UPDATE DECIMAL(15, 2),
CRQ_ID INTEGER,
TBW_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID INTEGER,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_DELIVER SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_TMB_LIST_WORK_LOAD (TBW_ID_IN INTEGER)
RETURNS (TBW_ID INTEGER,
TMB_ID INTEGER,
TBW_DATE DATE,
TBW_FROM TIME,
TBW_TO TIME,
TBW_HOURS_UPDATE DECIMAL(15, 2),
CRQ_ID INTEGER,
TBW_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID INTEGER,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_DELIVER SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_UNCLOSED_SPEC RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_ORIGINAL SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_GROUP_DELIVERY SMALLINT,
SPC_ORIGINAL SMALLINT,
PAY_SUM DECIMAL(15, 2),
SHP_SUM DECIMAL(15, 2),
HAVE_UNBLOCKED_PRC SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_UNIT_INSERT (IS_ACCEPTABLE_FOR_CPR CHAR(1) CHARACTER SET UNICODE_FSS)
RETURNS (UNT_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_UNIT_PACK (UNT_NAME_FROM VARCHAR(150) CHARACTER SET UNICODE_FSS,
UNT_NAME_TO VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_UPDATE_DELIVERY_DATE (SPC_ID INTEGER)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_CTR (OLD_CTR_ID INTEGER,
NEW_CTR_ID INTEGER)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_CUT (OLD_CUT_ID INTEGER,
NEW_CUT_ID INTEGER)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_PRD (OLD_PRD_ID INTEGER,
NEW_PRD_ID INTEGER)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_STF (OLD_STF_ID INTEGER,
NEW_STF_ID INTEGER)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_UPDATE_USER_BLOCK (USR_ID INTEGER,
USR_BLOCK SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE DCL_USER_ACTIONS (USR_ID INTEGER)
RETURNS (ACT_ID INTEGER,
ACT_SYSTEM_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_USER_FILTER (USR_NAME_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
RESPONS_PERSON SMALLINT)
RETURNS (USR_ID INTEGER,
USR_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_USER_FILTER_FULL (DEP_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (USR_ID INTEGER,
USR_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
USR_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
USR_POSITION VARCHAR(60) CHARACTER SET UNICODE_FSS,
USR_CODE VARCHAR(3) CHARACTER SET UNICODE_FSS,
USR_LOGIN VARCHAR(8) CHARACTER SET UNICODE_FSS,
USR_DEPARTMENT VARCHAR(100) CHARACTER SET UNICODE_FSS,
USR_PHONE VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_BLOCK SMALLINT,
USR_RESPONS_PERSON SMALLINT,
USR_NO_LOGIN SMALLINT,
USR_CHIEF_DEP SMALLINT,
USR_FAX VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_EMAIL VARCHAR(100) CHARACTER SET UNICODE_FSS,
ROLES VARCHAR(300) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_USER_INSERT (USR_CODE VARCHAR(3) CHARACTER SET UNICODE_FSS,
USR_LOGIN VARCHAR(8) CHARACTER SET UNICODE_FSS,
USR_PASSWD VARCHAR(64) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
USR_PHONE VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_BLOCK SMALLINT,
USR_RESPONS_PERSON SMALLINT,
USR_NO_LOGIN SMALLINT,
USR_CHIEF_DEP SMALLINT,
USR_FAX VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_EMAIL VARCHAR(100) CHARACTER SET UNICODE_FSS,
USR_LOCAL_ENTRY SMALLINT,
USR_INTERNET_ENTRY SMALLINT)
RETURNS (USR_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE DCL_YEARWEEK (D DATE)
RETURNS (WEEK_NO VARCHAR(8) CHARACTER SET UNICODE_FSS,
WEEK_NO_ONLY SMALLINT,
YEAR_NO_ONLY SMALLINT)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE GET_CONTEXT RETURNS (USR_ID INTEGER)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_APR_ID (APR_ID INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_DRP_ID (DRP_ID INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_LPC_ID (LPC_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_OPR_ID (OPR_ID INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_DELIVERY_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_SIP_ID (SIP_ID INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE GET_PRC_DATES_ON_STORAGE (CTR_ID INTEGER,
CON_ID INTEGER,
SPC_ID INTEGER)
RETURNS (DATES_FOR_PRODUCE_ON_STORAGE VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE MAINTENANCE_SELECTIVITY AS 
BEGIN SUSPEND; END ^
CREATE OR ALTER PROCEDURE MIGRATE_TO_CUSTOM_CODE_HISTORY AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE SET_CONTEXT (USER_ID INTEGER)
AS 
BEGIN EXIT; END ^
CREATE OR ALTER PROCEDURE YEARWEEK (D DATE)
RETURNS (WEEK_NO VARCHAR(8) CHARACTER SET UNICODE_FSS)
AS 
BEGIN SUSPEND; END ^

SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;

/*  Index definitions for all user tables */
CREATE INDEX DCL_ACCOUNT_IDX ON DCL_ACCOUNT (ACC_ACCOUNT);
CREATE UNIQUE INDEX DCL_ACTION_ACT_ACTION ON DCL_ACTION (ACT_SYSTEM_NAME);
CREATE INDEX DCL_IDX_ATT_PRN_ID_PRN_TBL ON DCL_ATTACHMENT (ATT_PARENT_ID, ATT_PARENT_TABLE);
CREATE UNIQUE INDEX DCL_BLANK_IDX_NAME_TYPE ON DCL_BLANK (BLN_TYPE, BLN_NAME);
CREATE UNIQUE INDEX DCL_CTN_INDEX_PRD_STF ON DCL_CATALOG_NUMBER (STF_ID, PRD_ID);
CREATE UNIQUE INDEX DCL_CATEGORY_IDX1 ON DCL_CATEGORY (CAT_ID, PARENT_ID);
CREATE INDEX DCL_CPR_IDX_DATE ON DCL_COMMERCIAL_PROPOSAL (CPR_DATE);
CREATE INDEX IDX_CPR_CTR ON DCL_COMMERCIAL_PROPOSAL (CTR_ID);
CREATE INDEX IDX_CPR_USR_CREATE ON DCL_COMMERCIAL_PROPOSAL (USR_ID_CREATE);
CREATE INDEX DCL_CFC_IDX_PLACE_DATE ON DCL_COND_FOR_CONTRACT (CFC_PLACE_DATE);
CREATE INDEX IDX_DCL_CONTRACT_CTR_ID ON DCL_CONTRACT (CTR_ID);
CREATE INDEX IDX_DCL_CONTRACT_CUR_ID ON DCL_CONTRACT (CUR_ID);
CREATE INDEX IDX_DCL_CONTRACT_SLN_ID ON DCL_CONTRACT (SLN_ID);
CREATE UNIQUE INDEX DCL_CONTRACTOR_UNP_IDX ON DCL_CONTRACTOR (CTR_UNP);
CREATE INDEX DCL_CONTRACT_CLOSED_CTC_DATE ON DCL_CONTRACT_CLOSED (CTC_DATE);
CREATE INDEX IDX_DCL_CON_LIST_SPEC_CON_ID ON DCL_CON_LIST_SPEC (CON_ID);
CREATE INDEX IDX_DCL_CON_LIST_SPEC_USR_ID ON DCL_CON_LIST_SPEC (USR_ID);
CREATE INDEX IDX_CPR_LIST_CPR ON DCL_CPR_LIST_PRODUCE (CPR_ID);
CREATE INDEX IDX_CPR_LIST_STF ON DCL_CPR_LIST_PRODUCE (STF_ID);
CREATE UNIQUE INDEX DCL_CRT_CUR_ID_DATE_IDX ON DCL_CURRENCY_RATE (CUR_ID, CRT_DATE);
CREATE INDEX DCL_DELIVERY_REQUEST_IDX1 ON DCL_DELIVERY_REQUEST (DLR_DATE);
CREATE UNIQUE INDEX DCL_FIELD_COMMENT_KEY ON DCL_FIELD_COMMENT (FCM_KEY);
CREATE UNIQUE INDEX DCL_FLP_TABLE_NAME_IDX ON DCL_FILES_PATH (FLP_TABLE_NAME);
CREATE INDEX DCL_LOG_IDX_LOG_IP ON DCL_LOG (LOG_IP);
CREATE INDEX DCL_LOG_IDX_LOG_TIME ON DCL_LOG (LOG_TIME);
CREATE INDEX DCL_PAYMENT_IDX_DATE ON DCL_PAYMENT (PAY_DATE);
CREATE INDEX IDX_DCL_PAY_LIST_SUMM_PAY_ID ON DCL_PAY_LIST_SUMM (PAY_ID);
CREATE INDEX IDX_DCL_PAY_LIST_SUMM_SPC_ID ON DCL_PAY_LIST_SUMM (SPC_ID);
CREATE INDEX DCL_PRODUCE_COST_PRC_DATE ON DCL_PRODUCE_COST (PRC_DATE);
CREATE UNIQUE INDEX DCL_RATE_RTN_DATE_FROM ON DCL_RATE_NDS (RTN_DATE_FROM);
CREATE UNIQUE INDEX DCL_SETTING_NAME ON DCL_SETTING (STN_NAME);
CREATE INDEX DCL_SHIPPING_IDX_DATE ON DCL_SHIPPING (SHP_DATE);
CREATE INDEX IDX_DCL_SHIPPING_SPC_ID ON DCL_SHIPPING (SPC_ID);
CREATE UNIQUE INDEX DCL_TMB_USR_ID_TMB_DATE ON DCL_TIMEBOARD (USR_ID, TMB_DATE);
CREATE UNIQUE INDEX DCL_USER_SETTING_UN ON DCL_USER_SETTING (USR_ID, UST_NAME);

/* View: DCL_CUSTOM_CODE_V, Owner: SYSDBA */
CREATE VIEW DCL_CUSTOM_CODE_V (CUS_CODE, CUS_INSTANT) AS

select cus_code, max(cus_instant) cus_instant
    from dcl_custom_code
    where cus_instant < ADDDAY((SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE), 1)
    group by cus_code
;

/* View: DCL_OCCUPIED_DLR_PRODUCE_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_DLR_PRODUCE_V (DRP_ID) AS
select distinct drp.drp_id
from  dcl_dlr_list_produce drp
where drp_id in
      (
        select distinct drp_id from dcl_spi_list_produce where drp_id = drp.drp_id
      )
      or
      drp_id in
      (
        select distinct drp_id from dcl_prc_list_produce where drp_id = drp.drp_id
      );

/* View: DCL_OCCUPIED_SPI_PRODUCE_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_SPI_PRODUCE_V (SIP_ID) AS
select distinct sip.sip_id
from  dcl_spi_list_produce sip
where sip_id in
      (
        select distinct sip_id from dcl_prc_list_produce where sip_id = sip.sip_id
      )
      or
      sip_id in
      (
        select distinct sip_id from dcl_dlr_list_produce drp, dcl_delivery_request dlr where sip_id = sip.sip_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
      );

/* View: DCL_SPEC_IN_CTC_V, Owner: SYSDBA */
CREATE VIEW DCL_SPEC_IN_CTC_V (SPC_ID) AS
select distinct spc.spc_id
from  dcl_con_list_spec spc
where spc_id in
      (
        select distinct spc_id from dcl_ctc_list where spc_id = spc.spc_id
      );

/* View: DCL_OCCUPIED_SHP_DOC_TYPE_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_SHP_DOC_TYPE_V (SDT_ID) AS
select distinct sdt.sdt_id
from  dcl_shp_doc_type sdt
where sdt_id in
      (
        select distinct sdt_id from dcl_order where sdt_id = sdt.sdt_id
      )
      or
      sdt_id in
      (
        select distinct sdt_id from dcl_ready_for_shipping where sdt_id = sdt.sdt_id
      );

/* View: DCL_OCCUPIED_SPEC_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_SPEC_V (SPC_ID) AS
select distinct spc.spc_id
from  dcl_con_list_spec spc
where spc_id in
      (
        select distinct spc_id from dcl_ctc_list where spc_id = spc.spc_id
      )
      or
      spc_id in
      (
        select distinct spc_id from dcl_order where spc_id = spc.spc_id
      )
      or
      spc_id in
      (
        select distinct spc_id from dcl_ord_list_produce where spc_id = spc.spc_id
      )
      or
      spc_id in
      (
        select distinct spc_id from dcl_pay_list_summ where spc_id = spc.spc_id
      )
      or
      spc_id in
      (
        select distinct spc_id from dcl_shipping where spc_id = spc.spc_id
      );

/* View: DCL_OCCUPIED_ORD_PRODUCE_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_ORD_PRODUCE_V (OPR_ID) AS
select distinct opr.opr_id
from  dcl_ord_list_produce opr
where opr_id in
      (
        select distinct opr_id from dcl_dlr_list_produce drp, dcl_delivery_request dlr where opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
      )
      or
      opr_id in
      (
        select distinct opr_id from dcl_prc_list_produce where opr_id = opr.opr_id
      )
      or
      opr_id in
      (
        select distinct opr_id from dcl_spi_list_produce where opr_id = opr.opr_id
      )
      or
      opr_id in
      (
        select distinct opr_id from dcl_assemble where opr_id = opr.opr_id
      )
      or
      opr_id in
      (
        select distinct opr_id from dcl_asm_list_produce where opr_id = opr.opr_id
      );

/* View: DCL_OCCUPIED_SPEC_IN_PAY_SHP_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_SPEC_IN_PAY_SHP_V (SPC_ID) AS
select distinct spc.spc_id
from  dcl_con_list_spec spc
where spc_id in
      (
        select distinct spc_id from dcl_pay_list_summ where spc_id = spc.spc_id
      )
      or
      spc_id in
      (
        select distinct spc_id from dcl_shipping where spc_id = spc.spc_id
      );

/* View: DCL_OCCUPIED_ASM_PRODUCE_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_ASM_PRODUCE_V (ASM_ID) AS
select distinct asm.asm_id
from  dcl_assemble asm
where asm_id in
      (
        select distinct asm_id from dcl_dlr_list_produce drp, dcl_delivery_request dlr where asm_id = asm.asm_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
      )
      or
      asm_id in
      (
        select distinct asm_id from dcl_prc_list_produce where asm_id = asm.asm_id
      );

/* View: DCL_SHP_USR_DEP_V, Owner: SYSDBA */
CREATE VIEW DCL_SHP_USR_DEP_V (SHP_ID, USR_ID, DEP_ID) AS
select distinct shp.shp_id, usr.usr_id, dep.dep_id
from  dcl_department dep,
      dcl_shipping shp,
      dcl_shp_list_produce lps,
      dcl_user usr,
      dcl_lps_list_manager lmn
where
      dep.dep_id = usr.dep_id and
      usr.usr_id = lmn.usr_id and
      shp.shp_id = lps.shp_id and
      lps.lps_id = lmn.lps_id;

/* View: DCL_OCCUPIED_APR_PRODUCE_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_APR_PRODUCE_V (APR_ID) AS
select distinct apr.apr_id
from  dcl_asm_list_produce apr
where apr_id in
      (
        select distinct apr_id from dcl_dlr_list_produce drp, dcl_delivery_request dlr where apr_id = apr.apr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
      )
      or
      apr_id in
      (
        select distinct apr_id from dcl_prc_list_produce where apr_id = apr.apr_id
      );

/* View: DCL_OCCUPIED_CONTRACT_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_CONTRACT_V (CON_ID) AS
select distinct con.con_id
from  dcl_contract con,
      dcl_con_list_spec spc
where
      spc.con_id = con.con_id and
      (
        spc.spc_id in ( select spc_id from DCL_OCCUPIED_SPEC_V where spc_id = spc.spc_id )
        or
        con.con_id in
        (
          select distinct con_id from dcl_cond_for_contract where con_id = con.con_id
        )
        or
        con.con_id in
        (
          select distinct con_id_where from dcl_shipping where con_id_where = con.con_id
        )
      );

/* View: DCL_OCCUPIED_CONTRACTOR_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_CONTRACTOR_V (CTR_ID) AS
select distinct ctr.ctr_id
from  dcl_contractor ctr
where ctr_id in
      (
        select distinct ctr_id from dcl_commercial_proposal where ctr_id = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id from dcl_cond_for_contract where ctr_id = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id from dcl_contract where ctr_id = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id from dcl_contractor_request where ctr_id = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id from dcl_contractor_request where ctr_id_other = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id from dcl_dlr_list_produce where ctr_id = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id from dcl_order where ctr_id = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id_for from dcl_order where ctr_id_for = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id from dcl_ord_list_produce where ctr_id = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id from dcl_payment where ctr_id = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id from dcl_shipping where ctr_id = ctr.ctr_id
      )
      or
      ctr_id in
      (
        select distinct ctr_id_where from dcl_shipping where ctr_id_where = ctr.ctr_id
      );

/* View: DCL_OCCUPIED_COUNTRY_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_COUNTRY_V (CUT_ID) AS
select distinct cut.cut_id
from  dcl_country cut
where cut_id in
      (
        select distinct cut_id from dcl_contractor where cut_id = cut.cut_id
      );

/* View: DCL_OCCUPIED_PRC_PRODUCE_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_PRC_PRODUCE_V (LPC_ID) AS
select distinct lpc.lpc_id
from  dcl_prc_list_produce lpc
where (
        lpc_id in
        (
          select lpc_id from dcl_shp_list_produce where lpc_id = lpc.lpc_id
        )
      )
      or
      (
        ( select reserved from dcl_get_reserved_count_for_cpr(-1, lpc.lpc_id) ) > 0
      );

/* View: DCL_OCCUPIED_STUFF_CATEGORY_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_STUFF_CATEGORY_V (STF_ID) AS
select distinct stf.stf_id
from  dcl_stuff_category stf
where stf_id in
      (
        select distinct stf_id from dcl_assemble where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_catalog_number where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_cfc_list_produce where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_contractor_request where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_cpr_list_produce where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_cpr_transport where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_dlr_list_produce where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_montage_adjustment where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_order where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_prc_list_produce where stf_id = stf.stf_id
      )
      or
      stf_id in
      (
        select distinct stf_id from dcl_shp_list_produce where stf_id = stf.stf_id
      );

/* View: DCL_OCCUPIED_ROUTE_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_ROUTE_V (RUT_ID) AS
select distinct rut.rut_id
from  dcl_route rut
where rut_id in
      (
        select distinct rut_id from dcl_produce_cost where rut_id = rut.rut_id
      );

/* View: DCL_OCCUPIED_SELLER_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_SELLER_V (SLN_ID) AS
select distinct sln.sln_id
from  dcl_seller sln
where sln_id in
      (
        select distinct sln_id from dcl_contract where sln_id = sln.sln_id
      );

/* View: DCL_OCCUPIED_PRC_PRODUCE_CPR_V, Owner: SYSDBA */
CREATE VIEW DCL_OCCUPIED_PRC_PRODUCE_CPR_V (LPC_ID) AS
select distinct lpc.lpc_id
from  dcl_prc_list_produce lpc
where (
        lpc_id in
        (
          select lpc_id from dcl_cpr_list_produce where lpc_id = lpc.lpc_id
        )
      )
      or
      (
        ( select reserved from dcl_get_reserved_count_for_cpr(-1, lpc.lpc_id) ) > 0
      );

/* View: DCL_LNT_PRODUCE, Owner: SYSDBA */
CREATE VIEW DCL_LNT_PRODUCE (PRD_ID, PRD_NAME, PRD_TYPE, PRD_PARAMS, PRD_ADD_PARAMS) AS
select PRD_ID, PRD_NAME, PRD_TYPE, PRD_PARAMS, PRD_ADD_PARAMS from dcl_produce;

/* View: DCL_LNT_SERVICE, Owner: SYSDBA */
CREATE VIEW DCL_LNT_SERVICE (LPS_ID, LPS_SERIAL_NUM) AS
select LPS_ID, LPS_SERIAL_NUM from dcl_shp_list_produce;

/* View: DCL_LNT_SERVICE_CONTRACT, Owner: SYSDBA */
CREATE VIEW DCL_LNT_SERVICE_CONTRACT (CON_ID, CON_NUMBER, CON_DATE, CON_FINAL_DATE, CTR_ID, CON_ORIGINAL) AS
select CON_ID, CON_NUMBER, CON_DATE, CON_FINAL_DATE, CTR_ID, CON_ORIGINAL from dcl_contract;

/* View: DCL_LNT_ACCOUNT, Owner: SYSDBA */
CREATE VIEW DCL_LNT_ACCOUNT (ACC_ID, CTR_ID, ACC_NAME, ACC_ACCOUNT, CUR_ID, ACC_INDEX) AS
select ACC_ID, CTR_ID, ACC_NAME, ACC_ACCOUNT, CUR_ID, ACC_INDEX from dcl_account;

COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

/* Stored functions bodies */

ALTER FUNCTION ADDDAY (ADATE DATE,
ADAYS INTEGER)
RETURNS DATE
AS 
BEGIN
  RETURN DATEADD(DAY, :ADAYS, :ADATE);
END ^

ALTER FUNCTION DNVL (A DOUBLE PRECISION,
B DOUBLE PRECISION)
RETURNS DOUBLE PRECISION
AS 
BEGIN
  RETURN COALESCE(A, B);
END ^

ALTER FUNCTION STRLEN (S VARCHAR(10000) CHARACTER SET UNICODE_FSS)
RETURNS INTEGER
AS 
BEGIN
  RETURN CHAR_LENGTH(S);
END ^

ALTER FUNCTION SUBSTR (S VARCHAR(512) CHARACTER SET UNICODE_FSS,
POS SMALLINT,
LEN SMALLINT)
RETURNS VARCHAR(512) CHARACTER SET UNICODE_FSS
AS 
BEGIN
  RETURN SUBSTRING(S FROM POS FOR LEN);
END ^

SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;

COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

/* Stored procedures bodies */

ALTER PROCEDURE CHECKUSERMESSAGESONDELETE AS 
declare variable message_id integer;
declare variable message_creation_date date;
declare variable delete_user_messages_period integer;

begin
select stn_value from DCL_SETTING ds where ds.stn_name='deleteUserMessagesPeriod' into :delete_user_messages_period ;
for select orm_id, orm_create_date from DCL_ORD_MESSAGE into :message_id, :message_creation_date do
begin
if(datediff(day, cast(message_creation_date as date), current_date) >= delete_user_messages_period)
then delete from DCL_ORD_MESSAGE where orm_id= :message_id;
end

for select pms_id, pms_create_date from DCL_PAY_MESSAGE into :message_id, :message_creation_date do
begin
if(datediff(day, cast(message_creation_date as date), current_date) >= delete_user_messages_period)
then delete from DCL_PAY_MESSAGE where pms_id= :message_id;
end

for select cms_id, cms_create_date from DCL_CON_MESSAGE into :message_id, :message_creation_date do
begin
if(datediff(day, cast(message_creation_date as date), current_date) >= delete_user_messages_period)
then delete from DCL_CON_MESSAGE where cms_id= :message_id;
end

for select ccm_id, ccm_create_date from DCL_CFC_MESSAGE into :message_id, :message_creation_date do
begin
if(datediff(day, cast(message_creation_date as date), current_date) >= delete_user_messages_period)
then delete from DCL_CFC_MESSAGE where ccm_id= :message_id;
end

end ^

ALTER PROCEDURE DATE2STR (DATA DATE)
RETURNS (STRDATE VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
declare variable d_year integer;
declare variable d_month integer;
declare variable d_day integer;
begin
  strDate = '';

  D_YEAR = extract(YEAR from DATA);
  D_MONTH = extract(MONTH from DATA);
  D_DAY = extract(DAY from DATA);
  if (D_DAY < 10) then
    strDate = '0' || cast(D_DAY as varchar(2));
  else
    strDate = cast(D_DAY as varchar(2));
  if (D_MONTH < 10) then
    strDate = strDate || '.' || '0' || cast(D_MONTH as varchar(2));
  else
    strDate = strDate || '.' || cast(D_MONTH as varchar(2));
  strDate = strDate || '.' || cast(D_YEAR as varchar(4));

  suspend;
end ^

ALTER PROCEDURE DCL_ADD_INFO_SERVICE_GUARANTEE (LPS_ID INTEGER)
RETURNS (SHP_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_SELLER_ID INTEGER,
CON_SELLER VARCHAR(100) CHARACTER SET UNICODE_FSS)
AS 
declare variable SHP_DATE_LOCAL date;
declare variable CON_DATE_LOCAL date;
declare variable SPC_DATE_LOCAL date;
begin
  shp_date = null;
  con_number = null;
  con_date = null;
  spc_number = null;
  spc_date = null;
  con_seller_id = null;
  con_seller = null;

  select shp.shp_date,
         con.con_number,
         con.con_date,
         spc.spc_number,
         spc.spc_date,
         sln.sln_id,
         sln.sln_name
  from dcl_shipping shp,
       dcl_shp_list_produce lps,
       dcl_con_list_spec spc,
       dcl_contract con
       left join dcl_seller sln on sln.sln_id = con.sln_id
  where lps.lps_id = :lps_id and
        shp.shp_id = lps.shp_id and
        spc.spc_id = shp.spc_id and
        con.con_id = spc.con_id
  into  :shp_date_local,
        :con_number,
        :con_date_local,
        :spc_number,
        :spc_date_local,
        :con_seller_id,
        :con_seller
  ;

  if ( shp_date_local is not null ) then
  begin
    select strdate from date2str(:shp_date_local) into :shp_date;
  end
  if ( con_date_local is not null ) then
  begin
    select strdate from date2str(:con_date_local) into :con_date;
  end
  if ( spc_date_local is not null ) then
  begin
    select strdate from date2str(:spc_date_local) into :spc_date;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_ASM_COUNT_BY_PRD_ID_ASM_ID (PRD_ID INTEGER,
STF_ID INTEGER,
ORD_ID INTEGER,
ASM_ID INTEGER)
RETURNS (TRN_PRODUCE_COUNT DECIMAL(15, 2))
AS 
declare variable opr_id integer;
declare variable apr_count decimal(15,2);
declare variable ord_id_local integer;
begin
  trn_produce_count = 0;

  for
    select
      apr.opr_id,
      apr.apr_count
    from
      dcl_assemble asm,
      dcl_asm_list_produce apr
    where
      asm.asm_id = :asm_id and
      asm.stf_id = :stf_id and
      apr.asm_id = asm.asm_id and
      apr.prd_id = :prd_id
    into :opr_id,
         :apr_count
  do
  begin
    if ( ord_id is not null and opr_id is not null ) then
    begin
      select ord_id from dcl_ord_list_produce where opr_id = :opr_id into :ord_id_local;
      if ( ord_id = ord_id_local ) then
      begin
        trn_produce_count = trn_produce_count + :apr_count;
      end
    end
    else if ( ord_id is null ) then
    begin
      trn_produce_count = trn_produce_count + :apr_count;
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_ASM_LIST_PRODUCES_LOAD (ASM_ID_IN INTEGER)
RETURNS (APR_ID INTEGER,
ASM_ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
OPR_ID INTEGER,
APR_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
APR_OCCUPIED INTEGER)
AS 
begin
  asm_id = asm_id_in;

  for
    select
      apr_id
    from
      dcl_asm_list_produce apr
    where apr.asm_id = :asm_id_in
    order by apr_id
    into
      :apr_id
  do
  begin
    select
      apr_id,
      asm_id,
      prd_id,
      stf_id,
      stf_name,
      opr_id,
      apr_count,
      apr_occupied,
      ctn_number
    from dcl_asm_list_produce_load(:apr_id)
    into :apr_id,
         :asm_id,
         :prd_id,
         :stf_id,
         :stf_name,
         :opr_id,
         :apr_count,
         :apr_occupied,
         :ctn_number
    ;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_ASM_LIST_PRODUCE_LOAD (APR_ID_IN INTEGER)
RETURNS (APR_ID INTEGER,
ASM_ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
OPR_ID INTEGER,
APR_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
APR_OCCUPIED INTEGER)
AS 
begin
  apr_id = null;
  asm_id = null;
  prd_id = null;
  stf_id = null;
  stf_name = null;
  opr_id = null;
  apr_count = null;
  apr_occupied = null;
  ctn_number = null;

  select
    apr.apr_id,
    apr.asm_id,
    apr.prd_id,
    asm.stf_id,
    apr.opr_id,
    apr.apr_count,
    (select apr_id from DCL_OCCUPIED_APR_PRODUCE_V where apr_id = apr.apr_id)
  from
    dcl_assemble asm,
    dcl_asm_list_produce apr
  where asm.asm_id = apr.asm_id and
        apr.apr_id = :apr_id_in
  into :apr_id,
       :asm_id,
       :prd_id,
       :stf_id,
       :opr_id,
       :apr_count,
       :apr_occupied
  ;

  if ( opr_id is not null ) then -- assemble
  begin
    select stf_id from dcl_ord_list_produce_load(:opr_id) into :stf_id;
  end

  if ( stf_id is not null ) then
  begin
    select stf_name from dcl_stuff_category where stf_id = :stf_id into :stf_name;
    select ctn_number from dcl_catalog_number where stf_id = :stf_id and prd_id = :prd_id into :ctn_number;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_ASSEMBLE_FILTER (ASM_NUMBER_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_DATE_BEGIN_IN DATE,
ASM_DATE_END_IN DATE,
ASM_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (ASM_ID INTEGER,
ASM_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ASM_DATE DATE,
ASM_BLOCK SMALLINT,
ASM_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ASM_TYPE SMALLINT)
AS 
begin
  asm_number_in = upper(asm_number_in);
  asm_user_in = upper(asm_user_in);

  for
    select asm_id,
           asm_number,
           asm_date,
           asm_block,
           (select usr_surname || ' ' || usr_name from dcl_user_language  where usr_id=asm.usr_id_create and lng_id = 1) as asm_user,
           asm_type
           from dcl_assemble asm
    where
          (( :asm_date_begin_in is null ) or ( asm_date >=:asm_date_begin_in ))
     and  (( :asm_date_end_in is null ) or ( asm_date <=:asm_date_end_in ))
     and  (( :asm_user_in is null ) or ( :asm_user_in like '' )  or ( (select upper(usr.usr_surname || ' ' || usr.usr_name) from dcl_user_language usr where usr_id = asm.usr_id_create and lng_id = 1) like('%' || :asm_user_in || '%') ))
     and  (( :asm_number_in is null ) or ( :asm_number_in like '' ) or ( upper(asm.asm_number) like('%' || :asm_number_in || '%') ))
    order by asm_date descending, asm_number descending
    into  :asm_id,
          :asm_number,
          :asm_date,
          :asm_block,
          :asm_user,
          :asm_type
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_ASSEMBLE_INSERT (ASM_DATE DATE,
ASM_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_COUNT INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
OPR_ID INTEGER,
ASM_TYPE SMALLINT)
RETURNS (ASM_ID INTEGER)
AS 
begin

  insert into dcl_assemble (
      asm_number,
      asm_date,
      asm_count,
      prd_id,
      stf_id,
      opr_id,
      asm_type
    )
    values (
     :asm_number,
     :asm_date,
     :asm_count,
     :prd_id,
     :stf_id,
     :opr_id,
     :asm_type
    )
    returning asm_id into :asm_id;

  suspend;
end ^

ALTER PROCEDURE DCL_ASSEMBLE_LOAD (ASM_ID_IN INTEGER)
RETURNS (ASM_ID INTEGER,
USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
ASM_CREATE_DATE TIMESTAMP,
ASM_EDIT_DATE TIMESTAMP,
ASM_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_DATE DATE,
ASM_BLOCK SMALLINT,
ASM_COUNT INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
OPR_ID INTEGER,
ASM_TYPE SMALLINT,
ASM_OCCUPIED INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
ORD_INFO VARCHAR(500) CHARACTER SET UNICODE_FSS,
ORD_INFO_CONTRACTOR_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
declare variable ORD_ID integer;
declare variable CONTRACTORS_FOR varchar(1000);
declare variable STR_DATE varchar(20);
begin
  asm_id = null;
  usr_id_create = null;
  usr_id_edit = null;
  asm_create_date = null;
  asm_edit_date = null;
  asm_number = null;
  asm_date = null;
  asm_block = null;
  asm_count = null;
  prd_id = null;
  stf_id = null;
  opr_id = null;
  asm_type = null;
  asm_occupied = null;
  ord_number = null;
  ord_date = null;
  ord_info = '';
  ord_info_contractor_for = '';

  select
    asm_id,
    usr_id_create,
    usr_id_edit,
    asm_create_date,
    asm_edit_date,
    asm_number,
    asm_date,
    asm_block,
    asm_count,
    prd_id,
    stf_id,
    opr_id,
    asm_type,
    (select asm_id from DCL_OCCUPIED_ASM_PRODUCE_V where asm_id = asm.asm_id)
  from dcl_assemble asm
  where asm_id = :asm_id_in
  into
    :asm_id,
    :usr_id_create,
    :usr_id_edit,
    :asm_create_date,
    :asm_edit_date,
    :asm_number,
    :asm_date,
    :asm_block,
    :asm_count,
    :prd_id,
    :stf_id,
    :opr_id,
    :asm_type,
    :asm_occupied
  ;

  -- assemble
  if ( asm_type = 0 ) then
  begin
    for
      select distinct ord_id,
             ord_number,
             ord_date, 
             ord_date_str,
             contractors_for
      from dcl_get_ord_info_for_asm(:asm_id)
      into :ord_id,
           :ord_number,
           :ord_date, 
           :str_date,
           :contractors_for
    do
    begin
      ord_info = ord_info || ord_number || 'from' || str_date || '<br>';
      ord_info_contractor_for = ord_info_contractor_for || contractors_for;
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_BEGIN_OF_NEXT_WEEK (T_INDATE TIMESTAMP)
RETURNS (T_BEGIN_OF_NEXT_WEEK TIMESTAMP)
AS 
DECLARE VARIABLE T DATE;
begin
  -- ISO8601 first day of week is Monday
  t = ADDDAY(T_INDATE, 8 - (EXTRACT (weekday from t_indate - 1) + 1));
  T_BEGIN_OF_NEXT_WEEK = t;

  suspend;
end ^

ALTER PROCEDURE DCL_BLANKS_LOAD (BLN_TYPE_IN SMALLINT)
RETURNS (BLN_ID INTEGER,
BLN_TYPE SMALLINT,
BLN_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
BLN_IMAGES VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_CHARSET VARCHAR(20) CHARACTER SET UNICODE_FSS,
BLN_LANGUAGE VARCHAR(32) CHARACTER SET UNICODE_FSS,
BLN_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_NOTE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_USAGE VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
declare variable checktype smallint;
declare variable bln_id_save integer;
declare variable bln_type_save smallint;
declare variable bln_name_save varchar(50);
declare variable bln_charset_save varchar(20);
declare variable bln_language_save varchar(32);
declare variable bln_preamble_save varchar(1000);
declare variable bln_note_save varchar(1000);
declare variable bln_usage_save varchar(1000);
begin
  checkType = -1;

  for
    select bln_id
    from dcl_blank
    where ( :bln_type_in is null or bln_type = :bln_type_in )
    order by bln_type
    into   :bln_id
  do
  begin
    select bln_type,
           bln_name,
           lng_name,
           bln_charset,
           bln_preamble,
           bln_note,
           bln_usage
    from dcl_blank_load(:bln_id)
    order by bln_type
    into   :bln_type,
           :bln_name,
           :bln_language,
           :bln_charset,
           :bln_preamble,
           :bln_note,
           :bln_usage;

    if ( checkType != bln_type and checkType !=-1 ) then
    begin

      bln_id_save = bln_id;
      bln_type_save = bln_type;
      bln_name_save = bln_name;
      bln_language_save = bln_language;
      bln_charset_save = bln_charset;
      bln_preamble_save = bln_preamble;
      bln_note_save = bln_note;
      bln_usage_save = bln_usage;

      bln_id = null;
      bln_type = null;
      bln_name = null;
      bln_language = null;
      bln_images = null;
      bln_charset = null;
      bln_preamble = null;
      bln_note = null;
      bln_usage = null;

      suspend;

      bln_id = bln_id_save;
      bln_type = bln_type_save;
      bln_name = bln_name_save;
      bln_language = bln_language_save;
      bln_charset = bln_charset_save;
      bln_preamble = bln_preamble_save;
      bln_note = bln_note_save;
      bln_usage = bln_usage_save;
    end

    checkType = bln_type;

    select bln_images from dcl_get_blank_images_in_str(:bln_id) into :bln_images;
    suspend;
  end
end ^

ALTER PROCEDURE DCL_BLANK_INSERT (BLN_TYPE SMALLINT,
BLN_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
LNG_ID INTEGER,
BLN_CHARSET VARCHAR(20) CHARACTER SET UNICODE_FSS,
BLN_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_NOTE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_USAGE VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (BLN_ID INTEGER)
AS 
begin
  insert into dcl_blank (
    bln_type,
    bln_name,
    lng_id,
    bln_charset,
    bln_preamble,
    bln_note,
    bln_usage
  )
  values (
    :bln_type,
    :bln_name,
    :lng_id,
    :bln_charset,
    :bln_preamble,
    :bln_note,
    :bln_usage
  )
  returning bln_id into :bln_id;

  suspend;
end ^

ALTER PROCEDURE DCL_BLANK_LOAD (BLN_ID_IN INTEGER)
RETURNS (BLN_ID INTEGER,
BLN_TYPE SMALLINT,
BLN_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
BLN_CHARSET VARCHAR(20) CHARACTER SET UNICODE_FSS,
LNG_ID INTEGER,
LNG_NAME VARCHAR(32) CHARACTER SET UNICODE_FSS,
BLN_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_NOTE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
BLN_USAGE VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
begin
  bln_id = null;
  bln_type = null;
  bln_name = null;
  bln_charset = null;
  lng_id = null;
  lng_name = null;
  bln_preamble = null;
  bln_note = null;
  bln_usage = null;

  select bln.bln_id,
         bln.bln_type,
         bln.bln_name,
         lng.lng_id,
         lng.lng_name,
         bln.bln_charset,
         bln.bln_preamble,
         bln.bln_note,
         bln.bln_usage
  from dcl_blank bln
       left join dcl_language lng on lng.lng_id = bln.lng_id
  where bln.bln_id = :bln_id_in
  into   :bln_id,
         :bln_type,
         :bln_name,
         :lng_id,
         :lng_name,
         :bln_charset,
         :bln_preamble,
         :bln_note,
         :bln_usage;

  suspend;
end ^

ALTER PROCEDURE DCL_CALCULATION_STATE (CTR_ID INTEGER,
CUR_ID INTEGER,
NOT_INCLUDE_ZERO SMALLINT,
INCLUDE_ALL_SPECS SMALLINT,
SLN_ID_IN INTEGER,
CON_ID_IN INTEGER,
NOT_SHOW_ANNUL SMALLINT,
EARLIEST_DOC_DATE DATE,
USR_ID INTEGER,
DEP_ID INTEGER)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CON_ANNUL SMALLINT,
CON_ANNUL_DATE DATE,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_ADD_PAY_COND VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_COND VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_DATE DATE,
SPC_DELIVERY_DATE_MATH DATE,
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
PAY_ID INTEGER,
PAY_DATE DATE,
PAY_SUMM DECIMAL(15, 2),
PAY_BLOCK SMALLINT,
SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_SUMM DECIMAL(15, 2),
ITOG_LINE SMALLINT,
REST_DOC_LINE SMALLINT,
SHP_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PAY_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_LINE SMALLINT,
PAY_CLOSED INTEGER,
SHP_CLOSED INTEGER,
MANAGERS VARCHAR(5000) CHARACTER SET UNICODE_FSS,
STUFF_CATEGORIES VARCHAR(5000) CHARACTER SET UNICODE_FSS,
COUNT_DAY INTEGER,
SHP_DATE_EXPIRATION DATE,
SHP_LETTER1_DATE DATE,
SHP_LETTER2_DATE DATE,
SHP_LETTER3_DATE DATE,
SHP_COMPLAINT_IN_COURT_DATE DATE,
SHP_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
SHP_ORIGINAL SMALLINT,
PAY_COMMENT VARCHAR(500) CHARACTER SET UNICODE_FSS,
SHP_NO_ACT SMALLINT,
ONLY_SPEC SMALLINT,
NO_SHIPPING SMALLINT,
PAY_DATE_EXPIRATION DATE,
ALONE_SHIPPING SMALLINT,
CON_COMMENT_FLAG INTEGER,
SPC_COMMENT_FLAG INTEGER,
DATES_FOR_PRODUCE_ON_STORAGE VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_CLOSED_CORRECT INTEGER,
GET_PAY_EXPIRATION_FROM_PROC SMALLINT,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_PAY_EXPIRATION INTEGER,
SPC_WHOSE_ID INTEGER,
SPC_WHOSE VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_ID_LIST_CON VARCHAR(200) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST_CON VARCHAR(200) CHARACTER SET UNICODE_FSS,
USR_ID_LIST_SHP VARCHAR(500) CHARACTER SET UNICODE_FSS,
CON_FINAL_DATE DATE,
CON_DAY_BEFORE_FINAL INTEGER,
CON_INCORRECT_FINAL_DATE SMALLINT)
AS 
declare variable MAX_DOC_FOR_SPC_COUNT integer;
declare variable SHP_COUNT integer;
declare variable PAY_COUNT integer;
declare variable IDX integer;
declare variable CURR_PAY integer;
declare variable CURR_SHP integer;
declare variable SPC_SUMM_ITOG decimal(15,2);
declare variable PAY_SUMM_ITOG decimal(15,2);
declare variable SHP_SUMM_ITOG decimal(15,2);
declare variable CUR_ITOG varchar(10);
declare variable CTR_NAME_CHECK varchar(200);
declare variable CON_ID_SAVED integer;
declare variable CON_NUMBER_SAVED varchar(200);
declare variable CON_DATE_SAVED date;
declare variable CON_CURRENCY_SAVED varchar(10);
declare variable CON_ANNUL_SAVED smallint;
declare variable CON_ANNUL_DATE_SAVED date;
declare variable SPC_ID_SAVED integer;
declare variable SPC_NUMBER_SAVED varchar(50);
declare variable SPC_DATE_SAVED date;
declare variable SPC_SUMM_SAVED decimal(15,2);
declare variable SPC_ADD_PAY_COND_SAVED varchar(2000);
declare variable SPC_DELIVERY_COND_SAVED varchar(2000);
declare variable SPC_DELIVERY_DATE_SAVED date;
declare variable SPC_ANNUL_SAVED smallint;
declare variable SPC_ANNUL_DATE_SAVED date;
declare variable CTR_ID_LOCAL integer;
declare variable SPC_GROUP_DELIVERY smallint;
declare variable SPC_PAY_SUMM decimal(15,2);
declare variable SPC_SHP_SUMM decimal(15,2);
declare variable TAKE_PART_SPC smallint;
declare variable HAVE_SHP_OR_PAY integer;
declare variable CONTRACTOR_SORT varchar(200);
declare variable MAX_PAY_DATE_FOR_SHP date;
declare variable SHP_MONTAGE smallint;
declare variable CON_COMMENT_FLAG_SAVED integer;
declare variable SPC_COMMENT_FLAG_SAVED integer;
declare variable DATES_FOR_PRODUCE_ON_STORAGE_SAVED varchar(200);
declare variable INCLUDE_OTHER_PAY_SHP smallint;
declare variable SPC_LETTER1_DATE_SAVED date;
declare variable SPC_LETTER2_DATE_SAVED date;
declare variable SPC_LETTER3_DATE_SAVED date;
declare variable SPC_COMPLAINT_IN_COURT_DATE_SAVED date;
declare variable USR_ID_LIST_CON_SAVED varchar(200);
declare variable DEP_ID_LIST_CON_SAVED varchar(200);
declare variable SPC_ID_SHP integer;
declare variable CON_FINAL_DATE_SAVED date;
declare variable CON_DAY_BEFORE_FINAL_SAVED integer;
declare variable CON_INCORRECT_FINAL_DATE_SAVED smallint;
begin
-- not include payments and shipping without specification
include_other_pay_shp = 1;
if (
     ( usr_id is not null and usr_id != -1 ) or
     ( dep_id is not null and dep_id != -1 )
   ) then
begin
  include_other_pay_shp = null;
end

ctr_name_check = 'FirstCheckContractor';
for
  select
    ctr_id,
    ctr_name,
    upper(ctr_name) as contractor_sort
  from
    dcl_contractor
  where
    ctr_id = :ctr_id or :ctr_id = -1
  order by contractor_sort
  into :ctr_id_local,
       :ctr_name,
       :contractor_sort
  do
  begin
    alone_shipping = null;

    for
      select
        con.con_id,
        con.con_number,
        con.con_date,
        con.con_annul,
        con.con_annul_date,
        con.con_final_date,
        strlen(con.con_comment),
        cur.cur_name,
        spc.spc_id,
        spc.spc_number,
        spc.spc_date,
        spc.spc_summ,
        spc.spc_group_delivery,
        spc.spc_add_pay_cond,
        spc.spc_delivery_cond,
        spc.spc_delivery_date,
        spc.spc_annul,
        spc.spc_annul_date,
        spc.spc_letter1_date,
        spc.spc_letter2_date,
        spc.spc_letter3_date,
        spc.spc_complaint_in_court_date,
        strlen(spc.spc_comment),
        spc.usr_id
      from
        dcl_contract con,
        dcl_con_list_spec spc,
        dcl_currency cur
      where
        con.ctr_id = :ctr_id_local and
        spc.con_id = con.con_id and
        cur.cur_id = con.cur_id and
        (:sln_id_in is null or con.sln_id = :sln_id_in ) and
        (:cur_id is null or cur.cur_id = :cur_id) and
        (:con_id_in is null or :con_id_in = -1 or con.con_id = :con_id_in ) and
        (
          :not_show_annul is null or
          (
            :not_show_annul is not null and con.con_annul is null and spc.spc_annul is null
          )
        ) and
        ( :usr_id = -1 or :usr_id is null or spc.usr_id = :usr_id ) and
        ( :dep_id = -1 or :dep_id is null or :dep_id = ( select dep_id from dcl_user where usr_id = spc.usr_id ) )
      order by spc.spc_date descending
       into
         :con_id,
         :con_number,
         :con_date,
         :con_annul,
         :con_annul_date,
         :con_final_date,
         :con_comment_flag,
         :con_currency,
         :spc_id,
         :spc_number,
         :spc_date,
         :spc_summ,
         :spc_group_delivery,
         :spc_add_pay_cond,
         :spc_delivery_cond,
         :spc_delivery_date,
         :spc_annul,
         :spc_annul_date,
         :spc_letter1_date,
         :spc_letter2_date,
         :spc_letter3_date,
         :spc_complaint_in_court_date,
         :spc_comment_flag,
         :spc_whose_id
    do
    begin
      con_incorrect_final_date = null;
      con_day_before_final = 0;
      if ( con_final_date is not null) then
      begin
        select count_day from dcl_get_count_day(:con_final_date, (select cast('NOW' as date) from rdb$database)) into :con_day_before_final;
        if (con_day_before_final <= 35) then
        begin
          con_incorrect_final_date = 1;
        end
      end

      select usr_id_list,
             dep_id_list
      from dcl_get_usr_dep_list_con(:con_id)
      into   :usr_id_list_con,
             :dep_id_list_con
      ;

      dates_for_produce_on_storage = null;
      select dates_for_produce_on_storage from get_prc_dates_on_storage(:ctr_id_local, :con_id, :spc_id) into :dates_for_produce_on_storage;

      spc_summ_itog = spc_summ;
      cur_itog = con_currency;
      spc_delivery_date_math = spc_delivery_date;

      itog_line = null;
      rest_doc_line = null;
      pay_count = 0;
      shp_count = 0;

      spc_pay_summ = 0;
      spc_shp_summ = 0;

      take_part_spc = null;
      if ( spc_group_delivery is not null ) then
      begin
        select dNVL(cast(sum(lps.lps_summ) as double precision), 0)
        from dcl_pay_list_summ lps
        where lps.spc_id = :spc_id and
              exists ( select distinct lps_id from dcl_ctc_pay where lps_id = lps.lps_id )
        into :spc_pay_summ;

        select dNVL(cast(sum(lps.lps_summ_plus_nds) as double precision), 0)
        from dcl_shp_list_produce lps,
             dcl_shipping shp
        where lps.shp_id = shp.shp_id and
              shp.spc_id = :spc_id and
              exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
        into :spc_shp_summ;

        if ( spc_summ_itog != spc_pay_summ or spc_summ_itog != spc_shp_summ ) then
        begin
          take_part_spc = 1;
        end
      end

      select
        count(psum.lps_id)
      from
        dcl_payment pay,
        dcl_pay_list_summ psum
      where
        psum.spc_id = :spc_id and
        pay.pay_id = psum.pay_id and
        (
          :earliest_doc_date is null or
          :take_part_spc = 1 or
          (
            :earliest_doc_date is not null and
            (
              pay.pay_date > :earliest_doc_date or
              not exists ( select distinct lps_id from dcl_ctc_pay where lps_id = psum.lps_id )
            )
          )
        )
        and
        (:cur_id is null or pay.cur_id = :cur_id) and
        (:not_include_zero is null or (:not_include_zero is not null and psum.lps_summ != 0) )
      into :pay_count;

      select
        count(shp.shp_id)
      from
        dcl_shipping shp
      where
        spc_id = :spc_id and
        (
          :earliest_doc_date is null or
          :take_part_spc = 1 or
          (
            :earliest_doc_date is not null and
            (
              shp.shp_date > :earliest_doc_date or
              not exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
            )
          )
        )
        and
        (:cur_id is null or cur_id = :cur_id) and
        (:not_include_zero is null or (:not_include_zero is not null and shp_summ_plus_nds != 0) )
      into :shp_count;

      -- correcting
      if ( ( pay_count > 0 or shp_count > 0 ) and earliest_doc_date is not null ) then
      begin
        select
          count(psum.lps_id)
        from
          dcl_payment pay,
          dcl_pay_list_summ psum
        where
          psum.spc_id = :spc_id and
          pay.pay_id = psum.pay_id and
          (:cur_id is null or pay.cur_id = :cur_id) and
          (:not_include_zero is null or (:not_include_zero is not null and psum.lps_summ != 0) )
        into :pay_count;

        select
          count(shp.shp_id)
        from
          dcl_shipping shp
        where
          spc_id = :spc_id and
          (:cur_id is null or cur_id = :cur_id) and
          (:not_include_zero is null or (:not_include_zero is not null and shp_summ_plus_nds != 0) )
        into :shp_count;
      end

      have_shp_or_pay = null;
      if ( include_all_specs is not null and pay_count = 0 and shp_count = 0 ) then
      begin
        select count(lps_id) from dcl_pay_list_summ where spc_id = :spc_id into :have_shp_or_pay;
        if ( have_shp_or_pay = 0 ) then
        begin
          select count(shp_id) from dcl_shipping where spc_id = :spc_id into :have_shp_or_pay;
        end
      end

      if ( ctr_id = -1 and ((pay_count != 0 or shp_count != 0) or have_shp_or_pay = 0) and ctr_name_check != ctr_name ) then
      begin
        ctr_name_check = :ctr_name;

        con_id_saved = :con_id;
        con_number_saved = :con_number;
        con_date_saved = :con_date;
        con_currency_saved = :con_currency;
        con_annul_saved = :con_annul;
        con_annul_date_saved = :con_annul_date;
        con_final_date_saved = :con_final_date;
        con_day_before_final_saved = :con_day_before_final;
        con_incorrect_final_date_saved = :con_incorrect_final_date;
        con_comment_flag_saved = :con_comment_flag;
        usr_id_list_con_saved = :usr_id_list_con;
        dep_id_list_con_saved = :dep_id_list_con;
        spc_id_saved = :spc_id;
        spc_number_saved = :spc_number;
        spc_date_saved = :spc_date;
        spc_summ_saved = :spc_summ;
        spc_add_pay_cond_saved = :spc_add_pay_cond;
        spc_delivery_cond_saved = :spc_delivery_cond;
        spc_delivery_date_saved = :spc_delivery_date;
        spc_annul_saved = :spc_annul;
        spc_annul_date_saved = :spc_annul_date;
        spc_letter1_date_saved = :spc_letter1_date;
        spc_letter2_date_saved = :spc_letter2_date;
        spc_letter3_date_saved = :spc_letter3_date;
        spc_complaint_in_court_date_saved = :spc_complaint_in_court_date;
        spc_comment_flag_saved = :spc_comment_flag;
        dates_for_produce_on_storage_saved = :dates_for_produce_on_storage;

        con_id = null;
        con_number = :ctr_name;
        con_date = null;
        con_currency = null;
        con_annul = null;
        con_annul_date = null;
        con_final_date = null;
        con_day_before_final = null;
        con_incorrect_final_date = null;
        con_comment_flag = null;
        usr_id_list_con = null;
        dep_id_list_con = null;
        spc_id = null;
        spc_number = null;
        spc_date = null;
        spc_summ = null;
        spc_add_pay_cond = null;
        spc_delivery_cond = null;
        spc_delivery_date = null;
        spc_delivery_date_math = null;
        spc_annul = null;
        spc_annul_date = null;
        spc_letter1_date = null;
        spc_letter2_date = null;
        spc_letter3_date = null;
        spc_complaint_in_court_date = null;
        spc_comment_flag = null;
        dates_for_produce_on_storage = null;

        pay_id = null;
        pay_date = null;
        pay_summ = null;
        pay_closed = null;
        pay_block = null;
        pay_comment = null;

        shp_id = null;
        shp_date = null;
        shp_date_expiration = null;
        shp_number = null;
        shp_summ = null;
        shp_closed = null;
        shp_closed_correct = null;
        get_pay_expiration_from_proc = null;
        shp_letter1_date = null;
        shp_letter2_date = null;
        shp_letter3_date = null;
        shp_complaint_in_court_date = null;
        shp_comment = null;
        shp_original = null;
        shp_no_act = null;
        managers = null;
        stuff_categories = null;

        itog_line = null;
        ctr_line = 1;

        suspend;

        ctr_line = null;
        con_id = :con_id_saved;
        con_number = :con_number_saved;
        con_date = :con_date_saved;
        con_currency = :con_currency_saved;
        con_annul = :con_annul_saved;
        con_annul_date = :con_annul_date_saved;
        con_final_date = :con_final_date_saved;
        con_day_before_final = :con_day_before_final_saved;
        con_incorrect_final_date = :con_incorrect_final_date_saved;
        con_comment_flag = :con_comment_flag_saved;
        usr_id_list_con = :usr_id_list_con_saved;
        dep_id_list_con = :dep_id_list_con_saved;
        spc_id = :spc_id_saved;
        spc_number = :spc_number_saved;
        spc_date = :spc_date_saved;
        spc_summ = :spc_summ_saved;
        spc_add_pay_cond = :spc_add_pay_cond_saved;
        spc_delivery_cond = :spc_delivery_cond_saved;
        spc_delivery_date = :spc_delivery_date_saved;
        spc_delivery_date_math = :spc_delivery_date_saved;
        spc_annul = :spc_annul_saved;
        spc_annul_date = :spc_annul_date_saved;
        spc_letter1_date = :spc_letter1_date_saved;
        spc_letter2_date = :spc_letter2_date_saved;
        spc_letter3_date = :spc_letter3_date_saved;
        spc_complaint_in_court_date = :spc_complaint_in_court_date_saved;
        spc_comment_flag = :spc_comment_flag_saved;
        dates_for_produce_on_storage = :dates_for_produce_on_storage_saved;
      end

      max_doc_for_spc_count = 0;
      if ( pay_count > shp_count ) then
      begin
        max_doc_for_spc_count = :pay_count;
      end
      else
      begin
        max_doc_for_spc_count = :shp_count;
      end

      no_shipping = null;
      if ( shp_count = 0 ) then
      begin
        no_shipping = 1;
      end

      only_spec = null;
      if ( have_shp_or_pay = 0 and max_doc_for_spc_count = 0 ) then
      begin
        max_doc_for_spc_count = 1;
        only_spec = 1;
      end

      if ( max_doc_for_spc_count != 0 ) then
      begin
        idx = 0;
        curr_pay = 0;
        curr_shp = 0;

        pay_summ_itog = 0;
        shp_summ_itog = 0;

        while (idx < max_doc_for_spc_count) do
        begin
          pay_id = null;
          pay_date = null;
          pay_closed = null;
          pay_summ = null;
          pay_block = null;
          pay_comment = null;

          shp_id = null;
          shp_date = null;
          shp_date_expiration = null;
          shp_number = null;
          shp_summ = null;
          shp_closed = null;
          shp_closed_correct = null;
          get_pay_expiration_from_proc = null;
          shp_letter1_date = null;
          shp_letter2_date = null;
          shp_letter3_date = null;
          shp_complaint_in_court_date = null;
          shp_comment = null;
          shp_original = null;
          shp_no_act = null;
          managers = null;
          stuff_categories = null;

          if ( only_spec = 1 ) then
          begin
            curr_pay = -1;
            curr_shp = -1;
          end

          if ( curr_pay != -1 ) then
          begin
            select first 1
              psum.lps_id,
              pay.pay_id,
              pay.pay_date,
              pay.pay_block,
              psum.lps_summ,
              pay.pay_comment
            from
              dcl_payment pay,
              dcl_pay_list_summ psum
            where
              psum.lps_id > :curr_pay and
              psum.spc_id = :spc_id and
              pay.pay_id = psum.pay_id and
              (:cur_id is null or pay.cur_id = :cur_id) and
              (:not_include_zero is null or (:not_include_zero is not null and psum.lps_summ != 0) )
            order by psum.lps_id
            into :curr_pay,
                 :pay_id,
                 :pay_date,
                 :pay_block,
                 :pay_summ,
                 :pay_comment;

            if ( pay_date is not null ) then
            begin
              pay_date_expiration = :pay_date;
            end

            pay_closed = null;
            if ( spc_group_delivery is not null ) then
            begin
              select distinct lps_id from dcl_ctc_pay where lps_id = :curr_pay into :pay_closed;
            end
            if ( ( spc_summ_itog = spc_pay_summ and spc_summ_itog = spc_shp_summ ) or ( spc_pay_summ = 0 and spc_shp_summ = 0 ) ) then
            begin
              pay_closed = null;
            end
          end

          if ( pay_date is null ) then
          begin
            curr_pay = -1;
          end
          else
          begin
            pay_summ_itog = pay_summ_itog + pay_summ;
          end

          if ( curr_shp != -1 ) then
          begin
            select first 1
              shp_id,
              shp_id,
              shp_date,
              shp_date_expiration,
              shp_number,
              shp_summ_plus_nds,
              (select count_day from dcl_get_count_day((select cast('NOW' as date) from rdb$database), shp.shp_date_expiration)) as count_day,
              shp_letter1_date,
              shp_letter2_date,
              shp_letter3_date,
              shp_complaint_in_court_date,
              shp_comment,
              shp_original,
              shp_montage,
              spc_id
            from
              dcl_shipping shp
            where
              shp.shp_id > :curr_shp and
              spc_id = :spc_id and
              (:cur_id is null or shp.cur_id = :cur_id) and
              (:not_include_zero is null or (:not_include_zero is not null and shp_summ_plus_nds != 0) )
            order by shp.shp_id
            into
              :curr_shp,
              :shp_id,
              :shp_date,
              :shp_date_expiration,
              :shp_number,
              :shp_summ,
              :count_day,
              :shp_letter1_date,
              :shp_letter2_date,
              :shp_letter3_date,
              :shp_complaint_in_court_date,
              :shp_comment,
              :shp_original,
              :shp_montage,
              :spc_id_shp;

            select usr_id_list from dcl_get_usr_id_list_shp(:shp_id, :spc_id_shp) into :usr_id_list_shp;

            select manager_list from DCL_GET_MANAGER_LIST_BY_SHP_ID(:shp_id) into :managers;
            select product_list from DCL_GET_PRODUCT_LIST_BY_SHP_ID(:shp_id) into :stuff_categories;
            shp_no_act = null;
            if ( shp_montage is not null ) then
            begin
              select count(lps.lps_id)
              from dcl_shp_list_produce lps
              where lps.shp_id = :shp_id and
                    lps.lps_enter_in_use_date is null and
                    lps.lps_montage_off is null
              into :shp_no_act;
            end

            shp_closed_correct = null;
            shp_closed = null;
            select distinct shp_id from dcl_ctc_shp ctc_shp where ctc_shp.shp_id = :shp_id into :shp_closed_correct;
            if ( spc_group_delivery is not null ) then
            begin
              shp_closed = :shp_closed_correct;
            end
            if ( ( spc_summ_itog = spc_pay_summ and spc_summ_itog = spc_shp_summ ) or ( spc_pay_summ = 0 and spc_shp_summ = 0 ) ) then
            begin
              shp_closed = null;
            end
          end

          if ( shp_date is null ) then
          begin
            curr_shp = -1;
          end
          else
          begin
            shp_summ_itog = shp_summ_itog + shp_summ;
          end

          get_pay_expiration_from_proc = null;
          if ( shp_count = 1 and pay_count = 1 and
               (
                 (spc_summ_itog = pay_summ_itog and spc_summ_itog = shp_summ_itog) or
                 (spc_summ_itog = pay_summ_itog and pay_summ_itog > shp_summ_itog)
               )
             ) then
          begin
            select count_day from dcl_get_count_day(:pay_date, :shp_date_expiration) into :count_day;
            get_pay_expiration_from_proc = 1;
          end

          if ( shp_count = 1 and pay_count > 1 ) then
          begin
            select dNVL(cast(sum(lps.lps_summ) as double precision), 0)
            from dcl_pay_list_summ lps
            where lps.spc_id = :spc_id
            into :spc_pay_summ;

            if ( spc_pay_summ = spc_summ_itog ) then
            begin
              select max(pay_date)
              from
                dcl_payment pay,
                dcl_pay_list_summ psum
              where
                psum.spc_id = :spc_id and
                pay.pay_id = psum.pay_id and
                (
                  :earliest_doc_date is null or
                  :take_part_spc = 1 or
                  (
                    :earliest_doc_date is not null and
                    (
                      pay.pay_date > :earliest_doc_date or
                      not exists ( select distinct lps_id from dcl_ctc_pay where lps_id = psum.lps_id )
                    )
                  )
                )
                and
                (:cur_id is null or pay.cur_id = :cur_id) and
                (:not_include_zero is null or (:not_include_zero is not null and psum.lps_summ != 0) )
              into :max_pay_date_for_shp;

              select count_day from dcl_get_count_day(:max_pay_date_for_shp, :shp_date_expiration) into :count_day;
              get_pay_expiration_from_proc = 1;
            end
          end

          if ( pay_closed is null and pay_count = 1 and shp_count > 1 ) then
          begin
          end
          else
          begin
            pay_date_expiration = null;
          end

          select spc_pay_expiration from dcl_get_spc_pay_expiration(:spc_id) into :spc_pay_expiration;
          spc_whose = null;
          if ( spc_whose_id is not null ) then
          begin
            select usr_lng_shp.usr_surname || ' ' || usr_lng_shp.usr_name
            from dcl_user_language usr_lng_shp
            where usr_lng_shp.usr_id = :spc_whose_id and
            usr_lng_shp.lng_id = 1
            into :spc_whose;
          end

          suspend;

          spc_pay_expiration = null;
          spc_whose_id = null;
          spc_whose = null;

          idx = idx + 1;
          if ( idx = 1 ) then
          begin
            con_number = null;
            con_date = null;
            con_currency = null;
            con_annul = null;
            con_annul_date = null;
            con_final_date = null;
            con_day_before_final = null;
            con_incorrect_final_date = null;
            con_comment_flag = null;
            usr_id_list_con = null;
            dep_id_list_con = null;
            spc_number = null;
            spc_date = null;
            spc_summ = null;
            spc_add_pay_cond = null;
            spc_delivery_cond = null;
            spc_delivery_date = null;
            spc_annul = null;
            spc_annul_date = null;
            spc_letter1_date = null;
            spc_letter2_date = null;
            spc_letter3_date = null;
            spc_complaint_in_court_date = null;
            spc_comment_flag = null;
            dates_for_produce_on_storage = null;
          end
        end

        con_id = null;
        con_number = null;
        con_date = null;
        con_currency = cur_itog;
        con_annul = null;
        con_annul_date = null;
        con_final_date = null;
        con_day_before_final = null;
        con_incorrect_final_date = null;
        con_comment_flag = null;
        usr_id_list_con = null;
        dep_id_list_con = null;
        spc_id = null;
        spc_number = null;
        spc_date = null;
        spc_summ = spc_summ_itog;
        spc_add_pay_cond = null;
        spc_delivery_cond = null;
        spc_delivery_date = null;
        spc_delivery_date_math = null;
        spc_annul = null;
        spc_annul_date = null;
        spc_letter1_date = null;
        spc_letter2_date = null;
        spc_letter3_date = null;
        spc_complaint_in_court_date = null;
        spc_comment_flag = null;
        dates_for_produce_on_storage = null;

        pay_id = null;
        pay_date = null;
        pay_summ = pay_summ_itog;
        pay_closed = null;
        pay_block = null;
        pay_comment = null;

        shp_id = null;
        shp_date = null;
        shp_date_expiration = null;
        shp_number = null;
        shp_summ = shp_summ_itog;
        shp_closed = null;
        shp_closed_correct = null;
        get_pay_expiration_from_proc = null;
        shp_letter1_date = null;
        shp_letter2_date = null;
        shp_letter3_date = null;
        shp_complaint_in_court_date = null;
        shp_comment = null;
        shp_original = null;
        shp_no_act = null;
        managers = null;
        stuff_categories = null;

        itog_line = 1;

        suspend;
      end
    end

    if ( include_other_pay_shp is not null ) then
    begin
      itog_line = null;
      rest_doc_line = 1;

      pay_count = 0;
      shp_count = 0;

      select
        count(pay.pay_id)
      from
        dcl_payment pay
      where
        pay.ctr_id = :ctr_id_local and
        ( ( pay.pay_summ -
            dNVL(cast( (
                         select sum(psum.lps_summ)
                         from  dcl_pay_list_summ psum
                         where psum.pay_id = pay.pay_id
                       ) as double precision), 0)
           ) != 0
        ) and
        (:cur_id is null or pay.cur_id = :cur_id) and
        (select is_pay_closed from dcl_is_pay_closed(pay.pay_id)) is null
      into :pay_count;

      select
        count(shp.shp_id)
      from
        dcl_shipping shp
      where
        shp.ctr_id = :ctr_id_local and
        shp.spc_id is null and
        (:cur_id is null or shp.cur_id = :cur_id) and
        (:not_include_zero is null or (:not_include_zero is not null and shp.shp_summ_plus_nds != 0) ) and
        not exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
      into :shp_count;

      dates_for_produce_on_storage = null;
      select dates_for_produce_on_storage from get_prc_dates_on_storage(:ctr_id_local, null, null) into :dates_for_produce_on_storage;
      dates_for_produce_on_storage_saved = :dates_for_produce_on_storage;

      if ( ctr_id = -1 and (pay_count != 0 or shp_count != 0 or dates_for_produce_on_storage != '' ) and ctr_name_check != ctr_name ) then
      begin
        ctr_name_check = :ctr_name;

        con_id = null;
        con_number = :ctr_name;
        con_date = null;
        con_currency = null;
        con_annul = null;
        con_annul_date = null;
        con_final_date = null;
        con_day_before_final = null;
        con_incorrect_final_date = null;
        con_comment_flag = null;
        usr_id_list_con = null;
        dep_id_list_con = null;
        spc_id = null;
        spc_number = null;
        spc_date = null;
        spc_summ = null;
        spc_add_pay_cond = null;
        spc_delivery_cond = null;
        spc_delivery_date = null;
        spc_delivery_date_math = null;
        spc_annul = null;
        spc_annul_date = null;
        spc_letter1_date = null;
        spc_letter2_date = null;
        spc_letter3_date = null;
        spc_complaint_in_court_date = null;
        spc_comment_flag = null;
        dates_for_produce_on_storage = null;

        pay_id = null;
        pay_date = null;
        pay_summ = null;
        pay_closed = null;
        pay_block = null;

        shp_id = null;
        shp_date = null;
        shp_date_expiration = null;
        shp_number = null;
        shp_summ = null;
        shp_closed = null;
        shp_closed_correct = null;
        get_pay_expiration_from_proc = null;
        shp_letter1_date = null;
        shp_letter2_date = null;
        shp_letter3_date = null;
        shp_complaint_in_court_date = null;
        shp_comment = null;
        shp_original = null;
        shp_no_act = null;
        managers = null;
        stuff_categories = null;

        itog_line = null;
        ctr_line = 1;

        suspend;

        ctr_line = null;
      end

      max_doc_for_spc_count = 0;
      if ( pay_count > shp_count ) then
      begin
        max_doc_for_spc_count = :pay_count;
      end
      else
      begin
        max_doc_for_spc_count = :shp_count;
      end

      if ( max_doc_for_spc_count != 0 ) then
      begin
        con_id = null;
        con_number = null;
        con_date = null;
        con_currency = null;
        con_annul = null;
        con_annul_date = null;
        con_final_date = null;
        con_day_before_final = null;
        con_incorrect_final_date = null;
        con_comment_flag = null;
        usr_id_list_con = null;
        dep_id_list_con = null;
        spc_id = null;
        spc_number = null;
        spc_date = null;
        spc_summ = null;
        spc_add_pay_cond = null;
        spc_delivery_cond = null;
        spc_delivery_date = null;
        spc_delivery_date_math = null;
        spc_annul = null;
        spc_annul_date = null;
        spc_letter1_date = null;
        spc_letter2_date = null;
        spc_letter3_date = null;
        spc_complaint_in_court_date = null;
        spc_comment_flag = null;
        dates_for_produce_on_storage = null;

        idx = 0;
        curr_pay = 0;
        curr_shp = 0;

        while (idx < max_doc_for_spc_count) do
        begin
          pay_id = null;
          pay_date = null;
          pay_summ = null;
          pay_closed = null;
          pay_block = null;
          pay_comment = null;

          shp_id = null;
          shp_date = null;
          shp_number = null;
          shp_summ = null;
          shp_closed = null;
          shp_closed_correct = null;
          get_pay_expiration_from_proc = null;
          shp_comment = null;
          shp_original = null;

          if ( curr_pay != -1 ) then
          begin
            select first 1
              pay.pay_id,
              pay.pay_id,
              pay.pay_date,
              pay.pay_block,
              ( pay.pay_summ -
                 dNVL(cast( (
                              select sum(psum.lps_summ)
                              from  dcl_pay_list_summ psum
                             where psum.pay_id = pay.pay_id
                           ) as double precision), 0)
              ),
              cur.cur_name,
              pay.pay_comment
            from
              dcl_payment pay,
              dcl_currency cur
            where
              pay.pay_id > :curr_pay and
              pay.ctr_id = :ctr_id_local and
              ( ( pay.pay_summ -
                dNVL(cast( (
                             select sum(psum.lps_summ)
                             from  dcl_pay_list_summ psum
                             where psum.pay_id = pay.pay_id
                           ) as double precision), 0)
                ) != 0
              ) and
              cur.cur_id = pay.cur_id and
              (:cur_id is null or cur.cur_id = :cur_id) and
              (select is_pay_closed from dcl_is_pay_closed(pay.pay_id)) is null
            order by pay.pay_id
            into :curr_pay,
                 :pay_id,
                 :pay_date,
                 :pay_block,
                 :pay_summ,
                 :pay_currency,
                 :pay_comment;
          end

          if ( pay_date is null ) then
          begin
            curr_pay = -1;
          end

          if ( curr_shp != -1 ) then
          begin
            select first 1
              shp_id,
              shp_id,
              shp_date,
              shp_date_expiration,
              shp_number,
              shp_summ_plus_nds,
              cur.cur_name,
              (select count_day from dcl_get_count_day((select cast('NOW' as date) from rdb$database), shp.shp_date_expiration)),
              shp_letter1_date,
              shp_letter2_date,
              shp_letter3_date,
              shp_complaint_in_court_date,
              shp_comment,
              shp_original,
              shp_montage,
              spc_id
            from
              dcl_shipping shp,
              dcl_currency cur
            where
              shp.shp_id > :curr_shp and
              shp.ctr_id = :ctr_id_local and
              shp.spc_id is null and
              cur.cur_id = shp.cur_id and
              (:cur_id is null or cur.cur_id = :cur_id) and
              (:not_include_zero is null or (:not_include_zero is not null and shp.shp_summ_plus_nds != 0) ) and
              not exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
            order by shp.shp_id
            into
              :curr_shp,
              :shp_id,
              :shp_date_expiration,
              :shp_date,
              :shp_number,
              :shp_summ,
              :shp_currency,
              :count_day,
              :shp_letter1_date,
              :shp_letter2_date,
              :shp_letter3_date,
              :shp_complaint_in_court_date,
              :shp_comment,
              :shp_original,
              :shp_montage,
              :spc_id_shp
              ;

            select usr_id_list from dcl_get_usr_id_list_shp(:shp_id, :spc_id_shp) into :usr_id_list_shp;

            select manager_list from DCL_GET_MANAGER_LIST_BY_SHP_ID(:shp_id) into :managers;
            select product_list from DCL_GET_PRODUCT_LIST_BY_SHP_ID(:shp_id) into :stuff_categories;
            shp_no_act = null;
            if ( shp_montage is not null ) then
            begin
              select count(lps.lps_id)
              from dcl_shp_list_produce lps
              where lps.shp_id = :shp_id and
                    lps.lps_enter_in_use_date is null and
                    lps.lps_montage_off is null
              into :shp_no_act;
            end

            select distinct shp_id from dcl_ctc_shp ctc_shp where ctc_shp.shp_id = :shp_id into :shp_closed_correct;
          end

          alone_shipping = 1;
          if ( shp_date is null ) then
          begin
            curr_shp = -1;
            alone_shipping = null;
          end

          suspend;

          idx = idx + 1;
        end
      end

      con_id = null;
      con_number = null;
      con_date = null;
      con_currency = null;
      con_annul = null;
      con_annul_date = null;
      con_final_date = null;
      con_day_before_final = null;
      con_incorrect_final_date = null;
      con_comment_flag = null;
      usr_id_list_con = null;
      dep_id_list_con = null;
      spc_id = null;
      spc_number = null;
      spc_date = null;
      spc_summ = null;
      spc_add_pay_cond = null;
      spc_delivery_cond = null;
      spc_delivery_date = null;
      spc_delivery_date_math = null;
      spc_annul = null;
      spc_annul_date = null;
      spc_letter1_date = null;
      spc_letter2_date = null;
      spc_letter3_date = null;
      spc_complaint_in_court_date = null;
      spc_comment_flag = null;

      pay_id = null;
      pay_date = null;
      pay_summ = null;
      pay_closed = null;
      pay_block = null;
      pay_comment = null;
    
      shp_id = null;
      shp_date = null;
      shp_number = null;
      shp_summ = null;
      shp_closed = null;
      shp_closed_correct = null;
      get_pay_expiration_from_proc = null;
      shp_comment = null;
      shp_original = null;

      dates_for_produce_on_storage = :dates_for_produce_on_storage_saved;
      if ( dates_for_produce_on_storage != '' ) then
      begin
        suspend;
      end

    end --if ( include_other_pay_shp is not null )
  end
end
 ^

ALTER PROCEDURE DCL_CALCULATION_STATE_DEBET (CTR_ID INTEGER,
CUR_ID INTEGER,
SLN_ID INTEGER,
USR_ID INTEGER,
DEP_ID INTEGER)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CON_ANNUL SMALLINT,
CON_ANNUL_DATE DATE,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
PAY_ID INTEGER,
PAY_DATE DATE,
PAY_SUMM DECIMAL(15, 2),
SHP_ID INTEGER,
SHP_NUMBER CHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_SUMM DECIMAL(15, 2),
ITOG_LINE SMALLINT,
REST_DOC_LINE SMALLINT,
SHP_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_LINE SMALLINT,
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
MANAGERS VARCHAR(5000) CHARACTER SET UNICODE_FSS,
STUFF_CATEGORIES VARCHAR(5000) CHARACTER SET UNICODE_FSS,
COUNT_DAY INTEGER,
SHP_DATE_EXPIRATION DATE,
SHP_LETTER1_DATE DATE,
SHP_LETTER2_DATE DATE,
SHP_LETTER3_DATE DATE,
SHP_COMPLAINT_IN_COURT_DATE DATE,
SHP_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
SHP_ORIGINAL SMALLINT,
PAY_COMMENT VARCHAR(500) CHARACTER SET UNICODE_FSS,
SHP_NO_ACT SMALLINT,
CON_COMMENT_FLAG INTEGER,
SPC_COMMENT_FLAG INTEGER,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_WHOSE_ID INTEGER,
SPC_WHOSE VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_ID_LIST_CON VARCHAR(200) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST_CON VARCHAR(200) CHARACTER SET UNICODE_FSS,
USR_ID_LIST_SHP VARCHAR(500) CHARACTER SET UNICODE_FSS,
CON_FINAL_DATE DATE,
CON_DAY_BEFORE_FINAL INTEGER,
CON_INCORRECT_FINAL_DATE SMALLINT)
AS 
declare variable MAX_DOC_FOR_SPC_COUNT integer;
declare variable SHP_COUNT integer;
declare variable PAY_COUNT integer;
declare variable IDX integer;
declare variable CURR_PAY integer;
declare variable CURR_SHP integer;
declare variable SPC_SUMM_ITOG decimal(15,2);
declare variable PAY_SUMM_ITOG decimal(15,2);
declare variable SHP_SUMM_ITOG decimal(15,2);
declare variable CUR_ITOG varchar(10);
declare variable CTR_NAME_CHECK varchar(200);
declare variable CON_ID_SAVED integer;
declare variable CON_NUMBER_SAVED varchar(200);
declare variable CON_DATE_SAVED date;
declare variable CON_CURRENCY_SAVED varchar(10);
declare variable CON_ANNUL_SAVED smallint;
declare variable CON_ANNUL_DATE_SAVED date;
declare variable SPC_ID_SAVED integer;
declare variable SPC_NUMBER_SAVED varchar(50);
declare variable SPC_DATE_SAVED date;
declare variable SPC_SUMM_SAVED decimal(15,2);
declare variable CTR_ID_LOCAL integer;
declare variable SPC_ADD_PAY_COND_SAVED varchar(5000);
declare variable SPC_ANNUL_SAVED smallint;
declare variable SPC_ANNUL_DATE_SAVED date;
declare variable SHP_MONTAGE integer;
declare variable CON_COMMENT_FLAG_SAVED integer;
declare variable SPC_COMMENT_FLAG_SAVED integer;
declare variable CONTRACTOR_SORT varchar(200);
declare variable INCLUDE_OTHER_PAY_SHP smallint;
declare variable SPC_LETTER1_DATE_SAVED date;
declare variable SPC_LETTER2_DATE_SAVED date;
declare variable SPC_LETTER3_DATE_SAVED date;
declare variable SPC_COMPLAINT_IN_COURT_DATE_SAVED date;
declare variable USR_ID_LIST_CON_SAVED varchar(200);
declare variable DEP_ID_LIST_CON_SAVED varchar(200);
declare variable SPC_ID_SHP integer;
declare variable CON_FINAL_DATE_SAVED date;
declare variable CON_DAY_BEFORE_FINAL_SAVED integer;
declare variable CON_INCORRECT_FINAL_DATE_SAVED integer;
begin
-- not include payments and shipping without specification
include_other_pay_shp = 1;
if (
     ( usr_id is not null and usr_id != -1 ) or
     ( dep_id is not null and dep_id != -1 )
   ) then
begin
  include_other_pay_shp = null;
end

ctr_name_check = 'FirstCheckContractor';
for
  select
    ctr_id,
    ctr_name,
    upper(ctr_name) as contractor_sort
  from
    dcl_contractor
  where
    ctr_id = :ctr_id or :ctr_id = -1
  order by contractor_sort
  into :ctr_id_local,
       :ctr_name,
       :contractor_sort
  do
  begin
    for
      select
        con.con_id,
        con.con_number,
        con.con_date,
        con.con_annul,
        con.con_annul_date,
        con.con_final_date,
        strlen(con.con_comment),
        cur.cur_name,
        spc.spc_id,
        spc.spc_number,
        spc.spc_date,
        spc.spc_summ,
        spc.spc_add_pay_cond,
        spc.spc_annul,
        spc.spc_annul_date,
        spc.spc_letter1_date,
        spc.spc_letter2_date,
        spc.spc_letter3_date,
        spc.spc_complaint_in_court_date,
        strlen(spc.spc_comment),
        spc.usr_id
      from
        dcl_contract con,
        dcl_con_list_spec spc,
        dcl_currency cur
      where
        con.ctr_id = :ctr_id_local and
        spc.con_id = con.con_id and
        cur.cur_id = con.cur_id and
        (:cur_id is null or cur.cur_id = :cur_id) and
        (con.sln_id is null or con.sln_id = :sln_id ) and
        ( :usr_id = -1 or :usr_id is null or spc.usr_id = :usr_id ) and
        ( :dep_id = -1 or :dep_id is null or :dep_id = ( select dep_id from dcl_user where usr_id = spc.usr_id ) )
       into
         :con_id,
         :con_number,
         :con_date,
         :con_annul,
         :con_annul_date,
         :con_final_date,
         :con_comment_flag,
         :con_currency,
         :spc_id,
         :spc_number,
         :spc_date,
         :spc_summ,
         :spc_add_pay_cond,
         :spc_annul,
         :spc_annul_date,
         :spc_letter1_date,
         :spc_letter2_date,
         :spc_letter3_date,
         :spc_complaint_in_court_date,
         :spc_comment_flag,
         :spc_whose_id
    do
    begin
      con_incorrect_final_date = null;
      con_day_before_final = 0;
      if ( con_final_date is not null) then
      begin
        select count_day from dcl_get_count_day(:con_final_date, (select cast('NOW' as date) from rdb$database)) into :con_day_before_final;
        if (con_day_before_final <= 35) then
        begin
          con_incorrect_final_date = 1;
        end
      end

      select usr_id_list,
             dep_id_list
      from dcl_get_usr_dep_list_con(:con_id)
      into   :usr_id_list_con,
             :dep_id_list_con
      ;

      itog_line = null;
      rest_doc_line = null;
      pay_count = 0;
      shp_count = 0;

      spc_summ_itog = spc_summ;
      cur_itog = con_currency;

      select
        count(lps_id)
      from
        dcl_pay_list_summ psum
      where
        spc_id = :spc_id and
        not exists ( select distinct lps_id from dcl_ctc_pay where lps_id = psum.lps_id )
      into :pay_count;

      select
        count(shp_id)
      from
        dcl_shipping shp
      where
        spc_id = :spc_id and
        not exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
      into :shp_count;

      if ( ctr_id = -1 and shp_count != 0 and ctr_name_check != ctr_name ) then
      begin
        ctr_name_check = :ctr_name;

        con_id_saved = :con_id;
        con_number_saved = :con_number;
        con_date_saved = :con_date;
        con_currency_saved = :con_currency;
        con_annul_saved = :con_annul;
        con_annul_date_saved = :con_annul_date;
        con_final_date_saved = :con_final_date;
        con_day_before_final_saved = :con_day_before_final;
        con_incorrect_final_date_saved = :con_incorrect_final_date;
        con_comment_flag_saved = :con_comment_flag;
        usr_id_list_con_saved = :usr_id_list_con;
        dep_id_list_con_saved = :dep_id_list_con;
        spc_id_saved = :spc_id;
        spc_number_saved = :spc_number;
        spc_date_saved = :spc_date;
        spc_summ_saved = :spc_summ;
        spc_add_pay_cond_saved = :spc_add_pay_cond;
        spc_annul_saved = :spc_annul;
        spc_annul_date_saved = :spc_annul_date;
        spc_letter1_date_saved = :spc_letter1_date;
        spc_letter2_date_saved = :spc_letter2_date;
        spc_letter3_date_saved = :spc_letter3_date;
        spc_complaint_in_court_date_saved = :spc_complaint_in_court_date;
        spc_comment_flag_saved = :spc_comment_flag;

        con_id = null;
        con_number = :ctr_name;
        con_date = null;
        con_currency = null;
        con_annul = null;
        con_annul_date = null;
        con_final_date = null;
        con_day_before_final = null;
        con_incorrect_final_date = null;
        con_comment_flag = null;
        usr_id_list_con = null;
        dep_id_list_con = null;
        spc_id = null;
        spc_number = null;
        spc_date = null;
        spc_summ = null;
        spc_add_pay_cond = null;
        spc_annul = null;
        spc_annul_date = null;
        spc_letter1_date = null;
        spc_letter2_date = null;
        spc_letter3_date = null;
        spc_complaint_in_court_date = null;
        spc_comment_flag = null;

        pay_id = null;
        pay_date = null;
        pay_summ = null;
        pay_comment = null;

        shp_id = null;
        shp_date = null;
        shp_date_expiration = null;
        shp_number = null;
        shp_summ = null;
        shp_letter1_date = null;
        shp_letter2_date = null;
        shp_letter3_date = null;
        shp_complaint_in_court_date = null;
        shp_comment = null;
        shp_original = null;
        shp_no_act = null;
        managers = null;
        stuff_categories = null;
        itog_line = null;
        ctr_line = 1;

        suspend;

        ctr_line = null;
        con_id = :con_id_saved;
        con_number = :con_number_saved;
        con_date = :con_date_saved;
        con_currency = :con_currency_saved;
        con_annul = :con_annul_saved;
        con_annul_date = :con_annul_date_saved;
        con_final_date = :con_final_date_saved;
        con_day_before_final = :con_day_before_final_saved;
        con_incorrect_final_date = :con_incorrect_final_date_saved;
        con_comment_flag = :con_comment_flag_saved;
        usr_id_list_con = :usr_id_list_con_saved;
        dep_id_list_con = :dep_id_list_con_saved;
        spc_id = :spc_id_saved;
        spc_number = :spc_number_saved;
        spc_date = :spc_date_saved;
        spc_summ = :spc_summ_saved;
        spc_add_pay_cond = :spc_add_pay_cond_saved;
        spc_annul = :spc_annul_saved;
        spc_annul_date = :spc_annul_date_saved;
        spc_letter1_date = :spc_letter1_date_saved;
        spc_letter2_date = :spc_letter2_date_saved;
        spc_letter3_date = :spc_letter3_date_saved;
        spc_complaint_in_court_date = :spc_complaint_in_court_date_saved;
        spc_comment_flag = :spc_comment_flag_saved;
      end

      max_doc_for_spc_count = 0;
      if ( pay_count > shp_count ) then
      begin
        max_doc_for_spc_count = :pay_count;
      end
      else
      begin
        max_doc_for_spc_count = :shp_count;
      end

      if ( max_doc_for_spc_count != 0 and shp_count !=0 ) then
      begin
        idx = 0;
        curr_pay = 0;
        curr_shp = 0;

        pay_summ_itog = 0;
        shp_summ_itog = 0;

        while (idx < max_doc_for_spc_count) do
        begin
          pay_id = null;
          pay_date = null;
          pay_summ = null;
          pay_comment = null;

          shp_id = null;
          shp_date = null;
          shp_date_expiration = null;
          shp_number = null;
          shp_summ = null;
          shp_letter1_date = null;
          shp_letter2_date = null;
          shp_letter3_date = null;
          shp_complaint_in_court_date = null;
          shp_comment = null;
          shp_original = null;
          shp_no_act = null;
          managers = null;
          stuff_categories = null;

          if ( curr_pay != -1 ) then
          begin
            select first 1
              psum.lps_id,
              pay.pay_id,
              pay.pay_date,
              pay.pay_comment,
              psum.lps_summ
            from
              dcl_payment pay,
              dcl_pay_list_summ psum
            where
              psum.lps_id > :curr_pay and
              psum.spc_id = :spc_id and
              pay.pay_id = psum.pay_id and
              not exists ( select distinct lps_id from dcl_ctc_pay where lps_id = psum.lps_id )
            order by psum.lps_id
            into :curr_pay,
                 :pay_id,
                 :pay_date,
                 :pay_comment, 
                 :pay_summ;
          end

          if ( pay_date is null ) then
          begin
            curr_pay = -1;
          end
          else
          begin
            pay_summ_itog = pay_summ_itog + pay_summ;
          end

          if ( curr_shp != -1 ) then
          begin
            select first 1
              shp_id,
              shp_id,
              shp_date,
              shp_date_expiration,
              shp_number,
              shp_summ_plus_nds,
              (select count_day from dcl_get_count_day((select cast('NOW' as date) from rdb$database), shp.shp_date_expiration)) as count_day,
              shp_letter1_date,
              shp_letter2_date,
              shp_letter3_date,
              shp_complaint_in_court_date,
              shp_comment,
              shp_original,
              shp_montage,
              spc_id
            from
              dcl_shipping shp
            where
              shp_id > :curr_shp and
              spc_id = :spc_id and
              not exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
            order by shp.shp_id
            into
              :curr_shp,
              :shp_id,
              :shp_date,
              :shp_date_expiration,
              :shp_number,
              :shp_summ,
              :count_day,
              :shp_letter1_date,
              :shp_letter2_date,
              :shp_letter3_date,
              :shp_complaint_in_court_date,
              :shp_comment,
              :shp_original,
              :shp_montage,
              :spc_id_shp;

            select usr_id_list from dcl_get_usr_id_list_shp(:shp_id, :spc_id_shp) into :usr_id_list_shp;

            select manager_list from DCL_GET_MANAGER_LIST_BY_SHP_ID(:shp_id) into :managers;
            select product_list from DCL_GET_PRODUCT_LIST_BY_SHP_ID(:shp_id) into :stuff_categories;
            shp_no_act = null;
            if ( shp_montage is not null ) then
            begin
              select count(lps.lps_id)
              from dcl_shp_list_produce lps
              where lps.shp_id = :shp_id and
                    lps.lps_enter_in_use_date is null and
                    lps.lps_montage_off is null
              into :shp_no_act;
            end
          end

          if ( shp_date is null ) then
          begin
            curr_shp = -1;
          end
          else
          begin
            shp_summ_itog = shp_summ_itog + shp_summ;
          end

          spc_whose = null;
          if ( spc_whose_id is not null ) then
          begin
            select usr_lng_shp.usr_surname || ' ' || usr_lng_shp.usr_name
            from dcl_user_language usr_lng_shp
            where usr_lng_shp.usr_id = :spc_whose_id and
            usr_lng_shp.lng_id = 1
            into :spc_whose;
          end

          suspend;

          spc_whose_id = null;
          spc_whose = null;

          idx = idx + 1;
          if ( idx = 1 ) then
          begin
            con_number = null;
            con_date = null;
            con_currency = null;
            con_annul = null;
            con_annul_date = null;
            con_final_date = null;
            con_day_before_final = null;
            con_incorrect_final_date = null;
            con_comment_flag = null;
            usr_id_list_con = null;
            dep_id_list_con = null;
            spc_number = null;
            spc_date = null;
            spc_summ = null;
            spc_add_pay_cond = null;
            spc_annul = null;
            spc_annul_date = null;
            spc_letter1_date = null;
            spc_letter2_date = null;
            spc_letter3_date = null;
            spc_complaint_in_court_date = null;
            spc_comment_flag = null;
          end
        end

        con_id = null;
        con_number = null;
        con_date = null;
        con_currency = cur_itog;
        con_annul = null;
        con_annul_date = null;
        con_final_date = null;
        con_day_before_final = null;
        con_incorrect_final_date = null;
        con_comment_flag = null;
        usr_id_list_con = null;
        dep_id_list_con = null;
        spc_id = null;
        spc_number = null;
        spc_date = null;
        spc_summ = spc_summ_itog;
        spc_add_pay_cond = null;
        spc_annul = null;
        spc_annul_date = null;
        spc_letter1_date = null;
        spc_letter2_date = null;
        spc_letter3_date = null;
        spc_complaint_in_court_date = null;
        spc_comment_flag = null;

        pay_id = null;
        pay_date = null;
        pay_comment = null;
        pay_summ = pay_summ_itog;

        shp_id = null;
        shp_date = null;
        shp_date_expiration = null;
        shp_number = null;
        shp_summ = shp_summ_itog;
        shp_letter1_date = null;
        shp_letter2_date = null;
        shp_letter3_date = null;
        shp_complaint_in_court_date = null;
        shp_comment = null;
        shp_original = null;
        shp_no_act = null;
        managers = null;
        stuff_categories = null;
        itog_line = 1;

        suspend;
      end
    end

    if ( include_other_pay_shp is not null ) then
    begin
      itog_line = null;
      rest_doc_line = 1;

      shp_count = 0;

      select
        count(shp_id)
      from
        dcl_shipping shp
      where
        shp.ctr_id = :ctr_id_local and
        shp.spc_id is null and
        shp.shp_summ_plus_nds > 0 and
        (:cur_id is null or shp.cur_id = :cur_id)
      into :shp_count;

      if ( ctr_id = -1 and shp_count != 0 and ctr_name_check != ctr_name ) then
      begin
        ctr_name_check = :ctr_name;

        con_id = null;
        con_number = :ctr_name;
        con_date = null;
        con_currency = null;
        con_annul = null;
        con_annul_date = null;
        con_final_date = null;
        con_day_before_final = null;
        con_incorrect_final_date = null;
        con_comment_flag = null;
        usr_id_list_con = null;
        dep_id_list_con = null;
        spc_id = null;
        spc_number = null;
        spc_date = null;
        spc_summ = null;
        spc_add_pay_cond = null;
        spc_annul = null;
        spc_annul_date = null;
        spc_letter1_date = null;
        spc_letter2_date = null;
        spc_letter3_date = null;
        spc_complaint_in_court_date = null;
        spc_comment_flag = null;

        pay_id = null;
        pay_date = null;
        pay_summ = null;
        pay_comment = null;

        shp_id = null;
        shp_date = null;
        shp_date_expiration = null;
        shp_number = null;
        shp_summ = null;
        shp_letter1_date = null;
        shp_letter2_date = null;
        shp_letter3_date = null;
        shp_complaint_in_court_date = null;
        shp_comment = null;
        shp_original = null;
        shp_no_act = null;
        managers = null;
        stuff_categories = null;

        itog_line = null;
        ctr_line = 1;

        suspend;

        ctr_line = null;
      end

      if ( shp_count != 0 ) then
      begin
        con_id = null;
        con_number = null;
        con_date = null;
        con_currency = null;
        con_annul = null;
        con_annul_date = null;
        con_final_date = null;
        con_day_before_final = null;
        con_incorrect_final_date = null;
        con_comment_flag = null;
        usr_id_list_con = null;
        dep_id_list_con = null;
        spc_id = null;
        spc_number = null;
        spc_date = null;
        spc_summ = null;
        spc_add_pay_cond = null;
        spc_annul = null;
        spc_annul_date = null;
        spc_letter1_date = null;
        spc_letter2_date = null;
        spc_letter3_date = null;
        spc_complaint_in_court_date = null;
        spc_comment_flag = null;
        managers = null;
        stuff_categories = null;

        pay_id = null;
        pay_date = null;
        pay_summ = null;
        pay_comment = null;

        for
          select
            shp_id,
            shp_id,
            shp_date,
            shp_date_expiration,
            shp_number,
            shp_summ_plus_nds,
            cur.cur_name,
            (select count_day from dcl_get_count_day((select cast('NOW' as date) from rdb$database), shp.shp_date_expiration)) as count_day,
            shp_letter1_date,
            shp_letter2_date,
            shp_letter3_date,
            shp_complaint_in_court_date,
            shp_comment,
            shp_original,
            shp_montage,
            spc_id
          from
            dcl_shipping shp,
            dcl_currency cur
          where
            shp.ctr_id = :ctr_id_local and
            shp.spc_id is null and
            shp.shp_summ_plus_nds > 0 and
            cur.cur_id = shp.cur_id and
            (:cur_id is null or cur.cur_id = :cur_id)
          order by shp.shp_id
          into
            :curr_shp,
            :shp_id,
            :shp_date,
            :shp_date_expiration,
            :shp_number,
            :shp_summ,
            :shp_currency,
            :count_day,
            :shp_letter1_date,
            :shp_letter2_date,
            :shp_letter3_date,
            :shp_complaint_in_court_date,
            :shp_comment,
            :shp_original,
            :shp_montage,
            :spc_id_shp
        do
        begin
          select usr_id_list from dcl_get_usr_id_list_shp(:shp_id, :spc_id_shp) into :usr_id_list_shp;
          con_currency = :shp_currency;
          select manager_list from DCL_GET_MANAGER_LIST_BY_SHP_ID(:shp_id) into :managers;
          select product_list from DCL_GET_PRODUCT_LIST_BY_SHP_ID(:shp_id) into :stuff_categories;
          shp_no_act = null;
          if ( shp_montage is not null ) then
          begin
            select count(lps.lps_id)
            from dcl_shp_list_produce lps
            where lps.shp_id = :shp_id and
                  lps.lps_enter_in_use_date is null and
                  lps.lps_montage_off is null
            into :shp_no_act;
          end

          suspend;
        end
      end -- if ( shp_count != 0 )
    end -- if ( include_other_pay_shp is not null )
  end
end
 ^

ALTER PROCEDURE DCL_CAN_SPC_BLOCK (SPC_ID INTEGER)
RETURNS (CAN_BLOC SMALLINT)
AS 
declare variable spc_summ decimal(15,2);
declare variable spc_group_delivery smallint;
declare variable spc_pay_summ decimal(15,2);
declare variable spc_shp_summ decimal(15,2);
begin
  can_bloc = null;
  select
    spc_summ,
    spc_group_delivery
  from dcl_con_list_spec
  where spc_id = :spc_id
  into
    :spc_summ,
    :spc_group_delivery;

  if ( spc_group_delivery is null ) then
  begin
    can_bloc = 1;
  end
  else
  begin
    select  dNVL(cast(sum(lps.lps_summ) as double precision), 0)
    from dcl_pay_list_summ lps
    where lps.spc_id = :spc_id and
          lps.lps_id in ( select distinct lps_id from dcl_ctc_pay )
    into :spc_pay_summ;

    select dNVL(cast(sum(lps.lps_summ_plus_nds) as double precision), 0)
    from dcl_shp_list_produce lps,
         dcl_shipping shp
    where lps.shp_id = shp.shp_id and
          shp.spc_id = :spc_id and
          shp.shp_id in ( select distinct shp_id from dcl_ctc_shp )
    into :spc_shp_summ;

    if ( spc_summ = spc_pay_summ and spc_summ = spc_shp_summ and spc_summ > 0 ) then
    begin
      can_bloc = 1;
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_CFC_MESSAGES_LOAD (USR_ID_IN INTEGER)
RETURNS (CCM_ID INTEGER,
CCM_CREATE_DATE TIMESTAMP,
CCM_MESSAGE VARCHAR(256) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
begin
  for
    select
      ccm_id,
      ccm_create_date,
      ccm_message,
      ctr_id
    from
      dcl_cfc_message ccm
    where ccm.usr_id = :usr_id_in
    order by ccm_create_date descending
    into
      :ccm_id,
      :ccm_create_date,
      :ccm_message,
      :ctr_id
  do
  begin
    ctr_name = null;
    if (ctr_id is not null) then
    begin
      select ctr_name from dcl_contractor where ctr_id = :ctr_id into :ctr_name;
    end
    suspend;
  end
end ^

ALTER PROCEDURE DCL_CFC_PRODUCES_SELECT (CFC_ID_IN INTEGER)
RETURNS (CCP_ID INTEGER,
CFC_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
CCP_PRICE DECIMAL(15, 2),
CCP_COUNT DECIMAL(15, 2),
CCP_NDS_RATE DECIMAL(15, 2),
CPR_ID INTEGER,
CPR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
CPR_DATE DATE)
AS 
begin
  for
    select
      ccp.ccp_id,
      ccp.cfc_id,
      stf.stf_id,
      stf.stf_name,
      ccp.prd_id,
      ccp.ccp_price,
      ccp.ccp_count,
      ccp.ccp_nds_rate,
      ccp.cpr_id
    from dcl_cfc_list_produce ccp,
         dcl_stuff_category stf
    where ccp.cfc_id = :cfc_id_in and
          stf.stf_id = ccp.stf_id
    order by ccp_id
    into :ccp_id,
         :cfc_id,
         :stf_id,
         :stf_name,
         :prd_id, 
         :ccp_price,
         :ccp_count,
         :ccp_nds_rate,
         :cpr_id
  do
  begin
    if ( cpr_id is not null ) then
    begin
      select
        cpr_number,
        cpr_date
      from dcl_commercial_proposal
      where cpr_id = :cpr_id
      into :cpr_number,
           :cpr_date;
    end
    suspend;
  end
end ^

ALTER PROCEDURE DCL_CLOSED_RECORD_INSERT (CTC_ID INTEGER,
SPC_ID INTEGER,
LCC_CHARGES DECIMAL(15, 2),
LCC_MONTAGE DECIMAL(15, 2),
LCC_TRANSPORT DECIMAL(15, 2),
LCC_UPDATE_SUM DECIMAL(15, 2))
RETURNS (LCC_ID INTEGER)
AS 
begin
  insert into dcl_ctc_list (
     ctc_id,
     spc_id,
     lcc_charges,
     lcc_montage,
     lcc_transport,
     lcc_update_sum
    )
    values (
     :ctc_id,
     :spc_id,
     :lcc_charges,
     :lcc_montage,
     :lcc_transport,
     :lcc_update_sum
    )
    returning lcc_id into :lcc_id;

  suspend;
end ^

ALTER PROCEDURE DCL_CLOSE_CONTRACT (SPC_ID INTEGER)
AS 
declare variable CON_ID integer;
declare variable SPC_COUNT_NOT_EXECUTED integer;
begin
  update dcl_con_list_spec spc set
    spc_executed = 1
  where
    spc.spc_id = :spc_id and
    spc.spc_executed is null and
    ( select can_bloc from dcl_can_spc_block(:spc_id) ) is not null;

  select con_id from dcl_con_list_spec where spc_id = :spc_id into :con_id;
  select count(spc_id) from dcl_con_list_spec where con_id = :con_id and spc_executed is null and spc_annul is null into :spc_count_not_executed;
  if ( spc_count_not_executed = 0 ) then -- cloesed all specifications -> close contract
  begin
    update dcl_contract set con_executed = 1 where con_id = :con_id;
  end
end ^

ALTER PROCEDURE DCL_CLOSE_RESERVED_IN_CPR AS 
declare variable CPR_ID integer;
declare variable COUNT_DAY_FOR_WAIT integer;
begin
  for
    select cpr_id
    from dcl_commercial_proposal cpr
    where cpr.cpr_assemble_minsk_store is not null and
          cpr.cpr_block is null and
          cpr.cpr_proposal_received_flag=0 and
          addday(cpr.cpr_final_date, 1) <= (SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE)
    into :cpr_id
  do
  begin
    update dcl_commercial_proposal cpr set cpr.cpr_block = 1, cpr.cpr_no_reservation = 1 where cpr.cpr_id = :cpr_id;
  end
  select stn_value from dcl_setting where stn_name like 'dayCountWaitReservedForShipping' into :count_day_for_wait;
  for
    select cpr_id
    from dcl_commercial_proposal cpr
    where cpr.cpr_assemble_minsk_store is not null and
          cpr.cpr_block is null and
          cpr.cpr_proposal_received_flag=1 and
          addday(cpr.cpr_final_date, :count_day_for_wait) <= (SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE)
    into :cpr_id
  do
  begin
    update dcl_commercial_proposal cpr set cpr.cpr_block = 1, cpr.cpr_no_reservation = 1 where cpr.cpr_id = :cpr_id;
  end
end ^

ALTER PROCEDURE DCL_COMMERCIAL_PROPOSAL_FILTER (CPR_NUMBER_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
CPR_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPR_DATE_BEGIN_IN DATE,
CPR_DATE_END_IN DATE,
CPR_SUMM_MIN_IN DECIMAL(15, 2),
CPR_SUMM_MAX_IN DECIMAL(15, 2),
CPR_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CPR_DEPARTMENT_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
CPR_STF_NAME_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPR_PROPOSAL_RECEIVED_FLAG_IN SMALLINT,
CPR_PROPOSAL_DECLINED_IN CHAR(1) CHARACTER SET UNICODE_FSS)
RETURNS (CPR_ID INTEGER,
CPR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
CPR_DATE DATE,
CPR_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPR_SUMM DECIMAL(15, 2),
CPR_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CPR_STF_NAME VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CPR_PROPOSAL_RECEIVED_FLAG SMALLINT,
CPR_PROPOSAL_DECLINED CHAR(1) CHARACTER SET UNICODE_FSS,
CPR_BLOCK SMALLINT,
CPR_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CPR_DEPARTMENT VARCHAR(100) CHARACTER SET UNICODE_FSS,
USR_ID_CREATE INTEGER,
CPR_CHECK_PRICE SMALLINT,
CPR_CHECK_PRICE_DATE TIMESTAMP,
CPR_CHECK_PRICE_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CPR_FINAL_DATE DATE,
CPR_ASSEMBLE_MINSK_STORE SMALLINT,
CPR_NO_RESERVATION SMALLINT,
DEP_ID INTEGER)
AS 
BEGIN
  CPR_NUMBER_IN = UPPER(CPR_NUMBER_IN);
  CPR_CONTRACTOR_IN = UPPER(CPR_CONTRACTOR_IN);
  CPR_USER_IN = UPPER(CPR_USER_IN);
  CPR_DEPARTMENT_IN = UPPER(CPR_DEPARTMENT_IN);
  CPR_STF_NAME_IN = UPPER(CPR_STF_NAME_IN);

  FOR
    SELECT
      cpr.cpr_id,
      cpr.cpr_number,
      cpr.cpr_date,
      ctr.ctr_name,
      cpr.cpr_summ,
      cur.cur_name,
      cpr.cpr_proposal_received_flag,
      cpr.cpr_proposal_declined,
      cpr.cpr_block,
      ul.usr_surname || ' ' || ul.usr_name AS cpr_user,
      cpr.usr_id_create,
      cpr.cpr_check_price,
      cpr.cpr_check_price_date,
      ulcp.usr_surname || ' ' || ulcp.usr_name AS cpr_check_price_user,
      cpr.cpr_final_date,
      cpr.cpr_assemble_minsk_store,
      cpr.cpr_no_reservation,
      dep.dep_name,
      CAST(LIST(DISTINCT stf.stf_name, ', ') AS VARCHAR(2000))
    FROM dcl_commercial_proposal cpr
      LEFT JOIN dcl_contractor ctr ON ctr.ctr_id = cpr.ctr_id
      LEFT JOIN dcl_currency cur ON cur.cur_id = cpr.cur_id
      LEFT JOIN dcl_user_language ul ON ul.usr_id = cpr.usr_id_create AND ul.lng_id = 1
      LEFT JOIN dcl_user_language ulcp ON ulcp.usr_id = cpr.usr_id_check_price AND ulcp.lng_id = 1
      LEFT JOIN dcl_user u ON u.usr_id = cpr.usr_id_create
      LEFT JOIN dcl_department dep ON dep.dep_id = u.dep_id
      LEFT JOIN dcl_cpr_list_produce lpr ON lpr.cpr_id = cpr.cpr_id
      LEFT JOIN dcl_stuff_category stf ON stf.stf_id = lpr.stf_id
    WHERE
          (:cpr_contractor_in IS NULL OR :cpr_contractor_in LIKE '' OR UPPER(ctr.ctr_name) LIKE('%' || :cpr_contractor_in || '%'))
     AND  (:cpr_date_begin_in IS NULL OR cpr.cpr_date >= :cpr_date_begin_in)
     AND  (:cpr_date_end_in IS NULL OR cpr.cpr_date <= :cpr_date_end_in)
     AND  (:cpr_summ_min_in IS NULL OR cpr.cpr_summ >= :cpr_summ_min_in)
     AND  (:cpr_summ_max_in IS NULL OR cpr.cpr_summ <= :cpr_summ_max_in)
     AND  (:cpr_user_in IS NULL OR :cpr_user_in LIKE '' OR UPPER(ul.usr_surname || ' ' || ul.usr_name) LIKE('%' || :cpr_user_in || '%'))
     AND  (:cpr_department_in IS NULL OR :cpr_department_in LIKE '' OR UPPER(dep.dep_name) LIKE('%' || :cpr_department_in || '%'))
     AND  (:cpr_stf_name_in IS NULL OR :cpr_stf_name_in LIKE '' OR EXISTS (
            SELECT 1
            FROM dcl_cpr_list_produce lpr2
              JOIN dcl_stuff_category stf2 ON stf2.stf_id = lpr2.stf_id
            WHERE lpr2.cpr_id = cpr.cpr_id
              AND UPPER(stf2.stf_name) LIKE('%' || :cpr_stf_name_in || '%')
          ))
     AND  (:cpr_proposal_declined_in IS NULL OR cpr.cpr_proposal_declined = :cpr_proposal_declined_in)
     AND  (:cpr_proposal_received_flag_in IS NULL OR cpr.cpr_proposal_received_flag = :cpr_proposal_received_flag_in)
     AND  (:cpr_number_in IS NULL OR :cpr_number_in LIKE '' OR UPPER(cpr.cpr_number) LIKE('%' || :cpr_number_in || '%'))
    GROUP BY
      cpr.cpr_id,
      cpr.cpr_number,
      cpr.cpr_date,
      ctr.ctr_name,
      cpr.cpr_summ,
      cur.cur_name,
      cpr.cpr_proposal_received_flag,
      cpr.cpr_proposal_declined,
      cpr.cpr_block,
      ul.usr_surname,
      ul.usr_name,
      cpr.usr_id_create,
      cpr.cpr_check_price,
      cpr.cpr_check_price_date,
      ulcp.usr_surname,
      ulcp.usr_name,
      cpr.cpr_final_date,
      cpr.cpr_assemble_minsk_store,
      cpr.cpr_no_reservation,
      dep.dep_name
    ORDER BY cpr.cpr_date DESC, cpr.cpr_number DESC
    INTO
      :cpr_id,
      :cpr_number,
      :cpr_date,
      :cpr_contractor,
      :cpr_summ,
      :cpr_currency,
      :cpr_proposal_received_flag,
      :cpr_proposal_declined,
      :cpr_block,
      :cpr_user,
      :usr_id_create,
      :cpr_check_price,
      :cpr_check_price_date,
      :cpr_check_price_user,
      :cpr_final_date,
      :cpr_assemble_minsk_store,
      :cpr_no_reservation,
      :cpr_department,
      :cpr_stf_name
  DO
  BEGIN
    dep_id = NULL;
    SELECT dep_id FROM dcl_user WHERE usr_id = :usr_id_create INTO :dep_id;
    SUSPEND;
  END
END ^

ALTER PROCEDURE DCL_COMMERCIAL_PROPOSAL_INSERT (CPR_DATE DATE,
CPR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CPS_ID INTEGER,
CPR_CONCERNING VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPR_CONCERNING_INVOICE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPR_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CUR_ID INTEGER,
CPR_COURSE DECIMAL(18, 8),
CPR_NDS DECIMAL(15, 2),
TRM_ID_PRICE_CONDITION INTEGER,
CPR_COUNTRY VARCHAR(32) CHARACTER SET UNICODE_FSS,
CPR_PAY_CONDITION VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPR_PAY_CONDITION_INVOICE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
TRM_ID_DELIVERY_CONDITION INTEGER,
CPR_DELIVERY_ADDRESS VARCHAR(256) CHARACTER SET UNICODE_FSS,
CPR_SUM_TRANSPORT DECIMAL(15, 2),
CPR_ALL_TRANSPORT SMALLINT,
CPR_DELIVERY_TERM VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CPR_DELIVERY_TERM_INVOICE VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CPR_ADD_INFO VARCHAR(3000) CHARACTER SET UNICODE_FSS,
CPR_FINAL_DATE DATE,
CPR_FINAL_DATE_INVOICE VARCHAR(30) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
EXECUTOR_ID INTEGER,
CPR_EXECUTOR_FLAG SMALLINT,
CPR_DATE_ACCEPT DATE,
BLN_ID INTEGER,
CPR_IMG_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
CPR_PROPOSAL_RECEIVED_FLAG SMALLINT,
CPR_BLOCK SMALLINT,
CPR_SUMM DECIMAL(15, 2),
CPR_NDS_BY_STRING SMALLINT,
CPR_SUM_ASSEMBLING DECIMAL(15, 2),
CPR_OLD_VERSION SMALLINT,
CUR_ID_TABLE INTEGER,
CPR_ASSEMBLE_MINSK_STORE SMALLINT,
CPR_FREE_PRICES SMALLINT,
CPR_CAN_EDIT_INVOICE SMALLINT,
CPR_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
PPS_ID INTEGER,
CPR_REVERSE_CALC SMALLINT,
CPS_ID_SELLER INTEGER,
CPS_ID_CUSTOMER INTEGER,
CPR_GUARANTY_IN_MONTH INTEGER,
CPR_PREPAY_PERCENT DECIMAL(15, 2),
CPR_PREPAY_SUM DECIMAL(15, 2),
CPR_DELAY_DAYS INTEGER,
CPR_NO_RESERVATION SMALLINT,
CPR_PROVIDER_DELIVERY SMALLINT,
CPR_PROVIDER_DELIVERY_ADDRESS VARCHAR(500) CHARACTER SET UNICODE_FSS,
CPR_DELIVERY_COUNT_DAY INTEGER,
CPR_DONOT_CALCULATE_NETTO SMALLINT,
CPR_PRINT_SCALE INTEGER,
CPR_CONTRACT_SCALE INTEGER,
CPR_INVOICE_SCALE INTEGER,
CPR_FINAL_DATE_ABOVE SMALLINT,
CTR_ID_CONSIGNEE INTEGER,
CPR_TENDER_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
CPR_TENDER_NUMBER_EDITABLE CHAR(1) CHARACTER SET UNICODE_FSS,
CPR_PROPOSAL_DECLINED CHAR(1) CHARACTER SET UNICODE_FSS)
RETURNS (CPR_ID INTEGER)
AS 
begin

  insert into dcl_commercial_proposal (
      cpr_number,
      cpr_date,
      ctr_id,
      cps_id,
      cpr_concerning,
      cpr_concerning_invoice,
      cpr_preamble,
      cur_id,
      cpr_course,
      cpr_nds,
      trm_id_price_condition,
      cpr_country,
      cpr_pay_condition,
      cpr_pay_condition_invoice,
      trm_id_delivery_condition,
      cpr_delivery_address,
      cpr_sum_transport,
      cpr_all_transport,
      cpr_delivery_term,
      cpr_delivery_term_invoice,
      cpr_add_info,
      cpr_final_date,
      cpr_final_date_invoice,
      usr_id,
      executor_id,
      cpr_executor_flag,
      cpr_date_accept,
      bln_id,
      cpr_img_name,
      cpr_proposal_received_flag,
      cpr_block,
      cpr_summ,
      cpr_nds_by_string,
      cpr_sum_assembling,
      cpr_old_version,
      cur_id_table,
      cpr_assemble_minsk_store,
      cpr_free_prices,
      cpr_can_edit_invoice,
      cpr_comment,
      pps_id,
      cpr_reverse_calc,
      cps_id_seller,
      cps_id_customer,
      cpr_guaranty_in_month,
      cpr_prepay_percent,
      cpr_prepay_sum,
      cpr_delay_days,
      cpr_no_reservation,
      cpr_provider_delivery,
      cpr_provider_delivery_address,
      cpr_delivery_count_day,
      cpr_donot_calculate_netto,
      cpr_print_scale,
      cpr_contract_scale,
      cpr_invoice_scale,
      cpr_final_date_above,
      ctr_id_consignee,
      cpr_tender_number,
      cpr_tender_number_editable,
      cpr_proposal_declined
    )
    values (
      :cpr_number,
      :cpr_date,
      :ctr_id,
      :cps_id,
      :cpr_concerning,
      :cpr_concerning_invoice,
      :cpr_preamble,
      :cur_id,
      :cpr_course,
      :cpr_nds,
      :trm_id_price_condition,
      :cpr_country,
      :cpr_pay_condition,
      :cpr_pay_condition_invoice,
      :trm_id_delivery_condition,
      :cpr_delivery_address,
      :cpr_sum_transport,
      :cpr_all_transport,
      :cpr_delivery_term,
      :cpr_delivery_term_invoice,
      :cpr_add_info,
      :cpr_final_date,
      :cpr_final_date_invoice,
      :usr_id,
      :executor_id,
      :cpr_executor_flag,
      :cpr_date_accept,
      :bln_id,
      :cpr_img_name,
      :cpr_proposal_received_flag,
      :cpr_block,
      :cpr_summ,
      :cpr_nds_by_string,
      :cpr_sum_assembling,
      :cpr_old_version,
      :cur_id_table,
      :cpr_assemble_minsk_store,
      :cpr_free_prices,
      :cpr_can_edit_invoice,
      :cpr_comment,
      :pps_id,
      :cpr_reverse_calc,
      :cps_id_seller,
      :cps_id_customer,
      :cpr_guaranty_in_month,
      :cpr_prepay_percent,
      :cpr_prepay_sum,
      :cpr_delay_days,
      :cpr_no_reservation,
      :cpr_provider_delivery,
      :cpr_provider_delivery_address,
      :cpr_delivery_count_day,
      :cpr_donot_calculate_netto,
      :cpr_print_scale,
      :cpr_contract_scale,
      :cpr_invoice_scale,
      :cpr_final_date_above,
      :ctr_id_consignee,
      :cpr_tender_number,
      :cpr_tender_number_editable,
      :cpr_proposal_declined
    )
    returning cpr_id into :cpr_id;

  suspend;
end ^

ALTER PROCEDURE DCL_COND_FOR_CONTRACT_FILTER (CFC_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CFC_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CFC_DATE_BEGIN_IN TIMESTAMP,
CFC_DATE_END_IN TIMESTAMP,
SLN_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
CFC_NOT_EXECUTED SMALLINT,
ANNUL_EXCLUDE SMALLINT,
CFC_NOT_PLACED SMALLINT)
RETURNS (CFC_ID INTEGER,
CFC_PLACE_DATE TIMESTAMP,
CFC_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CFC_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CFC_EXECUTE SMALLINT,
CFC_SELLER VARCHAR(100) CHARACTER SET UNICODE_FSS,
EXECUTED_AND_PLACED SMALLINT,
USR_ID INTEGER,
DEP_ID INTEGER,
CFC_CHECK_PRICE SMALLINT,
CFC_CHECK_PRICE_DATE TIMESTAMP,
CFC_CHECK_PRICE_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CFC_ANNUL SMALLINT)
AS 
declare variable CFC_PLACE smallint;
begin
  cfc_contractor_in = upper(cfc_contractor_in);
  cfc_user_in = upper(cfc_user_in);
  if (cfc_date_end_in is not null) then
  begin
    cfc_date_end_in = addday(cfc_date_end_in, 1);
  end
  sln_seller_in = upper(sln_seller_in);

  for
    select cfc_id,
           cfc_place_date,
           (select ctr_name from dcl_contractor  where ctr_id = cfc.ctr_id) as cfc_contractor,
           (select usr_surname || ' ' || usr_name from dcl_user_language  where usr_id = cfc.usr_id_create and lng_id = 1) as cfc_user,
           cfc_execute,
           (select sln_name from dcl_seller where sln_id = cfc.sln_id) as cfc_seller,
           cfc_check_price,
           cfc_check_price_date,
           (select usr_surname || ' ' || usr_name from dcl_user_language where usr_id = cfc.usr_id_check_price and lng_id = 1),
           cfc_place,
           cfc.usr_id_create,
           cfc.cfc_annul
    from dcl_cond_for_contract cfc
    where
          ( :cfc_not_executed is null or (:cfc_not_executed is not null and cfc_execute is null) )
     and  ( :annul_exclude is null or ( :annul_exclude is not null and cfc_annul is null ) )
     and  ( :cfc_not_placed is not null or ( :cfc_not_placed is null and cfc_place is not null ) )
     and  ( :cfc_date_begin_in is null or cfc_execute is null or cfc_place_date >=:cfc_date_begin_in)
     and  ( :cfc_date_end_in is null or cfc_execute is null or cfc_place_date <=:cfc_date_end_in )
     and  ( :cfc_contractor_in is null or :cfc_contractor_in like '' or ( (select upper(ctr.ctr_name) from dcl_contractor ctr where ctr_id = cfc.ctr_id) like('%' || :cfc_contractor_in || '%') ))
     and  ( :cfc_user_in is null or :cfc_user_in like '' or ( (select upper(usr.usr_surname || ' ' || usr.usr_name) from dcl_user_language usr where usr_id = cfc.usr_id_create and lng_id = 1) like('%' || :cfc_user_in || '%') ))
     and  ( :sln_seller_in is null or :sln_seller_in like '' or ( (select upper(sln.sln_name) from dcl_seller sln where sln_id = cfc.sln_id) like('%' || :sln_seller_in || '%') ))
    order by cfc_place, cfc_place_date descending
    into  :cfc_id,
          :cfc_place_date,
          :cfc_contractor,
          :cfc_user,
          :cfc_execute,
          :cfc_seller,
          :cfc_check_price,
          :cfc_check_price_date,
          :cfc_check_price_user,
          :cfc_place,
          :usr_id,
          :cfc_annul
  do
  begin
    executed_and_placed = 1;
    if ( cfc_place is null and cfc_execute is null ) then
    begin
      executed_and_placed = null;
    end

    dep_id = null;
    if ( usr_id is not null ) then
    begin
      select usr.dep_id from dcl_user usr where usr.usr_id = :usr_id into :dep_id;
    end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_COND_FOR_CONTRACT_INSERT (CFC_PLACE SMALLINT,
CFC_EXECUTE SMALLINT,
SLN_ID INTEGER,
CTR_ID INTEGER,
CFC_DOC_TYPE SMALLINT,
CFC_CON_NUMBER_TXT VARCHAR(200) CHARACTER SET UNICODE_FSS,
CFC_CON_DATE DATE,
CUR_ID INTEGER,
CON_ID INTEGER,
CFC_SPC_NUMBER_TXT VARCHAR(200) CHARACTER SET UNICODE_FSS,
CFC_SPC_DATE DATE,
CFC_PAY_COND VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CFC_CUSTOM_POINT VARCHAR(500) CHARACTER SET UNICODE_FSS,
CFC_DELIVERY_COND VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CFC_GUARANTEE_COND VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CFC_MONTAGE_COND VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CFC_DATE_CON_TO DATE,
CFC_COUNT_DELIVERY VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPS_ID_SIGN INTEGER,
CPS_ID INTEGER,
CFC_DELIVERY_COUNT SMALLINT,
PPS_ID INTEGER,
CFC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CFC_NEED_INVOICE SMALLINT,
CFC_ANNUL SMALLINT,
CFC_ANNUL_DATE DATE)
RETURNS (CFC_ID INTEGER)
AS 
begin

  insert into dcl_cond_for_contract(
      cfc_place,
      cfc_execute,
      sln_id,
      ctr_id,
      cfc_doc_type,
      cfc_con_number_txt,
      cfc_con_date,
      cur_id,
      con_id,
      cfc_spc_number_txt,
      cfc_spc_date,
      cfc_pay_cond,
      cfc_custom_point,
      cfc_delivery_cond,
      cfc_guarantee_cond,
      cfc_montage_cond,
      cfc_date_con_to,
      cfc_count_delivery,
      cps_id_sign,
      cps_id,
      cfc_delivery_count,
      pps_id,
      cfc_comment,
      cfc_need_invoice,
      cfc_annul,
      cfc_annul_date
    )
    values(
     :cfc_place,
     :cfc_execute,
     :sln_id,
     :ctr_id,
     :cfc_doc_type,
     :cfc_con_number_txt,
     :cfc_con_date,
     :cur_id,
     :con_id,
     :cfc_spc_number_txt,
     :cfc_spc_date,
     :cfc_pay_cond,
     :cfc_custom_point,
     :cfc_delivery_cond,
     :cfc_guarantee_cond,
     :cfc_montage_cond,
     :cfc_date_con_to,
     :cfc_count_delivery,
     :cps_id_sign,
     :cps_id,
     :cfc_delivery_count,
     :pps_id,
     :cfc_comment,
     :cfc_need_invoice,
     :cfc_annul,
     :cfc_annul_date
    )
    returning cfc_id into :cfc_id;

  suspend;
end ^

ALTER PROCEDURE DCL_CONTACT_PERSON_INSERT (CTR_ID INTEGER,
CPS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPS_PHONE VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_MOB_PHONE VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_FAX VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_BLOCK SMALLINT,
CPS_POSITION VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_ON_REASON VARCHAR(150) CHARACTER SET UNICODE_FSS,
CPS_EMAIL VARCHAR(50) CHARACTER SET UNICODE_FSS,
CPS_CONTRACT_COMMENT VARCHAR(300) CHARACTER SET UNICODE_FSS,
CPS_FIRE SMALLINT)
RETURNS (CPS_ID INTEGER)
AS 
begin
  insert into dcl_contact_person (
     ctr_id,
     cps_name,
     cps_phone,
     cps_mob_phone,
     cps_fax,
     cps_block,
     cps_position,
     cps_on_reason,
     cps_email,
     cps_contract_comment,
     cps_fire
  )
  values(
     :ctr_id,
     :cps_name,
     :cps_phone,
     :cps_mob_phone,
     :cps_fax,
     :cps_block,
     :cps_position,
     :cps_on_reason,
     :cps_email,
     :cps_contract_comment,
     :cps_fire
  )
  returning cps_id into :cps_id;

  suspend;
end ^

ALTER PROCEDURE DCL_CONTRACTOR_FILTER (CTR_NAME_IN VARCHAR(200) CHARACTER SET UNICODE_FSS)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_EMAIL VARCHAR(40) CHARACTER SET UNICODE_FSS)
AS 
begin
  ctr_name_in = upper(ctr_name_in);

  for
    select
      ctr_id,
      ctr_name,
      ctr_email
    from dcl_contractor ctr
    where
     ( :ctr_name_in is null or :ctr_name_in like '' or upper(ctr.ctr_name) like('%' || :ctr_name_in || '%') )
    order by upper(ctr.ctr_name)
  into
    :ctr_id,
    :ctr_name,
    :ctr_email
  do
  begin
    suspend;
  end

end ^

ALTER PROCEDURE DCL_CONTRACTOR_FILTER_FULL (CTR_NAME_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_ADDRESS_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CTR_ACCOUNT_IN VARCHAR(35) CHARACTER SET UNICODE_FSS,
CTR_EMAIL_IN VARCHAR(40) CHARACTER SET UNICODE_FSS,
CTR_UNP_IN VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_FULL_NAME_IN VARCHAR(300) CHARACTER SET UNICODE_FSS,
USR_NAME_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_ID_IN INTEGER,
DEP_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_FULL_NAME VARCHAR(300) CHARACTER SET UNICODE_FSS,
CTR_PHONE VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_FAX CHAR(100) CHARACTER SET UNICODE_FSS,
CTR_EMAIL VARCHAR(40) CHARACTER SET UNICODE_FSS,
CTR_BANK_PROPS VARCHAR(800) CHARACTER SET UNICODE_FSS,
CTR_BLOCK SMALLINT,
CTR_OCCUPIED INTEGER,
CTR_INDEX VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_REGION VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_PLACE VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_STREET VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_BUILDING VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_ADD_INFO VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
declare variable NEED_SUSPEND smallint;
declare variable USR_COUNT integer;
declare variable ACC_COUNT integer;
declare variable USR_CONTACT_PERSON_COUNT integer;
begin
  ctr_name_in = upper(ctr_name_in);
  ctr_address_in = upper(ctr_address_in);
  ctr_account_in = upper(ctr_account_in);
  ctr_email_in = upper(ctr_email_in);
  ctr_unp_in = upper(ctr_unp_in);
  ctr_full_name_in = upper(ctr_full_name_in);
  usr_name_in = upper(usr_name_in);
  dep_name_in = upper(dep_name_in);

  for
    select
      ctr_id,
      ctr_name,
      ctr_full_name,
      ctr_index,
      ctr_region,
      ctr_place,
      ctr_street,
      ctr_building,
      ctr_add_info,
      ctr_phone,
      ctr_fax,
      ctr_email,
      ctr_bank_props,
      ctr_block
    from dcl_contractor ctr
    where
        ( :ctr_name_in is null or :ctr_name_in like '' or upper(ctr.ctr_name) like('%' || :ctr_name_in || '%') )
    and ( :ctr_address_in is null or :ctr_address_in like '' or (upper(coalesce(ctr.ctr_index, '')) || ' ' || upper(coalesce(ctr.ctr_region, '')) || ' ' || upper(coalesce(ctr.ctr_place, '')) || ' ' || upper(coalesce(ctr.ctr_street, '')) || ' ' || upper(coalesce(ctr.ctr_building, '')) || ' ' || upper(coalesce(ctr.ctr_add_info, '')) ) like('%' || :ctr_address_in || '%') )
    and ( :ctr_email_in is null or :ctr_email_in like '' or upper(ctr.ctr_email) like('%' || :ctr_email_in || '%') )
    and ( :ctr_unp_in is null or :ctr_unp_in like '' or upper(ctr.ctr_unp) like('%' || :ctr_unp_in || '%') )
    and ( :ctr_full_name_in is null or :ctr_full_name_in like '' or upper(ctr.ctr_full_name) like('%' || :ctr_full_name_in || '%') )
    order by upper(ctr.ctr_name)
  into
    :ctr_id,
    :ctr_name,
    :ctr_full_name,
    :ctr_index,
    :ctr_region,
    :ctr_place,
    :ctr_street,
    :ctr_building,
    :ctr_add_info,
    :ctr_phone,
    :ctr_fax,
    :ctr_email,
    :ctr_bank_props,
    :ctr_block
  do
  begin
    need_suspend = null;

    ctr_occupied = null;
    select ctr_id from DCL_OCCUPIED_CONTRACTOR_V where ctr_id = :ctr_id into :ctr_occupied;

    if ( (usr_id_in is null) and (usr_name_in is null or usr_name_in like '') and (dep_name_in is null or dep_name_in like '') ) then
    begin
      need_suspend = 1;
    end
    else
    begin
      if ( usr_id_in is not null ) then
      begin
        select count(ctr_usr.usr_id)
        from dcl_contractor_user ctr_usr
        where ctr_usr.ctr_id = :ctr_id and
              ctr_usr.usr_id = :usr_id_in
        into :usr_count;

        select count(cps_usr.usr_id)
        from dcl_contact_person cps,
             dcl_contact_person_user cps_usr
        where cps.ctr_id = :ctr_id and
              cps_usr.cps_id = cps.cps_id and
              cps_usr.usr_id = :usr_id_in
        into :usr_contact_person_count;

        usr_count = usr_count + usr_contact_person_count;

        if ( usr_count > 0 ) then
        begin
          need_suspend = 1;
        end
      end
      else
      begin
        if ( not (usr_name_in is null or usr_name_in like '') ) then
        begin
          select count(ctr_usr.usr_id)
          from dcl_contractor_user ctr_usr,
               dcl_user_language usr_lng
          where ctr_usr.ctr_id = :ctr_id and
                usr_lng.usr_id = ctr_usr.usr_id and
                usr_lng.lng_id = 1 and
                upper(usr_lng.usr_surname || ' ' || usr_lng.usr_name) like('%' || :usr_name_in || '%')
          into :usr_count;

          select count(cps_usr.usr_id)
          from dcl_contact_person cps,
               dcl_contact_person_user cps_usr,
               dcl_user_language usr_lng
          where cps.ctr_id = :ctr_id and
                cps_usr.cps_id = cps.cps_id and
                usr_lng.usr_id = cps_usr.usr_id and
                usr_lng.lng_id = 1 and
                upper(usr_lng.usr_surname || ' ' || usr_lng.usr_name) like('%' || :usr_name_in || '%')
          into :usr_contact_person_count;

          usr_count = usr_count + usr_contact_person_count;

          if ( usr_count > 0 ) then
          begin
            need_suspend = 1;
          end
        end
      end

      if ( not (dep_name_in is null or dep_name_in like '') and need_suspend is null ) then
      begin
        select count(ctr_usr.usr_id)
        from dcl_contractor_user ctr_usr,
             dcl_user usr,
             dcl_department dep
        where ctr_usr.ctr_id = :ctr_id and
              usr.usr_id = ctr_usr.usr_id and
              dep.dep_id = usr.dep_id and
              upper(dep.dep_name) like('%' || :dep_name_in || '%')
        into :usr_count;

        select count(cps_usr.usr_id)
        from dcl_contact_person cps,
             dcl_contact_person_user cps_usr,
             dcl_user usr,
             dcl_department dep
        where cps.ctr_id = :ctr_id and
              cps_usr.cps_id = cps.cps_id and
              usr.usr_id = cps_usr.usr_id and
              dep.dep_id = usr.dep_id and
              upper(dep.dep_name) like('%' || :dep_name_in || '%')
        into :usr_contact_person_count;

        usr_count = usr_count + usr_contact_person_count;

        if ( usr_count > 0 ) then
        begin
          need_suspend = 1;
        end
      end
    end

    if ( need_suspend is not null and ctr_account_in is not null and ctr_account_in not like '' ) then
    begin
      need_suspend = null;
      select count(acc_id)
      from dcl_account acc
      where acc.ctr_id = :ctr_id and
            upper(acc.acc_account) like('%' || :ctr_account_in || '%')
      into :acc_count;

      if ( acc_count > 0 ) then
      begin
        need_suspend = 1;
      end
    end

    if ( need_suspend is not null ) then
    begin
      suspend;
    end
  end

end ^

ALTER PROCEDURE DCL_CONTRACTOR_FOR_CC_FILTER (CTR_NAME_IN VARCHAR(200) CHARACTER SET UNICODE_FSS)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
declare variable CTR_NAME_FILTER varchar(200);
begin
  ctr_name_in = upper(ctr_name_in);

  for
    select
      upper(ctr.ctr_name) as ctr_name_filter,
      ctr.ctr_id as ctr_id,
      ctr_name
    from dcl_contractor ctr,
         dcl_ctc_list lcc,
         dcl_contract con,
         dcl_con_list_spec spc
    where ctr.ctr_id = con.ctr_id and
          spc.con_id = con.con_id and
          spc.spc_id = lcc.spc_id and
          (( :ctr_name_in is null ) or ( :ctr_name_in like '' ) or ( upper(ctr.ctr_name) like('%' || :ctr_name_in || '%') ))
    group by ctr_name_filter, ctr_id, ctr_name
    order by ctr_name_filter
  into
    :ctr_name_filter,
    :ctr_id,
    :ctr_name
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_CONTRACTOR_INSERT (CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_FULL_NAME VARCHAR(300) CHARACTER SET UNICODE_FSS,
CUT_ID INTEGER,
CTR_INDEX VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_REGION VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_PLACE VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_STREET VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_BUILDING VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_ADD_INFO VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CTR_PHONE VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_FAX VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_EMAIL VARCHAR(40) CHARACTER SET UNICODE_FSS,
CTR_BANK_PROPS VARCHAR(800) CHARACTER SET UNICODE_FSS,
CTR_UNP VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_OKPO VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_BLOCK SMALLINT,
RPT_ID INTEGER,
CTR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (CTR_ID INTEGER)
AS 
begin
  insert into dcl_contractor (
    ctr_name,
    ctr_full_name,
    cut_id,
    ctr_index,
    ctr_region,
    ctr_place,
    ctr_street,
    ctr_building,
    ctr_add_info,
    ctr_phone,
    ctr_fax,
    ctr_email,
    ctr_bank_props,
    ctr_unp,
    ctr_okpo,
    ctr_block,
    rpt_id,
    ctr_comment
  )
  values (
    :ctr_name,
    :ctr_full_name,
    :cut_id,
    :ctr_index,
    :ctr_region,
    :ctr_place,
    :ctr_street,
    :ctr_building,
    :ctr_add_info,
    :ctr_phone,
    :ctr_fax,
    :ctr_email,
    :ctr_bank_props,
    :ctr_unp,
    :ctr_okpo,
    :ctr_block,
    :rpt_id,
    :ctr_comment
  )
  returning ctr_id into :ctr_id;

  suspend;
end ^

ALTER PROCEDURE DCL_CONTRACTOR_LOAD (CTR_ID_IN INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_FULL_NAME VARCHAR(300) CHARACTER SET UNICODE_FSS,
CUT_ID INTEGER,
CUT_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_PHONE VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_FAX CHAR(100) CHARACTER SET UNICODE_FSS,
CTR_EMAIL VARCHAR(40) CHARACTER SET UNICODE_FSS,
CTR_BANK_PROPS VARCHAR(800) CHARACTER SET UNICODE_FSS,
ACCOUNT1 VARCHAR(35) CHARACTER SET UNICODE_FSS,
ACCOUNT2 VARCHAR(35) CHARACTER SET UNICODE_FSS,
ACCOUNTVAL VARCHAR(35) CHARACTER SET UNICODE_FSS,
CTR_UNP VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_OKPO VARCHAR(15) CHARACTER SET UNICODE_FSS,
CTR_DOUBLE_ACCOUNT SMALLINT,
CTR_BLOCK INTEGER,
RPT_ID INTEGER,
RPT_DESCRIPTION VARCHAR(500) CHARACTER SET UNICODE_FSS,
BYN_ACCOUNTS VARCHAR(200) CHARACTER SET UNICODE_FSS,
OTHER_ACCOUNTS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTR_INDEX VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_REGION VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_PLACE VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_STREET VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_BUILDING VARCHAR(20) CHARACTER SET UNICODE_FSS,
CTR_ADD_INFO VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CTR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
declare variable ACC_ACCOUNT varchar(35);
declare variable CUR_NAME varchar(10);
begin
  ctr_id = null;
  ctr_name = null;
  ctr_full_name = null;
  cut_id = null;
  cut_name = null;
  ctr_index = null;
  ctr_region = null;
  ctr_place = null;
  ctr_street = null;
  ctr_building = null;
  ctr_add_info = null;
  ctr_phone = null;
  ctr_fax = null;
  ctr_email = null;
  ctr_bank_props = null;
  account1 = null;
  account2 = null;
  accountVal = null;
  ctr_unp = null;
  ctr_okpo = null;
  ctr_block = null;
  ctr_double_account = null;
  rpt_id = null;
  rpt_description = null;
  byn_accounts = '';
  other_accounts = '';
  ctr_comment = null;

  select
       ctr.ctr_id,
       ctr.ctr_name,
       ctr.ctr_full_name,
       ctr.cut_id,
       cut.cut_name,
       ctr.ctr_index,
       ctr.ctr_region,
       ctr.ctr_place,
       ctr.ctr_street,
       ctr.ctr_building,
       ctr.ctr_add_info,
       ctr.ctr_phone,
       ctr.ctr_fax,
       ctr.ctr_email,
       ctr.ctr_bank_props,
       (select acc_account from dcl_account where ctr_id = ctr.ctr_id and acc_index = 1),
       (select acc_account from dcl_account where ctr_id = ctr.ctr_id and acc_index = 2),
       (select acc_account from dcl_account where ctr_id = ctr.ctr_id and acc_index = 3),
       ctr.ctr_unp,
       ctr.ctr_okpo,
       ctr.ctr_block,
       ctr.ctr_double_account,
       rpt.rpt_id,
       rpt.rpt_description,
       ctr.ctr_comment
  from dcl_contractor ctr
       left join dcl_country cut on cut.cut_id = ctr.cut_id,
       dcl_reputation rpt
  where ctr_id = :ctr_id_in and
        rpt.rpt_id = ctr.rpt_id
  into
       :ctr_id,
       :ctr_name,
       :ctr_full_name,
       :cut_id,
       :cut_name,
       :ctr_index,
       :ctr_region,
       :ctr_place,
       :ctr_street,
       :ctr_building,
       :ctr_add_info,
       :ctr_phone,
       :ctr_fax,
       :ctr_email,
       :ctr_bank_props,
       :account1,
       :account2,
       :accountVal,
       :ctr_unp,
       :ctr_okpo,
       :ctr_block,
       :ctr_double_account,
       :rpt_id,
       :rpt_description,
       :ctr_comment
  ;

  for
    select
      acc.acc_account,
      cur.cur_name
    from dcl_account acc,
         dcl_currency cur
    where acc.ctr_id = :ctr_id and
          cur.cur_id = acc.cur_id and
          cur.cur_name like 'BYN'
    into  :acc_account,
          :cur_name
  do
  begin
    if ( cur_name is null ) then
    begin
      cur_name = '';
    end
    if ( acc_account is not null ) then
    begin
      byn_accounts = byn_accounts || :acc_account || ' ' || :cur_name || ', ';
    end
  end

  for
    select
      acc.acc_account,
      cur.cur_name
    from dcl_account acc,
         dcl_currency cur
    where acc.ctr_id = :ctr_id and
          cur.cur_id = acc.cur_id and
          (cur.cur_name not like 'BYN' or cur.cur_name is null)
    into  :acc_account,
          :cur_name
  do
  begin
    if ( cur_name is null ) then
    begin
      cur_name = '';
    end
    if ( acc_account is not null ) then
    begin
      other_accounts = other_accounts || :acc_account || ' ' || :cur_name || ', ';
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_CONTRACTOR_REQUEST_FILTER (CRQ_NUMBER_IN VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID_IN INTEGER,
CRQ_EQUIPMENT_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
EXCLUDE_ANNUL SMALLINT,
CRQ_NOT_DELIVER SMALLINT,
CRQ_TICKET_NUMBER_IN VARCHAR(30) CHARACTER SET UNICODE_FSS,
SLN_ID_IN INTEGER,
CRQ_STUFF_CATEGORY_IN VARCHAR(150) CHARACTER SET UNICODE_FSS)
RETURNS (CRQ_ID INTEGER,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_RECEIVE_DATE DATE,
CRQ_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID INTEGER,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_SERIAL_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_DELIVER SMALLINT,
CRQ_ANNUL SMALLINT,
ATTACH_IDX INTEGER,
CRQ_TICKET_NUMBER VARCHAR(30) CHARACTER SET UNICODE_FSS,
CRQ_SELLER VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_CREATE_DATE TIMESTAMP,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER)
AS 
declare variable LPS_ID integer;
declare variable PRD_ID integer;
declare variable CRQ_EQUIPMENT_CMP varchar(2040);
declare variable CRQ_NO_CONTRACT smallint;
declare variable STF_ID integer;
declare variable CRQ_ATTACH_COUNT integer;
declare variable NEED_SUSPEND smallint;
declare variable SLN_ID integer;
begin
  crq_number_in = upper(crq_number_in);
  crq_contractor_in = upper(crq_contractor_in);
  crq_equipment_in = upper(crq_equipment_in);
  crq_ticket_number_in = upper(crq_ticket_number_in);
  crq_stuff_category_in = upper(crq_stuff_category_in);

  for
    select crq_id,
           crq_number,
           crq_receive_date,
           crq_create_date,
           (select ctr_name from dcl_contractor  where ctr_id = crq.ctr_id),
           crq_request_type_id,
           lps_id,
           prd_id,
           crq_deliver,
           crq_no_contract,
           stf_id,
           crq_serial_num,
           crq_annul,
           crq_ticket_number,
           sln_id,
           crq_comment,
           con_id
    from dcl_contractor_request crq
    where
          ( :crq_request_type_id_in is null or crq.crq_request_type_id = :crq_request_type_id_in )
     and  ( :crq_number_in is null or :crq_number_in like '' or ( upper(crq.crq_number) like('%' || :crq_number_in || '%')) )
     and  ( :crq_ticket_number_in is null or :crq_ticket_number_in like '' or ( upper(crq.crq_ticket_number) like('%' || :crq_ticket_number_in || '%')) )
     and  ( :crq_contractor_in is null or :crq_contractor_in like '' or (select upper(ctr.ctr_name) from dcl_contractor ctr where ctr_id = crq.ctr_id) like('%' || :crq_contractor_in || '%') )
     and  ( :exclude_annul is null or ( :exclude_annul is not null and crq_annul is null ) )
     and  ( :crq_not_deliver is null or ( :crq_not_deliver is not null and crq_deliver is null ) )
    order by crq_receive_date descending
    into  :crq_id,
          :crq_number,
          :crq_receive_date,
          :crq_create_date,
          :crq_contractor,
          :crq_request_type_id,
          :lps_id,
          :prd_id,
          :crq_deliver,
          :crq_no_contract,
          :stf_id,
          :crq_serial_number,
          :crq_annul,
          :crq_ticket_number,
          :sln_id,
          :crq_comment,
          :con_id
  do
  begin
    need_suspend = 1;
    -- service or guarantee
    if ( crq_request_type_id = 2 or crq_request_type_id = 3 ) then
    begin
      select crq_deliver from dcl_get_crq_deliver(:crq_id) into :crq_deliver;
      if ( crq_not_deliver is not null and crq_deliver is not null ) then
      begin
        need_suspend = null;
      end
    end

    select count(*) from dcl_attachment where att_parent_id = :crq_id and att_parent_table='DCL_CONTRACTOR_REQUEST' into :crq_attach_count;

    if ( need_suspend is not null ) then
    begin
      attach_idx = null;
      if ( crq_attach_count = 0 ) then
      begin
       attach_idx = 1;
      end
      if ( crq_attach_count > 0 ) then
      begin
       attach_idx = 6;
      end

      crq_equipment_cmp = '';
      crq_equipment = null;
      stf_name = null;

      if (
           (
             crq_request_type_id = 1 or
             ( ( crq_request_type_id = 2 or crq_request_type_id = 3 ) and crq_no_contract is null )
           )
           and lps_id is not null
         ) then
      begin
        crq_serial_number = null;

        select lps_serial_num,
               crq_equipment,
               stf_name
        from   dcl_equipment_pnp_load(:lps_id)
        into  :crq_serial_number,
              :crq_equipment,
              :stf_name;
      end
      else
      begin
        if (
             ( crq_request_type_id = 2 or crq_request_type_id = 3 ) and
               crq_no_contract is not null and stf_id is not null and prd_id is not null
           ) then
        begin
          select crq_equipment
          from   dcl_equipment_for_produce_load(:stf_id, :prd_id)
          into   :crq_equipment;
        end

        if ( stf_id is not null ) then
        begin
          select stf_name from dcl_stuff_category where stf_id = :stf_id into :stf_name;
        end
      end

      if ( crq_equipment is not null ) then
      begin
        crq_equipment_cmp = crq_equipment;
      end
      if ( crq_serial_number is not null ) then
      begin
        crq_equipment_cmp = crq_equipment_cmp || ' ' || crq_serial_number;
      end
    end

    crq_seller = null;
    if ( need_suspend is not null ) then
    begin
      if ( crq_request_type_id = 2 or crq_request_type_id = 3 ) then -- service or guarantee
      begin
        if ( con_id is not null ) then
        begin
          select sln_id from dcl_contract where con_id = :con_id into :sln_id;
        end
      end

      need_suspend = null;
      if ( crq_no_contract is not null and crq_request_type_id != 1 ) then
      begin
        sln_id = 2;
      end
      if ( sln_id = sln_id_in or sln_id_in is null ) then
      begin
        need_suspend = 1;

        if ( sln_id is not null ) then
        begin
          select sln_name from dcl_seller where sln_id = :sln_id into :crq_seller;
        end
      end
    end

    if (
         ( crq_equipment_in is null or crq_equipment_in like '' or upper(crq_equipment_cmp) like('%' || crq_equipment_in || '%') ) and
         need_suspend is not null
       ) then
    begin
      need_suspend = null;
      if ( crq_stuff_category_in is null or crq_stuff_category_in like '' ) then
      begin
        need_suspend = 1;
      end
      else
      begin
        if ( upper(stf_name) like('%' || crq_stuff_category_in || '%') ) then
        begin
          need_suspend = 1;
        end
      end

      if ( need_suspend is not null ) then
      begin
        suspend;
      end
    end
  end
end ^

ALTER PROCEDURE DCL_CONTRACTOR_REQUEST_INSERT (CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_RECEIVE_DATE DATE,
CTR_ID INTEGER,
CPS_ID INTEGER,
CRQ_REQUEST_TYPE_ID INTEGER,
CON_ID INTEGER,
LPS_ID INTEGER,
PRD_ID INTEGER,
CRQ_DELIVER SMALLINT,
SLN_ID INTEGER,
USR_ID_MANAGER INTEGER,
USR_ID_CHIEF INTEGER,
USR_ID_SPECIALIST INTEGER,
CRQ_CITY VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_ID_OTHER INTEGER,
CRQ_NO_CONTRACT SMALLINT,
STF_ID INTEGER,
CRQ_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_YEAR_OUT VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_ENTER_IN_USE_DATE DATE,
CRQ_OPERATING_TIME INTEGER,
CRQ_ANNUL SMALLINT,
CRQ_TICKET_NUMBER VARCHAR(30) CHARACTER SET UNICODE_FSS,
CRQ_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CON_ID_FOR_WORK INTEGER)
RETURNS (CRQ_ID INTEGER)
AS 
begin

    insert into dcl_contractor_request(
      crq_number,
      crq_receive_date,
      ctr_id,
      cps_id,
      crq_request_type_id,
      con_id,
      lps_id,
      prd_id,
      crq_deliver,
      sln_id,
      usr_id_manager,
      usr_id_chief,
      usr_id_specialist,
      crq_city,
      ctr_id_other,
      crq_no_contract,
      stf_id,
      crq_serial_num,
      crq_year_out,
      crq_enter_in_use_date,
      crq_operating_time,
      crq_annul,
      crq_ticket_number,
      crq_comment,
      con_id_for_work
    )
    values(
      :crq_number,
      :crq_receive_date,
      :ctr_id,
      :cps_id,
      :crq_request_type_id,
      :con_id,
      :lps_id,
      :prd_id,
      :crq_deliver,
      :sln_id,
      :usr_id_manager,
      :usr_id_chief,
      :usr_id_specialist,
      :crq_city,
      :ctr_id_other,
      :crq_no_contract,
      :stf_id,
      :crq_serial_num,
      :crq_year_out,
      :crq_enter_in_use_date,
      :crq_operating_time,
      :crq_annul,
      :crq_ticket_number,
      :crq_comment,
      :con_id_for_work
    )
    returning crq_id into :crq_id;

  suspend;
end ^

ALTER PROCEDURE DCL_CONTRACTOR_REQUEST_LOAD (CRQ_ID INTEGER)
RETURNS (USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
CRQ_CREATE_DATE TIMESTAMP,
CRQ_EDIT_DATE TIMESTAMP,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_RECEIVE_DATE DATE,
CTR_ID INTEGER,
CPS_ID INTEGER,
CRQ_REQUEST_TYPE_ID INTEGER,
CON_ID INTEGER,
LPS_ID INTEGER,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPS_ENTER_IN_USE_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CRQ_DELIVER SMALLINT,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
MANAGER_ID INTEGER,
MANAGER_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
MANAGER_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
CHIEF_ID INTEGER,
CHIEF_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
CHIEF_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPECIALIST_ID INTEGER,
SPECIALIST_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPECIALIST_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
CRQ_CITY VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTR_ID_OTHER INTEGER,
CTR_NAME_OTHER VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_NO_CONTRACT SMALLINT,
CRQ_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_YEAR_OUT VARCHAR(100) CHARACTER SET UNICODE_FSS,
CRQ_ENTER_IN_USE_DATE DATE,
STF_NAME1 VARCHAR(150) CHARACTER SET UNICODE_FSS,
CRQ_ANNUL SMALLINT,
CRQ_TICKET_NUMBER VARCHAR(30) CHARACTER SET UNICODE_FSS,
SHP_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_SELLER_ID INTEGER,
CON_SELLER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CRQ_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_OPERATING_TIME INTEGER,
CON_ID_FOR_WORK INTEGER)
AS 
declare variable COUNT_DELIVER integer;
begin
    select
      usr_id_create,
      usr_id_edit,
      crq_create_date,
      crq_edit_date,
      crq_number,
      crq_receive_date,
      ctr_id,
      cps_id,
      crq_request_type_id,
      con_id,
      lps_id,
      prd_id,
      crq_deliver,
      sln_id,
      usr_id_manager,
      usr_id_chief,
      usr_id_specialist,
      crq_city,
      ctr_id_other,
      crq_no_contract,
      stf_id, 
      crq_serial_num,
      crq_year_out,
      crq_enter_in_use_date,
      crq_operating_time,
      crq_annul,
      crq_ticket_number,
      crq_comment,
      con_id_for_work
    from dcl_contractor_request
    where crq_id = :crq_id
    into 
      :usr_id_create,
      :usr_id_edit,
      :crq_create_date,
      :crq_edit_date,
      :crq_number,
      :crq_receive_date,
      :ctr_id,
      :cps_id,
      :crq_request_type_id,
      :con_id,
      :lps_id,
      :prd_id,
      :crq_deliver,
      :sln_id,
      :manager_id,
      :chief_id,
      :specialist_id,
      :crq_city,
      :ctr_id_other,
      :crq_no_contract,
      :stf_id,
      :crq_serial_num,
      :crq_year_out,
      :crq_enter_in_use_date,
      :crq_operating_time,
      :crq_annul,
      :crq_ticket_number,
      :crq_comment,
      :con_id_for_work
    ;
    stf_name1 = null;
    if ( stf_id is not null ) then
    begin
      select stf_name from dcl_stuff_category where stf_id = :stf_id into :stf_name1;
    end

    if (
         crq_request_type_id = 1 or
         ( ( crq_request_type_id = 2 or crq_request_type_id = 3 ) and crq_no_contract is null )
       ) then
    begin
      select lps_serial_num,
             lps_year_out,
             lps_enter_in_use_date,
             stf_name,
             ctn_number,
             crq_equipment,
             mad_complexity
      from dcl_equipment_pnp_load(:lps_id)
      into  :lps_serial_num,
            :lps_year_out,
            :lps_enter_in_use_date,
            :stf_name,
            :ctn_number,
            :crq_equipment,
            :mad_complexity;

      manager_name = null;
      manager_surname = null;
      if ( manager_id is not null ) then
      begin
        select usr_name,
               usr_surname
        from dcl_user_language
        where usr_id = :manager_id and lng_id = 1
        into :manager_name,
             :manager_surname;
      end

      chief_name = null;
      chief_surname = null;
      if ( chief_id is not null ) then
      begin
        select usr_name,
               usr_surname
        from dcl_user_language
        where usr_id = :chief_id and lng_id = 1
        into :chief_name,
             :chief_surname;
      end

      specialist_name = null;
      specialist_surname = null;
      if ( specialist_id is not null ) then
      begin
        select usr_name,
               usr_surname
        from dcl_user_language
        where usr_id = :specialist_id and lng_id = 1
        into :specialist_name,
             :specialist_surname;
      end

      ctr_name_other = null;
      if ( ctr_id_other is not null ) then
      begin
        select ctr_name from dcl_contractor where ctr_id = :ctr_id_other into :ctr_name_other;
      end
    end

    if (
         ( crq_request_type_id = 2 or crq_request_type_id = 3 ) and
           crq_no_contract is not null
       ) then
    begin
      stf_name = stf_name1;

      select ctn_number,
             crq_equipment,
             mad_complexity
     from dcl_equipment_for_produce_load(:stf_id, :prd_id)
     into  :ctn_number,
           :crq_equipment,
           :mad_complexity;
    end

    shp_date = null;
    con_number = null;
    con_date = null;
    spc_number = null;
    spc_date = null;
    con_seller_id = null;
    con_seller = null;
    -- service or guarantee
    if ( crq_request_type_id = 2 or crq_request_type_id = 3 ) then
    begin
      select
        shp_date,
        con_number,
        con_date,
        spc_number,
        spc_date,
        con_seller_id,
        con_seller
      from dcl_add_info_service_guarantee(:lps_id)
      into
        :shp_date,
        :con_number,
        :con_date,
        :spc_number,
        :spc_date,
        :con_seller_id,
        :con_seller
      ;

      crq_deliver = null;
      select count(crp_id) from dcl_crq_print where crq_id = :crq_id and crp_deliver is not null into :count_deliver;
      if ( count_deliver > 0 ) then
      begin
        crq_deliver = 1;
      end
    end

    sln_name = null;
    if ( sln_id is not null ) then
    begin
      select sln_name from dcl_seller where sln_id = :sln_id into :sln_name;
    end

    suspend;
end ^

ALTER PROCEDURE DCL_CONTRACTS_CLOSED_LOAD (CTC_ID_IN INTEGER)
RETURNS (LCC_ID INTEGER,
CTC_ID INTEGER,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_ORIGINAL SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_GROUP_DELIVERY SMALLINT,
SPC_ORIGINAL SMALLINT,
SUM_OUT_NDS_EUR DECIMAL(15, 2),
LCC_CHARGES DECIMAL(15, 2),
LCC_MONTAGE DECIMAL(15, 2),
LCC_UPDATE_SUM DECIMAL(15, 2),
HAVE_UNBLOCKED_PRC SMALLINT)
AS 
declare variable UNBLOCKED_PRC_COUNT integer;
begin
  for
    select
      lcc_id,
      ctc_id,
      ctr.ctr_id,
      ctr.ctr_name,
      con.con_id,
      con.con_number,
      con.con_date,
      con.con_original,
      spc.spc_id,
      spc.spc_number,
      spc.spc_date,
      spc.spc_summ,
      spc.spc_group_delivery,
      spc.spc_original,
      ( select sum_out_nds_eur from dcl_get_sum_out_nds_eur(spc.spc_id) ),
      lcc_charges,
      lcc_montage,
      lcc_update_sum
    from dcl_ctc_list lcc,
         dcl_con_list_spec spc,
         dcl_contract con,
         dcl_contractor ctr
    where ctc_id = :ctc_id_in and
          spc.spc_id = lcc.spc_id and
          con.con_id = spc.con_id and
          ctr.ctr_id = con.ctr_id
    order by upper(ctr.ctr_name)
    into :lcc_id,
         :ctc_id,
         :ctr_id,
         :ctr_name,
         :con_id,
         :con_number,
         :con_date,
         :con_original,
         :spc_id,
         :spc_number,
         :spc_date,
         :spc_summ,
         :spc_group_delivery,
         :spc_original,
         :sum_out_nds_eur,
         :lcc_charges,
         :lcc_montage,
         :lcc_update_sum
  do
  begin
    have_unblocked_prc = null;

    select
      coalesce(count(lps.lps_id), 0)
    from
      dcl_ctc_shp cshp,
      dcl_shp_list_produce lps,
      dcl_prc_list_produce lpc,
      dcl_produce_cost prc
    where
      cshp.lcc_id = :lcc_id and
      lps.shp_id = cshp.shp_id and
      lpc.lpc_id = lps.lpc_id and
      prc.prc_id = lpc.prc_id and
      prc.prc_block is null
    into :unblocked_prc_count;

    if ( unblocked_prc_count != 0 ) then
    begin
      have_unblocked_prc = 1;
    end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_CONTRACT_CLOSED_FILTER (CTC_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTC_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTC_DATE_BEGIN_IN DATE,
CTC_DATE_END_IN DATE,
CTC_NOT_BLOCK_IN SMALLINT)
RETURNS (CTC_ID INTEGER,
CTC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTC_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTC_DATE DATE,
CTC_BLOCK SMALLINT,
USR_ID_CREATE INTEGER,
CON_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SHOW_WARN SMALLINT)
AS 
declare variable CTR_COUNT integer;
declare variable CON_COUNT integer;
declare variable FOUND_REC_CTR integer;
declare variable FOUND_REC_CON integer;
declare variable CTC_CONTRACTOR_FILTER varchar(200);
declare variable CON_NUMBER_FILTER varchar(50);
declare variable COPY_PROJECT_COUNT integer;
declare variable UNBLOCKED_PRC_COUNT integer;
declare variable SHP_COUNT integer;
declare variable PAY_COUNT integer;
begin
  ctc_number_in = upper(ctc_number_in);
  ctc_contractor_in = upper(ctc_contractor_in);

  for
    select ctc_id,
           ctc_number,
           ctc_date,
           ctc_block,
           usr_id_create
           from dcl_contract_closed c
    where
          ( :ctc_date_begin_in is null or ctc_date >=:ctc_date_begin_in )
     and  ( :ctc_date_end_in is null or ctc_date <=:ctc_date_end_in )
     and  (
            ( :ctc_not_block_in is null )
            or
            ( :ctc_not_block_in is not null and ctc_block is null )
          )
    order by ctc_date descending
    into  :ctc_id,
          :ctc_number,
          :ctc_date,
          :ctc_block,
          :usr_id_create
  do
  begin

    found_rec_ctr = 0;
    ctr_count = 0;
    select
      count(ctr.ctr_id)
    from dcl_contractor ctr,
         dcl_ctc_list lcc,
         dcl_contract con,
         dcl_con_list_spec spc
    where ctr.ctr_id = con.ctr_id and
          spc.con_id = con.con_id and
          spc.spc_id = lcc.spc_id and
          lcc.ctc_id = :ctc_id
    into :ctr_count;

    if (ctr_count > 1) then
    begin
      ctc_contractor = '';
      if ( ctc_contractor_in is null or ctc_contractor_in like '' ) then
      begin
        found_rec_ctr = 1;
      end
      else
      begin
        for
          select
            upper(ctr.ctr_name)
          from dcl_contractor ctr,
               dcl_ctc_list lcc,
               dcl_contract con,
               dcl_con_list_spec spc
          where ctr.ctr_id = con.ctr_id and
               spc.con_id = con.con_id and
               spc.spc_id = lcc.spc_id and
               lcc.ctc_id = :ctc_id
          into :ctc_contractor_filter
        do
        begin
          if ( ctc_contractor_in is null or ctc_contractor_filter like('%' || :ctc_contractor_in || '%') ) then
          begin
            found_rec_ctr = 1;
            break;
          end
        end
      end

    end
    else
    begin
      select
        ctr.ctr_name,
        upper(ctr.ctr_name)
      from dcl_contractor ctr,
           dcl_ctc_list lcc,
           dcl_contract con,
           dcl_con_list_spec spc
      where ctr.ctr_id = con.ctr_id and
            spc.con_id = con.con_id and
            spc.spc_id = lcc.spc_id and
            lcc.ctc_id = :ctc_id
      into :ctc_contractor,
           :ctc_contractor_filter;

      if ( ctc_contractor_in is null or ctc_contractor_filter like('%' || :ctc_contractor_in || '%') ) then
      begin
        found_rec_ctr = 1;
      end
    end

    if (found_rec_ctr = 1) then
    begin
      found_rec_con = 0;
      con_count = 0;
      select
        count(con.con_id)
      from dcl_ctc_list lcc,
           dcl_contract con,
           dcl_con_list_spec spc
      where spc.con_id = con.con_id and
            spc.spc_id = lcc.spc_id and
            lcc.ctc_id = :ctc_id
      into :con_count;

      if (con_count > 1) then
      begin
        con_number = '';
        con_date = null;
        if ( ctc_number_in is null or ctc_number_in like '' ) then
        begin
          found_rec_con = 1;
        end
        else
        begin
          for
            select
              upper(con.con_number)
            from dcl_ctc_list lcc,
                 dcl_contract con,
                 dcl_con_list_spec spc
            where spc.con_id = con.con_id and
                  spc.spc_id = lcc.spc_id and
                 lcc.ctc_id = :ctc_id
            into :con_number_filter
          do
          begin
            if ( ctc_number_in is null or con_number_filter like('%' || :ctc_number_in || '%') ) then
            begin
              found_rec_con = 1;
              break;
            end
          end
        end
      end
      else
      begin
        select
          con.con_number,
          con.con_date,
          upper(con.con_number)
        from dcl_ctc_list lcc,
             dcl_contract con,
             dcl_con_list_spec spc
        where spc.con_id = con.con_id and
              spc.spc_id = lcc.spc_id and
              lcc.ctc_id = :ctc_id
        into :con_number,
             :con_date,
             :con_number_filter;

        if ( ctc_number_in is null or con_number_filter like('%' || :ctc_number_in || '%') ) then
        begin
          found_rec_con = 1;
        end
      end
    end

    if (found_rec_ctr = 1 and found_rec_con = 1) then
    begin
      show_warn = null;

      select count(spc.spc_id)
      from dcl_ctc_list lcc,
           dcl_con_list_spec spc,
           dcl_contract con
      where ctc_id = :ctc_id and
            spc.spc_id = lcc.spc_id and
            con.con_id = spc.con_id and
            (
              con.con_original is null or
              con.con_original = 0 or
              spc.spc_original is null or
              spc.spc_original = 0
            )
      into :copy_project_count;
      if ( copy_project_count > 0 ) then
      begin
        show_warn = 1;
      end

      if ( show_warn is null ) then
      begin
        select
          coalesce(count(lps.lps_id), 0)
        from
          dcl_ctc_list lcc,
          dcl_ctc_shp cshp,
          dcl_shp_list_produce lps,
          dcl_prc_list_produce lpc,
          dcl_produce_cost prc
        where
          lcc.ctc_id = :ctc_id and
          cshp.lcc_id = lcc.lcc_id and
          lps.shp_id = cshp.shp_id and
          lpc.lpc_id = lps.lpc_id and
          prc.prc_id = lpc.prc_id and
          prc.prc_block is null
        into :unblocked_prc_count;

        if ( unblocked_prc_count != 0 ) then
        begin
          show_warn = 1;
        end
      end

      if ( show_warn is null ) then
      begin
        select
          coalesce(count(shp.shp_id), 0)
        from
          dcl_ctc_list lcc,
          dcl_ctc_shp cshp,
          dcl_shipping shp
        where
          lcc.ctc_id = :ctc_id and
          cshp.lcc_id = lcc.lcc_id and
          shp.shp_id = cshp.shp_id and
          shp.shp_original is null
        into :shp_count;

        if ( shp_count != 0 ) then
        begin
          show_warn = 1;
        end
      end

      /*
      show_warn_dates = null;
      select
        coalesce(count(shp.shp_id), 0)
      from
        dcl_ctc_list lcc,
        dcl_ctc_shp cshp,
        dcl_shipping shp
      where
        lcc.ctc_id = :ctc_id and
        cshp.lcc_id = lcc.lcc_id and
        shp.shp_id = cshp.shp_id and
        shp.shp_date > :ctc_date
      into :shp_count;

      if ( shp_count != 0 ) then
      begin
        show_warn_dates = 1;
      end

      if (show_warn_dates is null) then
      begin
        select
          coalesce(count(pay.pay_id), 0)
        from
          dcl_ctc_list lcc,
          dcl_ctc_pay cpay,
          dcl_pay_list_summ lps,
          dcl_payment pay
        where
          lcc.ctc_id = :ctc_id and
          cpay.lcc_id = lcc.lcc_id and
          lps.lps_id = cpay.lps_id and
          pay.pay_id = lps.pay_id and
          pay.pay_date > :ctc_date
        into :pay_count;
      end
      */

      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_CONTRACT_CLOSED_INSERT (CTC_DATE DATE,
CTC_BLOCK SMALLINT)
RETURNS (CTC_ID INTEGER)
AS 
begin

  insert into dcl_contract_closed (
    ctc_date,
    ctc_block
  )
  values (
    :ctc_date,
    :ctc_block
  )
  returning ctc_id into :ctc_id;

  suspend;
end ^

ALTER PROCEDURE DCL_CONTRACT_FILTER (CON_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_DATE_BEGIN_IN DATE,
CON_DATE_END_IN DATE,
CON_SUMM_MIN_IN DECIMAL(15, 2),
CON_SUMM_MAX_IN DECIMAL(15, 2),
CON_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_EXECUTED_IN SMALLINT,
ORIDINAL_ABSENT SMALLINT,
SLN_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_SUMM DECIMAL(15, 2),
CON_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
CON_EXECUTED SMALLINT,
CON_USER VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CON_REMINDER SMALLINT,
CON_ANNUL SMALLINT,
SPC_COUNT INTEGER,
ATTACH_IDX INTEGER,
USR_ID_LIST VARCHAR(200) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_REUSABLE SMALLINT,
CON_FINAL_DATE DATE,
CON_ORIGINAL SMALLINT,
SPC_NUMBERS_NO_ORIGINAL VARCHAR(1000) CHARACTER SET UNICODE_FSS,
DAY_BEFORE_FINAL INTEGER,
NO_DELIVERY_DATE SMALLINT,
INCORRECT_FINAL_DATE SMALLINT)
AS 
declare variable SPC_SUMM decimal(15,2);
declare variable SPC_DELIVERY_DATE date;
declare variable SPC_DELIVERY_TERM_TYPE smallint;
declare variable SPC_PERCENT_OR_SUM smallint;
declare variable SPC_DELIVERY_PERCENT decimal(15,2);
declare variable SPC_DELIVERY_SUM decimal(15,2);
declare variable PAYED_SUMM decimal(15,2);
declare variable CON_ATTACH_COUNT integer;
declare variable SPC_ID integer;
declare variable SPC_HAVE_NO_ATTACH smallint;
declare variable SPC_HAVE_SOME_ATTACH smallint;
declare variable SPC_HAVE_ALL_ATTACH smallint;
declare variable SPC_ATTACH_COUNT integer;
declare variable SPC_NUMBER varchar(50);
begin
  con_number_in = upper(con_number_in);
  con_contractor_in = upper(con_contractor_in);
  con_user_in = upper(con_user_in);
  sln_seller_in = upper(sln_seller_in);

  for
    select con_id,
           con_number,
           con_date,
           (select ctr_name from dcl_contractor  where ctr_id = con.ctr_id),
           con_summ,
           (select cur_name from dcl_currency  where cur_id = con.cur_id),
           con_executed,
           con_annul,
           con_reusable,
           con_final_date,
           con_original
    from dcl_contract con
    where
          ( :con_contractor_in is null or :con_contractor_in like '' or ( (select upper(ctr.ctr_name) from dcl_contractor ctr where ctr_id = con.ctr_id) like('%' || :con_contractor_in || '%') ))
     and  ( :con_executed_in is null or ( :con_executed_in = 1 and con_executed = :con_executed_in ) or ( :con_executed_in = 0 and con_executed is null ) )
     and  (
             :oridinal_absent is null or
             (
               :oridinal_absent = 1 and
               (
                 con.con_original != 1 or
                 con.con_original is null or
                 (
                   select coalesce(count(spc.spc_id), 0)
                   from dcl_con_list_spec spc
                   where spc.con_id = con.con_id and (spc.spc_original != 1 or spc.spc_original is null) and
                         -- for pint 1880
                         ( :con_user_in is null or :con_user_in like '' or (select upper(usr.usr_surname || ' ' || usr.usr_name) from dcl_user_language usr where usr_id = spc.usr_id and lng_id = 1) like('%' || :con_user_in || '%') )
                 ) > 0
               )
             )
          )
     and  ( :sln_seller_in is null or :sln_seller_in like '' or ( (select upper(sln.sln_name) from dcl_seller sln where sln_id = con.sln_id) like('%' || :sln_seller_in || '%') ))
     and  ( :con_date_begin_in is null or con_date >=:con_date_begin_in )
     and  ( :con_date_end_in is null or con_date <=:con_date_end_in )
     and  ( :con_summ_min_in is null or con_summ >=:con_summ_min_in )
     and  ( :con_summ_max_in is null or con_summ <=:con_summ_max_in )
     and  ( :con_number_in is null or :con_number_in like '' or upper(con.con_number) like('%' || :con_number_in || '%') )
    into  :con_id,
          :con_number,
          :con_date,
          :con_contractor,
          :con_summ,
          :con_currency,
          :con_executed,
          :con_annul,
          :con_reusable,
          :con_final_date,
          :con_original
  do
  begin
    select con_user,
           usr_id_list,
           dep_id_list
    from dcl_get_usr_dep_list_con(:con_id)
    into   :con_user,
           :usr_id_list,
           :dep_id_list
    ;

    if ( :con_user_in is null or :con_user_in like '' or upper(:con_user) like('%' || :con_user_in || '%') ) then
    begin
      con_reminder = null;
      no_delivery_date = null;
      incorrect_final_date = null;

      spc_have_no_attach = 1;
      spc_have_some_attach = 0;
      spc_have_all_attach = 1;

      for
        select
          spc_id,
          spc_summ,
          spc_delivery_date,
          spc_delivery_term_type,
          spc_percent_or_sum,
          spc_delivery_percent,
          spc_delivery_sum,
          (select
             sum(lps_summ)
           from
             dcl_pay_list_summ psum
           where
            psum.spc_id = spc.spc_id
          )
        from dcl_con_list_spec spc
        where con_id = :con_id
        into
          :spc_id,
          :spc_summ,
          :spc_delivery_date,
          :spc_delivery_term_type,
          :spc_percent_or_sum,
          :spc_delivery_percent,
          :spc_delivery_sum,
          :payed_summ
      do
      begin
        if ( spc_delivery_term_type = 2 and spc_percent_or_sum is not null and spc_delivery_date is null ) then
        begin
          if ( spc_percent_or_sum = 0 and (spc_delivery_percent <= payed_summ / spc_summ * 100) ) then
          begin
            con_reminder = 1;
            no_delivery_date = 1;
          end
          if ( spc_percent_or_sum = 1 and spc_delivery_sum <= payed_summ ) then
          begin
            con_reminder = 1;
            no_delivery_date = 1;
          end
        end

        select attachmentsCount from dcl_get_att_count_for_spc(:spc_id) into :spc_attach_count;
        if ( spc_attach_count > 0 ) then
        begin
          spc_have_no_attach = 0;
          spc_have_some_attach = 1;
        end
        if ( spc_attach_count = 0 ) then
        begin
          spc_have_all_attach = 0;
        end
      end

      select count(spc_id) from dcl_con_list_spec where con_id = :con_id into :spc_count;
      select count(*) from dcl_attachment where att_parent_id = :con_id and att_parent_table='DCL_CONTRACT' into :con_attach_count;

      if ( spc_count = 0 ) then
      begin
        spc_have_all_attach = 0;
      end

      -- sequence is important !!!
      attach_idx = null;
      if ( con_attach_count = 0 and spc_have_no_attach = 1 ) then
      begin
        attach_idx = 1;
      end
      if ( con_attach_count = 0 and spc_have_some_attach = 1 ) then
      begin
        attach_idx = 2;
      end
      if ( con_attach_count = 0 and spc_have_all_attach = 1 ) then
      begin
        attach_idx = 3;
      end
      if ( con_attach_count > 0 and spc_have_no_attach = 1 ) then
      begin
        attach_idx = 4;
      end
      if ( con_attach_count > 0 and spc_have_some_attach = 1 ) then
      begin
        attach_idx = 5;
      end
      if ( con_attach_count > 0 and spc_have_all_attach = 1 ) then
      begin
        attach_idx = 6;
      end

      spc_numbers_no_original = '';
      for 
        select spc_number
        from dcl_con_list_spec
        where con_id = :con_id and
              ( spc_original = 0 or spc_original is null ) and
              spc_annul is null
        into :spc_number
      do
      begin
        spc_numbers_no_original = spc_numbers_no_original || spc_number || ', ';
      end

      day_before_final = 0;
      if ( con_final_date is not null) then
      begin
        select count_day from dcl_get_count_day(:con_final_date, (select cast('NOW' as date) from rdb$database)) into :day_before_final;
        if (day_before_final <= 35 and con_executed is null) then
        begin
          if (con_annul is null) then
          begin
            con_reminder = 1;
          end
          incorrect_final_date = 1;
        end
      end

      suspend;
    end

  end
end ^

ALTER PROCEDURE DCL_CONTRACT_FOR_CC_FILTER (CTR_ID INTEGER)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
begin
    if (ctr_id is null) then
    begin
      for
        select
            con_id,
            con_number,
            con_date,
            cur.cur_id,
            cur.cur_name
        from
            dcl_contract con,
            dcl_currency cur
        where
            cur.cur_id = con.cur_id
        into  :con_id,
              :con_number,
              :con_date,
              :cur_id,
              :cur_name
      do
      begin
        suspend;
      end
    end
    else
    begin
      for
        select
            con.con_id,
            con.con_number,
            con.con_date,
            cur.cur_id,
            cur.cur_name
        from
            dcl_ctc_list lcc,
            dcl_contract con,
            dcl_con_list_spec spc,
            dcl_currency cur
        where
            con.ctr_id = :ctr_id and
            spc.con_id = con.con_id and
            spc.spc_id = lcc.spc_id and
            cur.cur_id = con.cur_id
        into  :con_id,
              :con_number,
              :con_date,
              :cur_id,
              :cur_name
      do
      begin
        suspend;
      end
    end
end ^

ALTER PROCEDURE DCL_CONTRACT_FOR_CONTRACTOR (CTR_ID INTEGER,
CUR_ID_IN INTEGER,
CON_NUMBER_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
ALL_CON SMALLINT,
ONLY_REUSABLE SMALLINT,
CON_FINAL_DATE_AFTER DATE)
RETURNS (CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
SLN_IS_RESIDENT SMALLINT,
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
CON_REUSABLE SMALLINT,
CON_FINAL_DATE DATE,
CON_ANNUL SMALLINT)
AS 
begin
  con_number_in = upper(con_number_in);
  for
    select con.con_id,
           con.con_number,
           con.con_date,
           con.sln_id,
           cur.cur_id,
           cur.cur_name,
           con.con_reusable,
           con.con_final_date,
           con.con_annul
    from dcl_contract con,
         dcl_currency cur
    where
      con.ctr_id = :ctr_id and
      cur.cur_id = con.cur_id and
      con.cur_id = coalesce(:cur_id_in, con.cur_id) and
      ( :all_con is not null or ( :all_con is null and (con_executed != 1 or con_executed is null) ) ) and
      ( :only_reusable is null or con.con_reusable = :only_reusable ) and
      ( con.sln_id is null or con.sln_id in (select int_id from dcl_decode_id_list(:con_seller_in)) ) and
      ( :con_number_in is null or ( upper(con.con_number) like ('%' || :con_number_in || '%') ) ) and
      ( :con_final_date_after is null or con.con_final_date > :con_final_date_after )
    order by con_date descending, con_number descending
    into  :con_id,
          :con_number,
          :con_date,
          :sln_id,
          :cur_id,
          :cur_name,
          :con_reusable,
          :con_final_date,
          :con_annul
  do
  begin
    sln_name = '';
    if ( sln_id is not null ) then
    begin
      select sln_name, sln_is_resident from dcl_seller where sln_id = :sln_id into :sln_name, :sln_is_resident;
    end
    suspend;
  end
end ^

ALTER PROCEDURE DCL_CONTRACT_INSERT (CON_DATE DATE,
CTR_ID INTEGER,
CUR_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_EXECUTED SMALLINT,
CON_SUMM DECIMAL(15, 2),
CON_ORIGINAL SMALLINT,
CON_ANNUL SMALLINT,
CON_ANNUL_DATE DATE,
CON_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SLN_ID INTEGER,
CON_REUSABLE SMALLINT,
CON_FINAL_DATE DATE)
RETURNS (CON_ID INTEGER)
AS 
begin

  insert into dcl_contract (
     con_number,
     con_date,
     ctr_id,
     cur_id,
     con_executed,
     con_summ,
     con_original,
     con_annul,
     con_annul_date,
     con_comment,
     sln_id,
     con_reusable,
     con_final_date
    )
    values (
     :con_number,
     :con_date,
     :ctr_id,
     :cur_id,
     :con_executed,
     :con_summ,
     :con_original,
     :con_annul,
     :con_annul_date,
     :con_comment,
     :sln_id,
     :con_reusable,
     :con_final_date
   )
   returning con_id into :con_id;

  suspend;
end ^

ALTER PROCEDURE DCL_CON_LIST_SPECS_LOAD (CON_ID_IN INTEGER)
RETURNS (SPC_ID INTEGER,
CON_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_SUMM_NDS DECIMAL(15, 2),
SPC_EXECUTED SMALLINT,
SPC_NDS_RATE DECIMAL(15, 2),
SPC_DELIVERY_DATE DATE,
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_ORIGINAL SMALLINT,
SPC_MONTAGE SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
SPC_DELIVERY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_TERM_TYPE SMALLINT,
SPC_PERCENT_OR_SUM SMALLINT,
SPC_DELIVERY_PERCENT DECIMAL(15, 2),
SPC_DELIVERY_SUM DECIMAL(15, 2),
SPC_PAY_AFTER_MONTAGE SMALLINT,
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
SPC_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
USR_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_OCCUPIED INTEGER,
SPC_OCCUPIED_IN_PAY_SHP INTEGER,
SPC_IN_CTC INTEGER,
PAYED_SUMM DECIMAL(15, 2),
PAYED_DATE DATE,
ATTACHMENTS_COUNT INTEGER,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_ADDITIONAL_DAYS_COUNT INTEGER)
AS 
begin
  con_id = con_id_in;

  for
    select
      spc_id
    from
      dcl_con_list_spec spc
    where spc.con_id = :con_id_in
    order by spc_date descending
    into
      :spc_id
  do
  begin
    select
      spc_id,
      con_id,
      spc_number,
      spc_date,
      spc_summ,
      spc_summ_nds,
      spc_executed,
      spc_nds_rate,
      spc_delivery_date,
      spc_add_pay_cond,
      spc_delivery_cond,
      spc_delivery_term_type,
      spc_percent_or_sum,
      spc_delivery_percent,
      spc_delivery_sum,
      spc_original,
      spc_montage,
      spc_pay_after_montage,
      spc_group_delivery,
      spc_annul,
      spc_annul_date,
      spc_comment,
      usr_id,
      usr_name,
      spc_occupied,
      spc_occupied_in_pay_shp,
      spc_in_ctc,
      payed_summ,
      payed_date,
      attachments_count,
      spc_letter1_date,
      spc_letter2_date,
      spc_letter3_date,
      spc_complaint_in_court_date,
      spc_additional_days_count
    from dcl_con_list_spec_load(:spc_id)
    into
      :spc_id,
      :con_id,
      :spc_number,
      :spc_date,
      :spc_summ,
      :spc_summ_nds,
      :spc_executed,
      :spc_nds_rate,
      :spc_delivery_date,
      :spc_add_pay_cond,
      :spc_delivery_cond,
      :spc_delivery_term_type,
      :spc_percent_or_sum,
      :spc_delivery_percent,
      :spc_delivery_sum,
      :spc_original,
      :spc_montage,
      :spc_pay_after_montage,
      :spc_group_delivery,
      :spc_annul,
      :spc_annul_date,
      :spc_comment,
      :usr_id,
      :usr_name,
      :spc_occupied,
      :spc_occupied_in_pay_shp,
      :spc_in_ctc,
      :payed_summ,
      :payed_date,
      :attachments_count,
      :spc_letter1_date,
      :spc_letter2_date,
      :spc_letter3_date,
      :spc_complaint_in_court_date,
      :spc_additional_days_count
    ;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_CON_LIST_SPEC_INSERT (CON_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_SUMM_NDS DECIMAL(15, 2),
SPC_NDS_RATE DECIMAL(15, 2),
SPC_EXECUTED SMALLINT,
SPC_DELIVERY_DATE DATE,
SPC_DELIVERY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_TERM_TYPE SMALLINT,
SPC_PERCENT_OR_SUM SMALLINT,
SPC_DELIVERY_PERCENT DECIMAL(15, 2),
SPC_DELIVERY_SUM DECIMAL(15, 2),
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_ORIGINAL SMALLINT,
SPC_MONTAGE SMALLINT,
SPC_PAY_AFTER_MONTAGE SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
SPC_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_ADDITIONAL_DAYS_COUNT INTEGER)
RETURNS (SPC_ID INTEGER)
AS 
begin

  insert into dcl_con_list_spec (
      con_id,
      spc_number,
      spc_date,
      spc_summ,
      spc_summ_nds,
      spc_nds_rate,
      spc_executed,
      spc_delivery_date,
      spc_delivery_cond,
      spc_delivery_term_type,
      spc_percent_or_sum,
      spc_delivery_percent,
      spc_delivery_sum,
      spc_add_pay_cond,
      spc_original,
      spc_montage,
      spc_pay_after_montage,
      spc_group_delivery,
      spc_annul,
      spc_annul_date,
      spc_comment,
      usr_id,
      spc_letter1_date,
      spc_letter2_date,
      spc_letter3_date,
      spc_complaint_in_court_date,
      spc_additional_days_count
  )
  values (
      :con_id,
      :spc_number,
      :spc_date,
      :spc_summ,
      :spc_summ_nds,
      :spc_nds_rate,
      :spc_executed,
      :spc_delivery_date,
      :spc_delivery_cond,
      :spc_delivery_term_type,
      :spc_percent_or_sum,
      :spc_delivery_percent,
      :spc_delivery_sum,
      :spc_add_pay_cond,
      :spc_original,
      :spc_montage,
      :spc_pay_after_montage,
      :spc_group_delivery,
      :spc_annul,
      :spc_annul_date,
      :spc_comment,
      :usr_id,
      :spc_letter1_date,
      :spc_letter2_date,
      :spc_letter3_date,
      :spc_complaint_in_court_date,
      :spc_additional_days_count
  )   
  returning spc_id into :spc_id;

  suspend;
end ^

ALTER PROCEDURE DCL_CON_LIST_SPEC_LOAD (SPC_ID_IN INTEGER)
RETURNS (SPC_ID INTEGER,
CON_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_SUMM_NDS DECIMAL(15, 2),
SPC_EXECUTED SMALLINT,
SPC_NDS_RATE DECIMAL(15, 2),
SPC_DELIVERY_DATE DATE,
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_ORIGINAL SMALLINT,
SPC_MONTAGE SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
SPC_DELIVERY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_TERM_TYPE SMALLINT,
SPC_PERCENT_OR_SUM SMALLINT,
SPC_DELIVERY_PERCENT DECIMAL(15, 2),
SPC_DELIVERY_SUM DECIMAL(15, 2),
SPC_PAY_AFTER_MONTAGE SMALLINT,
SPC_ANNUL SMALLINT,
SPC_ANNUL_DATE DATE,
SPC_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
USR_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_OCCUPIED INTEGER,
SPC_OCCUPIED_IN_PAY_SHP INTEGER,
SPC_IN_CTC INTEGER,
PAYED_SUMM DECIMAL(15, 2),
PAYED_DATE DATE,
ATTACHMENTS_COUNT INTEGER,
SPC_LETTER1_DATE DATE,
SPC_LETTER2_DATE DATE,
SPC_LETTER3_DATE DATE,
SPC_COMPLAINT_IN_COURT_DATE DATE,
SPC_ADDITIONAL_DAYS_COUNT INTEGER)
AS 
begin
  spc_id = null;
  con_id = null;
  spc_number = null;
  spc_date = null;
  spc_summ = null;
  spc_summ_nds = null;
  spc_executed = null;
  spc_nds_rate = null;
  spc_delivery_date = null;
  spc_add_pay_cond = null;
  spc_original = null;
  spc_montage = null;
  spc_group_delivery = null;
  spc_delivery_cond = null;
  spc_delivery_term_type = null;
  spc_percent_or_sum = null;
  spc_delivery_percent = null;
  spc_delivery_sum = null;
  spc_pay_after_montage = null;
  spc_annul = null;
  spc_annul_date = null;
  spc_comment = null;
  usr_id = null;
  usr_name = null;
  spc_occupied = null;
  spc_occupied_in_pay_shp = null;
  spc_in_ctc = null;
  payed_summ = null;
  payed_date = null;
  attachments_count = null;
  spc_letter1_date = null;
  spc_letter2_date = null;
  spc_letter3_date = null;
  spc_complaint_in_court_date = null;
  spc_additional_days_count = null;

  select
      spc_id,
      con_id,
      spc_number,
      spc_date,
      spc_summ,
      spc_summ_nds,
      spc_executed,
      spc_nds_rate,
      spc_delivery_date,
      spc_add_pay_cond,
      spc_delivery_cond,
      spc_delivery_term_type,
      spc_percent_or_sum,
      spc_delivery_percent,
      spc_delivery_sum,
      spc_original,
      spc_montage,
      spc_pay_after_montage,
      spc_group_delivery,
      spc_annul,
      spc_annul_date,
      spc_comment,
      usr_id,
      (select usr_surname || ' ' || usr_name from dcl_user_language where usr_id = spc.usr_id and lng_id = 1),
      spc_letter1_date,
      spc_letter2_date,
      spc_letter3_date,
      spc_complaint_in_court_date,
      spc_additional_days_count
  from dcl_con_list_spec spc
  where spc_id = :spc_id_in
  into
      :spc_id,
      :con_id,
      :spc_number,
      :spc_date,
      :spc_summ,
      :spc_summ_nds,
      :spc_executed,
      :spc_nds_rate,
      :spc_delivery_date,
      :spc_add_pay_cond,
      :spc_delivery_cond,
      :spc_delivery_term_type,
      :spc_percent_or_sum,
      :spc_delivery_percent,
      :spc_delivery_sum,
      :spc_original,
      :spc_montage,
      :spc_pay_after_montage,
      :spc_group_delivery,
      :spc_annul,
      :spc_annul_date,
      :spc_comment,
      :usr_id,
      :usr_name,
      :spc_letter1_date,
      :spc_letter2_date,
      :spc_letter3_date,
      :spc_complaint_in_court_date,
      :spc_additional_days_count
  ;

  select spc_id from DCL_OCCUPIED_SPEC_V where spc_id = :spc_id into :spc_occupied;
  select spc_id from DCL_OCCUPIED_SPEC_IN_PAY_SHP_V where spc_id = :spc_id into :spc_occupied_in_pay_shp;
  select spc_id from DCL_SPEC_IN_CTC_V where spc_id = :spc_id into :spc_in_ctc;
  select sum(lps_summ) from dcl_pay_list_summ where spc_id = :spc_id into payed_summ;
  select payed_date from dcl_get_payed_date(:spc_id, :spc_summ, :spc_percent_or_sum, :spc_delivery_percent, :spc_delivery_sum) into :payed_date;
  select attachmentsCount from dcl_get_att_count_for_spc(:spc_id) into :attachments_count;

  suspend;
end ^

ALTER PROCEDURE DCL_CON_MESSAGES_LOAD (USR_ID_IN INTEGER)
RETURNS (CMS_ID INTEGER,
CMS_CREATE_DATE TIMESTAMP,
CMS_MESSAGE VARCHAR(256) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
begin
  for
    select
      cms_id,
      cms_create_date,
      cms_message,
      ctr_id
    from
      dcl_con_message cms
    where cms.usr_id = :usr_id_in
    order by cms_create_date descending
    into
      :cms_id,
      :cms_create_date,
      :cms_message,
      :ctr_id
  do
  begin
    ctr_name = null;
    if (ctr_id is not null) then
    begin
      select ctr_name from dcl_contractor where ctr_id = :ctr_id into :ctr_name;
    end
    suspend;
  end
end ^

ALTER PROCEDURE DCL_COUNTRY_INSERT (CUT_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (CUT_ID INTEGER)
AS 
begin
  insert into dcl_country (
    cut_name
  )
  values (
    :cut_name
  )
  returning cut_id into :cut_id;

  suspend;
end ^

ALTER PROCEDURE DCL_CPR_LIST_PRODUCES_LOAD (CPR_ID_IN INTEGER,
CPR_DATE TIMESTAMP)
RETURNS (LPR_ID INTEGER,
CPR_ID INTEGER,
LPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
LPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPR_PRICE_BRUTTO DECIMAL(15, 2),
LPR_DISCOUNT DECIMAL(15, 2),
LPR_PRICE_NETTO DECIMAL(15, 2),
LPR_COUNT DECIMAL(15, 2),
CUS_ID INTEGER,
CUS_CODE VARCHAR(10) CHARACTER SET UNICODE_FSS,
CUS_PERCENT DECIMAL(15, 2),
LPR_COEFICIENT DECIMAL(18, 8),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
LPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
LPC_ID INTEGER,
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
LPR_SALE_PRICE DECIMAL(15, 2),
LPR_SALE_COST_PARKING_TRANS DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(6) CHARACTER SET UNICODE_FSS)
AS 
begin
  cpr_id = cpr_id_in;

  for
    select
      lpr_id
    from
      dcl_cpr_list_produce lpr
    where lpr.cpr_id = :cpr_id_in
    order by lpr_id
    into
      :lpr_id
  do
  begin
    select
      lpr_id,
      cpr_id,
      lpr_produce_name,
      lpr_catalog_num,
      lpr_price_brutto,
      lpr_discount,
      lpr_price_netto,
      lpr_count,
      cus_id,
      cus_code,
      cus_percent,
      lpr_coeficient,
      stf_id,
      stf_name,
      prd_id,
      lpr_comment,
      lpc_id,
      lpc_cost_one_by,
      lpc_price_list_by,
      lpc_1c_number,
      lpr_sale_price,
      lpr_sale_cost_parking_trans
    from dcl_cpr_list_produce_load(:lpr_id, :cpr_date)
    into
      :lpr_id,
      :cpr_id,
      :lpr_produce_name,
      :lpr_catalog_num,
      :lpr_price_brutto,
      :lpr_discount,
      :lpr_price_netto,
      :lpr_count,
      :cus_id,
      :cus_code,
      :cus_percent,
      :lpr_coeficient,
      :stf_id,
      :stf_name,
      :prd_id,
      :lpr_comment,
      :lpc_id,
      :lpc_cost_one_by,
      :lpc_price_list_by,
      :lpc_1c_number,
      :lpr_sale_price,
      :lpr_sale_cost_parking_trans
    ;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_CPR_LIST_PRODUCE_LOAD (LPR_ID_IN INTEGER,
CPR_DATE TIMESTAMP)
RETURNS (LPR_ID INTEGER,
CPR_ID INTEGER,
LPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
LPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPR_PRICE_BRUTTO DECIMAL(15, 2),
LPR_DISCOUNT DECIMAL(15, 2),
LPR_PRICE_NETTO DECIMAL(15, 2),
LPR_COUNT DECIMAL(15, 2),
CUS_ID INTEGER,
CUS_CODE VARCHAR(10) CHARACTER SET UNICODE_FSS,
CUS_PERCENT DECIMAL(15, 2),
LPR_COEFICIENT DECIMAL(18, 8),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
LPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
LPC_ID INTEGER,
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
LPR_SALE_PRICE DECIMAL(15, 2),
LPR_SALE_COST_PARKING_TRANS DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(6) CHARACTER SET UNICODE_FSS)
AS 
declare variable PRC_DATE date;
begin
  lpr_id = null;
  cpr_id = null;
  lpr_produce_name = null;
  lpr_catalog_num = null;
  lpr_price_brutto = null;
  lpr_discount = null;
  lpr_price_netto = null;
  lpr_count = null;
  cus_id = null;
  cus_code = null;
  cus_percent = null;
  lpr_coeficient = null;
  stf_id = null;
  stf_name = null;
  prd_id = null;
  lpr_comment = null;
  lpc_id = null;
  lpc_cost_one_by = null;
  lpc_price_list_by = null;
  lpr_sale_price = null;
  lpr_sale_cost_parking_trans = null;

  select
    lpr_id,
    cpr_id,
    lpr_produce_name,
    lpr_catalog_num,
    lpr_price_brutto,
    lpr_discount,
    lpr_price_netto,
    lpr_count,
    cus_id,
    (select cus_code from dcl_custom_code cus where cus_id = lpr.cus_id ),
    (
      select cus_percent
      from dcl_custom_code cus
      where cus_code = (
                         select cus_code
                         from dcl_custom_code
                         where cus_id = lpr.cus_id
                       )
      and
      cus_instant = (
                      select max(cus_instant)
                      from dcl_custom_code
                      where cus_code = cus.cus_code and
                            cus_instant <= :cpr_date
                    )
    ),
    lpr_coeficient,
    stf_id,
    ( select stf_name from dcl_stuff_category where stf_id = lpr.stf_id ),
    prd_id,
    lpr_comment,
    lpc_id,
    lpr_sale_price,
    lpr_sale_cost_parking_trans
  from dcl_cpr_list_produce lpr
  where lpr_id = :lpr_id_in
  into
    :lpr_id,
    :cpr_id,
    :lpr_produce_name,
    :lpr_catalog_num,
    :lpr_price_brutto,
    :lpr_discount,
    :lpr_price_netto,
    :lpr_count,
    :cus_id,
    :cus_code,
    :cus_percent,
    :lpr_coeficient,
    :stf_id,
    :stf_name,
    :prd_id,
    :lpr_comment,
    :lpc_id,
    :lpr_sale_price,
    :lpr_sale_cost_parking_trans
  ;

  if ( lpc_id is not null ) then
  begin

    select prc_date,
           lpc_cost_one_by,
           lpc_price_list_by,
           lpc_1c_number
    from dcl_prc_list_produce_load(:lpc_id)
    into   :prc_date,
           :lpc_cost_one_by,
           :lpc_price_list_by,
           :lpc_1c_number
    ;

    if (prc_date < '2016-07-01') then
    begin
      lpc_cost_one_by = ROUND(lpc_cost_one_by / 100, 0) / 100;
      lpc_price_list_by = ROUND(lpc_price_list_by / 100, 0) / 100;

      lpr_price_brutto = ROUND(lpr_price_brutto / 100, 0) / 100;
      lpr_discount = ROUND(lpr_discount / 100, 0) / 100;
      lpr_price_netto = ROUND(lpr_price_netto / 100, 0) / 100;
    end

  end

  suspend;
end ^

ALTER PROCEDURE DCL_CPR_TRANSPORTS_LOAD (CPR_ID_IN INTEGER)
RETURNS (TRN_ID INTEGER,
CPR_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
TRN_SUM DECIMAL(15, 2))
AS 
begin
  cpr_id = cpr_id_in;

  for
    select
      trn_id
    from
      dcl_cpr_transport trn
    where trn.cpr_id = :cpr_id_in
    order by trn_id
    into
      :trn_id
  do
  begin
    select
      trn_id,
      cpr_id,
      stf_id,
      stf_name,
      trn_sum
    from dcl_cpr_transport_load(:trn_id)
    into
      :trn_id,
      :cpr_id,
      :stf_id,
      :stf_name,
      :trn_sum
    ;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_CPR_TRANSPORT_LOAD (TRN_ID_IN INTEGER)
RETURNS (TRN_ID INTEGER,
CPR_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
TRN_SUM DECIMAL(15, 2))
AS 
begin
  trn_id = null;
  cpr_id = null;
  stf_id = null;
  stf_name = null;
  trn_sum = null;

  select
    trn_id,
    cpr_id,
    stf_id,
    ( select stf_name from dcl_stuff_category where stf_id = trn.stf_id ),
    trn_sum
  from dcl_cpr_transport trn
  where trn_id = :trn_id_in
  into
    :trn_id,
    :cpr_id,
    :stf_id,
    :stf_name,
    :trn_sum
  ;

  suspend;
end ^

ALTER PROCEDURE DCL_CURRENCIES_RATES_FOR_DATE (COURSE_DATE DATE)
RETURNS (CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
CRT_ID INTEGER,
CRT_RATE DECIMAL(15, 6))
AS 
begin
  for
    select cur.cur_id,
           cur.cur_name,
           crt.crt_id,
           crt.crt_rate
    from dcl_currency cur
         left join dcl_currency_rate crt on
         (
           crt.cur_id = cur.cur_id and
           crt.crt_date = :course_date
         )
    into   :cur_id,
           :cur_name,
           :crt_id,
           :crt_rate
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_CURRENCY_RATE_FOR_DATE (CUR_ID INTEGER,
COURSE_DATE DATE)
RETURNS (CRT_ID INTEGER,
CRT_RATE DECIMAL(15, 6),
CRT_DATE DATE)
AS 
begin
  select
    crt_id,
    crt_rate,
    crt_date
  from dcl_currency_rate
  where cur_id = :cur_id and
        crt_date = (
                     select max(crt_date)
                     from dcl_currency_rate
                     where cur_id = :cur_id and
                           crt_date <= :course_date
                   )
  into
    :crt_id,
    :crt_rate,
    :crt_date
  ;

  suspend;
end ^

ALTER PROCEDURE DCL_CURRENCY_RATE_MIN_DATE RETURNS (CRT_DATE DATE)
AS 
declare variable CURRENCY_COUNT integer;
declare variable DATE_CURRENT date;
declare variable RATE_COUNT integer;
declare variable I integer;
declare variable FLAG integer;
begin
  select count(cur_id) from dcl_currency into :currency_count;
  select cast('NOW' as date) from rdb$database into :date_current;
  crt_date = :date_current;
  i = 0;
  flag = 0;

  while (i < 30 and flag = 0) do
  begin
    date_current = AddDay(:date_current, -1);
    select count(crt_id) from dcl_currency_rate where crt_date = :date_current into :rate_count;
    if (rate_count < currency_count ) then
    begin
      crt_date = date_current;
    end
    else
    begin
      flag = 1;
    end

    i = i + 1;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_CURRENT_WORKS_FILTER (CRQ_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID_IN INTEGER,
CRQ_EQUIPMENT_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CRQ_STUFF_CATEGORY_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
ORD_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (CRQ_ID INTEGER,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID INTEGER,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_CREATE_DATE TIMESTAMP,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
MANAGER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_SUM DECIMAL(15, 2),
ORD_SENT_TO_PROD_DATE DATE,
EXECUTED_DATES VARCHAR(500) CHARACTER SET UNICODE_FSS)
AS 
declare variable CON_ID integer;
declare variable DATE_STR varchar(10);
declare variable OPR_DATE_EXECUTED date;
declare variable LINKED_COUNT integer;
begin
  ord_user_in = upper(ord_user_in);

  for
    select crq_id,
           crq_number,
           crq_create_date,
           crq_contractor,
           crq_request_type_id,
           crq_equipment,
           crq_comment,
           stf_name,
           con_id
    from dcl_contractor_request_filter(
      null,
      :crq_contractor_in,
      :crq_request_type_id_in,
      :crq_equipment_in,
      null,
      null,
      null,
      null,
      :crq_stuff_category_in
    )
    into  :crq_id,
          :crq_number,
          :crq_create_date,
          :crq_contractor,
          :crq_request_type_id,
          :crq_equipment,
          :crq_comment,
          :stf_name,
          :con_id
  do
  begin
    con_number = null;
    con_date = null;
    if (con_id is not null) then
    begin
      select con_number, con_date from dcl_contract where con_id = :con_id into :con_number, :con_date;
    end

    select count(ord.ord_id)
    from dcl_crq_ord_link crq_ord,
         dcl_order ord
    where crq_ord.crq_id = :crq_id
          and ord.ord_id = crq_ord.ord_id
    into :linked_count;

    if ( linked_count = 0 and (:ord_user_in is null or :ord_user_in like '') ) then
    begin
      ord_id = null;
      ord_number = null;
      ord_date = null;
      manager = null;
      ord_sum = null;
      ord_sent_to_prod_date = null;
      executed_dates = null;

      suspend;
    end
    else
    begin

      for
        select ord.ord_id,
               ord.ord_number,
               ord.ord_date,
               (select usr_surname || ' ' || usr_name from dcl_user_language  where usr_id = ord.usr_id_create and lng_id = 1),
               ord_summ,
               ord_sent_to_prod_date
        from dcl_crq_ord_link crq_ord,
             dcl_order ord
        where crq_ord.crq_id = :crq_id
              and ord.ord_id = crq_ord.ord_id
              and ( :ord_user_in is null or :ord_user_in like '' or (select upper(usr.usr_surname || ' ' || usr.usr_name) from dcl_user_language usr where usr_id = ord.usr_id_create and lng_id = 1) like('%' || :ord_user_in || '%') )
        into :ord_id,
             :ord_number,
             :ord_date,
             :manager,
             :ord_sum,
             :ord_sent_to_prod_date
      do
      begin
        executed_dates = '';

        for
          select distinct executed.opr_date_executed
          from dcl_ord_list_produce opr,
               dcl_opr_list_executed executed
          where opr.ord_id = :ord_id and
                executed.opr_id = opr.opr_id
          into :opr_date_executed
        do
        begin
          select strdate from date2str(:opr_date_executed) into :date_str;
          executed_dates = executed_dates || :date_str || ', ';
        end

        suspend;
      end

    end

  end
end ^

ALTER PROCEDURE DCL_CURRENT_WORK_ADD_INFO (ORD_ID INTEGER)
RETURNS (SPI_SEND_DATES VARCHAR(1000) CHARACTER SET UNICODE_FSS,
COST_PRODUCES_DATES VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SHIP_NUMBERS_DATES VARCHAR(3000) CHARACTER SET UNICODE_FSS)
AS 
declare variable STR_DATE varchar(10);
declare variable SPI_SEND_DATE date;
declare variable CURRENT_SPI_SEND_DATE date;
declare variable SIP_ID integer;
declare variable PRC_DATE date;
declare variable CURRENT_PRC_DATE date;
declare variable LPC_ID integer;
declare variable SHP_DATE date;
declare variable SHP_NUMBER varchar(50);
declare variable SHP_NUM_DATE varchar(80);
declare variable CURRENT_SHP_NUM_DATE varchar(80);
begin
  spi_send_dates = '';
  cost_produces_dates = '';
  ship_numbers_dates = '';

  SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE into :current_spi_send_date;
  SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE into :current_prc_date;
  current_shp_num_date = '';

  for
    select spi_send_date,
           sip_id
    from dcl_get_spi_num_date_for_ord(:ord_id)
    order by spi_send_date
    into :spi_send_date,
         :sip_id
  do
  begin
    if ( spi_send_date != current_spi_send_date and spi_send_date is not null ) then
    begin
      select strdate from date2str(:spi_send_date) into :str_date;
      spi_send_dates = :spi_send_dates || :str_date || ', ';

      current_spi_send_date = spi_send_date;
    end

    for
      select
        prc_date,
        lpc_id
      from  dcl_produce_cost prc,
            dcl_prc_list_produce lpc
      where lpc.sip_id = :sip_id and
            prc.prc_id = lpc.prc_id
      into :prc_date,
           :lpc_id
    do
    begin
      if ( prc_date != current_prc_date and prc_date is not null ) then
      begin
        select strdate from date2str(:prc_date) into :str_date;
        cost_produces_dates = :cost_produces_dates || :str_date || '|';

        current_prc_date = prc_date;
      end

      for
        select distinct shp.shp_number, shp.shp_date
        from  dcl_shipping shp,
              dcl_shp_list_produce lps
        where lps.lpc_id = :lpc_id and
              shp.shp_id = lps.shp_id
        into :shp_number, :shp_date
      do
      begin
        select strdate from date2str(:shp_date) into :str_date;
        shp_num_date = :shp_number  || 'from' || :str_date || '|';
        if (shp_num_date != :current_shp_num_date) then
        begin
          ship_numbers_dates = :ship_numbers_dates || :shp_num_date;

          current_shp_num_date = shp_num_date;
        end
      end
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_CUSTOM_CODE_FILTER (CUS_CODE_IN VARCHAR(520) CHARACTER SET UNICODE_FSS)
RETURNS (CUS_ID INTEGER,
CUS_CODE VARCHAR(10) CHARACTER SET UNICODE_FSS,
CUS_DESCRIPTION VARCHAR(500) CHARACTER SET UNICODE_FSS,
CUS_PERCENT DECIMAL(15, 2),
CUS_BLOCK SMALLINT)
AS 
begin
  cus_code_in = upper(cus_code_in);

  for
    select cus_id,
           cus_code,
           cus_description,
           cus_percent,
           cus_block
    from dcl_custom_code cus
    where cus_instant =
          (
            select max(cus_instant)
            from dcl_custom_code
            where cus_code = cus.cus_code and cus_instant <= ADDDAY((SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE), 1)
          )
          and
          ( :cus_code_in is null or ( (upper(cus.cus_code) || ',' || upper(cus.cus_description)) like('%' || :cus_code_in || '%')) )
    into
      :cus_id,
      :cus_code,
      :cus_description,
      :cus_percent,
      :cus_block
  do
  begin
    suspend;
  end

end ^

ALTER PROCEDURE DCL_DECODE_ID_LIST (PAR_IDS VARCHAR(1024) CHARACTER SET UNICODE_FSS)
RETURNS (INT_ID INTEGER)
AS 
declare variable txt_id varchar(16);
declare variable int_pos integer;
declare variable int_len integer;
declare variable txt_symbol varchar(1);
BEGIN
  -- Initialization part
  INT_LEN = STRLEN(:PAR_IDS); -- get lengh of input string
  INT_POS = 1;
  TXT_ID = '';

  -- Go through every symbol of input string
  while (INT_POS != (INT_LEN + 1)) do
  begin
    -- Get current symbol (1 char)
    TXT_SYMBOL = SUBSTR(PAR_IDS, INT_POS, 1);

    -- Is it separator-symbol?
    if (TXT_SYMBOL != ';') then
    begin
      TXT_ID = TXT_ID || TXT_SYMBOL;
    end else
    begin
      INT_ID = cast(TXT_ID as integer);
      suspend;
      TXT_ID = '';
    end
    
    INT_POS = INT_POS + 1;
  end
  
  -- If last symbol of input string was not separator symbol,
  -- we need to suspend last value
  if (TXT_ID != '') then
  begin
    INT_ID = cast(TXT_ID as integer);
    suspend;
  end
END ^

ALTER PROCEDURE DCL_DELETE_CONTRACT_CLOSED (CTC_ID INTEGER)
AS 
begin
  if ( ctc_id is null ) then
  begin
    exit;
  end

  delete from dcl_contract_closed where ctc_id = :ctc_id;
end ^

ALTER PROCEDURE DCL_DELETE_DUPLICATE_CTN (OLD_STF_ID INTEGER,
NEW_STF_ID INTEGER)
AS 
declare variable prd_id integer;
declare variable ctn_id integer;
declare variable ctn_count integer;
begin
  FOR select prd_id, ctn_id from DCL_CATALOG_NUMBER where stf_id= :old_stf_id INTO :prd_id, :ctn_id
  DO
  begin
    select count(*) from dcl_catalog_number where stf_id = :new_stf_id and prd_id = :prd_id into :ctn_count;
    if (ctn_count > 0) then begin
                            delete from DCL_CATALOG_NUMBER where ctn_id = :ctn_id;
                          end

  end
end ^

ALTER PROCEDURE DCL_DELIVERY_REQUEST_FILTER (DLR_NUMBER_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
DLR_DATE_BEGIN_IN DATE,
DLR_DATE_END_IN DATE,
DLR_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
DLR_FAIR_TRADE_IN SMALLINT,
UNEXECUTED SMALLINT,
MINSK SMALLINT,
ANNUL_EXCLUDE SMALLINT,
SPECIFICATION_NUMBERS_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (DLR_ID INTEGER,
DLR_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
DLR_DATE DATE,
DLR_FAIR_TRADE SMALLINT,
DLR_PLACE_REQUEST SMALLINT,
DLR_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
DLR_ANNUL SMALLINT,
SPECIFICATION_NUMBERS VARCHAR(5000) CHARACTER SET UNICODE_FSS,
CUSTOMERS VARCHAR(2500) CHARACTER SET UNICODE_FSS,
CONTRACTS VARCHAR(2500) CHARACTER SET UNICODE_FSS,
ORDERS VARCHAR(2500) CHARACTER SET UNICODE_FSS,
DLR_MINSK SMALLINT,
USR_ID INTEGER,
DEP_ID INTEGER,
PRODUCE_COUNT INTEGER)
AS 
declare variable COUNT_REST_DRP decimal(15,2);
declare variable DLR_NEED_DELIVER smallint;
declare variable SPI_NUMBER varchar(100);
declare variable CTR_NAME varchar(200);
declare variable ORD_NUM_DATE varchar(40);
declare variable NEED_SUSPEND smallint;
declare variable DLR_EXECUTED smallint;
begin
  dlr_number_in = upper(dlr_number_in);
  dlr_user_in = upper(dlr_user_in);
  specification_numbers_in = upper(specification_numbers_in);

  for
    select dlr_id,
           dlr_number,
           dlr_date,
           dlr_fair_trade,
           dlr_need_deliver,
           dlr_place_request,
           usr_id_create,
           (select usr_surname || ' ' || usr_name from dcl_user_language  where usr_id = dlr.usr_id_create and lng_id = 1),
           dlr_annul,
           dlr_minsk,
           dlr_executed
           from dcl_delivery_request dlr
    where
          ( :dlr_fair_trade_in is null or :dlr_fair_trade_in = 0 or ( :dlr_fair_trade_in = 1 and dlr_fair_trade = :dlr_fair_trade_in ) )
     and  ( dlr_minsk = :minsk )
     and  ( :annul_exclude is null or ( :annul_exclude is not null and dlr_annul is null ) )
     and  ( :dlr_date_begin_in is null or dlr_date >=:dlr_date_begin_in )
     and  ( :dlr_date_end_in is null or dlr_date <=:dlr_date_end_in )
     and  ( :dlr_user_in is null or :dlr_user_in like '' or (select upper(usr.usr_surname || ' ' || usr.usr_name) from dcl_user_language usr where usr_id=dlr.usr_id_create and lng_id = 1) like('%' || :dlr_user_in || '%') )
     and  ( :dlr_number_in is null or :dlr_number_in like '' or upper(dlr.dlr_number) like('%' || :dlr_number_in || '%') )
    order by dlr_date descending, dlr_number descending
    into  :dlr_id,
          :dlr_number,
          :dlr_date,
          :dlr_fair_trade,
          :dlr_need_deliver,
          :dlr_place_request,
          :usr_id,
          :dlr_user,
          :dlr_annul,
          :dlr_minsk,
          :dlr_executed
  do
  begin
    dep_id = null;
    select dep_id from dcl_user where usr_id = :usr_id into :dep_id;

    select count(drp_id) from dcl_dlr_list_produce drp where dlr_id = :dlr_id into :produce_count;

    need_suspend = 1;

    specification_numbers = '';
    customers = '';
    contracts = '';
    orders = '';

    if (
         dlr_fair_trade is null or
         ( dlr_fair_trade is not null and dlr_minsk is not null )
       ) then
    begin
      for
        select distinct(spi.spi_number)
        from dcl_spi_list_produce sip,
             dcl_specification_import spi,
             dcl_dlr_list_produce drp
        where spi.spi_id = sip.spi_id and
              sip.drp_id = drp.drp_id and
              drp.dlr_id = :dlr_id
        into :spi_number
      do
      begin
        specification_numbers = specification_numbers || spi_number || '<br>';
      end

      need_suspend = 0;
      if ( specification_numbers_in is null or specification_numbers_in like '' or upper(specification_numbers) like('%' || :specification_numbers_in || '%') ) then
      begin
        need_suspend = 1;

        for
          select distinct(ctr_name)
          from dcl_get_customer_for_dlr(:dlr_id)
          into :ctr_name
        do
        begin
          customers = customers || ctr_name || '<br>';
        end

        for
          select distinct(con_num_and_other)
          from dcl_get_con_num_for_dlr(:dlr_id)
          into :ord_num_date
        do
        begin
          contracts = contracts || ord_num_date || '<br>';
        end

        for
          select distinct(ord_num_date)
          from dcl_get_ord_num_date_for_dlr(:dlr_id)
          into :ord_num_date
        do
        begin
          orders = orders || ord_num_date || '<br>';
        end
      end
    end
    else
    begin
      if ( specification_numbers_in is not null and specification_numbers_in != '' ) then
      begin
        need_suspend = 0;
      end
    end

    if ( unexecuted is null and need_suspend = 1 ) then
    begin
      suspend;
    end
    else
    begin
      if ( dlr_minsk = 0 ) then -- in doc
      begin
        select count_rest_drp from dcl_get_count_rest_drp(:dlr_id, :dlr_need_deliver) into :count_rest_drp;
        if ( count_rest_drp > 0 and need_suspend = 1  ) then
        begin
          suspend;
        end
      end

      if ( dlr_minsk = 1 and dlr_executed is null ) then -- out doc
      begin
        suspend;
      end
    end

  end --for 1

end ^

ALTER PROCEDURE DCL_DELIVERY_REQUEST_INSERT (DLR_DATE DATE,
DLR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
DLR_FAIR_TRADE SMALLINT,
DLR_WHEREFROM VARCHAR(100) CHARACTER SET UNICODE_FSS,
DLR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
DLR_PLACE_REQUEST SMALLINT,
DLR_MINSK SMALLINT,
DLR_NEED_DELIVER SMALLINT,
DLR_ORD_NOT_FORM SMALLINT,
DLR_GUARANTEE_REPAIR SMALLINT,
DLR_INCLUDE_IN_SPEC SMALLINT,
DLR_ANNUL SMALLINT,
DLR_EXECUTED SMALLINT)
RETURNS (DLR_ID INTEGER)
AS 
begin

  insert into dcl_delivery_request (
    dlr_number,
    dlr_date,
    dlr_fair_trade,
    dlr_wherefrom,
    dlr_comment,
    dlr_place_request,
    dlr_minsk,
    dlr_need_deliver,
    dlr_ord_not_form,
    dlr_guarantee_repair,
    dlr_include_in_spec,
    dlr_annul,
    dlr_executed
  )
  values (
    :dlr_number,
    :dlr_date,
    :dlr_fair_trade,
    :dlr_wherefrom,
    :dlr_comment,
    :dlr_place_request,
    :dlr_minsk,
    :dlr_need_deliver,
    :dlr_ord_not_form,
    :dlr_guarantee_repair,
    :dlr_include_in_spec,
    :dlr_annul,
    :dlr_executed
  )
  returning dlr_id into :dlr_id;

  suspend;
end ^

ALTER PROCEDURE DCL_DEPARTMENT_FILTER (DEP_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS)
AS 
begin
  dep_name_in = upper(dep_name_in);

  for
    select
      dep_id,
      dep_name
    from dcl_department dep
    where
     ( :dep_name_in is null or :dep_name_in like '' or upper(dep.dep_name) like('%' || :dep_name_in || '%') )
  into
    :dep_id,
    :dep_name
  do
  begin
    suspend;
  end

end ^

ALTER PROCEDURE DCL_DLR_COUNT_BY_PRD_ID_DLR_ID (PRD_ID INTEGER,
STF_ID INTEGER,
ORD_ID INTEGER,
DLR_ID INTEGER)
RETURNS (TRN_PRODUCE_COUNT DECIMAL(15, 2))
AS 
declare variable opr_id integer;
declare variable apr_id integer;
declare variable drp_count decimal(15,2);
declare variable ord_id_local integer;
begin
  trn_produce_count = 0;

  for
    select
      drp.opr_id,
      drp.apr_id,
      drp.drp_count
    from
      dcl_dlr_list_produce drp
    where
      drp.dlr_id = :dlr_id and
      drp.stf_id = :stf_id and
      drp.prd_id = :prd_id and
      ( :ord_id is not null or ( :ord_id is null and opr_id is null )) -- cut manual enter
    into :opr_id,
         :apr_id,
         :drp_count
  do
  begin
    if ( apr_id is not null ) then
    begin
      select
        opr.opr_id
      from
        dcl_ord_list_produce opr,
        dcl_assemble asm,
        dcl_asm_list_produce apr
      where opr.opr_id = asm.opr_id and
            asm.asm_id = apr.asm_id and
            apr.apr_id = :apr_id
      into
        :opr_id
      ;
    end

    if ( ord_id is not null and opr_id is not null ) then
    begin
      select ord_id from dcl_ord_list_produce where opr_id = :opr_id into :ord_id_local;
      if ( ord_id = ord_id_local ) then
      begin
        trn_produce_count = trn_produce_count + :drp_count;
      end
    end
    else if ( ord_id is null ) then
    begin
      trn_produce_count = trn_produce_count + :drp_count;
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_DLR_LIST_PRODUCES_LOAD (DLR_ID_IN INTEGER)
RETURNS (DRP_ID INTEGER,
DLR_ID INTEGER,
PRD_ID INTEGER,
DRP_PRICE DECIMAL(15, 2),
DRP_COUNT DECIMAL(15, 2),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
OPR_ID INTEGER,
ASM_ID INTEGER,
APR_ID INTEGER,
SIP_ID INTEGER,
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
DRP_PURPOSE VARCHAR(500) CHARACTER SET UNICODE_FSS,
DRP_OCCUPIED INTEGER,
RECEIVE_MANAGER_ID INTEGER,
RECEIVE_MANAGER_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
RECEIVE_MANAGER_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
RECEIVE_DATE DATE,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
SPI_NUMBERS VARCHAR(500) CHARACTER SET UNICODE_FSS,
DRP_HAVE_DEPEND SMALLINT,
ORD_INFO VARCHAR(500) CHARACTER SET UNICODE_FSS,
ORD_INFO_CONTRACTOR_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_ID INTEGER,
DRP_MAX_EXTRA SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
begin
  dlr_id = dlr_id_in;

  for
    select
      drp_id
    from
      dcl_dlr_list_produce drp
    where drp.dlr_id = :dlr_id_in
    order by drp_id
    into
      :drp_id
  do
  begin
    select
      dlr_id,
      prd_id,
      drp_price,
      drp_count,
      stf_id,
      stf_name,
      ctr_id,
      ctr_name,
      spc_id,
      spc_number,
      spc_date,
      con_id, 
      con_number,
      con_date,
      opr_id,
      asm_id,
      apr_id,
      sip_id,
      prs_id,
      prs_name,
      drp_purpose,
      drp_occupied,
      receive_manager_id,
      receive_manager_name,
      receive_manager_surname,
      receive_date,
      ord_id,
      ord_number,
      ord_date,
      spi_number,
      spi_date,
      spi_numbers,
      drp_have_depend,
      ord_info,
      ord_info_contractor_for,
      drp_max_extra
    from
      dcl_dlr_list_produce_load(:drp_id)
    into
      :dlr_id,
      :prd_id,
      :drp_price,
      :drp_count,
      :stf_id,
      :stf_name,
      :ctr_id,
      :ctr_name,
      :spc_id,
      :spc_number,
      :spc_date,
      :con_id,
      :con_number,
      :con_date,
      :opr_id,
      :asm_id,
      :apr_id,
      :sip_id,
      :prs_id,
      :prs_name,
      :drp_purpose,
      :drp_occupied,
      :receive_manager_id,
      :receive_manager_name,
      :receive_manager_surname,
      :receive_date,
      :ord_id,
      :ord_number,
      :ord_date,
      :spi_number,
      :spi_date,
      :spi_numbers,
      :drp_have_depend,
      :ord_info,
      :ord_info_contractor_for,
      :drp_max_extra
    ;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_DLR_LIST_PRODUCE_LOAD (DRP_ID_IN INTEGER)
RETURNS (DRP_ID INTEGER,
DLR_ID INTEGER,
PRD_ID INTEGER,
DRP_PRICE DECIMAL(15, 2),
DRP_COUNT DECIMAL(15, 2),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
OPR_ID INTEGER,
ASM_ID INTEGER,
APR_ID INTEGER,
SIP_ID INTEGER,
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
DRP_PURPOSE VARCHAR(500) CHARACTER SET UNICODE_FSS,
DRP_OCCUPIED INTEGER,
RECEIVE_MANAGER_ID INTEGER,
RECEIVE_MANAGER_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
RECEIVE_MANAGER_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
RECEIVE_DATE DATE,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
SPI_NUMBERS VARCHAR(500) CHARACTER SET UNICODE_FSS,
DLR_ORD_NOT_FORM SMALLINT,
DRP_HAVE_DEPEND SMALLINT,
ORD_INFO VARCHAR(500) CHARACTER SET UNICODE_FSS,
ORD_INFO_CONTRACTOR_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_ID INTEGER,
DRP_MAX_EXTRA SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
declare variable SPI_NUMBER_LOCAL varchar(100);
begin
  drp_id = null;
  dlr_id = null;
  prd_id = null;
  drp_price = null;
  drp_count = null;
  stf_id = null;
  stf_name = null;
  ctr_id = null;
  ctr_name = null;
  spc_id = null;
  spc_number = null;
  spc_date = null;
  con_id = null;
  con_number = null;
  con_date = null;
  cur_name = null;
  opr_id = null;
  asm_id = null;
  apr_id = null;
  sip_id = null;
  prs_id = null;
  prs_name = null;
  drp_purpose = null;
  drp_occupied = null;
  receive_manager_id = null;
  receive_date = null;
  ord_number = null;
  ord_date = null;
  ord_id = null;
  spi_number = null;
  spi_date = null;
  receive_manager_name = null;
  receive_manager_surname = null;
  dlr_ord_not_form = null;
  drp_have_depend = null;
  ord_info = null;
  ord_info_contractor_for = null;
  drp_max_extra = null;

  select
      drp.drp_id,
      drp.dlr_id,
      drp.prd_id,
      drp.drp_price,
      drp.drp_count,
      drp.stf_id,
      stf.stf_name,
      drp.ctr_id,
      drp.spc_id,
      drp.opr_id,
      drp.asm_id,
      drp.apr_id,
      drp.sip_id,
      drp.prs_id,
      drp.drp_purpose,
      (select drp_id from DCL_OCCUPIED_DLR_PRODUCE_V where drp_id = drp.drp_id) as drp_occupied,
      drp.receive_manager_id,
      drp.receive_date,
      dlr.dlr_ord_not_form,
      drp.drp_max_extra
  from
      dcl_dlr_list_produce drp,
      dcl_stuff_category stf,
      dcl_delivery_request dlr
  where drp.drp_id = :drp_id_in and
        stf.stf_id = drp.stf_id and
        dlr.dlr_id = drp.dlr_id
  into
      :drp_id,
      :dlr_id,
      :prd_id,
      :drp_price,
      :drp_count,
      :stf_id,
      :stf_name,
      :ctr_id,
      :spc_id,
      :opr_id,
      :asm_id,
      :apr_id,
      :sip_id,
      :prs_id,
      :drp_purpose,
      :drp_occupied,
      :receive_manager_id,
      :receive_date,
      :dlr_ord_not_form,
      :drp_max_extra
    ;

    if ( ctr_id is not null ) then
    begin
      select ctr_name from dcl_contractor where ctr_id = :ctr_id into :ctr_name;
    end

    if (spc_id is not null) then
    begin
      select
        spc.spc_number,
        spc.spc_date,
        con.con_id,
        con.con_number,
        con.con_date,
        cur.cur_name
      from
        dcl_con_list_spec spc,
        dcl_contract con,
        dcl_currency cur
      where spc.spc_id = :spc_id and
            con.con_id = spc.con_id and
            cur.cur_id = con.cur_id
      into 
        :spc_number,
        :spc_date,
        :con_id,
        :con_number,
        :con_date,
        :cur_name
      ;
    end

    if ( prs_id is not null ) then
    begin
      select prs_name from dcl_purpose where prs_id = :prs_id into :prs_name;
    end

    if ( opr_id is not null ) then
    begin
      select
        ord.ord_id,
        ord.ord_number,
        ord.ord_date
      from dcl_order ord,
           dcl_ord_list_produce opr
      where ord.ord_id = opr.ord_id and
            opr.opr_id = :opr_id
      into
        :ord_id,
        :ord_number,
        :ord_date
      ;

      select
        opr_have_depend
      from dcl_ord_list_produce_load(:opr_id)
      into
        :drp_have_depend
      ;
    end

    if ( asm_id is not null ) then
    begin
      drp_have_depend = 1;

      select ord_info,
             ord_info_contractor_for,
             ord_number,
             ord_date
      from dcl_assemble_load(:asm_id)
      into   :ord_info,
             :ord_info_contractor_for,
             :ord_number,
             :ord_date
      ;
    end

    if ( apr_id is not null ) then
    begin
      select
        ord.ord_id,
        ord.ord_number,
        ord.ord_date
      from
        dcl_order ord,
        dcl_ord_list_produce opr,
        dcl_assemble asm,
        dcl_asm_list_produce apr
      where ord.ord_id = opr.ord_id and
            opr.opr_id = asm.opr_id and
            asm.asm_id = apr.asm_id and
            apr.apr_id = :apr_id
      into
        :ord_id,
        :ord_number,
        :ord_date
      ;
    end

    if ( sip_id is not null ) then
    begin
      select
        spi_number,
        spi_date
      from dcl_specification_import spi,
           dcl_spi_list_produce sip
      where spi.spi_id = sip.spi_id and
            sip.sip_id = :sip_id
      into
        :spi_number,
        :spi_date
      ;

      select ord_id from dcl_spi_list_produce_load(:sip_id) into :ord_id;
    end

    if ( receive_manager_id is not null ) then
    begin
      select
        (select usr_name from dcl_user_language where usr_id = u.usr_id and lng_id = 1) as usr_name,
        (select usr_surname from dcl_user_language where usr_id = u.usr_id and lng_id = 1) as usr_surname
      from dcl_user u
      where usr_id = :receive_manager_id
      into
        :receive_manager_name, 
        :receive_manager_surname
      ;
    end

    spi_numbers = '';
    for
      select distinct(spi.spi_number)
      from dcl_spi_list_produce sip,
           dcl_specification_import spi
      where spi.spi_id = sip.spi_id and
            sip.drp_id = :drp_id_in
      into :spi_number_local
    do
    begin
      spi_numbers = spi_numbers || spi_number_local || ', ';
    end

    suspend;
end ^

ALTER PROCEDURE DCL_DRP_DEPENDED_LINES (ASM_ID INTEGER)
RETURNS (ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
PRD_COUNT DECIMAL(15, 2))
AS 
begin
  if ( asm_id is not null ) then
  begin
    for
      select
        -1,
        apr.prd_id as "produce.id",
        asm.stf_id,
        apr.apr_count
      from dcl_assemble asm,
           dcl_asm_list_produce apr
      where asm.asm_id = :asm_id and
            apr.asm_id = asm.asm_id
      into
        :id,
        :prd_id,
        :stf_id,
        :prd_count
    do
    begin
      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_EQUIPMENT_FILTER (CON_ID_IN INTEGER,
CRQ_EQUIPMENT_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
REQ_ID INTEGER)
RETURNS (LPS_ID INTEGER,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPS_USR_ID INTEGER,
LPS_USR_FULLNAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPS_ENTER_IN_USE_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS,
LPS_OCCUPIED INTEGER,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
SHP_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
CON_SELLER_ID INTEGER,
CON_SELLER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare variable FILTERSTR varchar(3000);
declare variable LPS_ENTER_IN_USE_DATE_LOCAL date;
declare variable MAD_ID integer;
begin
  crq_equipment_in = upper(crq_equipment_in);

  for
    select lps.lps_id,
           lps.lps_serial_num,
           lps.lps_year_out,
           lps.lps_enter_in_use_date,
           (select stf_name from dcl_stuff_category stf where stf.stf_id = lps.stf_id),
           ctn.ctn_number,
           prd.prd_name || coalesce(' ' || prd.prd_type, '') || coalesce(' ' || prd.prd_params, '') || coalesce(' ' || prd.prd_add_params, ''),
           ctn.mad_id
    from dcl_con_list_spec spc,
         dcl_shipping shp,
         dcl_shp_list_produce lps,
         dcl_prc_list_produce lpc,
         dcl_produce prd,
         dcl_catalog_number ctn
    where spc.con_id = :con_id_in and
          shp.spc_id = spc.spc_id and
          lps.shp_id = shp.shp_id and
          lpc.lpc_id = lps.lpc_id and
          prd.prd_id = lpc.prd_id and
          ctn.prd_id = lpc.prd_id and
          ctn.stf_id = lps.stf_id and
          exists ( select ctn_id from dcl_catalog_number where prd_id = prd.prd_id and mad_id is not null )
    into  :lps_id,
          :lps_serial_num,
          :lps_year_out,
          :lps_enter_in_use_date_local,
          :stf_name,
          :ctn_number,
          :crq_equipment,
          :mad_id
  do
  begin
    lps_occupied = null;
    if ( req_id = 1 ) then -- only for PNP
    begin
      select distinct lps_id from dcl_contractor_request where lps_id = :lps_id and crq_request_type_id = 1 into :lps_occupied;
      if ( lps_occupied is not null ) then
      begin
        select first 1 crq_number from dcl_contractor_request where lps_id = :lps_id and crq_request_type_id = 1 into :crq_number;
      end
    end

    lps_enter_in_use_date = null;
    if ( lps_enter_in_use_date_local is not null ) then
    begin
      select strdate from date2str(:lps_enter_in_use_date_local) into :lps_enter_in_use_date;
    end

    if ( mad_id is not null ) then
    begin
      select mad_complexity from dcl_montage_adjustment where mad_id = :mad_id into :mad_complexity;
    end

    select first 1 usr_id
    from dcl_lps_list_manager
    where lps_id = :lps_id
    into :lps_usr_id;

    lps_usr_fullname = null;
    if ( lps_usr_id is not null ) then
    begin
      select usr_surname || ' ' || usr_name
      from dcl_user_language
      where usr_id = :lps_usr_id and lng_id = 1
      into :lps_usr_fullname;
    end

    -- not PNP - Service or Guarantee
    shp_date = null;
    con_number = null;
    con_date = null;
    spc_number = null;
    spc_date = null;
    con_seller_id = null;
    con_seller = null;
    if ( req_id != 1 ) then
    begin
      select
        shp_date,
        con_number,
        con_date,
        spc_number,
        spc_date,
        con_seller_id,
        con_seller
      from dcl_add_info_service_guarantee(:lps_id)
      into
        :shp_date,
        :con_number,
        :con_date,
        :spc_number,
        :spc_date,
        :con_seller_id,
        :con_seller
      ;
    end

    if ( crq_equipment_in is null or crq_equipment_in like '' ) then
    begin
      suspend;
    end
    else
    begin
      filterstr = crq_equipment || coalesce(' ' || ctn_number, '') || coalesce(' ' || stf_name, '') || coalesce(' ' || lps_serial_num, '');
      filterstr = upper(filterstr);
      if ( filterstr like '%' || crq_equipment_in || '%' ) then
      begin
        suspend;
      end
    end

  end
end ^

ALTER PROCEDURE DCL_EQUIPMENT_FOR_PRODUCE_LOAD (STF_ID INTEGER,
PRD_ID INTEGER)
RETURNS (CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
begin
     select ctn.ctn_number,
            prd.prd_name || coalesce(' ' || prd.prd_type, '') || coalesce(' ' || prd.prd_params, '') || coalesce(' ' || prd.prd_add_params, ''),
            mad.mad_complexity
    from dcl_produce prd,
         dcl_catalog_number ctn
         left join dcl_montage_adjustment mad on mad.mad_id = ctn.mad_id
    where prd.prd_id = :prd_id and
          ctn.prd_id = prd.prd_id and
          ctn.stf_id = :stf_id
    into  :ctn_number,
          :crq_equipment,
          :mad_complexity;

   suspend;
end ^

ALTER PROCEDURE DCL_EQUIPMENT_GUARANTY_LOAD (LPS_ID INTEGER,
PRD_ID INTEGER)
RETURNS (CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
begin
     select lps.lps_serial_num,
            lps.lps_year_out,
            (select stf_name from dcl_stuff_category stf where stf.stf_id = lps.stf_id),
            ctn.ctn_number,
            prd.prd_name || coalesce(' ' || prd.prd_type, '') || coalesce(' ' || prd.prd_params, '') || coalesce(' ' || prd.prd_add_params, ''),
            mad.mad_complexity
    from dcl_shp_list_produce lps,
         dcl_produce prd,
         dcl_catalog_number ctn
         left join dcl_montage_adjustment mad on mad.mad_id = ctn.mad_id
    where lps.lps_id = :lps_id and
          prd.prd_id = :prd_id and
          ctn.prd_id = prd.prd_id and
          ctn.stf_id = lps.stf_id
    into  :lps_serial_num,
          :lps_year_out,
          :stf_name,
          :ctn_number,
          :crq_equipment,
          :mad_complexity;

   suspend;
end ^

ALTER PROCEDURE DCL_EQUIPMENT_PNP_LOAD (LPS_ID INTEGER)
RETURNS (CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPS_ENTER_IN_USE_DATE VARCHAR(20) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
declare variable mad_id integer;
declare variable lps_enter_in_use_date_local date;
begin
   mad_complexity = null;

   select lps.lps_serial_num,
          lps.lps_year_out,
          lps.lps_enter_in_use_date,
          (select stf_name from dcl_stuff_category stf where stf.stf_id = lps.stf_id),
          ctn.ctn_number,
          prd.prd_name || coalesce(' ' || prd.prd_type, '') || coalesce(' ' || prd.prd_params, '') || coalesce(' ' || prd.prd_add_params, ''),
          ctn.mad_id
   from dcl_shp_list_produce lps,
        dcl_prc_list_produce lpc,
        dcl_produce prd,
        dcl_catalog_number ctn
   where lps.lps_id = :lps_id and
         lpc.lpc_id = lps.lpc_id and
         prd.prd_id = lpc.prd_id and
         ctn.prd_id = lpc.prd_id and
         ctn.stf_id = lps.stf_id
   into  :lps_serial_num,
         :lps_year_out,
         :lps_enter_in_use_date_local,
         :stf_name,
         :ctn_number,
         :crq_equipment,
         :mad_id;

   lps_enter_in_use_date = null;
   if ( lps_enter_in_use_date_local is not null ) then
   begin
     select strdate from date2str(:lps_enter_in_use_date_local) into :lps_enter_in_use_date;
   end

   if ( mad_id is not null ) then
   begin
     select mad_complexity from dcl_montage_adjustment where mad_id = :mad_id into :mad_complexity;
   end

   suspend;
end ^

ALTER PROCEDURE DCL_GET_1C_BY_PRC_ID_PRD_ID (PRD_ID INTEGER,
STF_ID INTEGER,
PRC_ID INTEGER)
RETURNS (LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS)
AS 
begin

  for
    select
      distinct lpc_1c_number
    from
      dcl_prc_list_produce
    where
      prc_id = :prc_id and
      prd_id = :prd_id and
      stf_id = :stf_id
    order by lpc_1c_number
    into :lpc_1c_number
  do
  begin
    suspend;
  end

end ^

ALTER PROCEDURE DCL_GET_ASM_LIST_FOR_ORD (ORD_ID INTEGER)
RETURNS (ASSEMBLIES VARCHAR(2500) CHARACTER SET UNICODE_FSS)
AS 
declare variable ASM_NUM_DATE varchar(40);
begin
  assemblies = '';

  for
    select distinct(asm_num_date)
    from dcl_get_asm_num_date_for_ord(:ord_id)
    into :asm_num_date
  do
  begin
    assemblies = assemblies || asm_num_date || ', ';
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_ASM_NUM_DATE_FOR_ORD (ORD_ID INTEGER)
RETURNS (ASM_NUM_DATE VARCHAR(40) CHARACTER SET UNICODE_FSS)
AS 
declare variable ASM_DATE date;
declare variable ASM_NUMBER varchar(10);
declare variable OPR_ID integer;
begin
  for 
    select opr_id
    from dcl_ord_list_produce
    where ord_id = :ord_id
    into :opr_id
  do
  begin
    for
      select
        asm_date,
        asm_number
      from
        dcl_assemble asm,
        dcl_asm_list_produce apr
      where   apr.asm_id = asm.asm_id and
              apr.opr_id = :opr_id

      union

      select
        asm_date,
        asm_number
      from
        dcl_assemble asm
      where   asm.opr_id = :opr_id

      into
        :asm_date,
        :asm_number
    do
    begin
      asm_num_date = '';
      select strdate from date2str(:asm_date) into :asm_num_date;
      asm_num_date = asm_number || 'from' || :asm_num_date;

      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_ATT_COUNT_FOR_SPC (SPC_ID INTEGER)
RETURNS (ATTACHMENTSCOUNT INTEGER)
AS 
begin
  attachmentsCount = 0;

  select count(*)
  from dcl_attachment
  where att_parent_table='DCL_CON_LIST_SPEC' and
        att_parent_id = :spc_id
  into :attachmentsCount;

  suspend;
end ^

ALTER PROCEDURE DCL_GET_BLANK_IMAGES_IN_STR (BLN_ID INTEGER)
RETURNS (BLN_IMAGES VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
declare variable bim_name varchar(50);
declare variable bim_image varchar(32);
begin
  bln_images = '';
  for
    select bim_name,
           bim_image
    from dcl_blank_image
    where bln_id = :bln_id
    order by bim_id
    into   :bim_name,
           :bim_image
  do
  begin
    bln_images = bln_images || bim_name || ': ' || bim_image || '<br>';
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_CATEGORIES_FOR_TREE (CAT_ID_IN INTEGER,
CAT_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_NAME_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CUS_CODE_IN VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
NOT_BLOCKED SMALLINT,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (CAT_ID INTEGER,
IS_HAVE_PRODUCES SMALLINT,
IS_HAVE_SUBFOLDERS SMALLINT,
PRD_COUNT INTEGER)
AS 
declare variable cat_count integer;
declare variable cat_name varchar(100);
begin
  cat_name_in = upper(cat_name_in);

  prd_name_in = upper(prd_name_in);
  prd_type_in = upper(prd_type_in);
  prd_params_in = upper(prd_params_in);
  prd_add_params_in = upper(prd_add_params_in);
  cus_code_in = upper(cus_code_in);
  ctn_number_in = upper(ctn_number_in);
  prd_common_in = upper(prd_common_in);

  for
    select
      cat_id,
      cat_name
    from
      dcl_category cat
    where
      ( cat_id = :cat_id_in )
    order by cat_name
    into :cat_id, :cat_name
  do
  begin
      select count(cat_id) from dcl_category where (parent_id = :cat_id) into :cat_count;
      if ( cat_count = 0 or cat_count is null ) then
      begin
        is_have_subfolders = null;
      end
      else
      begin
        is_have_subfolders = 1;
      end

      prd_count = null;
      select
        count(prd_id)
      from
        dcl_produce prd
      where
        prd.cat_id = :cat_id and
        ( :not_blocked is null or ( :not_blocked is not null and prd_block is null ) ) and
        ( :stf_id_in is null or ( (select count(ctn_id) from dcl_catalog_number ctn where ctn.prd_id = prd.prd_id and ctn.stf_id = :stf_id_in ) = 1 ) ) and
        ( :prd_name_in is null or :prd_name_in like '' or upper(prd.prd_name) like('%' || :prd_name_in || '%') ) and
        ( :prd_type_in is null or :prd_type_in like '' or upper(prd.prd_type) like('%' || :prd_type_in || '%') ) and
        ( :prd_params_in is null or :prd_params_in like '' or upper(prd.prd_params) like('%' || :prd_params_in || '%') ) and
        ( :prd_add_params_in is null or :prd_add_params_in like '' or upper(prd.prd_add_params) like('%' || :prd_add_params_in || '%') ) and
        ( :cus_code_in is null or :cus_code_in like '' or upper(prd.cus_code) like('%' || :cus_code_in || '%') ) and
        ( :ctn_number_in is null or :ctn_number_in like '' or ( (select count(ctn_id) from dcl_catalog_number ctn where ctn.prd_id = prd.prd_id and upper(ctn.ctn_number) like('%' || :ctn_number_in || '%') ) >= 1 ) )
      into :prd_count;

      if ( :prd_common_in is not null and prd_count != 0 ) then
      begin
        select count(prd_id) from dcl_get_produces_for_cat(:cat_id, :prd_name_in, :prd_type_in, :prd_params_in, :prd_add_params_in, :stf_id_in, :cus_code_in, :ctn_number_in, :not_blocked, :prd_common_in) into :prd_count;
      end

      if ( prd_count = 0 ) then
      begin
        if ( is_have_subfolders = 1 ) then
        begin
         select sum(is_have_produces) from dcl_get_child_categories(:cat_id, null, :prd_name_in, :prd_type_in, :prd_params_in, :prd_add_params_in, :stf_id_in, :cus_code_in, :ctn_number_in, :not_blocked, :prd_common_in) into :is_have_produces;
        end
        else
        begin
          is_have_produces = null;
        end
        suspend;
      end
      else
      begin
        is_have_produces = 1;
        suspend;
      end
  end
end ^

ALTER PROCEDURE DCL_GET_CHILD_CATEGORIES (CAT_ID_IN INTEGER,
CAT_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_NAME_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CUS_CODE_IN VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
NOT_BLOCKED SMALLINT,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (CAT_ID INTEGER,
IS_HAVE_PRODUCES SMALLINT,
IS_HAVE_SUBFOLDERS SMALLINT,
PRD_COUNT INTEGER)
AS 
declare variable cat_count integer;
declare variable cat_name varchar(100);
begin
  cat_name_in = upper(cat_name_in);

  prd_name_in = upper(prd_name_in);
  prd_type_in = upper(prd_type_in);
  prd_params_in = upper(prd_params_in);
  prd_add_params_in = upper(prd_add_params_in);
  cus_code_in = upper(cus_code_in);
  ctn_number_in = upper(ctn_number_in);
  prd_common_in = upper(prd_common_in);

  for
    select
      cat_id,
      cat_name
    from
      dcl_category cat
    where
      ( (:cat_id_in is null and parent_id is null ) or parent_id = :cat_id_in )
    into :cat_id, :cat_name
  do
  begin
      select count(cat_id) from dcl_category where (parent_id = :cat_id) into :cat_count;
      if ( cat_count = 0 or cat_count is null ) then
      begin
        is_have_subfolders = null;
      end
      else
      begin
        is_have_subfolders = 1;
      end

      prd_count = null;
      select
        count(prd_id)
      from
        dcl_produce prd
      where
        prd.cat_id = :cat_id and
        ( :not_blocked is null or ( :not_blocked is not null and prd_block is null ) ) and
        ( :stf_id_in is null or ( (select count(ctn_id) from dcl_catalog_number ctn where ctn.prd_id = prd.prd_id and ctn.stf_id = :stf_id_in ) = 1 ) ) and
        ( :prd_name_in is null or :prd_name_in like '' or upper(prd.prd_name) like('%' || :prd_name_in || '%') ) and
        ( :prd_type_in is null or :prd_type_in like '' or upper(prd.prd_type) like('%' || :prd_type_in || '%') ) and
        ( :prd_params_in is null or :prd_params_in like '' or upper(prd.prd_params) like('%' || :prd_params_in || '%') ) and
        ( :prd_add_params_in is null or :prd_add_params_in like '' or upper(prd.prd_add_params) like('%' || :prd_add_params_in || '%') ) and
        ( :cus_code_in is null or :cus_code_in like '' or upper(prd.cus_code) like('%' || :cus_code_in || '%') ) and
        ( :ctn_number_in is null or :ctn_number_in like '' or ( (select count(ctn_id) from dcl_catalog_number ctn where ctn.prd_id = prd.prd_id and upper(ctn.ctn_number) like('%' || :ctn_number_in || '%') ) >= 1 ) )
      into :prd_count;

      if ( :prd_common_in is not null and prd_count != 0 ) then
      begin
        select count(prd_id) from dcl_get_produces_for_cat(:cat_id, :prd_name_in, :prd_type_in, :prd_params_in, :prd_add_params_in, :stf_id_in, :cus_code_in, :ctn_number_in, :not_blocked, :prd_common_in) into :prd_count;
      end

      if ( prd_count = 0 ) then
      begin
        if ( is_have_subfolders = 1 ) then
        begin
         select sum(is_have_produces) from dcl_get_child_categories(:cat_id, null, :prd_name_in, :prd_type_in, :prd_params_in, :prd_add_params_in, :stf_id_in, :cus_code_in, :ctn_number_in, :not_blocked, :prd_common_in) into :is_have_produces;
        end
        else
        begin
          is_have_produces = null;
        end
        suspend;
      end
      else
      begin
        is_have_produces = 1;
        suspend;
      end
  end
end ^

ALTER PROCEDURE DCL_GET_CIRC_AND_REST_FOR_PRD (PRD_ID INTEGER)
RETURNS (PRD_CIRCULATION180DAYS DECIMAL(15, 2),
REST_IN_MINSK DECIMAL(15, 2))
AS 
declare variable PRD_COUNT decimal(15,2);
declare variable PRD_COUNT_SHIPPED decimal(15,2);
begin
  prd_circulation180days = 0;
  rest_in_minsk = 0;

  select sum(lps.lps_count)
  from
    dcl_shipping shp,
    dcl_shp_list_produce lps,
    dcl_prc_list_produce lpc
  where lpc.prd_id = :prd_id and
        lps.lpc_id = lpc.lpc_id and
        lps.shp_id = shp.shp_id and
        shp.shp_date <= (SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE) and
        shp.shp_date >= ADDDAY((SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE), -180)
  into :prd_circulation180days;

  select sum(lpc_count) from dcl_prc_list_produce where prd_id = :prd_id into :prd_count;
  select sum(lps_count)
  from dcl_shp_list_produce lps,
       dcl_prc_list_produce lpc
  where lps.lpc_id = lpc.lpc_id and
        lpc.prd_id = :prd_id
  into :prd_count_shipped;

  if( prd_count_shipped is not null ) then rest_in_minsk = prd_count - prd_count_shipped;
  else rest_in_minsk = prd_count;

  suspend;
end ^

ALTER PROCEDURE DCL_GET_CONTRACTORS_FOR_FOR_ORD (ORD_ID INTEGER)
RETURNS (CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
declare variable ord_in_one_spec smallint;
begin
  select ord_in_one_spec from dcl_order where ord_id = :ord_id into :ord_in_one_spec;

  if ( ord_in_one_spec is not null ) then
  begin
    select ctr_name
    from
      dcl_contractor ctr,
      dcl_order ord
    where ctr.ctr_id = ord.ctr_id_for and
          ord.ord_id = :ord_id
    into :ctr_name;

    suspend;
  end
  else
  begin
    for
      select distinct ctr.ctr_name
      from dcl_contractor ctr,
           dcl_ord_list_produce opr
      where  ctr.ctr_id = opr.ctr_id and
             opr.ord_id = :ord_id
      into :ctr_name
    do
    begin
      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_CONTRACTOR_FOR_FOR_ORD (ORD_ID INTEGER,
DELIMITER VARCHAR(5) CHARACTER SET UNICODE_FSS)
RETURNS (CONTRACTORS VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
declare variable contractor varchar(200);
begin
  contractors = '';
  for
    select distinct ctr_name
    from dcl_get_contractors_for_for_ord(:ord_id)
    into :contractor
  do
  begin
    contractors = :contractors || :contractor || delimiter;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_CON_NUM_FOR_DLR (DLR_ID INTEGER)
RETURNS (CON_NUM_AND_OTHER VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
declare variable CON_NUMBER varchar(50);
declare variable CON_DATE date;
declare variable SPC_NUMBER varchar(50);
declare variable SPC_DATE date;
declare variable SPC_DATE_STR varchar(20);
declare variable ASM_ID integer;
declare variable SPC_ID integer;
begin
  for
    select asm_id,
           spc_id
    from dcl_dlr_list_produce drp
    where drp.dlr_id = :dlr_id
    into   :asm_id,
           :spc_id
  do
  begin
    if ( asm_id is not null ) then
    begin
      for
        select
          con_number,
          con_date,
          spc_number,
          spc_date
        from dcl_get_ord_info_for_asm(:asm_id) prc,
             dcl_order ord,
             dcl_con_list_spec spc,
             dcl_contract con
        where ord.ord_id = prc.ord_id and
              spc.spc_id = ord.spc_id and
              con.con_id = spc.con_id
        into
          :con_number,
          :con_date,
          :spc_number,
          :spc_date
      do
      begin
        con_num_and_other = '';
        select strdate from date2str(:con_date) into :con_num_and_other;
        select strdate from date2str(:spc_date) into :spc_date_str;
        con_num_and_other = con_number || 'from' || :con_num_and_other || ', ' || spc_number || 'from' || spc_date_str;

        suspend;
      end
    end
    else
    begin
      if ( spc_id is not null ) then
      begin
        select
          spc.spc_number,
          spc.spc_date,
          con.con_number,
          con.con_date
        from
          dcl_con_list_spec spc,
          dcl_contract con
        where spc.spc_id = :spc_id and
              con.con_id = spc.con_id
        into
          :spc_number,
          :spc_date,
          :con_number,
          :con_date
        ;

        con_num_and_other = '';
        select strdate from date2str(:con_date) into :con_num_and_other;
        select strdate from date2str(:spc_date) into :spc_date_str;
        con_num_and_other = con_number || 'from' || :con_num_and_other || ', ' || spc_number || 'from' || spc_date_str;
      end

      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_COUNT_DAY (DATE1 DATE,
DATE2 DATE)
RETURNS (COUNT_DAY INTEGER)
AS 
begin
  COUNT_DAY = NULL;

  if ( DATE1 is NULL or DATE2 is NULL ) then
  begin
    COUNT_DAY = NULL;
  end
  else
  begin
    COUNT_DAY = DATE1 - DATE2;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_COUNT_OPR_USED_IN_ASM (OPR_ID INTEGER)
RETURNS (OUT_COUNT DECIMAL(15, 2))
AS 
declare variable ASM decimal(15,2);
declare variable DISASM decimal(15,2);
begin
    out_count = 0;

    select coalesce(sum(apr.apr_count * asm.asm_count), 0)
    from dcl_assemble asm,
         dcl_asm_list_produce apr
    where asm.asm_type = 0 -- ????????????????
          and asm.asm_id = apr.asm_id
          and apr.opr_id = :opr_id
    into :asm;

    -- ???????? ???????????????? ?????????????? ???? ????????????, ???? ???????????? ??????????????, ?????????????? ???????? ???? ???????????? ??????????????.
    if (asm > 0) then
    begin
      out_count = out_count + asm;
    end


    select coalesce(sum(asm.asm_count), 0)
    from dcl_assemble asm
    where asm.asm_type = 1 -- ??????????????????
          and asm.opr_id = :opr_id
    into :disasm;

    -- ???????? ??????????????????, ???? ??????????????, ?????? ?????? ?????????????? ??????????????????. ???????? ??????.
    if (disasm > 0) then
    begin
      out_count = out_count + disasm;
    end

    suspend;
end ^

ALTER PROCEDURE DCL_GET_COUNT_REST_DRP (DLR_ID INTEGER,
DLR_NEED_DELIVER SMALLINT)
RETURNS (COUNT_REST_DRP DECIMAL(15, 2))
AS 
DECLARE VARIABLE COUNT_LPC DECIMAL(15,2);
DECLARE VARIABLE COUNT_SIP DECIMAL(15,2);
DECLARE VARIABLE COUNT_EMPTY_MANAGER INTEGER;
DECLARE VARIABLE COUNT_EMPTY_DATE INTEGER;
DECLARE VARIABLE COUNT_DRP INTEGER;
begin
  count_drp = 0;
  select count(drp_id)
  from dcl_dlr_list_produce drp
  where drp.dlr_id = :dlr_id
  into :count_drp;

  if ( count_drp = 0 ) then
  begin
    count_rest_drp = 1;
    suspend;
  end
  else
  begin
    count_rest_drp = 0;
    if ( dlr_need_deliver is null ) then
    begin
      count_lpc = 0;
      count_sip = 0;

      select coalesce(sum(drp_count), 0)
      from dcl_dlr_list_produce drp
      where drp.dlr_id = :dlr_id
      into :count_rest_drp;

      select coalesce(sum(lpc_count), 0)
      from dcl_dlr_list_produce drp,
           dcl_prc_list_produce lpc
      where drp.dlr_id = :dlr_id and
            lpc.drp_id = drp.drp_id
      into :count_lpc;

      select coalesce(sum(sip_count), 0)
      from dcl_dlr_list_produce drp,
           dcl_spi_list_produce sip
      where drp.dlr_id = :dlr_id and
            sip.drp_id = drp.drp_id
      into :count_sip;

      count_rest_drp = count_rest_drp - count_lpc - count_sip;

      suspend;
    end
    else -- dlr_need_deliver is not null
    begin
      select count(drp_id)
      from dcl_dlr_list_produce drp
      where drp.dlr_id = :dlr_id and
            drp.receive_manager_id is null
      into :count_empty_manager;

      select count(drp_id)
      from dcl_dlr_list_produce drp
      where drp.dlr_id = :dlr_id and
            drp.receive_date is null
      into :count_empty_date;

      if ( :count_empty_manager != 0 or :count_empty_date != 0 ) then
      begin
        count_rest_drp = 1;
      end

      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_CRQ_DELIVER (CRQ_ID INTEGER)
RETURNS (CRQ_DELIVER SMALLINT)
AS 
declare variable count_not_deliver integer;
begin
  crq_deliver = null;
  select count(crp_id) from dcl_crq_print where crq_id = :crq_id and crp_deliver is null into :count_not_deliver;
  if ( count_not_deliver = 0 ) then
  begin
    crq_deliver = 1;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_CTN_NUM_LIST_BY_PRD_ID (PRD_ID INTEGER)
RETURNS (PRODUCT_LIST VARCHAR(5000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_LIST VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
DECLARE VARIABLE STF_NAME VARCHAR(150);
DECLARE VARIABLE CTN_NUMBER VARCHAR(50);
begin
  product_list = '';
  ctn_number_list = '';
  for
    select
      stf_name,
      ctn_number
    from
      dcl_stuff_category stf,
      dcl_catalog_number ctn
    where
      stf.stf_id = ctn.stf_id and
      ctn.prd_id = :prd_id
    order by 1
    into
      :stf_name,
      :ctn_number
  do
  begin
    product_list = :product_list || :stf_name || '<br>';
    ctn_number_list = :ctn_number_list || :ctn_number || '<br>';
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_CUSTOMER_FOR_DLR (DLR_ID INTEGER)
RETURNS (CTR_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
declare variable ctr_id integer;
declare variable asm_id integer;
declare variable ctr_name_local varchar(200);
begin
  for
    select ctr_id,
           asm_id
    from dcl_dlr_list_produce drp
    where drp.dlr_id = :dlr_id
    into   :ctr_id,
           :asm_id
  do
  begin
    if ( ctr_id is not null ) then
    begin
      select ctr.ctr_name from dcl_contractor ctr where ctr.ctr_id = :ctr_id into :ctr_name;
      suspend;
    end
    else if ( asm_id is not null ) then
    begin
      ctr_name = '';
      for
        select distinct ctr_name
        from dcl_get_ord_cust_info_for_asm(:asm_id)
        into :ctr_name_local
      do
      begin
        ctr_name = ctr_name || ctr_name_local;
      end

      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_DECODE_RESTS_IN_LIT (PRD_ID INTEGER,
STF_ID INTEGER)
RETURNS (QUANTITY DECIMAL(15, 2),
DATE_CREATED TIMESTAMP,
CONTRACTOR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPECIFICATION_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACT_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare variable OPR_ID integer;
declare variable ORD_DATE date;
declare variable TRN_DATE date;
begin
    date_created = null;
    contractor_name = null;
    specification_number = null;
    contract_number = null;

    for
      select coalesce(prc.ord_produce_cnt_rest, 0) + coalesce(prc.trn_produce_cnt_rest, 0),
             prc.ord_date,
             prc.trn_date,
             prc.opr_id
      from dcl_movement_load(:prd_id, :stf_id, 1, null) prc
      where coalesce(prc.ord_produce_cnt_rest, 0) + coalesce(prc.trn_produce_cnt_rest, 0) > 0 and
            (prc.ord_date is not null or prc.trn_date is not null)
      into  :quantity,
            :ord_date,
            :trn_date,
            :opr_id
    do
    begin
        if (ord_date is not null) then
        begin
          date_created = :ord_date;
        end
        else
        begin
          date_created = :trn_date;
        end

        select contractor_name, specification_number, contract_number
        from dcl_get_rest_info_from_order(:opr_id)
        into :contractor_name, :specification_number, :contract_number;

        suspend;
    end
end ^

ALTER PROCEDURE DCL_GET_DECODE_RESTS_IN_MINSK (PRD_ID INTEGER,
STF_ID INTEGER)
RETURNS (QUANTITY DECIMAL(15, 2),
DATE_CREATED TIMESTAMP,
CONTRACTOR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPECIFICATION_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACT_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare variable OPR_ID integer;
begin
    date_created = null;
    contractor_name = null;
    specification_number = null;
    contract_number = null;

    for
      select prc.prc_produce_cnt_rest,
             prc.prc_date,
             prc.opr_id
      from dcl_movement_load(:prd_id, :stf_id, 1, null) prc
      where prc.prc_produce_cnt_rest > 0 and
            prc.prc_date is not null
      into  :quantity,
            :date_created,
            :opr_id
    do
    begin
        select contractor_name, specification_number, contract_number
        from dcl_get_rest_info_from_order(:opr_id)
        into :contractor_name, :specification_number, :contract_number;

        suspend;
    end
end ^

ALTER PROCEDURE DCL_GET_DOUBLE_CONTRACTOR (CTR_ID INTEGER,
PAY_ACCOUNT VARCHAR(35) CHARACTER SET UNICODE_FSS)
RETURNS (CONTRACTORS VARCHAR(800) CHARACTER SET UNICODE_FSS)
AS 
DECLARE VARIABLE CONTRACTOR VARCHAR(200);
begin
  contractors = '';

  for
    select distinct ctr.ctr_name
    from dcl_contractor ctr,
         dcl_account acc
    where  ctr.ctr_id != :ctr_id and
           ctr.ctr_double_account is not null and
           acc.ctr_id = ctr.ctr_id and
           acc.acc_account = :pay_account
    into :contractor
  do
  begin
    contractors = :contractors || :contractor || ', ';
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_DOUBLE_PRODUCES (STF_ID INTEGER)
RETURNS (DOUBLE_STR VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
begin

  double_str = 'Double Catalog Numbers';
  suspend;

  for
    select
      distinct ctn1.ctn_number
    from dcl_catalog_number ctn1,
         dcl_catalog_number ctn2
    where ctn1.ctn_id != ctn2.ctn_id
          and ctn1.prd_id != ctn2.prd_id
          and ctn1.ctn_number = ctn2.ctn_number
          and ctn1.ctn_number != ''
          and ( select prd_id from dcl_produce prd where prd.prd_id = ctn1.prd_id and prd.prd_not_check_double is null ) is not null
          and ( :stf_id = -1 or ctn1.stf_id = :stf_id )
    into :double_str
  do
  begin
    suspend;
  end

  if (stf_id = -1) then
  begin

    double_str = 'Double Types';
    suspend;

    for
      select
        distinct prd1.prd_type
      from dcl_produce prd1,
           dcl_produce prd2
      where prd1.prd_id != prd2.prd_id
            and prd1.prd_type = prd2.prd_type
            and prd1.prd_type != ''
            and prd1.prd_not_check_double is null
      into :double_str
    do
    begin
      suspend;
    end

    double_str = 'Double Parameters';
    suspend;

    for
      select
        distinct prd1.prd_params
      from dcl_produce prd1,
           dcl_produce prd2
      where prd1.prd_id != prd2.prd_id
            and prd1.prd_params = prd2.prd_params
            and prd1.prd_params != ''
            and prd1.prd_not_check_double is null
      into :double_str
    do
    begin
      suspend;
    end

    double_str = 'Double Additional Parameters';
    suspend;

    for
      select
        distinct prd1.prd_add_params
      from dcl_produce prd1,
           dcl_produce prd2
      where prd1.prd_id != prd2.prd_id
            and prd1.prd_add_params = prd2.prd_add_params
            and prd1.prd_add_params != ''
            and prd1.prd_not_check_double is null
      into :double_str
    do
    begin
      suspend;
    end

  end
end ^

ALTER PROCEDURE DCL_GET_MANAGERS_BY_SHP_ID (SHP_ID INTEGER)
RETURNS (MANAGER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
begin
  for
    select
      distinct (usr_surname || ' ' || usr_name)
    from
      dcl_user_language usr_lng,
      dcl_shp_list_produce lps,
      dcl_lps_list_manager lmn
    where
      lps.shp_id = :shp_id and
      lmn.lps_id = lps.lps_id and
      usr_lng.usr_id = lmn.usr_id and
      usr_lng.lng_id = 1
    into :manager
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_MANAGER_LIST_BY_SHP_ID (SHP_ID INTEGER)
RETURNS (MANAGER_LIST VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
declare variable usr_name varchar(50);
begin
  manager_list = '';
  for
    select
      manager
    from
      dcl_get_managers_by_shp_id(:shp_id)
    order by 1
    into :usr_name
  do
  begin
    manager_list = :manager_list || :usr_name || '<br>';
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_NUM (T VARCHAR(64) CHARACTER SET UNICODE_FSS)
RETURNS (NUM INTEGER)
AS 
DECLARE VARIABLE D DATE;
DECLARE VARIABLE Y INTEGER;
begin
  SELECT CAST('NOW' AS TIMESTAMP) FROM RDB$DATABASE INTO :d;
  Y = EXTRACT(YEAR FROM D);

  select dcl_num from dcl_year_num where dcl_year=:y and dcl_table=:t into num;
  if ( num is NULL ) then
  begin
    num = 1;
    insert into dcl_year_num (dcl_year,  dcl_num, dcl_table) values (:y, :num, :t);
  end
  else
  begin
    num = num + 1;
    update dcl_year_num set dcl_num = :num where dcl_year=:y and dcl_table=:t;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_OCCUPIED_SHP_POS (POSITION_IDS VARCHAR(1024) CHARACTER SET UNICODE_FSS)
RETURNS (OCCUPIED_IDS VARCHAR(1024) CHARACTER SET UNICODE_FSS)
AS 
declare variable LPS_ID integer;
declare variable CRQ_COUNT integer;
begin
  occupied_ids = '';

  for 
    select int_id from dcl_decode_id_list(:position_ids)
    into :lps_id
  do
  begin
    select count(crq_id) from dcl_contractor_request crq where lps_id = :lps_id into :crq_count;
    if ( crq_count > 0 ) then
    begin
      occupied_ids = occupied_ids || :lps_id || ', ';
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_OPR_ID_BY_LPC (ASM_ID_IN INTEGER,
APR_ID_IN INTEGER,
DRP_ID_IN INTEGER,
SIP_ID_IN INTEGER)
RETURNS (OPR_ID INTEGER)
AS 
declare variable DRP_ID integer;
declare variable ASM_ID integer;
declare variable APR_ID integer;
begin
  opr_id = null;

  if (sip_id_in is not null) then
  begin
    select opr_id, drp_id from dcl_spi_list_produce sip where sip.sip_id = :sip_id_in into :opr_id, :drp_id;
  end

  if (drp_id_in is not null) then
  begin
    drp_id = :drp_id_in;
  end

  if (drp_id is not null) then
  begin
    select opr_id, asm_id, apr_id from dcl_dlr_list_produce drp where drp.drp_id = :drp_id into :opr_id, :asm_id, :apr_id;
  end

  if (asm_id_in is not null) then
  begin
    asm_id = :asm_id_in;
  end

  if (asm_id is not null) then
  begin
    select opr_id from dcl_assemble asm where asm.asm_id = :asm_id into :opr_id;
  end

  if (apr_id_in is not null) then
  begin
    apr_id = :apr_id_in;
  end

  if (apr_id is not null) then
  begin
    select opr_id from dcl_asm_list_produce apr where apr.apr_id = :apr_id into :opr_id;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_OPR_ID_FROM_ASM (ASM_ID INTEGER,
APR_ID INTEGER)
RETURNS (OPR_ID INTEGER)
AS 
begin
    if(asm_id is not null) then select opr_id from dcl_assemble where asm_id=:asm_id into :opr_id;
    else if(asm_id is not null) then if(apr_id is not null) then if(opr_id is null) then select asm.opr_id from dcl_asm_list_produce prd
                                                                                                           join dcl_assemble asm on prd.asm_id=asm.asm_id
                                                                                                           where prd.apr_id=:apr_id into :opr_id;
	suspend;
end ^

ALTER PROCEDURE DCL_GET_ORD_CUST_INFO_FOR_ASM (ASM_ID INTEGER)
RETURNS (CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
declare variable ord_id integer;
declare variable opr_id integer;
begin
  for
    select distinct apr.opr_id
    from dcl_asm_list_produce apr
    where apr.asm_id = :asm_id
    into :opr_id
  do
  begin
    select ord_id from dcl_ord_list_produce opr where opr.opr_id = :opr_id into :ord_id;

    for
      select ctr_name
      from dcl_get_contractors_for_for_ord(:ord_id)
      into :ctr_name
    do
    begin
      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_ORD_ID_BY_LPC (OPR_ID_IN INTEGER,
ASM_ID_IN INTEGER,
APR_ID_IN INTEGER,
DRP_ID_IN INTEGER,
SIP_ID_IN INTEGER)
RETURNS (ORD_ID INTEGER)
AS 
declare variable OPR_ID integer;
declare variable DRP_ID integer;
declare variable ASM_ID integer;
declare variable APR_ID integer;
begin
  ord_id = null;
  opr_id = null;

  if (sip_id_in is not null) then
  begin
    select opr_id, drp_id from dcl_spi_list_produce sip where sip.sip_id = :sip_id_in into :opr_id, :drp_id;
  end

  if (drp_id_in is not null) then
  begin
    drp_id = :drp_id_in;
  end

  if (drp_id is not null) then
  begin
    select opr_id, asm_id, apr_id from dcl_dlr_list_produce drp where drp.drp_id = :drp_id into :opr_id, :asm_id, :apr_id;
  end

  if (asm_id_in is not null) then
  begin
    asm_id = :asm_id_in;
  end

  if (asm_id is not null) then
  begin
    select opr_id from dcl_assemble asm where asm.asm_id = :asm_id into :opr_id;
  end

  if (apr_id_in is not null) then
  begin
    apr_id = :apr_id_in;
  end

  if (apr_id is not null) then
  begin
    select opr_id from dcl_asm_list_produce apr where apr.apr_id = :apr_id into :opr_id;
  end

  if (opr_id_in is not null) then
  begin
    opr_id = :opr_id_in;
  end

  if (opr_id is not null) then
  begin
    select ord_id from dcl_ord_list_produce opr where opr.opr_id = :opr_id into :ord_id;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_ORD_INFO_FOR_ASM (ASM_ID INTEGER)
RETURNS (ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
ORD_DATE_STR VARCHAR(20) CHARACTER SET UNICODE_FSS,
CONTRACTORS_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS)
AS 
declare variable opr_id integer;
begin
  for
    select distinct apr.opr_id
    from dcl_asm_list_produce apr
    where apr.asm_id = :asm_id
    into :opr_id
  do
  begin
    select ord.ord_id,
           ord.ord_number,
           ord.ord_date
    from dcl_ord_list_produce opr,
         dcl_order ord
    where opr.opr_id = :opr_id and
          ord.ord_id = opr.ord_id
    into   :ord_id,
           :ord_number,
           :ord_date
    ;

    ord_date_str = '';
    select strdate from date2str(:ord_date) into :ord_date_str;
    select contractors from dcl_get_contractor_for_for_ord(:ord_id, '<br>') into :contractors_for;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_ORD_NUM_DATE_FOR_DLR (DLR_ID INTEGER)
RETURNS (ORD_NUM_DATE VARCHAR(40) CHARACTER SET UNICODE_FSS)
AS 
declare variable ord_number varchar(15);
declare variable ord_date date;
declare variable opr_id integer;
declare variable apr_id integer;
declare variable asm_id integer;
declare variable ord_id integer;
begin
  for
    select opr_id,
           apr_id,
           asm_id
    from dcl_dlr_list_produce drp
    where drp.dlr_id = :dlr_id
    into   :opr_id,
           :apr_id,
           :asm_id
  do
  begin
    if ( asm_id is not null ) then
    begin
      for
        select
          distinct ord_id,
          ord_number,
          ord_date
        from
          dcl_get_ord_info_for_asm(:asm_id)
        into
          :ord_id,
          :ord_number,
          :ord_date
      do
      begin
        ord_num_date = '';
        select strdate from date2str(:ord_date) into :ord_num_date;
        ord_num_date = ord_number || 'from' || :ord_num_date;

        suspend;
      end
    end
    else
    begin
      if ( opr_id is not null ) then
      begin
        select
          ord_number,
          ord_date
        from dcl_order ord,
             dcl_ord_list_produce opr
        where ord.ord_id = opr.ord_id and
              opr.opr_id = :opr_id
        into
          :ord_number,
          :ord_date
        ;
      end

      if ( apr_id is not null ) then
      begin
        select
          ord_number,
          ord_date
        from
          dcl_order ord,
          dcl_ord_list_produce opr,
          dcl_assemble asm,
          dcl_asm_list_produce apr
        where ord.ord_id = opr.ord_id and
              opr.opr_id = asm.opr_id and
              asm.asm_id = apr.asm_id and
              apr.apr_id = :apr_id
        into
          :ord_number,
          :ord_date
        ;
      end

      ord_num_date = '';
      select strdate from date2str(:ord_date) into :ord_num_date;
      ord_num_date = ord_number || 'from' || :ord_num_date;

      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_PAYED_DATE (SPC_ID INTEGER,
SPC_SUMM DECIMAL(15, 2),
SPC_PERCENT_OR_SUM SMALLINT,
SPC_DELIVERY_PERCENT DECIMAL(15, 2),
SPC_DELIVERY_SUM DECIMAL(15, 2))
RETURNS (PAYED_DATE DATE)
AS 
declare variable LPS_SUMM decimal(15,2);
declare variable PAY_DATE date;
declare variable CHECK_SUM decimal(15,2);
declare variable CALCULATED decimal(15,2);
begin
  payed_date = null;
  if ( spc_percent_or_sum is not null ) then
  begin
    check_sum = 0;
    for
      select lps_summ, pay_date
      from dcl_pay_list_summ psum,
           dcl_payment pay
      where psum.spc_id = :spc_id and
            pay.pay_id = psum.pay_id
      order by pay_date
      into :lps_summ,
           :pay_date
    do
    begin
      check_sum = check_sum + lps_summ;

      if ( 0 = spc_percent_or_sum and spc_summ != 0 ) then
      begin
        calculated = (check_sum / spc_summ * 100);
        if ( calculated + 0.5 >= spc_delivery_percent ) then
        begin
          payed_date = pay_date;
          break;
        end
      end

      if ( 1 = spc_percent_or_sum ) then
      begin
        if ( check_sum >= spc_delivery_sum ) then
        begin
          payed_date = pay_date;
          break;
        end
      end
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_PRC_LIST_FOR_ORD (ORD_ID INTEGER)
RETURNS (COST_PRODUCES VARCHAR(2500) CHARACTER SET UNICODE_FSS)
AS 
declare variable PRC_NUM_DATE varchar(80);
begin
  cost_produces = '';

  for
    select distinct(prc_num_date)
    from dcl_get_prc_num_date_for_ord(:ord_id)
    into :prc_num_date
  do
  begin
    cost_produces = cost_produces || prc_num_date || ', ';
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_PRC_NUM_DATE_FOR_DRP (DRP_ID INTEGER)
RETURNS (PRC_NUM_DATE VARCHAR(80) CHARACTER SET UNICODE_FSS)
AS 
declare variable PRC_DATE date;
declare variable PRC_NUMBER varchar(50);
begin
  for
    select
      prc_date,
      prc_number
    from
      dcl_produce_cost prc,
      dcl_prc_list_produce lpc
    where   lpc.prc_id = prc.prc_id and
            lpc.drp_id = :drp_id
    into
      :prc_date,
      :prc_number
  do
  begin
    prc_num_date = '';
    select strdate from date2str(:prc_date) into :prc_num_date;
    prc_num_date = prc_number || 'from' || :prc_num_date;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_PRC_NUM_DATE_FOR_ORD (ORD_ID INTEGER)
RETURNS (PRC_NUM_DATE VARCHAR(80) CHARACTER SET UNICODE_FSS)
AS 
declare variable PRC_DATE date;
declare variable PRC_NUMBER varchar(50);
declare variable OPR_ID integer;
declare variable DRP_ID integer;
declare variable APR_ID integer;
declare variable ASM_ID integer;
declare variable SIP_ID integer;
begin
  for 
    select opr_id
    from dcl_ord_list_produce
    where ord_id = :ord_id
    into :opr_id
  do
  begin
    for
      select
        prc_date,
        prc_number
      from
        dcl_produce_cost prc,
        dcl_prc_list_produce lpc
      where   lpc.prc_id = prc.prc_id and
              lpc.opr_id = :opr_id
      into
        :prc_date,
        :prc_number
    do
    begin
      prc_num_date = '';
      select strdate from date2str(:prc_date) into :prc_num_date;
      prc_num_date = prc_number || 'from' || :prc_num_date;

      suspend;
    end

    for
      select drp_id
      from dcl_dlr_list_produce drp
      where drp.opr_id = :opr_id
      into :drp_id
    do
    begin
      for
        select prc_num_date
        from dcl_get_prc_num_date_for_drp(:drp_id)
        into :prc_num_date
      do
      begin
        suspend;
      end

      for
        select sip_id
        from dcl_spi_list_produce sip
        where sip.drp_id = :drp_id
        into :sip_id
      do
      begin
        for
          select prc_num_date
          from dcl_get_prc_num_date_for_sip(:sip_id)
          into :prc_num_date
        do
        begin
          suspend;
        end
      end
    end

    for
      select apr_id
      from dcl_asm_list_produce apr
      where apr.opr_id = :opr_id
      into :apr_id
    do
    begin
      for
        select
          prc_date,
          prc_number
        from
          dcl_produce_cost prc,
          dcl_prc_list_produce lpc
        where   lpc.prc_id = prc.prc_id and
                lpc.apr_id = :apr_id
        into
          :prc_date,
          :prc_number
      do
      begin
        prc_num_date = '';
        select strdate from date2str(:prc_date) into :prc_num_date;
        prc_num_date = prc_number || 'from' || :prc_num_date;

        suspend;
      end

      for
        select drp_id
        from dcl_dlr_list_produce drp
        where drp.apr_id = :apr_id
        into :drp_id
      do
      begin
        for
          select prc_num_date
          from dcl_get_prc_num_date_for_drp(:drp_id)
          into :prc_num_date
        do
        begin
          suspend;
        end
      end
    end

    for
      select asm_id
      from dcl_assemble asm
      where asm.opr_id = :opr_id
      into :asm_id
    do
    begin
      for
        select
          prc_date,
          prc_number
        from
          dcl_produce_cost prc,
          dcl_prc_list_produce lpc
        where   lpc.prc_id = prc.prc_id and
                lpc.asm_id = :asm_id
        into
          :prc_date,
          :prc_number
      do
      begin
        prc_num_date = '';
        select strdate from date2str(:prc_date) into :prc_num_date;
        prc_num_date = prc_number || 'from' || :prc_num_date;

        suspend;
      end

      for
        select drp_id
        from dcl_dlr_list_produce drp
        where drp.apr_id = :asm_id
        into :drp_id
      do
      begin
        for
          select prc_num_date
          from dcl_get_prc_num_date_for_drp(:drp_id)
          into :prc_num_date
        do
        begin
          suspend;
        end
      end
    end

    for
      select sip_id
      from dcl_spi_list_produce sip
      where sip.opr_id = :opr_id
      into :sip_id
    do
    begin
      for
        select prc_num_date
        from dcl_get_prc_num_date_for_sip(:sip_id)
        into :prc_num_date
      do
      begin
        suspend;
      end
    end

  end
end ^

ALTER PROCEDURE DCL_GET_PRC_NUM_DATE_FOR_SIP (SIP_ID INTEGER)
RETURNS (PRC_NUM_DATE VARCHAR(80) CHARACTER SET UNICODE_FSS)
AS 
declare variable PRC_DATE date;
declare variable PRC_NUMBER varchar(50);
begin
  for
    select
      prc_date,
      prc_number
    from
      dcl_produce_cost prc,
      dcl_prc_list_produce lpc
    where   lpc.prc_id = prc.prc_id and
            lpc.sip_id = :sip_id
    into
      :prc_date,
      :prc_number
  do
  begin
    prc_num_date = '';
    select strdate from date2str(:prc_date) into :prc_num_date;
    prc_num_date = prc_number || 'from' || :prc_num_date;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_PRODUCES_FOR_CAT (CAT_ID_IN INTEGER,
PRD_NAME_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CUS_CODE_IN VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
NOT_BLOCKED SMALLINT,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (PRD_ID INTEGER,
PRD_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
UNT_ID INTEGER,
CUS_CODE VARCHAR(10) CHARACTER SET UNICODE_FSS,
PRD_BLOCK SMALLINT,
PRODUCT_LIST VARCHAR(5000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_LIST VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_NOT_CHECK_DOUBLE SMALLINT,
PRD_USER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare variable PRD_COMMON varchar(5000);
declare variable PRD_NAME_ORDER varchar(1000);
begin
  prd_name_in = upper(prd_name_in);
  prd_type_in = upper(prd_type_in);
  prd_params_in = upper(prd_params_in);
  prd_add_params_in = upper(prd_add_params_in);
  cus_code_in = upper(cus_code_in);
  ctn_number_in = upper(ctn_number_in);
  prd_common_in = upper(prd_common_in);

  for
    select
      prd_id,
      prd_name,
      upper(prd.prd_name) as prd_name_order,
      prd_type,
      prd_params,
      prd_add_params,
      unt_id,
      cus_code,
      prd_block,
      prd_not_check_double,
      (select usr_surname || ' ' || usr_name from dcl_user_language  where usr_id = prd.usr_id_create and lng_id = 1)
    from
      dcl_produce prd
    where
      cat_id = :cat_id_in and
      ( :not_blocked is null or ( :not_blocked is not null and prd_block is null ) ) and
      ( :stf_id_in is null or ( (select count(ctn_id) from dcl_catalog_number ctn where ctn.prd_id = prd.prd_id and ctn.stf_id = :stf_id_in ) = 1 ) ) and
      ( :prd_name_in is null or :prd_name_in like '' or upper(prd.prd_name) like('%' || :prd_name_in || '%') ) and
      ( :prd_type_in is null or :prd_type_in like '' or upper(prd.prd_type) like('%' || :prd_type_in || '%') ) and
      ( :prd_params_in is null or :prd_params_in like '' or upper(prd.prd_params) like('%' || :prd_params_in || '%') ) and
      ( :prd_add_params_in is null or :prd_add_params_in like '' or upper(prd.prd_add_params) like('%' || :prd_add_params_in || '%') ) and
      ( :cus_code_in is null or :cus_code_in like '' or upper(prd.cus_code) like('%' || :cus_code_in || '%') ) and
      ( :ctn_number_in is null or :ctn_number_in like '' or ( (select count(ctn_id) from dcl_catalog_number ctn where ctn.prd_id = prd.prd_id and upper(ctn.ctn_number) like('%' || :ctn_number_in || '%') ) >= 1 ) )
    order by prd_name_order, prd_type, prd_params, prd_add_params
    into :prd_id,
         :prd_name,
         :prd_name_order,
         :prd_type,
         :prd_params,
         :prd_add_params,
         :unt_id,
         :cus_code,
         :prd_block,
         :prd_not_check_double,
         :prd_user
  do
  begin
    select product_list, ctn_number_list from dcl_get_ctn_num_list_by_prd_id(:prd_id) into :product_list, :ctn_number_list;
    prd_common = upper(coalesce(:prd_name, '') || ' ' || coalesce(:prd_type, '') || ' ' || coalesce(:prd_params, '') || ' ' || coalesce(:prd_add_params, '') || ' ' || coalesce(:cus_code, '') || ' ' || coalesce(:ctn_number_list, ''));
    if ( :prd_common_in is null or :prd_common_in like '' or :prd_common like('%' || :prd_common_in || '%') ) then
    begin
      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_PRODUCT_LIST_BY_SHP_ID (SHP_ID INTEGER)
RETURNS (PRODUCT_LIST VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
DECLARE VARIABLE STF_NAME VARCHAR(150);
begin
  product_list = '';
  for
    select
      distinct stf_name
    from
      dcl_stuff_category stf,
      dcl_shp_list_produce lps
    where
    stf.stf_id = lps.stf_id and
    lps.shp_id = :shp_id
    order by 1
    into :stf_name
  do
  begin
    product_list = :product_list || :stf_name || '<br>';
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_RESERVED_COUNT_FOR_CPR (CPR_ID INTEGER,
LPC_ID INTEGER)
RETURNS (RESERVED DECIMAL(15, 2))
AS 
begin
  reserved = 0;

  if ( lpc_id is not null ) then
  begin

    select coalesce (sum(lpr_count), 0) from
    (
      select ( lpr_count - ( select coalesce (sum(lps.lps_count), 0) from dcl_shp_list_produce lps where lps.lpr_id = lpr.lpr_id ) ) as lpr_count
      from  dcl_cpr_list_produce lpr
      where lpr.lpc_id = :lpc_id and
            (
              select count(cpr_id)
              from dcl_commercial_proposal cpr
              where cpr.cpr_id = lpr.cpr_id and
                    cpr.cpr_id != :cpr_id and
                    cpr.cpr_assemble_minsk_store is not null and
                    (
                      cpr.cpr_no_reservation is null and
                      (
                        cpr.cpr_final_date >= (SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE)
                        or
                        cpr.cpr_proposal_received_flag=1
                      )
                    )
            ) > 0
    )
    into  :reserved;

  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_RESERVED_INFO (CPR_ID_IN INTEGER,
LPC_ID INTEGER)
RETURNS (RESERVED DECIMAL(15, 2),
RESERVED_FOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
RESERVED_END DATE,
DATE_ACCEPT DATE)
AS 
declare variable CPR_ID integer;
declare variable CPR_PROPOSAL_RECEIVED_FLAG smallint;
begin
  cpr_id_in = coalesce (cpr_id_in, -1);
  lpc_id = coalesce (lpc_id, -1);
  for
    select
       distinct cpr_id
    from dcl_cpr_list_produce lpr
    where lpr.lpc_id = :lpc_id and
          (lpr.lpr_count - ( select coalesce (sum(lps.lps_count), 0) from dcl_shp_list_produce lps where lps.lpr_id = lpr.lpr_id) ) > 0  and
          lpr.cpr_id = (
                         select cpr_id
                         from dcl_commercial_proposal cpr
                         where cpr.cpr_id = lpr.cpr_id and
                               cpr.cpr_assemble_minsk_store is not null and
                               cpr.cpr_no_reservation is null and
                               (
                                 cpr.cpr_final_date >= (SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE)
                                 or
                                 cpr.cpr_proposal_received_flag=1
                               )
                       )
    into :cpr_id
  do
  begin
    select coalesce (sum(lpr_count), 0) from
    (
      select ( lpr_count - ( select coalesce (sum(lps.lps_count), 0) from dcl_shp_list_produce lps where lps.lpr_id = lpr.lpr_id) ) as lpr_count
      from  dcl_cpr_list_produce lpr
      where lpr.lpc_id = :lpc_id and
            lpr.cpr_id = :cpr_id
    )
    into  :reserved;
    select ctr.ctr_name,
           cpr.cpr_number,
           cpr.cpr_final_date,
           cpr.cpr_proposal_received_flag,
           cpr.cpr_date_accept
    from   dcl_commercial_proposal cpr,
           dcl_contractor ctr
    where  cpr.cpr_id = :cpr_id and
           ctr.ctr_id = cpr.ctr_id
    into   :reserved_for,
           :number,
           :reserved_end,
           :cpr_proposal_received_flag,
           :date_accept
    ;
    if ( cpr_proposal_received_flag=0 ) then
    begin
      date_accept = null;
    end
    if ( reserved > 0 ) then
    begin
      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_REST_ASM_FOR_DLR (DLR_ID INTEGER)
RETURNS (APR_ID INTEGER,
ASM_ID INTEGER,
ASM_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_DATE DATE,
PRD_ID INTEGER,
APR_COUNT DECIMAL(15, 2))
AS 
declare variable ASM_TYPE integer;
declare variable ASM_COUNT decimal(15,2);
declare variable DRP_COUNT decimal(15,2);
declare variable LPC_COUNT decimal(15,2);
declare variable OPR_ID integer;
begin
  if ( dlr_id is null ) then
  begin
    dlr_id = -1; -- __'__??'____??_??___??_??__ ___??'"___>''__'<_?? ID, ''.__ ___>'_ null __'__??____ ___??'__??'''_ __'_'______?? sql
  end


  for
    select asm_id,
           asm_number,
           asm_date,
           asm_type,
           asm_count,
           prd_id,
           opr_id
    from dcl_assemble asm
  into :asm_id,
       :asm_number,
       :asm_date,
       :asm_type,
       :asm_count,
       :prd_id,
       :opr_id
  do
  begin
    apr_id = null;
    if ( asm_type = 0 ) then
    begin
      apr_count = asm_count;

      select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.asm_id = :asm_id and dlr.dlr_id = drp.dlr_id and drp.dlr_id != :dlr_id and dlr.dlr_annul is null into :drp_count;
      select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.asm_id = :asm_id into :lpc_count;

      apr_count = apr_count - drp_count - lpc_count;

      if ( apr_count > 0 ) then
      begin
        suspend;
      end
    end

    if ( asm_type = 1 ) then
    begin
      for
        select apr_id,
               apr.prd_id,
               (
                 (apr_count * :asm_count) -
                 (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.apr_id = apr.apr_id and dlr.dlr_id = drp.dlr_id and drp.dlr_id != :dlr_id and dlr.dlr_annul is null ) -
                 (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.apr_id = apr.apr_id )
               ) as apr_count
        from dcl_asm_list_produce apr
        where apr.asm_id = :asm_id
              and (
                    (
                      (apr_count * :asm_count) -
                      (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.apr_id = apr.apr_id and dlr.dlr_id = drp.dlr_id and drp.dlr_id != :dlr_id and dlr.dlr_annul is null ) -
                      (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.apr_id = apr.apr_id )
                    ) > 0
                  )
        into :apr_id,
             :prd_id,
             :apr_count
      do
      begin
        suspend;
      end
    end
  end

end ^

ALTER PROCEDURE DCL_GET_REST_ASM_FOR_PRC (PRC_ID INTEGER)
RETURNS (APR_ID INTEGER,
ASM_ID INTEGER,
ASM_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
ASM_DATE DATE,
PRD_ID INTEGER,
APR_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare variable ASM_TYPE integer;
declare variable ASM_COUNT decimal(15,2);
declare variable DRP_COUNT decimal(15,2);
declare variable LPC_COUNT decimal(15,2);
declare variable OPR_ID integer;
begin
  if ( prc_id is null ) then
  begin
    prc_id = -1;
  end


  for
    select asm_id,
           asm_number,
           asm_date,
           asm_type,
           asm_count,
           prd_id,
           opr_id,
           (select ctn_number from dcl_catalog_number ctn where ctn.prd_id = asm.prd_id and ctn.stf_id = asm.stf_id)
    from dcl_assemble asm
  into :asm_id,
       :asm_number,
       :asm_date,
       :asm_type,
       :asm_count,
       :prd_id,
       :opr_id,
       :ctn_number
  do
  begin
    apr_id = null;
    if ( asm_type = 0 ) then
    begin
      apr_count = asm_count;

      select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.asm_id = :asm_id and ( lpc.prc_id != :prc_id or ( lpc.prc_id = :prc_id and (select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = lpc.lpc_id) is not null) ) into :lpc_count;
      select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.asm_id = :asm_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null into :drp_count;

      apr_count = apr_count - drp_count - lpc_count;

      if ( apr_count > 0 ) then
      begin
        suspend;
      end
    end

    if ( asm_type = 1 ) then
    begin
      for
        select apr_id,
               apr.prd_id,
               (
                 (apr_count * :asm_count) -
                 (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.apr_id = apr.apr_id and ( lpc.prc_id != :prc_id or ( lpc.prc_id = :prc_id and (select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = lpc.lpc_id) is not null) ) ) -
                 (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.apr_id = apr.apr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null )
               ) as apr_count,
               (select ctn_number from dcl_catalog_number ctn where ctn.prd_id = apr.prd_id and ctn.stf_id = asm.stf_id)
        from  dcl_assemble asm,
              dcl_asm_list_produce apr
        where asm.asm_id = :asm_id
              and apr.asm_id = asm.asm_id
              and (
                    (
                      (apr_count * :asm_count) -
                      (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.apr_id = apr.apr_id and ( lpc.prc_id != :prc_id or ( lpc.prc_id = :prc_id and (select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = lpc.lpc_id) is not null) ) ) -
                      (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.apr_id = apr.apr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null )
                    ) > 0
                  )
        into :apr_id,
             :prd_id, 
             :apr_count,
             :ctn_number
      do
      begin
        suspend;
      end
    end
  end

end ^

ALTER PROCEDURE DCL_GET_REST_DRP_FOR_PRC (PRC_ID INTEGER)
RETURNS (DRP_ID INTEGER,
DLR_ID INTEGER,
DLR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
DLR_DATE DATE,
PRD_ID INTEGER,
DRP_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
begin
  if ( prc_id is null ) then
  begin
    prc_id = -1;
  end

  for
    select drp_id,
           dlr.dlr_id as dlr_id,
           dlr_number,
           dlr_date,
           prd_id,
           (
             drp_count -
             (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.drp_id = drp.drp_id and ( lpc.prc_id != :prc_id or ( lpc.prc_id = :prc_id and (select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = lpc.lpc_id) is not null) ) )
           ) as drp_count,
           (select ctn_number from dcl_catalog_number ctn where ctn.prd_id = drp.prd_id and ctn.stf_id = drp.stf_id)
    from dcl_dlr_list_produce drp,
         dcl_delivery_request dlr
    where dlr.dlr_id = drp.dlr_id
          and dlr.dlr_fair_trade is not null
          and dlr.dlr_minsk = 0
          and dlr.dlr_include_in_spec is null
          and dlr.dlr_place_request is not null
          and dlr.dlr_annul is null
          and dlr.dlr_need_deliver is null
          and drp.prd_id is not null
          and (
                (
                  drp_count -
                  (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.drp_id = drp.drp_id and ( lpc.prc_id != :prc_id or ( lpc.prc_id = :prc_id and (select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = lpc.lpc_id) is not null) ) )
                ) > 0
              )
    into :drp_id,
         :dlr_id,
         :dlr_number,
         :dlr_date,
         :prd_id,
         :drp_count,
         :ctn_number
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_REST_DRP_FOR_SPI (SPI_ID INTEGER)
RETURNS (DRP_ID INTEGER,
DLR_ID INTEGER,
DLR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
DLR_DATE DATE,
PRD_ID INTEGER,
DRP_COUNT DECIMAL(15, 2),
GUARANTEE SMALLINT)
AS 
begin
  if ( spi_id is null ) then
  begin
    spi_id = -1; -- _???'__???'____???_???___???___ ___'"___>''__'<_??? ID, ''._??? ___>'_ null __'______ _???_???'__???'''_ __'_'______??? sql
  end

  for
    select drp_id,
           dlr.dlr_id as dlr_id,
           dlr_number,
           dlr_date,
           prd_id,
           (drp_count - (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.drp_id = drp.drp_id and sip.spi_id != :spi_id )),
           dlr.dlr_guarantee_repair
    from dcl_dlr_list_produce drp,
         dcl_delivery_request dlr
    where dlr.dlr_id = drp.dlr_id
          and
          (
            ( dlr.dlr_fair_trade is null ) or
            ( dlr.dlr_fair_trade is not null and dlr.dlr_minsk = 0 and dlr.dlr_include_in_spec is not null )
          )
          and dlr.dlr_place_request is not null
          and dlr.dlr_annul is null
          and drp.prd_id is not null
          and ( (drp_count - (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.drp_id = drp.drp_id and sip.spi_id != :spi_id )) > 0 )
    into :drp_id,
         :dlr_id,
         :dlr_number,
         :dlr_date,
         :prd_id,
         :drp_count,
         :guarantee
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_REST_INFO_FROM_ORDER (OPR_ID INTEGER)
RETURNS (CONTRACTOR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPECIFICATION_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACT_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare all_in_one_spec smallint;
begin
    select ord_in_one_spec from dcl_ord_list_produce opr join dcl_order ord on opr.ord_id = ord.ord_id where opr_id=:opr_id into :all_in_one_spec;
    if(all_in_one_spec is null) then select contractor.ctr_name, spc.spc_number, con.con_number from dcl_ord_list_produce opr
                                                                                                left join dcl_contractor contractor on opr.ctr_id=contractor.ctr_id
                                                                                                left join dcl_con_list_spec spc on opr.spc_id=spc.spc_id
                                                                                                left join dcl_contract con on spc.con_id=con.con_id
                                                                                                where opr.opr_id=:opr_id into :contractor_name,:specification_number, :contract_number;
    else select contractor.ctr_name, spc.spc_number, con.con_number from dcl_order ord
                                                                    join dcl_ord_list_produce opr on opr.ord_id = ord.ord_id
                                                                    join dcl_contractor contractor on ord.ctr_id_for=contractor.ctr_id
                                                                    left join dcl_con_list_spec spc on ord.spc_id=spc.spc_id
                                                                    left join dcl_contract con on spc.con_id=con.con_id
                                                                    where opr.opr_id=:opr_id into :contractor_name, :specification_number, :contract_number;

	suspend;
end ^

ALTER PROCEDURE DCL_GET_REST_LPC_FOR_CPR (CPR_ID INTEGER,
RUT_ID INTEGER,
LPC_1C_NUMBER_IN VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRC_DATE_MIN DATE)
RETURNS (LPC_ID INTEGER,
PRC_ID INTEGER,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_DATE DATE,
LPC_COUNT DECIMAL(15, 2),
FREE_COUNT DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
RESERVED DECIMAL(15, 2))
AS 
begin
  if ( cpr_id is null ) then
  begin
    cpr_id = -1;
  end

  lpc_1c_number_in = upper(lpc_1c_number_in);

  for
    select
       prc.prc_id,
       prc.prc_number,
       prc.prc_date,
       lpc.lpc_id,
       (lpc_count - (select  coalesce (sum(shp.lps_count), 0) from dcl_shp_list_produce shp where shp.lpc_id = lpc.lpc_id )),
       lpc.lpc_1c_number,
       lpc.prd_id,
       (select ctn_number from dcl_catalog_number ctn where ctn.prd_id = lpc.prd_id and ctn.stf_id = lpc.stf_id)
    from dcl_produce_cost prc,
         dcl_prc_list_produce lpc
    where prc.rut_id = :rut_id and
          lpc.prc_id = prc.prc_id and
          ( :prc_date_min is null or prc.prc_date >= :prc_date_min ) and
          ( :lpc_1c_number_in is null or :lpc_1c_number_in like '' or upper(lpc.lpc_1c_number) like('%' || :lpc_1c_number_in || '%') ) and
          lpc.lpc_count > (select coalesce (sum(shp.lps_count), 0) from dcl_shp_list_produce shp where shp.lpc_id = lpc.lpc_id )
    into
       :prc_id,
       :prc_number,
       :prc_date,
       :lpc_id,
       :lpc_count,
       :lpc_1c_number,
       :prd_id,
       :ctn_number
  do
  begin
    free_count = lpc_count;
    reserved = 0;

    if ( lpc_id is not null ) then
    begin
      select reserved from dcl_get_reserved_count_for_cpr(:cpr_id, :lpc_id) into :reserved;
    end
    free_count = free_count - reserved;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_REST_LPC_FOR_LPR (CPR_ID INTEGER,
LPC_ID INTEGER)
RETURNS (REST_LPC_COUNT DECIMAL(15, 2))
AS 
declare variable free_count decimal(15,2);
declare variable reserved decimal(15,2);
begin
  if ( cpr_id is null ) then
  begin
    cpr_id = -1;
  end

  select
     (lpc_count - (select coalesce (sum(shp.lps_count), 0) from dcl_shp_list_produce shp where shp.lpc_id = :lpc_id ))
  from dcl_prc_list_produce lpc
  where lpc.lpc_id = :lpc_id
  into
     :free_count
  ;

  reserved = 0;

  if ( lpc_id is not null ) then
  begin
    select reserved from dcl_get_reserved_count_for_cpr(:cpr_id, :lpc_id) into :reserved;
  end
  rest_lpc_count = free_count - reserved;

  suspend;
end ^

ALTER PROCEDURE DCL_GET_REST_LPC_FOR_SHP (RUT_ID_IN INTEGER,
LPC_1C_NUMBER_IN VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRC_DATE_MIN DATE,
CTR_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRC_ID INTEGER,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_DATE DATE,
PRD_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
RUT_ID INTEGER,
LPC_COUNT DECIMAL(15, 2),
FREE_COUNT DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CPR_CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPR_NUMBER VARCHAR(20) CHARACTER SET UNICODE_FSS,
LPR_ID INTEGER)
AS 
declare variable PRD_ID integer;
declare variable RESERVED decimal(15,2);
declare variable LPR_COUNT decimal(15,2);
declare variable CPR_ID integer;
declare variable LPC_COUNT_SAVE decimal(15,2);
declare variable FREE_COUNT_SAVE decimal(15,2);
begin
  lpc_1c_number_in = upper(lpc_1c_number_in);
  for
    select
       prc.prc_id,
       prc.prc_number,
       prc.prc_date,
       prc.rut_id,
       lpc.lpc_id,
       lpc.stf_id,
       lpc.lpc_count,
       (lpc_count - (select  coalesce (sum(lps.lps_count), 0) from dcl_shp_list_produce lps where lps.lpc_id = lpc.lpc_id )),
       lpc.lpc_1c_number,
       lpc.prd_id
    from dcl_produce_cost prc,
         dcl_prc_list_produce lpc
    left join get_contractor_for_for_lpc_id(lpc.lpc_id) on 1 = 1
    where prc.rut_id = :rut_id_in and
          lpc.prc_id = prc.prc_id and
          ( :prc_date_min is null or prc.prc_date >= :prc_date_min ) and
          ( :lpc_1c_number_in is null or :lpc_1c_number_in like '' or upper(lpc.lpc_1c_number) like('%' || :lpc_1c_number_in || '%') ) and
          lpc.lpc_count > (select coalesce (sum(lps.lps_count), 0) from dcl_shp_list_produce lps where lps.lpc_id = lpc.lpc_id ) and
          ( :ctr_id_in is null or get_contractor_for_for_lpc_id.ctr_id = :ctr_id_in )
    into
       :prc_id,
       :prc_number,
       :prc_date,
       :rut_id,
       :lpc_id,
       :stf_id,
       :lpc_count,
       :free_count,
       :lpc_1c_number,
       :prd_id
  do
  begin
    select stf_name from dcl_stuff_category where stf_id = :stf_id into :stf_name;
    select
      prd_name,
      prd_type,
      prd_params,
      prd_add_params,
      (select ctn_number_list from dcl_get_ctn_num_list_by_prd_id(prd.prd_id))
    from dcl_produce prd
    where prd.prd_id = :prd_id
    into
      :prd_name,
      :prd_type,
      :prd_params,
      :prd_add_params,
      :ctn_number
    ;
    lpr_id = null;
    cpr_number = '';
    cpr_ctr_name = '';
    lpc_count_save = lpc_count;
    free_count_save = free_count;
    select reserved from dcl_get_reserved_count_for_cpr(-1, :lpc_id) into :reserved;
    if ( reserved != 0 ) then
    begin
      for
        select lpr_id,
               lpr_count - ( select coalesce (sum(lps.lps_count), 0) from dcl_shp_list_produce lps where lps.lpr_id = lpr.lpr_id),
               cpr_id
        from  dcl_cpr_list_produce lpr
        where lpr.lpc_id = :lpc_id and
              (
                select count(cpr_id)
                from dcl_commercial_proposal cpr
                where cpr.cpr_id = lpr.cpr_id and
                      cpr.cpr_assemble_minsk_store is not null and
                      cpr.cpr_no_reservation is null and
                      (
                        cpr.cpr_final_date >= (SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE)
                        or
                        cpr.cpr_proposal_received_flag=1
                      )
              ) > 0
        into  :lpr_id,
              :lpr_count,
              :cpr_id
      do
      begin
        lpc_count = lpr_count;
        free_count = lpr_count;
        if ( free_count != 0 ) then
        begin
          select cpr_number,
                 ctr_name
          from dcl_commercial_proposal cpr,
               dcl_contractor ctr
          where cpr.cpr_id = :cpr_id and
                ctr.ctr_id = cpr.ctr_id
          into  :cpr_number,
                :cpr_ctr_name
          ;
          suspend;
        end
      end
      lpc_count_save = lpc_count_save - reserved;
      free_count_save = free_count_save - reserved;
    end
    lpr_id = null;
    cpr_number = '';
    cpr_ctr_name = '';
    lpc_count = lpc_count_save;
    free_count = free_count_save;
    if ( free_count != 0 ) then
    begin
      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_GET_REST_OPR_FOR_ASM (STF_ID INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2))
AS 
begin
  stf_id = null; -- Request from Lintera
  for
    select opr_id,
           ord.ord_id as ord_id,
           ord_number,
           ord_date,
           prd_id,
           (
             (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ) -
             (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id ) -
             (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null ) -
             (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id ) -
             (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
           )
    from dcl_ord_list_produce opr,
         dcl_order ord
    where ord.ord_id = opr.ord_id and
          ord.ord_all_include_in_spec is null and
          (:stf_id is null or ord.stf_id = :stf_id) and
          opr.opr_use_prev_number is null and
          opr.prd_id is not null
          and (
                ( (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ) -
                  (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id ) -
                  (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null ) -
                  (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id ) -
                  (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
                ) > 0
              )
    into :opr_id,
         :ord_id,
         :ord_number,
         :ord_date,
         :prd_id,
         :opr_count_executed
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_REST_OPR_FOR_DLR (DLR_ID INTEGER,
USR_ID INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
CTR_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SELLER SMALLINT,
SPECIFICATION_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACT_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACTOR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
begin
  if ( dlr_id is null ) then
  begin
    dlr_id = -1;
  end

  for
    select opr_id,
           ord.ord_id as ord_id,
           ord_number,
           ord_date,
           prd_id,
           (
             (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ) -
             (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and ( drp.dlr_id != :dlr_id or ( drp.dlr_id = :dlr_id and (select drp_id from DCL_OCCUPIED_DLR_PRODUCE_V where drp_id = drp.drp_id) is not null) ) and dlr.dlr_annul is null ) -
             (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id ) -
             (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id ) -
             (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
           ),
           (select ctn_number from dcl_catalog_number ctn where ctn.prd_id = opr.prd_id and ctn.stf_id = ord.stf_id),
           sln_id
    from dcl_ord_list_produce opr,
         dcl_order ord
    where ord.ord_id = opr.ord_id
          and (ord.usr_id_create = :usr_id or :usr_id = -1 )
          and ord.ord_all_include_in_spec is null
          and opr.opr_use_prev_number is null
          and opr.prd_id is not null
          and (
                ( (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ) -
                  (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and ( drp.dlr_id != :dlr_id or ( drp.dlr_id = :dlr_id and (select drp_id from DCL_OCCUPIED_DLR_PRODUCE_V where drp_id = drp.drp_id) is not null) ) and dlr.dlr_annul is null ) -
                  (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id ) -
                  (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id ) -
                  (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
                ) > 0
              )
    into :opr_id,
         :ord_id,
         :ord_number,
         :ord_date,
         :prd_id,
         :opr_count_executed,
         :ctn_number,
         :seller
  do
  begin
    select contractors from dcl_get_contractor_for_for_ord(:ord_id, ', ') into :ctr_name;
    select specification_number, contract_number , contractor_name from  dcl_get_rest_info_from_order(:opr_id) into :specification_number, :contract_number , :contractor_name;
    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_REST_OPR_FOR_PRC (PRC_ID INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
CTR_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SELLER SMALLINT)
AS 
begin
  if ( prc_id is null ) then
  begin
    prc_id = -1;
  end

  for
    select opr.opr_id,
           ord.ord_id,
           ord.ord_number,
           ord.ord_date,
           opr.prd_id,
           (
             (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ) -
             (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id and ( lpc.prc_id != :prc_id or ( lpc.prc_id = :prc_id and (select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = lpc.lpc_id) is not null) ) ) -
             (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null ) -
             (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id ) -
             (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
           ),
           (select ctn_number from dcl_catalog_number ctn where ctn.prd_id = opr.prd_id and ctn.stf_id = ord.stf_id),
           sln_id
    from dcl_ord_list_produce opr,
         dcl_order ord
    where ord.ord_id = opr.ord_id
          and ord.ord_all_include_in_spec is null
          and opr.opr_use_prev_number is null
          and opr.prd_id is not null
          and (
                ( (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ) -
                  (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id and ( lpc.prc_id != :prc_id or ( lpc.prc_id = :prc_id and (select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = lpc.lpc_id) is not null) ) ) -
                  (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null ) -
                  (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id ) -
                  (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
                ) > 0
              )
    into :opr_id,
         :ord_id,
         :ord_number,
         :ord_date,
         :prd_id,
         :opr_count_executed,
         :ctn_number,
         :seller
  do
  begin
    select contractors from dcl_get_contractor_for_for_ord(:ord_id, ', ') into :ctr_name;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_REST_OPR_FOR_SPI (SPI_ID INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
CTR_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
SELLER SMALLINT,
GUARANTEE SMALLINT)
AS 
begin
  if ( spi_id is null ) then
  begin
    spi_id = -1; -- __'___'____??_____??_??__ ___??'"___>''__'<__ ID, ''.__ ___>'_ null __'__??____ ____'__??'''_ __'_'_______ sql
  end

  for
    select opr_id,
           ord.ord_id as ord_id,
           ord_number,
           ord_date,
           prd_id,
           (
             (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ) -
             (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id and ( sip.spi_id != :spi_id or ( sip.spi_id = :spi_id and (select sip_id from DCL_OCCUPIED_SPI_PRODUCE_V where sip_id = sip.sip_id) is not null) ) ) -
             (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null ) -
             (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id ) -
             (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
           ),
           sln_id,
           ord_by_guaranty
    from dcl_ord_list_produce opr,
         dcl_order ord
    where ord.ord_id = opr.ord_id
          and ord.ord_all_include_in_spec is not null
          and opr.opr_use_prev_number is null
          and opr.prd_id is not null
          and (
                ( (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ) -
                  (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id and ( sip.spi_id != :spi_id or ( sip.spi_id = :spi_id and (select sip_id from DCL_OCCUPIED_SPI_PRODUCE_V where sip_id = sip.sip_id) is not null) ) ) -
                  (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null ) -
                  (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id ) -
                  (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
                ) > 0
              )
    into :opr_id,
         :ord_id,
         :ord_number,
         :ord_date,
         :prd_id,
         :opr_count_executed,
         :seller,
         :guarantee
  do
  begin
    select contractors from dcl_get_contractor_for_for_ord(:ord_id, ', ') into :ctr_name;

    suspend;
  end

end ^

ALTER PROCEDURE DCL_GET_REST_SIP_FOR_DLR (DLR_ID INTEGER)
RETURNS (SIP_ID INTEGER,
SPI_ID INTEGER,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
PRD_ID INTEGER,
SIP_COUNT DECIMAL(15, 2))
AS 
begin
  if ( dlr_id is null ) then
  begin
    dlr_id = -1; -- __'__??'____??_??___??_??__ ___??'"___>''__'<_?? ID, ''.__ ___>'_ null __'__??____ ___??'__??'''_ __'_'______?? sql
  end

  for
    select sip_id,
           spi.spi_id as spi_id,
           spi_number,
           spi_date,
           prd_id,
           (
             sip_count -
             (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.sip_id = sip.sip_id and dlr.dlr_id = drp.dlr_id and drp.dlr_id != :dlr_id and dlr.dlr_annul is null ) -
             (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.sip_id = sip.sip_id )
           ) as sip_count
    from dcl_spi_list_produce sip,
         dcl_specification_import spi
    where spi.spi_id = sip.spi_id
          and sip.prd_id is not null
          and (
                (
                  sip_count -
                  (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.sip_id = sip.sip_id and dlr.dlr_id = drp.dlr_id and drp.dlr_id != :dlr_id and dlr.dlr_annul is null ) -
                  (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.sip_id = sip.sip_id )
                ) > 0
              )
    into :sip_id,
         :spi_id,
         :spi_number,
         :spi_date,
         :prd_id,
         :sip_count
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_REST_SIP_FOR_PRC (PRC_ID INTEGER)
RETURNS (SIP_ID INTEGER,
SPI_ID INTEGER,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
PRD_ID INTEGER,
SIP_COUNT DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare variable CUS_CODE varchar(10);
declare variable DRP_ID integer;
declare variable OPR_ID integer;
begin
  if ( prc_id is null ) then
  begin
    prc_id = -1;
  end

  for
    select sip_id,
           sip.drp_id,
           sip.opr_id,
           spi.spi_id,
           spi_number,
           spi_date,
           prd_id,
           (
             sip_count -
             (
               select coalesce(sum(lpc.lpc_count), 0)
               from dcl_prc_list_produce lpc
               where lpc.sip_id = sip.sip_id and
                     (
                       lpc.prc_id != :prc_id or
                       (
                         lpc.prc_id = :prc_id and
                         ( select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = lpc.lpc_id ) is not null
                       )
                     )
             )
           ),
           (
             select
               ctn_number
             from
               dcl_catalog_number ctn,
               dcl_dlr_list_produce drp
             where
               ctn.prd_id = sip.prd_id and
               ctn.stf_id = drp.stf_id and
               drp.drp_id = sip.drp_id
           ),
           (
             select
               cus.cus_code
             from
               dcl_custom_code cus,
               dcl_produce prd
             where
               prd.prd_id = sip.prd_id and
               cus.cus_code = prd.cus_code and
               cus.cus_instant = (
                                   select max(cus1.cus_instant)
                                   from dcl_custom_code cus1
                                   where
                                     cus1.cus_code = cus.cus_code and
                                     cus.cus_instant <= spi.spi_date
                                 )
           )
    from dcl_spi_list_produce sip,
         dcl_specification_import spi
    where spi.spi_id = sip.spi_id
          and spi.spi_arrive is not null
          and sip.prd_id is not null
          and (
                (
                  sip_count -
                  (
                    select coalesce(sum(lpc.lpc_count), 0)
                    from dcl_prc_list_produce lpc
                    where lpc.sip_id = sip.sip_id and
                          (
                            lpc.prc_id != :prc_id or
                            (
                              lpc.prc_id = :prc_id and
                              ( select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = lpc.lpc_id ) is not null
                            )
                          )
                  )
                ) > 0
              )
    order by spi.spi_date descending, spi.spi_id, 10, sip.sip_id
    into :sip_id,
         :drp_id,
         :opr_id,
         :spi_id,
         :spi_number,
         :spi_date,
         :prd_id,
         :sip_count,
         :ctn_number,
         :cus_code
  do
  begin
    if ( drp_id is not null ) then
    begin
      select
        ctn_number
      from
        dcl_catalog_number ctn,
        dcl_dlr_list_produce drp
      where
        drp.drp_id = :drp_id and
        ctn.prd_id = :prd_id and
        ctn.stf_id = drp.stf_id
      into :ctn_number;
    end
    if ( opr_id is not null ) then
    begin
      select
        ctn_number
      from
        dcl_catalog_number ctn,
        dcl_ord_list_produce opr,
        dcl_order ord
      where
        opr.opr_id = :opr_id and
        ord.ord_id = opr.ord_id and
        ctn.prd_id = :prd_id and
        ctn.stf_id = ord.stf_id
      into :ctn_number;
    end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_ROW_SUM (SUM_PAY_CLOSED DECIMAL(15, 2),
SUMM_PLUS_NDS DECIMAL(15, 2),
SUMM_ALL DECIMAL(15, 2))
RETURNS (SUMM_ROW DECIMAL(15, 2))
AS 
declare variable summ_row_f float;
begin
  if ( sum_pay_closed != 0 ) then
  begin
    summ_row_f = summ_all * summ_plus_nds / sum_pay_closed;
  end
  else
  begin
    summ_row_f = 0;
  end

  summ_row = summ_row_f;

  suspend;
end ^

ALTER PROCEDURE DCL_GET_ROW_SUMM_EUR (LCC_ID INTEGER,
SUMM_PLUS_NDS FLOAT)
RETURNS (SUMM_EUR DECIMAL(15, 2))
AS 
declare variable EUR decimal(15,2);
declare variable SUMM decimal(15,2);
declare variable SUMM_EUR_F float;
begin
  select sum(pls.lps_summ_eur), sum(pls.lps_summ)
  from dcl_pay_list_summ pls,
       dcl_ctc_pay ctc_pay
  where ctc_pay.lcc_id = :lcc_id and
        pls.lps_id = ctc_pay.lps_id
  into :eur, :summ;

  if ( summ != 0 ) then
  begin
    summ_eur_f = eur * summ_plus_nds / summ;
  end
  else
  begin
    summ_eur_f = 0;
  end

  summ_eur = summ_eur_f;

  suspend;
end ^

ALTER PROCEDURE DCL_GET_ROW_SUMM_OUT_NDS (SUMM_EUR_ROW DECIMAL(15, 2),
NDS_RATE DECIMAL(15, 2))
RETURNS (SUMM_OUT_NDS DECIMAL(15, 2))
AS 
declare variable summ_out_nds_f float;
begin
  summ_out_nds_f = summ_eur_row  * 100 / ( 100 + nds_rate );

  summ_out_nds = summ_out_nds_f;

  suspend;
end ^

ALTER PROCEDURE DCL_GET_SPC_PAY_EXPIRATION (SPC_ID INTEGER)
RETURNS (SPC_PAY_EXPIRATION INTEGER)
AS 
declare variable SPP_DATE date;
declare variable PAY_SUM decimal(15,2);
declare variable SPP_SUM decimal(15,2);
declare variable SPP_SUM_ALL decimal(15,2);
declare variable LAST_PAY_DATE date;
declare variable LAST_GRAPHIC_DATE date;
begin
  spc_pay_expiration = 0;

  select coalesce(sum(psum.lps_summ), 0)
  from
    dcl_payment pay,
    dcl_pay_list_summ psum
  where
    psum.spc_id = :spc_id and
    pay.pay_id = psum.pay_id
  into :pay_sum;

  spp_sum_all = 0;
  for
    select spp_sum,
           spp_date
    from dcl_spc_list_payment
    where spc_id = :spc_id and
          (spp_date < (select cast('NOW' as date) from rdb$database) or spp_date is null )
    order by spp_id
    into :spp_sum,
         :spp_date
  do
  begin
    spp_sum_all = spp_sum_all + spp_sum;
    if ( spp_sum_all > pay_sum and spp_date is not null) then
    begin
      select count_day from dcl_get_count_day((select cast('NOW' as date) from rdb$database), :spp_date) into :spc_pay_expiration;

      suspend;
      exit;
    end
  end

  select coalesce(sum(spp_sum), 0)
  from dcl_spc_list_payment
  where spc_id = :spc_id
  into :spp_sum;

  if ( spp_sum_all = pay_sum ) then -- all paied
  begin
    select max(pay.pay_date)
    from
      dcl_payment pay,
      dcl_pay_list_summ psum
    where
      psum.spc_id = :spc_id and
      pay.pay_id = psum.pay_id
    into :last_pay_date;

    select max(spp_date)
    from dcl_spc_list_payment
    where spc_id = :spc_id
    into :last_graphic_date;

    if ( last_graphic_date < last_pay_date ) then
    begin
      select count_day from dcl_get_count_day(:last_pay_date, :last_graphic_date) into :spc_pay_expiration;
      suspend;
    end
  end

end ^

ALTER PROCEDURE DCL_GET_SPI_LIST_FOR_ORD (ORD_ID INTEGER)
RETURNS (SPECIFICATIONS_IMPORT VARCHAR(2500) CHARACTER SET UNICODE_FSS)
AS 
declare variable SPI_NUM_DATE varchar(130);
declare variable SPI_DATE integer;
declare variable SPI_NUMBER varchar(100);
begin
  specifications_import = '';

  for
    select distinct spi_number, spi_date
    from dcl_get_spi_num_date_for_ord(:ord_id)
    into :spi_number,
         :spi_date
  do
  begin
    select strdate from date2str(:spi_date) into :spi_num_date;
    spi_num_date = spi_number || 'from' || :spi_num_date;

    specifications_import = specifications_import || spi_num_date || ', ';
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_SPI_NUM_DATE_FOR_DRP (DRP_ID INTEGER)
RETURNS (SPI_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_SEND_DATE DATE,
SIP_ID INTEGER)
AS 
begin
  for
    select
      spi_date,
      spi_number,
      spi_send_date,
      sip_id
    from
      dcl_specification_import spi,
      dcl_spi_list_produce sip
    where   sip.spi_id = spi.spi_id and
            sip.drp_id = :drp_id
    into
      :spi_date,
      :spi_number,
      :spi_send_date,
      :sip_id
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_SPI_NUM_DATE_FOR_ORD (ORD_ID INTEGER)
RETURNS (SPI_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_SEND_DATE DATE,
SIP_ID INTEGER)
AS 
declare variable OPR_ID integer;
declare variable DRP_ID integer;
declare variable APR_ID integer;
declare variable ASM_ID integer;
begin
  for 
    select opr_id
    from dcl_ord_list_produce
    where ord_id = :ord_id
    into :opr_id
  do
  begin
    for
      select
        spi_date,
        spi_number,
        spi_send_date,
        sip_id
      from
        dcl_specification_import spi,
        dcl_spi_list_produce sip
      where   sip.spi_id = spi.spi_id and
              sip.opr_id = :opr_id
      into
        :spi_date,
        :spi_number,
        :spi_send_date,
        :sip_id
    do
    begin
      suspend;
    end

    for
      select drp_id
      from dcl_dlr_list_produce drp
      where drp.opr_id = :opr_id
      into :drp_id
    do
    begin
      for
        select
          spi_date,
          spi_number,
          spi_send_date,
          sip_id
        from dcl_get_spi_num_date_for_drp(:drp_id)
        into
          :spi_date,
          :spi_number,
          :spi_send_date,
          :sip_id
      do
      begin
        suspend;
      end
    end

    for
      select apr_id
      from dcl_asm_list_produce apr
      where apr.opr_id = :opr_id
      into :apr_id
    do
    begin
      for
        select drp_id
        from dcl_dlr_list_produce drp
        where drp.apr_id = :apr_id
        into :drp_id
      do
      begin
        for
          select
            spi_date,
            spi_number,
            spi_send_date,
            sip_id
          from dcl_get_spi_num_date_for_drp(:drp_id)
          into
            :spi_date,
            :spi_number,
            :spi_send_date,
            :sip_id
        do
        begin
          suspend;
        end
      end
    end

    for
      select asm_id
      from dcl_assemble asm
      where asm.opr_id = :opr_id
      into :asm_id
    do
    begin
      for
        select drp_id
        from dcl_dlr_list_produce drp
        where drp.apr_id = :asm_id
        into :drp_id
      do
      begin
        for
          select
            spi_date,
            spi_number,
            spi_send_date,
            sip_id
          from dcl_get_spi_num_date_for_drp(:drp_id)
          into
            :spi_date,
            :spi_number,
            :spi_send_date,
            :sip_id
        do
        begin
          suspend;
        end
      end
    end

  end
end ^

ALTER PROCEDURE DCL_GET_SUM_OUT_NDS_EUR (SPC_ID INTEGER)
RETURNS (SUM_OUT_NDS_EUR DECIMAL(15, 2))
AS 
DECLARE VARIABLE LPS_SUMM_EUR DECIMAL(15,2);
DECLARE VARIABLE LPS_SUMM DECIMAL(15,2);
DECLARE VARIABLE SHP_SUMM_PLUS_NDS DECIMAL(15,2);
DECLARE VARIABLE SPC_NDS_RATE DECIMAL(15,2);
DECLARE VARIABLE SUM_OUT_NDS_EUR_F FLOAT;
begin
  /* Procedure Text */

  select sum(pls.lps_summ_eur), sum(pls.lps_summ)
  from dcl_pay_list_summ pls
  where pls.spc_id = :spc_id
  into :lps_summ_eur, :lps_summ;

  select sum(shp.shp_summ_plus_nds)
  from dcl_shipping shp
  where shp.spc_id = :spc_id
  into :shp_summ_plus_nds;

  select spc.spc_nds_rate
  from dcl_con_list_spec spc
  where spc.spc_id = :spc_id
  into :spc_nds_rate;

  sum_out_nds_eur_f = :shp_summ_plus_nds / :lps_summ * :lps_summ_eur * 100  / (100 + :spc_nds_rate);

  sum_out_nds_eur = sum_out_nds_eur_f;

  suspend;
end ^

ALTER PROCEDURE DCL_GET_SUM_OUT_NDS_EUR_PART (SPC_ID INTEGER,
PAY_IDS VARCHAR(5000) CHARACTER SET UNICODE_FSS,
SHP_IDS VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (SUM_OUT_NDS_EUR DECIMAL(15, 2))
AS 
declare variable lps_summ_eur decimal(15,2);
declare variable lps_summ decimal(15,2);
declare variable shp_summ_plus_nds decimal(15,2);
declare variable spc_nds_rate decimal(15,2);
declare variable sum_out_nds_eur_f float;
begin
  /* Procedure Text */

  select sum(pls.lps_summ_eur), sum(pls.lps_summ)
  from dcl_pay_list_summ pls
  where pls.spc_id = :spc_id and
        not exists ( select int_id from dcl_decode_id_list(:pay_ids) where int_id = pls.pay_id )
  into :lps_summ_eur, :lps_summ;

  select sum(shp.shp_summ_plus_nds)
  from dcl_shipping shp
  where shp.spc_id = :spc_id  and
        not exists ( select int_id from dcl_decode_id_list(:shp_ids) where int_id = shp.shp_id )
  into :shp_summ_plus_nds;

  select spc.spc_nds_rate
  from dcl_con_list_spec spc
  where spc.spc_id = :spc_id
  into :spc_nds_rate;

  sum_out_nds_eur_f = :shp_summ_plus_nds / :lps_summ * :lps_summ_eur * 100  / (100 + :spc_nds_rate);

  sum_out_nds_eur = sum_out_nds_eur_f;

  suspend;
end ^

ALTER PROCEDURE DCL_GET_TIMESTAMP_BREAKDOWN (PAR_DATE1 TIMESTAMP,
PAR_DATE2 TIMESTAMP,
PAR_INTERVAL VARCHAR(32) CHARACTER SET UNICODE_FSS)
RETURNS (X_VALUE VARCHAR(40) CHARACTER SET UNICODE_FSS,
T_BEGIN TIMESTAMP,
T_END TIMESTAMP)
AS 
DECLARE VARIABLE I_YEAR INTEGER;
DECLARE VARIABLE I_YEAR1 INTEGER;
DECLARE VARIABLE I_YEAR2 INTEGER;
DECLARE VARIABLE I_MONTH INTEGER;
DECLARE VARIABLE I_MONTH1 INTEGER;
DECLARE VARIABLE I_MONTH2 INTEGER;
DECLARE VARIABLE I_COUNT INTEGER;
DECLARE VARIABLE D_DATE TIMESTAMP;
begin
  if ((:PAR_DATE1 is null) or (:PAR_DATE2 is null)) then exit;
  if (:PAR_DATE1 > :PAR_DATE2) then exit;
  if (:PAR_INTERVAL is null) then exit;
  if (not ((upper(:PAR_INTERVAL) = 'YEAR') or (upper(:PAR_INTERVAL) = 'MONTH') or (upper(:PAR_INTERVAL) = 'WEEK') or (upper(:PAR_INTERVAL) = 'DAY') or (upper(:PAR_INTERVAL) = 'TWODAYS') or (upper(:PAR_INTERVAL) = 'THREEDAYS') or (upper(:PAR_INTERVAL) = 'THREEHOURS') or (upper(:PAR_INTERVAL) = 'SIXHOURS') or (upper(:PAR_INTERVAL) = 'TWELVEHOURS'))) then exit;


  -- Breakdown by YEAR
  if (upper(:PAR_INTERVAL) = 'YEAR') then
  begin
    -- Date sample is '2004-05-19 10:30:04.0000'
    I_YEAR1 = SUBSTR(:PAR_DATE1, 1, 4);
    I_YEAR2 = SUBSTR(:PAR_DATE2, 1, 4);
    I_YEAR = I_YEAR1;
    while (I_YEAR <= I_YEAR2) do
    begin
      X_VALUE = I_YEAR;
      T_BEGIN = cast(('01.' || '01.' || I_YEAR) as timestamp);
      T_END = ADDYEAR(T_BEGIN, 1);

      -- begin of the period
      if (I_YEAR = I_YEAR1)
      then
        T_BEGIN = PAR_DATE1;

      T_END = ADDSECOND(T_END, -1);

      -- end of the period
      if (I_YEAR = I_YEAR2)
      then
          T_END = PAR_DATE2;

      I_YEAR = I_YEAR + 1;
      suspend;
    end
  end

  -- Breakdown by MONTH
  if (upper(:PAR_INTERVAL) = 'MONTH') then
  begin
    -- Date sample is '2004-05-19 10:30:04.0000'
    I_YEAR1 = SUBSTR(:PAR_DATE1, 1, 4);
    I_YEAR2 = SUBSTR(:PAR_DATE2, 1, 4);
    I_YEAR = I_YEAR1;
  
    I_MONTH1 = SUBSTR(:PAR_DATE1, 6, 7);
    I_MONTH2 = SUBSTR(:PAR_DATE2, 6, 7);
    I_MONTH = I_MONTH1;
  
    I_COUNT = 0;
  
    while (I_YEAR <= I_YEAR2) do
    begin
      while (((I_YEAR < I_YEAR2) and (I_MONTH <= 12)) or ((I_YEAR = I_YEAR2) and (I_MONTH <= I_MONTH2))) do
      begin
        if (I_MONTH < 10)
        then
          X_VALUE = '0' || I_MONTH || '.' || I_YEAR;
        else
          X_VALUE = I_MONTH || '.' || I_YEAR;
  
        T_BEGIN = cast(('01.' || I_MONTH || '.' || I_YEAR) as timestamp);
        T_END = ADDMONTH(T_BEGIN, 1);

        -- begin of the period
        if ((I_MONTH = I_MONTH1) and (I_YEAR = I_YEAR1))
        then
          T_BEGIN = PAR_DATE1;

        T_END = ADDSECOND(T_END, -1);

        -- end of the period
        if ((I_MONTH = I_MONTH2) and (I_YEAR = I_YEAR2))
        then
          T_END = PAR_DATE2;
  
        I_MONTH = I_MONTH + 1;
        suspend;
      end
      I_YEAR = I_YEAR + 1;
      I_MONTH = 1;
    end
  end

  -- Breakdown by WEEK

  if (upper(:PAR_INTERVAL) = 'WEEK') then
  begin
    T_BEGIN = PAR_DATE1;
    T_END = PAR_DATE1;

    while (T_BEGIN <= PAR_DATE2) do
    begin
      if (T_BEGIN = PAR_DATE1) then
      begin
        select T_BEGIN_OF_NEXT_WEEK from DCL_BEGIN_OF_NEXT_WEEK(:T_BEGIN) into :T_END;
        T_END = ADDSECOND(T_END, -1);
      end

      select WEEK_NO from DCL_YEARWEEK(:T_BEGIN) into :X_VALUE;
      suspend;
      T_BEGIN = ADDSECOND(T_END, 1);
      T_END = ADDSECOND(ADDWEEK(T_BEGIN, 1), -1);

      if (T_END > PAR_DATE2) then T_END = PAR_DATE2;
    end
  end

  -- Breakdown by DAY
  if (upper(:PAR_INTERVAL) = 'DAY') then
  begin
    T_BEGIN = PAR_DATE1;
    T_END = PAR_DATE1;

    while (T_END < PAR_DATE2) do
    begin
      D_DATE = T_BEGIN;
      X_VALUE = D_DATE;

      if (T_BEGIN = PAR_DATE1) then
      begin
        D_DATE = ADDDAY(D_DATE, 1);
        T_END = ADDSECOND(D_DATE, -1);
      end

      suspend;
      T_BEGIN = ADDSECOND(T_END, 1);
      T_END = ADDSECOND(ADDDAY(T_BEGIN, 1), -1);

      if (T_END > PAR_DATE2) then T_END = PAR_DATE2;
    end
  end

  -- Breakdown by TWO DAYS
  IF (UPPER(:PAR_INTERVAL) = 'TWODAYS') THEN
  BEGIN
    T_BEGIN = PAR_DATE1;
    T_END = PAR_DATE1;

    WHILE (T_END < PAR_DATE2) DO
    BEGIN
      D_DATE = T_BEGIN;
      X_VALUE = D_DATE;

      IF (T_BEGIN = PAR_DATE1) THEN
      BEGIN
        D_DATE = ADDDAY(D_DATE, 2);
        T_END = ADDSECOND(D_DATE, -1);
      END

      SUSPEND;
      T_BEGIN = ADDSECOND(T_END, 1);
      T_END = ADDSECOND(ADDDAY(T_BEGIN, 2), -1);

      IF (T_END > PAR_DATE2) THEN
      BEGIN
        T_END = PAR_DATE2;
        D_DATE = T_BEGIN;
        X_VALUE = D_DATE;
        SUSPEND;
      END
    END
  END

  -- Breakdown by THREE DAYS
  IF (UPPER(:PAR_INTERVAL) = 'THREEDAYS') THEN
  BEGIN
    T_BEGIN = PAR_DATE1;
    T_END = PAR_DATE1;

    WHILE (T_END < PAR_DATE2) DO
    BEGIN
      D_DATE = T_BEGIN;
      X_VALUE = D_DATE;

      IF (T_BEGIN = PAR_DATE1) THEN
      BEGIN
        D_DATE = ADDDAY(D_DATE, 3);
        T_END = ADDSECOND(D_DATE, -1);
      END

      SUSPEND;
      T_BEGIN = ADDSECOND(T_END, 1);
      T_END = ADDSECOND(ADDDAY(T_BEGIN, 3), -1);

      IF (T_END > PAR_DATE2) THEN
      BEGIN
        T_END = PAR_DATE2;
        D_DATE = T_BEGIN;
        X_VALUE = D_DATE;
        SUSPEND;
      END
    END
  END


  -- Breakdown by THREEHOURS
  if (upper(:PAR_INTERVAL) = 'THREEHOURS') then
  begin
    T_BEGIN = PAR_DATE1;
    T_END = PAR_DATE1;

    while (T_END <= PAR_DATE2) do
    begin
      D_DATE = T_BEGIN;
      X_VALUE = D_DATE;

      if (T_BEGIN = PAR_DATE1) then
      begin
        D_DATE = ADDHOUR(D_DATE, 3);
        T_END = ADDSECOND(D_DATE, -1);
      end

      suspend;
      T_BEGIN = ADDSECOND(T_END, 1);
      T_END = ADDSECOND(addhour(T_BEGIN, 3), -1);
    end
  end

  -- Breakdown by SIXHOURS
  if (upper(:PAR_INTERVAL) = 'SIXHOURS') then
  begin
    T_BEGIN = PAR_DATE1;
    T_END = PAR_DATE1;

    while (T_END <= PAR_DATE2) do
    begin
      D_DATE = T_BEGIN;
      X_VALUE = D_DATE;

      if (T_BEGIN = PAR_DATE1) then
      begin
        D_DATE = ADDHOUR(D_DATE, 6);
        T_END = ADDSECOND(D_DATE, -1);
      end

      suspend;
      T_BEGIN = ADDSECOND(T_END, 1);
      T_END = ADDSECOND(addhour(T_BEGIN, 6), -1);
    end
  end

  -- Breakdown by TWELVEHOURS
  if (upper(:PAR_INTERVAL) = 'TWELVEHOURS') then
  begin
    T_BEGIN = PAR_DATE1;
    T_END = PAR_DATE1;

    while (T_END <= PAR_DATE2) do
    begin
      D_DATE = T_BEGIN;
      X_VALUE = D_DATE;

      if (T_BEGIN = PAR_DATE1) then
      begin
        D_DATE = ADDHOUR(D_DATE, 12);
        T_END = ADDSECOND(D_DATE, -1);
      end

      suspend;
      T_BEGIN = ADDSECOND(T_END, 1);
      T_END = ADDSECOND(ADDHOUR(T_BEGIN, 12), -1);
    end
  end

end ^

ALTER PROCEDURE DCL_GET_TREE (CAT_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_NAME_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
PRD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CUS_CODE_IN VARCHAR(10) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
NOT_BLOCKED SMALLINT,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS)
RETURNS (CAT_ID INTEGER,
CAT_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
PARENT_ID INTEGER,
IS_HAVE_PRODUCES SMALLINT,
IS_HAVE_SUBFOLDERS SMALLINT,
PRD_COUNT INTEGER)
AS 
declare variable cat_name_fake varchar(100);
begin
  for
    select
      cat_id,
      cat_name,
      parent_id,
      upper(cat.cat_name) as cat_name_sort
    from
      dcl_category cat
    order by parent_id, cat_name_sort
    into :cat_id,
         :cat_name,
         :parent_id,
         :cat_name_fake
  do
  begin
      select sum(is_have_produces),
             sum(is_have_subfolders),
             sum(prd_count)
      from DCL_GET_CATEGORIES_FOR_TREE(:cat_id, :cat_name_in, :prd_name_in, :prd_type_in, :prd_params_in, :prd_add_params_in, :stf_id_in, :cus_code_in, :ctn_number_in, :not_blocked, :prd_common_in)
      into :is_have_produces,
           :is_have_subfolders,
           :prd_count;
      suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_USER_FOR_CONTRACT (CON_ID INTEGER)
RETURNS (USR_ID INTEGER,
CON_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER)
AS 
begin
  for
    select
      distinct
        usr_id,
        (select usr_surname || ' ' || usr_name from dcl_user_language where usr_id = spc.usr_id and lng_id = 1)
    from dcl_con_list_spec spc
    where con_id = :con_id and usr_id is not null
    into :usr_id,
         :con_user
  do
  begin
    dep_id = null;
    if ( usr_id is not null ) then
    begin
      select dep_id from dcl_user where usr_id = :usr_id into :dep_id;
    end
    suspend;
  end
end ^

ALTER PROCEDURE DCL_GET_USR_DEP_LIST_CON (CON_ID INTEGER)
RETURNS (CON_USER VARCHAR(1000) CHARACTER SET UNICODE_FSS,
USR_ID_LIST VARCHAR(200) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
declare variable CON_USER_LOCAL varchar(50);
declare variable USR_ID_LOCAL integer;
declare variable DEP_ID_LOCAL integer;
begin
  con_user = '';
  usr_id_list = '';
  dep_id_list = '';
  for
    select usr_id,
           con_user,
           dep_id
    from dcl_get_user_for_contract(:con_id)
    into :usr_id_local,
         :con_user_local,
         :dep_id_local
  do
  begin
    usr_id_list = usr_id_list || usr_id_local || '<br>';
    con_user = con_user || con_user_local || '<br>';
    if ( dep_id_local is not null ) then
    begin
      dep_id_list = dep_id_list || dep_id_local || '<br>';
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GET_USR_FOR_SPEC_IMP (SPI_ID INTEGER)
RETURNS (USERS VARCHAR(2000) CHARACTER SET UNICODE_FSS)
AS 
declare variable user_id integer;
declare variable usr_full_name varchar(50);
declare variable temp varchar(1950);
begin
    temp = '';
    select usr_surname || ' ' || usr_name from dcl_user_language where usr_id =(select usr_id_create from dcl_specification_import where spi_id=:spi_id) and lng_id = 1 into :users;
    for select o.usr_id_create from dcl_spi_list_produce sp
                               join dcl_ord_list_produce op on sp.opr_id=op.opr_id
                               join dcl_order o on op.ord_id=o.ord_id
                               where sp.spi_id=:spi_id into :user_id
    do
    begin
        select usr_surname || ' ' || usr_name from dcl_user_language where usr_id =:user_id and lng_id = 1 into :usr_full_name;
        if(position (usr_full_name, temp) = 0) then temp = :temp || usr_full_name || ', ';
    end
    for select d.usr_id_create from dcl_spi_list_produce sp
                               join dcl_dlr_list_produce dp on sp.drp_id=dp.drp_id
                               join dcl_delivery_request d on dp.dlr_id=d.dlr_id
                               where sp.spi_id=:spi_id into :user_id
    do
    begin
        select usr_surname || ' ' || usr_name from dcl_user_language  where usr_id =:user_id and lng_id = 1 into :usr_full_name;
        if(position (usr_full_name, temp) = 0) then temp = temp ||  usr_full_name || ', ';
    end
    if (char_length(temp) > 2 ) then
      begin
        temp = substring(temp from 1 for char_length(temp)-2);
        users = users || '/ ??????????????????: ' || temp;
      end
    suspend;
end ^

ALTER PROCEDURE DCL_GET_USR_ID_LIST_SHP (SHP_ID INTEGER,
SPC_ID INTEGER)
RETURNS (USR_ID_LIST VARCHAR(500) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST VARCHAR(500) CHARACTER SET UNICODE_FSS)
AS 
declare variable CON_ID integer;
declare variable USR_ID_LOCAL integer;
declare variable DEP_ID_LOCAL integer;
begin
  usr_id_list = '';
  dep_id_list = '';
  if ( spc_id is not null ) then
  begin
    select con_id from dcl_con_list_spec where spc_id = :spc_id into :con_id;
    for
      select usr_id,
             dep_id
      from dcl_get_user_for_contract(:con_id)
      into :usr_id_local,
           :dep_id_local
    do
    begin
      usr_id_list = usr_id_list || usr_id_local || '<br>';
      if (dep_id_local is not null) then
      begin
        dep_id_list = dep_id_list || dep_id_local || '<br>';
      end
    end
  end

  for
    select distinct lmn.usr_id
    from dcl_shp_list_produce lps,
         dcl_lps_list_manager lmn
    where lps.shp_id = :shp_id and
          lmn.lps_id = lps.lps_id
    into :usr_id_local
  do
  begin
    usr_id_list = usr_id_list || usr_id_local || '<br>';
    select dep_id from dcl_user where usr_id = :usr_id_local into :dep_id_local;
    if (dep_id_local is not null) then
    begin
      dep_id_list = dep_id_list || dep_id_local || '<br>';
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_GOODS_CIRCULATION (DATE_BEGIN DATE,
DATE_END DATE,
PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
SLN_ID_IN INTEGER,
CTR_ID_IN INTEGER)
RETURNS (LPS_ID INTEGER,
LPS_COUNT DECIMAL(15, 2),
PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
REST_IN_MINSK DECIMAL(15, 2),
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
UNIT VARCHAR(150) CHARACTER SET UNICODE_FSS,
CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
declare variable PRD_COMMON varchar(1700);
begin
  prd_common_in = upper(prd_common_in);

  for
    select lps.lps_id,
           lps.lps_count,
           shp.shp_date,
           lpc.prd_id,
           ctr.ctr_name,
           (
             select ctn.ctn_number
             from dcl_catalog_number ctn
             where ctn.stf_id = lpc.stf_id and
                   ctn.prd_id = lpc.prd_id
           ),
           stf.stf_id,
           stf.stf_name
      from dcl_shipping shp,
           dcl_contractor ctr,
           dcl_shp_list_produce lps,
           dcl_prc_list_produce lpc,
           dcl_stuff_category stf,
           dcl_con_list_spec spc,
           dcl_contract con
      where shp.shp_date >= :date_begin and
            shp.shp_date <= :date_end and
            lps.shp_id = shp.shp_id and
            lpc.lpc_id = lps.lpc_id and
            ctr.ctr_id = shp.ctr_id and
            stf.stf_id = lpc.stf_id and
            (:stf_id_in is null or :stf_id_in = -1 or stf.stf_id = :stf_id_in) and
            spc.spc_id = shp.spc_id and
            con.con_id = spc.con_id and
            (:sln_id_in is null or con.sln_id = :sln_id_in ) and
            (:ctr_id_in is null or :ctr_id_in = -1 or ctr.ctr_id = :ctr_id_in )
      into :lps_id,
           :lps_count,
           :shp_date,
           :prd_id,
           :contractor,
           :ctn_number,
           :stf_id,
           :stf_name
    do
    begin

      select
        prd.prd_name,
        prd.prd_type,
        prd.prd_params,
        prd.prd_add_params,
        unt.unt_name
      from  dcl_produce prd,
            dcl_unit_language unt
      where prd.prd_id = :prd_id and
            unt.unt_id = prd.unt_id and
            unt.lng_id = 1
      into
        :produce_name,
        :prd_type,
        :prd_params,
        :prd_add_params,
        :unit
      ;

      prd_common = upper(coalesce(:produce_name, '') || ' ' || coalesce(:prd_type, '') || ' ' || coalesce(:prd_params, '') || ' ' || coalesce(:prd_add_params, ''));
      if ( :prd_common_in is null or :prd_common_in like '' or :prd_common like('%' || :prd_common_in || '%') ) then
      begin
        select rest_in_minsk from dcl_get_circ_and_rest_for_prd(:prd_id) into :rest_in_minsk;

        suspend;
      end
    end
end ^

ALTER PROCEDURE DCL_GOODS_CIRCULATION_REST (PRD_COMMON_IN VARCHAR(1000) CHARACTER SET UNICODE_FSS,
STF_ID_IN INTEGER,
CTR_ID_FOR_IN INTEGER)
RETURNS (PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
UNIT VARCHAR(150) CHARACTER SET UNICODE_FSS,
CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
REST_IN_MINSK DECIMAL(15, 2))
AS 
declare variable PRD_COMMON varchar(1700);
declare variable ORD_IN_ONE_SPEC smallint;
declare variable ORD_CTR_ID_FOR integer;
declare variable OPR_CTR_ID_FOR integer;
begin
  prd_common_in = upper(prd_common_in);

  for
    select ord.stf_id,
           stf.stf_name,
           opr.prd_id,
           opr.ctr_id,
           ord.ord_date,
           ord.ord_in_one_spec,
           ord.ctr_id_for,
           (
             select ctn.ctn_number
             from dcl_catalog_number ctn
             where ctn.stf_id = ord.stf_id and
                   ctn.prd_id = opr.prd_id
           )
    from   dcl_order ord,
           dcl_ord_list_produce opr,
           dcl_stuff_category stf
    where  opr.ord_id = ord.ord_id and
           stf.stf_id = ord.stf_id and
           (:stf_id_in is null or :stf_id_in = -1 or stf.stf_id = :stf_id_in ) and
           (
             :ctr_id_for_in is null or
             :ctr_id_for_in = -1 or
             ( ord.ctr_id_for = :ctr_id_for_in and ord.ord_in_one_spec is not null ) or
             ( ord.ord_in_one_spec is null and (select count(opr_id) from dcl_ord_list_produce where ord_id = ord.ord_id and ctr_id = :ctr_id_for_in ) > 0 )
           ) and
           ord.ord_annul is null and
           opr.opr_count > 0
    into   :stf_id,
           :stf_name,
           :prd_id,
           :opr_ctr_id_for,
           :shp_date, --    
           :ord_in_one_spec,
           :ord_ctr_id_for,
           :ctn_number
  do
  begin
     select
        prd.prd_name,
        prd.prd_type,
        prd.prd_params,
        prd.prd_add_params,
        unt.unt_name
      from  dcl_produce prd,
            dcl_unit_language unt
      where prd.prd_id = :prd_id and
            unt.unt_id = prd.unt_id and
            unt.lng_id = 1
      into
        :produce_name,
        :prd_type,
        :prd_params,
        :prd_add_params,
        :unit
      ;

      prd_common = upper(coalesce(:produce_name, '') || ' ' || coalesce(:prd_type, '') || ' ' || coalesce(:prd_params, '') || ' ' || coalesce(:prd_add_params, ''));
      if ( :prd_common_in is null or :prd_common_in like '' or :prd_common like('%' || :prd_common_in || '%') ) then
      begin

        if (ord_in_one_spec is null) then
        begin
          select ctr_name from dcl_contractor where ctr_id = :opr_ctr_id_for into :contractor;
        end
        else
        begin
          select ctr_name from dcl_contractor where ctr_id = :ord_ctr_id_for into :contractor;
        end

        select rest_in_minsk from dcl_get_circ_and_rest_for_prd(:prd_id) into :rest_in_minsk;

        suspend;
      end
  end
end ^

ALTER PROCEDURE DCL_GOODS_REST (DATE_IN DATE,
USR_ID_IN INTEGER,
DEP_ID_IN INTEGER,
DATE_TO_IN DATE,
PURPOSE_ID_IN INTEGER,
STF_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
USR_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
UNIT VARCHAR(15) CHARACTER SET UNICODE_FSS,
LPC_COUNT DECIMAL(15, 2),
LPC_COUNT_FREE DECIMAL(15, 2),
PRC_DATE DATE,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
LESS_3_MONTH DECIMAL(15, 2),
MONTH_3_6 DECIMAL(15, 2),
MONTH_6_9 DECIMAL(15, 2),
MONTH_9_12 DECIMAL(15, 2),
MORE_12_MONTH DECIMAL(15, 2),
LPC_COUNT_FREE_TO DECIMAL(15, 2),
LESS_3_MONTH_TO DECIMAL(15, 2),
MONTH_3_6_TO DECIMAL(15, 2),
MONTH_6_9_TO DECIMAL(15, 2),
MONTH_9_12_TO DECIMAL(15, 2),
MORE_12_MONTH_TO DECIMAL(15, 2),
PURPOSE VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORDER_FOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
LPC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
DRP_PURPOSE VARCHAR(500) CHARACTER SET UNICODE_FSS,
PRODUCE_NAME_SORT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
STF_NAME_SORT VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
DLR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
declare variable NEED_SUSPEND integer;
declare variable SUM_EUR decimal(15,2);
declare variable SUM_EUR_TO decimal(15,2);
declare variable DRP_ID integer;
declare variable SUM_OTHER_CHARGES decimal(15,2);
declare variable LPC_COST_ONE decimal(15,2);
declare variable DATE_FOR_END_DATE date;
begin
  date_for_end_date = addday(:date_in, 1);
  if ( date_to_in is null ) then
  begin
    for
      select lpc.lpc_id,
             lpc.drp_id,
             prd.prd_id,
             prd.prd_name,
             prd.prd_type,
             prd.prd_params,
             prd.prd_add_params,
             stf.stf_name,
             (
                select ctn.ctn_number
                from dcl_catalog_number ctn
                where ctn.stf_id = lpc.stf_id and
                      ctn.prd_id = prd.prd_id
             ),
             usr.usr_id,
             usr_lng.usr_surname || ' ' || usr_lng.usr_name,
             lpc.dep_id,
             unt.unt_name,
             lpc.lpc_count,
             coalesce (lpc.lpc_count, 0) -
             (
               select  coalesce (sum(lps.lps_count), 0)
               from dcl_shp_list_produce lps
               where lps.lpc_id = lpc.lpc_id and
                     lps.shp_date <= :date_for_end_date
             ),
             prc.prc_date,
             prc.prc_number,
             lpc.lpc_sum_transport + lpc.lpc_custom,
             lpc.lpc_cost_one,
             lpc.lpc_1c_number,
             lpc.lpc_cost_one_by,
             lpc.lpc_price_list_by,
             lpc.lpc_comment,
             prs.prs_name
      from dcl_prc_list_produce lpc,
           dcl_produce_cost prc,
           dcl_stuff_category stf,
           dcl_user usr,
           dcl_user_language usr_lng,
           dcl_purpose prs,
           dcl_produce prd,
           dcl_unit_language unt
      where prc.prc_id = lpc.prc_id and
            stf.stf_id = lpc.stf_id and
            usr.usr_id = lpc.usr_id and
            usr_lng.usr_id = usr.usr_id and
            usr_lng.lng_id = 1 and
            prc.prc_date <= :date_for_end_date and
            (:purpose_id_in = -1 or :purpose_id_in = lpc.prs_id ) and
            prs.prs_id = lpc.prs_id and
            prd.prd_id = lpc.prd_id and
            unt.unt_id = prd.unt_id and
            unt.lng_id = 1 and
            (:usr_id_in is null or :usr_id_in = -1 or :usr_id_in = usr.usr_id ) and
            (:dep_id_in is null or :dep_id_in = -1 or :dep_id_in = lpc.dep_id ) and
            (:stf_id_in is null or :stf_id_in = -1 or :stf_id_in = stf.stf_id )
      order by prc.prc_date
      into :lpc_id,
           :drp_id,
           :prd_id,
           :produce_name,
           :prd_type,
           :prd_params,
           :prd_add_params,
           :stf_name,
           :ctn_number,
           :usr_id,
           :usr_name,
           :dep_id,
           :unit,
           :lpc_count,
           :lpc_count_free,
           :prc_date,
           :prc_number,
           :sum_other_charges,
           :lpc_cost_one,
           :lpc_1c_number,
           :lpc_cost_one_by,
           :lpc_price_list_by,
           :lpc_comment,
           :purpose
    do
    begin
      dep_name = null;
      if ( dep_id is not null ) then
      begin
        select dep_name from dcl_department where dep_id = :dep_id into :dep_name;
      end

      select ctr_name,
             spc_number,
             spc_date,
             con_number,
             con_date
      from get_contractor_for_for_lpc_id(:lpc_id)
      into :order_for,
           :spc_number,
           :spc_date,
           :con_number,
           :con_date;

      drp_purpose = null;
      dlr_comment = null;
      if ( drp_id is not null ) then
      begin
        select drp.drp_purpose from dcl_dlr_list_produce drp where drp.drp_id = :drp_id into :drp_purpose;

        select dlr.dlr_comment
        from dcl_delivery_request dlr,
             dcl_dlr_list_produce drp
        where dlr.dlr_id = drp.dlr_id and
              drp.drp_id = :drp_id
        into :dlr_comment;

      end

      lpc_count_free = coalesce (:lpc_count_free, 0);

      less_3_month = 0;
      month_3_6 = 0;
      month_6_9 = 0;
      month_9_12 = 0;
      more_12_month = 0;

      if ( lpc_count_free != 0 ) then
      begin
        if (prc_date < '2016-07-01') then
        begin
          lpc_cost_one_by = ROUND(lpc_cost_one_by / 100, 0) / 100;
          lpc_price_list_by = ROUND(lpc_price_list_by / 100, 0) / 100;
        end

        sum_eur = ( lpc_cost_one + sum_other_charges / lpc_count ) * lpc_count_free;

        if ( prc_date >= addday(date_in, -30 * 3) ) then
        begin
          less_3_month = sum_eur;
        end
        else
        begin
          if ( prc_date >= addday(date_in, -30 * 6) ) then
          begin
            month_3_6 = sum_eur;
          end
          else
          begin
            if ( prc_date >= addday(date_in, -30 * 9) ) then
            begin
              month_6_9 = sum_eur;
            end
            else
            begin
              if ( prc_date >= addday(date_in, -30 * 12) ) then
              begin
                month_9_12 = sum_eur;
              end
              else
              begin
                more_12_month = sum_eur;
              end
            end
          end
        end

        produce_name_sort = upper(produce_name || ' ' || prd_type || ' ' || prd_params || ' ' || prd_add_params);
        stf_name_sort = upper(stf_name);
        suspend;
      end

    end
  end
  else
  begin
    for
      select lpc.lpc_id,
             lpc.drp_id,
             prd.prd_id,
             prd.prd_name,
             prd.prd_type,
             prd.prd_params,
             prd.prd_add_params,
             stf.stf_name,
             (
                select ctn.ctn_number
                from dcl_catalog_number ctn
                where ctn.stf_id = lpc.stf_id and
                      ctn.prd_id = prd.prd_id
             ),
             usr.usr_id,
             usr_lng.usr_surname || ' ' || usr_lng.usr_name,
             lpc.dep_id,
             unt.unt_name,
             lpc.lpc_count,
             (
               select coalesce (lpc_count, 0)
               from dcl_prc_list_produce lpc1,
                    dcl_produce_cost prc1
                where lpc1.lpc_id = lpc.lpc_id and
                      prc1.prc_id = lpc1.prc_id and
                      prc1.prc_date <= :date_for_end_date
             )
             -
             (
               select  coalesce (sum(lps.lps_count), 0)
               from dcl_shp_list_produce lps
               where lps.lpc_id = lpc.lpc_id and
                     lps.shp_date <= :date_for_end_date
             ),
             coalesce (lpc_count, 0) -
             (
               select  coalesce (sum(lps.lps_count), 0)
               from dcl_shp_list_produce lps
               where lps.lpc_id = lpc.lpc_id and
                     lps.shp_date <= :date_to_in
             ),
             prc.prc_date,
             prc.prc_number,
             lpc.lpc_sum_transport + lpc.lpc_custom,
             lpc.lpc_cost_one,
             lpc.lpc_1c_number,
             lpc.lpc_cost_one_by,
             lpc.lpc_price_list_by,
             lpc.lpc_comment,
             prs.prs_name
      from dcl_prc_list_produce lpc,
           dcl_produce_cost prc,
           dcl_stuff_category stf,
           dcl_user usr,
           dcl_user_language usr_lng,
           dcl_purpose prs,
           dcl_produce prd,
           dcl_unit_language unt
      where prc.prc_id = lpc.prc_id and
            stf.stf_id = lpc.stf_id and
            usr.usr_id = lpc.usr_id and
            usr_lng.usr_id = usr.usr_id and
            usr_lng.lng_id = 1 and
            prc.prc_date <= :date_to_in and
            (:purpose_id_in = -1 or :purpose_id_in = lpc.prs_id ) and
            prs.prs_id = lpc.prs_id and
            prd.prd_id = lpc.prd_id and
            unt.unt_id = prd.unt_id and
            unt.lng_id = 1 and
            (:usr_id_in is null or :usr_id_in = -1 or :usr_id_in = usr.usr_id ) and
            (:dep_id_in is null or :dep_id_in = -1 or :dep_id_in = lpc.dep_id ) and
            (:stf_id_in is null or :stf_id_in = -1 or :stf_id_in = stf.stf_id )
      order by prc.prc_date
      into :lpc_id,
           :drp_id,
           :prd_id,
           :produce_name,
           :prd_type,
           :prd_params,
           :prd_add_params,
           :stf_name,
           :ctn_number,
           :usr_id,
           :usr_name,
           :dep_id,
           :unit,
           :lpc_count,
           :lpc_count_free,
           :lpc_count_free_to,
           :prc_date,
           :prc_number,
           :sum_other_charges,
           :lpc_cost_one,
           :lpc_1c_number,
           :lpc_cost_one_by,
           :lpc_price_list_by,
           :lpc_comment,
           :purpose
    do
    begin
      dep_name = null;
      if ( dep_id is not null ) then
      begin
        select dep_name from dcl_department where dep_id = :dep_id into :dep_name;
      end

      select ctr_name,
             spc_number,
             spc_date,
             con_number,
             con_date
      from get_contractor_for_for_lpc_id(:lpc_id)
      into :order_for,
           :spc_number,
           :spc_date,
           :con_number,
           :con_date;

      drp_purpose = null;
      dlr_comment = null;
      if ( drp_id is not null ) then
      begin
        select drp.drp_purpose from dcl_dlr_list_produce drp where drp.drp_id = :drp_id into :drp_purpose;

        select dlr.dlr_comment
        from dcl_delivery_request dlr,
             dcl_dlr_list_produce drp
        where dlr.dlr_id = drp.dlr_id and
              drp.drp_id = :drp_id
        into :dlr_comment;
      end

      lpc_count_free =  coalesce (:lpc_count_free, 0);
      lpc_count_free_to =  coalesce (:lpc_count_free_to, 0);

      need_suspend = 1;

      less_3_month = 0;
      month_3_6 = 0;
      month_6_9 = 0;
      month_9_12 = 0;
      more_12_month = 0;

      less_3_month_to = 0;
      month_3_6_to = 0;
      month_6_9_to = 0;
      month_9_12_to = 0;
      more_12_month_to = 0;

      if ( :lpc_count_free = 0 and :lpc_count_free_to = 0 ) then
      begin
        need_suspend = 0;
      end

      if ( need_suspend = 1 ) then
      begin
        if (prc_date < '2016-07-01') then
        begin
          lpc_cost_one_by = ROUND(lpc_cost_one_by / 100, 0) / 100;
          lpc_price_list_by = ROUND(lpc_price_list_by / 100, 0) / 100;
        end

        sum_eur = ( lpc_cost_one + sum_other_charges / lpc_count ) * lpc_count_free;
        sum_eur_to = ( lpc_cost_one + sum_other_charges / lpc_count ) * lpc_count_free_to;

        if ( prc_date <= date_for_end_date ) then
        begin
          if ( prc_date >= addday(date_in, -30 * 3) ) then
          begin
            less_3_month = sum_eur;
          end
          else
          begin
            if ( prc_date >= addday(date_in, -30 * 6) ) then
            begin
              month_3_6 = sum_eur;
            end
            else
            begin
              if ( prc_date >= addday(date_in, -30 * 9) ) then
              begin
                month_6_9 = sum_eur;
              end
              else
              begin
                if ( prc_date >= addday(date_in, -30 * 12) ) then
                begin
                  month_9_12 = sum_eur;
                end
                else
                begin
                  more_12_month = sum_eur;
                end
              end
            end
          end
        end

        if ( prc_date >= addday(date_to_in, -30 * 3) ) then
        begin
          less_3_month_to = sum_eur_to;
        end
        else
        begin
          if ( prc_date >= addday(date_to_in, -30 * 6) ) then
          begin
            month_3_6_to = sum_eur_to;
          end
          else
          begin
            if ( prc_date >= addday(date_to_in, -30 * 9) ) then
            begin
              month_6_9_to = sum_eur_to;
            end
            else
            begin
              if ( prc_date >= addday(date_to_in, -30 * 12) ) then
              begin
                month_9_12_to = sum_eur_to;
              end
              else
              begin
                more_12_month_to = sum_eur_to;
              end
            end
          end
        end

        produce_name_sort = upper(produce_name || ' ' || prd_type || ' ' || prd_params || ' ' || prd_add_params);
        stf_name_sort = upper(stf_name);
        suspend;
      end

    end
  end
end ^

ALTER PROCEDURE DCL_INSTRUCTION_FILTER (IST_ID INTEGER,
INS_NUMBER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
INS_DATE_BEGIN_IN DATE,
INS_DATE_END_IN DATE,
SHOW_ACTIVE SMALLINT,
INS_CONCERNING_IN VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (INS_ID INTEGER,
INS_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
INS_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
INS_DATE_SIGN DATE,
INS_DATE_FROM DATE,
INS_DATE_TO DATE,
INS_CONCERNING VARCHAR(5000) CHARACTER SET UNICODE_FSS,
INS_INACTIVE INTEGER,
ATTACH_IDX INTEGER)
AS 
declare variable ins_attach_count integer;
declare variable now_date date;
begin
  ins_number_in = upper(ins_number_in);
  ins_concerning_in = upper(ins_concerning_in);
  SELECT CAST('NOW' AS DATE) FROM RDB$DATABASE into :now_date;

  for
    select ins.ins_id,
           ins.ins_number,
           ins.ins_date_sign,
           ins.ins_date_from,
           ins.ins_date_to,
           ins.ins_concerning,
           ist.ist_name
    from dcl_instruction ins,
         dcl_instruction_type ist
    where
          ist.ist_id = ins.ist_id
     and  ( :ist_id is null or :ist_id = -1 or ist.ist_id = :ist_id )
     and  ( :ins_date_begin_in is null or ins_date_from >= :ins_date_begin_in )
     and  ( :ins_date_end_in is null or ins_date_to <= :ins_date_end_in )
     and  ( :ins_number_in is null or :ins_number_in like '' or upper(ins.ins_number) like('%' || :ins_number_in || '%') )
     and  ( :show_active is null or ins_date_to is null or :now_date < ins_date_to )
     and  ( :ins_concerning_in is null or :ins_concerning_in like '' or upper(ins.ins_concerning) like('%' || :ins_concerning_in || '%') )
    order by ins_date_from desc
    into  :ins_id,
          :ins_number,
          :ins_date_sign,
          :ins_date_from,
          :ins_date_to,
          :ins_concerning,
          :ins_type
  do
  begin
    select count(*) from dcl_attachment where att_parent_id = :ins_id and att_parent_table='DCL_INSTRUCTION' into :ins_attach_count;

    attach_idx = null;
    if ( ins_attach_count = 0 ) then
    begin
     attach_idx = 1;
    end
    if ( ins_attach_count > 0 ) then
    begin
     attach_idx = 6;
    end

    ins_inactive = null;
    if ( ins_date_to is not null and now_date >= ins_date_to ) then
    begin
      ins_inactive = 1;
    end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_INSTRUCTION_INSERT (IST_ID INTEGER,
INS_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
INS_DATE_SIGN DATE,
INS_DATE_FROM DATE,
INS_DATE_TO DATE,
INS_CONCERNING VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (INS_ID INTEGER)
AS 
begin

  insert into dcl_instruction (
     ist_id,
     ins_number,
     ins_date_sign,
     ins_date_from,
     ins_date_to,
     ins_concerning
    )
    values (
     :ist_id,
     :ins_number,
     :ins_date_sign,
     :ins_date_from,
     :ins_date_to,
     :ins_concerning
   )
   returning ins_id into :ins_id;

  suspend;
end ^

ALTER PROCEDURE DCL_INSTRUCTION_LOAD (INS_ID INTEGER)
RETURNS (USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
INS_CREATE_DATE TIMESTAMP,
INS_EDIT_DATE TIMESTAMP,
IST_ID INTEGER,
IST_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
INS_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
INS_DATE_SIGN DATE,
INS_DATE_FROM DATE,
INS_DATE_TO DATE,
INS_CONCERNING VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
begin
  select ins.usr_id_create,
         ins.usr_id_edit,
         ins.ins_create_date,
         ins.ins_edit_date,
         ins.ist_id,
         ist.ist_name,
         ins.ins_number,
         ins.ins_date_sign,
         ins.ins_date_from,
         ins.ins_date_to,
         ins.ins_concerning
  from   dcl_instruction ins,
         dcl_instruction_type ist
  where ins.ins_id = :ins_id and
        ist.ist_id = ins.ist_id
  into  :usr_id_create,
        :usr_id_edit,
        :ins_create_date,
        :ins_edit_date,
        :ist_id,
        :ist_name,
        :ins_number,
        :ins_date_sign,
        :ins_date_from,
        :ins_date_to,
        :ins_concerning
  ;

  suspend;
end ^

ALTER PROCEDURE DCL_IS_HAVE_EMPTY_DATE_CONF (ORD_ID INTEGER,
OPR_ID INTEGER,
ORD_DATE_CONF_ALL SMALLINT)
RETURNS (HAVE_EMPTY_DATE_CONF SMALLINT)
AS 
declare variable COUNT_ORD_PRD integer;
declare variable COUNT_ORD_PRD_IN_TERM_TBL integer;
begin
  have_empty_date_conf = null;

  if ( ord_date_conf_all is null ) then
  begin
    select coalesce(sum(opr.opr_count), 0)
    from dcl_ord_list_produce opr
    where opr.ord_id = :ord_id and
          opr.opr_id = coalesce(:opr_id, opr.opr_id)
    into :count_ord_prd;

    select coalesce(sum(ptr.ptr_count), 0)
    from dcl_ord_list_produce opr,
         dcl_production_term ptr
    where opr.ord_id = :ord_id and
          opr.opr_id = coalesce(:opr_id, opr.opr_id) and
          ptr.opr_id = opr.opr_id and
          ptr.ptr_date is not null
    into :count_ord_prd_in_term_tbl;

    if ( count_ord_prd != count_ord_prd_in_term_tbl ) then
    begin
      have_empty_date_conf = 1;
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_IS_PAY_CLOSED (PAY_ID INTEGER)
RETURNS (IS_PAY_CLOSED INTEGER)
AS 
declare variable count_lines_in_doc integer;
declare variable count_in_not_closed integer;
declare variable is_pay_block smallint;
begin
  count_in_not_closed = null;

  select pay_block from dcl_payment where pay_id = :pay_id into :is_pay_block;

  select
      count(psum.lps_id)
  from
      dcl_pay_list_summ psum
  where
      psum.pay_id = :pay_id and
      not exists ( select distinct lps_id from dcl_ctc_pay ctc_pay where ctc_pay.lps_id = psum.lps_id )
  into :count_in_not_closed;

  select count(psum.lps_id) from dcl_pay_list_summ psum where psum.pay_id = :pay_id into :count_lines_in_doc;

  if ( is_pay_block is not null and count_in_not_closed = 0 and count_lines_in_doc > 0 ) then
  begin
    is_pay_closed = 1;
  end
  else
  begin
    is_pay_closed = null;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_IS_SHP_CLOSED (SHP_ID INTEGER)
RETURNS (IS_SHP_CLOSED INTEGER)
AS 
declare variable HAVE_SPEC integer;
declare variable COUNT_IN_NOT_CLOSED integer;
begin
  count_in_not_closed = null;

  select
      count(shp.shp_id)
  from
      dcl_shipping shp
  where
      shp.shp_id = :shp_id and
      not exists ( select distinct shp_id from dcl_ctc_shp ctc_shp where ctc_shp.shp_id = :shp_id )
  into :count_in_not_closed;

  select count(shp.spc_id) from dcl_shipping shp where shp.shp_id = :shp_id into :have_spec;

  if ( count_in_not_closed = 0 and have_spec > 0 ) then
  begin
    is_shp_closed = 1;
  end
  else
  begin
    is_shp_closed = null;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_IS_WARM_BY_DELIVERY_DATE (ORD_DELIVERY_DATE DATE,
SPC_DELIVERY_DATE DATE)
RETURNS (IS_WARN SMALLINT)
AS 
begin
  IS_WARN = NULL;

  if ( SPC_DELIVERY_DATE is NULL or ORD_DELIVERY_DATE is NULL ) then
  begin
    IS_WARN = NULL;
  end
  else if ( SPC_DELIVERY_DATE - ORD_DELIVERY_DATE < 14 ) then
  begin
    IS_WARN = 1;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_LOG_FILTER (ACT_ID INTEGER,
USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
IP_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
DATE_BEGIN_IN DATE,
DATE_END_IN DATE)
RETURNS (LOG_ID INTEGER,
LOG_ACTION VARCHAR(100) CHARACTER SET UNICODE_FSS,
LOG_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
LOG_IP VARCHAR(20) CHARACTER SET UNICODE_FSS,
LOG_TIME TIMESTAMP)
AS 
begin
  user_in = upper(user_in);
  ip_in = upper(ip_in);
  if ( date_end_in is not null ) then
  begin
    date_end_in = addday(date_end_in, 1);
  end

  for
    select log.log_id,
           coalesce(act.act_name, act.act_system_name),
           usr.usr_surname || ' ' || usr.usr_name,
           log.log_ip,
           log.log_time
    from dcl_log log,
         dcl_action act,
         dcl_user_language usr
    where
          ( :act_id is null or act.act_id = :act_id )
     and  log.act_id = act.act_id
     and  usr.usr_id = log.usr_id
     and  usr.lng_id = 1
     and  ( :date_begin_in is null or log_time >= :date_begin_in )
     and  ( :date_end_in is null or log_time <= :date_end_in )
     and  ( :ip_in is null or :ip_in like '' or upper(log.log_ip) like('%' || :ip_in || '%') )
     and  ( :user_in is null or :user_in like '' or (select upper(usr.usr_surname || ' ' || usr.usr_name) from dcl_user_language where usr_id = log.usr_id and lng_id = 1) like('%' || :user_in || '%') )
    order by log_time descending
    into  :log_id,
          :log_action,
          :log_user,
          :log_ip,
          :log_time
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_LOG_INSERT (USR_ID INTEGER,
ACT_ID INTEGER,
LOG_IP VARCHAR(20) CHARACTER SET UNICODE_FSS)
AS 
declare variable act_logging smallint;
begin
  act_logging = null;
  select act_logging from dcl_action where act_id = :act_id into :act_logging;

  if ( act_logging = 1 ) then
  begin
    insert into dcl_log(usr_id, act_id, log_ip) values (:usr_id, :act_id, :log_ip);
  end
end ^

ALTER PROCEDURE DCL_LOG_INSERT_BY_ACT_SYS_NAME (ACT_SYSTEM_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
LOG_IP VARCHAR(20) CHARACTER SET UNICODE_FSS)
AS 
declare variable act_id integer;
declare variable act_logging smallint;
begin
  act_id = null;
  act_logging = null;
  select
    act_id,
    act_logging
  from dcl_action
  where
    act_system_name = :act_system_name
  into
    :act_id,
    :act_logging
  ;
  if ( act_logging = 1 ) then
  begin
    insert into dcl_log(act_id, log_ip) values (:act_id, :log_ip);
  end

  if ( act_id is null ) then
  begin
    insert into dcl_action(act_system_name) values (:act_system_name);
  end
end ^

ALTER PROCEDURE DCL_MARGIN (DEP_ID_IN INTEGER,
USR_ID_IN INTEGER,
CTR_ID_IN INTEGER,
STF_ID_IN INTEGER,
RUT_ID_IN INTEGER,
DATE_BEGIN DATE,
DATE_END DATE,
CTC_BLOCK_IN SMALLINT)
RETURNS (LCC_ID INTEGER,
LPS_ID INTEGER,
CTC_ID INTEGER,
CTC_DATE DATE,
CTC_BLOCK SMALLINT,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
PAY_ID INTEGER,
PAY_DATE DATE,
PAY_COURSE DECIMAL(15, 6),
LPS_SUMM_EUR DECIMAL(15, 2),
LPS_SUMM DECIMAL(15, 2),
LPS_SUM_TRANSPORT DECIMAL(15, 2),
LPS_CUSTOM DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LCC_CHARGES DECIMAL(15, 2),
LCC_MONTAGE DECIMAL(15, 2),
LCC_TRANSPORT DECIMAL(15, 2),
LCC_UPDATE_SUM DECIMAL(15, 2),
LPS_MONTAGE_TIME DECIMAL(15, 1),
SUMM DECIMAL(15, 2),
SUMM_ZAK DECIMAL(15, 2),
MARGIN DECIMAL(15, 2),
USR_ID INTEGER,
USR_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
RUT_ID INTEGER,
RUT_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CON_ORIGINAL SMALLINT,
SPC_ORIGINAL SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
LPC_ID INTEGER,
PRD_ID INTEGER,
MONTAGE_COST DECIMAL(15, 2),
CUT_ID INTEGER,
CUT_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
HAVE_UNBLOCKED_PRC SMALLINT,
SHP_ORIGINAL SMALLINT)
AS 
declare variable LCC_CHARGES_COMMON decimal(15,2);
declare variable LCC_MONTAGE_COMMON decimal(15,2);
declare variable LCC_TRANSPORT_COMMON decimal(15,2);
declare variable LCC_UPDATE_SUM_COMMON decimal(15,2);
declare variable SPC_NDS_RATE decimal(15,2);
declare variable SUM_PAY_CLOSED decimal(15,2);
declare variable LMN_PERCENT decimal(3,0);
declare variable MAD_MECH_TOTAL decimal(15,1);
declare variable MAD_EL_TOTAL decimal(15,1);
declare variable UNBLOCKED_PRC_COUNT integer;
declare variable SHP_SUM_UPDATE decimal(15,2);
declare variable SHP_SUM_NDS decimal(15,2);
declare variable SHP_SUM_UPDATE_ROW decimal(15,2);
begin
  for
    select
      dep.dep_id,
      dep.dep_name,
      usr.usr_id,
      usr_lng.usr_surname || ' ' || usr_lng.usr_name,
      ctcl.lcc_id,
      ctcl.lcc_charges,
      ctcl.lcc_montage,
      ctcl.lcc_transport,
      ctcl.lcc_update_sum,
      coalesce(shp.shp_sum_update, 0),
      coalesce(shp.shp_summ_plus_nds, 0),
      lps.lps_id,
      ctc.ctc_id,
      ctc.ctc_date,
      ctc.ctc_block,
      ctr.ctr_id,
      ctr.ctr_name,
      ctr.cut_id,
      con.con_id,
      con.con_number,
      con.con_date,
      con.con_original,
      spc.spc_id,
      spc.spc_number,
      spc.spc_date,
      spc.spc_summ,
      spc.spc_original,
      spc.spc_group_delivery,
      spc.spc_nds_rate,
      cur.cur_id,
      cur.cur_name,
      stf.stf_id,
      stf.stf_name,
      shp.shp_id,
      shp.shp_number,
      shp.shp_date,
      shp.shp_original,
      pay.pay_id,
      pay.pay_date,
      pay.pay_course,
      lpc.lpc_sum_transport / lpc.lpc_count * lps.lps_count,
      lpc.lpc_custom / lpc.lpc_count * lps.lps_count,
      lps.lps_summ_plus_nds,
      lps.lps_montage_time,
      lpc.lpc_cost_one * lps.lps_count,
      rut.rut_id,
      rut.rut_name,
      lmn.lmn_percent,
      lps.lpc_id
    from
          dcl_department dep,
          dcl_user usr,
          dcl_user_language usr_lng,
          dcl_lps_list_manager lmn,
          dcl_ctc_list ctcl,
          dcl_contract_closed ctc,
          dcl_con_list_spec spc,
          dcl_contract con,
          dcl_contractor ctr,
          dcl_currency cur,
          dcl_shipping shp,
          dcl_shp_list_produce lps,
          dcl_stuff_category stf,
          dcl_pay_list_summ psum,
          dcl_payment pay,
          dcl_prc_list_produce lpc,
          dcl_produce_cost prc,
          dcl_route rut,
          dcl_ctc_shp ctc_shp,
          dcl_ctc_pay ctc_pay
    where
          ( :dep_id_in = -1 or :dep_id_in is null or dep.dep_id = :dep_id_in ) and
          usr.dep_id = dep.dep_id and
          ( :usr_id_in = -1 or :usr_id_in is null or usr.usr_id = :usr_id_in ) and
          usr_lng.usr_id = usr.usr_id and
          usr_lng.lng_id = 1 and
          lmn.usr_id = usr.usr_id and
          lps.lps_id = lmn.lps_id and
          spc.spc_id = ctcl.spc_id and
          ctc.ctc_id = ctcl.ctc_id and
          con.con_id = spc.con_id and
          ( :ctr_id_in = -1 or :ctr_id_in is null or ctr.ctr_id = :ctr_id_in ) and
          ctr.ctr_id = con.ctr_id and
          shp.spc_id = spc.spc_id and
          shp.shp_id = ctc_shp.shp_id and
          ctc_shp.lcc_id = ctcl.lcc_id and
          cur.cur_id = con.cur_id and
          lps.shp_id = shp.shp_id and
          ( :stf_id_in = -1 or :stf_id_in is null or stf.stf_id = :stf_id_in ) and
          stf.stf_id = lps.stf_id and
          psum.spc_id = spc.spc_id and
          psum.lps_id = ctc_pay.lps_id and
          ctc_pay.lcc_id = ctcl.lcc_id and
          pay.pay_id = psum.pay_id and
          lpc.lpc_id = lps.lpc_id and
          prc.prc_id = lpc.prc_id and
          ( rut.rut_id = :rut_id_in or :rut_id_in = -1 or :rut_id_in is null ) and
          rut.rut_id = prc.rut_id and
          ( ctc.ctc_date >= :date_begin and ctc.ctc_date <= :date_end ) and
          ( :ctc_block_in is null or ctc.ctc_block = :ctc_block_in )
    into
         :dep_id,
         :dep_name,
         :usr_id,
         :usr_name,
         :lcc_id,
         :lcc_charges_common,
         :lcc_montage_common,
         :lcc_transport_common,
         :lcc_update_sum_common,
         :shp_sum_update,
         :shp_sum_nds,
         :lps_id,
         :ctc_id,
         :ctc_date,
         :ctc_block,
         :ctr_id,
         :ctr_name,
         :cut_id,
         :con_id,
         :con_number,
         :con_date,
         :con_original,
         :spc_id,
         :spc_number,
         :spc_date,
         :spc_summ,
         :spc_original,
         :spc_group_delivery,
         :spc_nds_rate,
         :cur_id,
         :cur_name,
         :stf_id,
         :stf_name,
         :shp_id,
         :shp_number,
         :shp_date,
         :shp_original,
         :pay_id,
         :pay_date,
         :pay_course,
         :lps_sum_transport,
         :lps_custom,
         :lps_summ_plus_nds,
         :lps_montage_time,
         :summ_zak,
         :rut_id,
         :rut_name,
         :lmn_percent,
         :lpc_id
  do
  begin
    cut_name = null;
    if ( cut_id is not null ) then
    begin
      select cut_name from dcl_country where cut_id = :cut_id into :cut_name;
    end

    prd_id = null;
    select prd_id from dcl_prc_list_produce where lpc_id = :lpc_id into :prd_id;

    mad_mech_total = 0.0;
    mad_el_total = 0.0;
    select coalesce(madh.mad_mech_total, 0),
           coalesce(madh.mad_el_total, 0)
    from   dcl_montage_adjustment mad
           left join dcl_montage_adjustment_h madh on
           (
             madh.mad_id = mad.mad_id and
             madh.mad_date_from = (
                                    select max(mad_date_from)
                                    from dcl_montage_adjustment_h
                                    where mad_id = mad.mad_id and
                                          mad_date_from <= :shp_date
                                  )
           )
    where  mad.mad_id = (
                          select mad_id
                          from dcl_catalog_number
                          where prd_id = :prd_id and
                                stf_id = :stf_id
                        )
    into   :mad_mech_total,
           :mad_el_total
    ;
    montage_cost = mad_mech_total + mad_el_total;

    select summ_eur from dcl_get_row_summ_eur(:lcc_id, :lps_summ_plus_nds) into :lps_summ_eur;
    select summ_out_nds from dcl_get_row_summ_out_nds(:lps_summ_eur, :spc_nds_rate) into :lps_summ;

    select sum(pls.lps_summ)
    from dcl_pay_list_summ pls,
         dcl_ctc_pay ctc_pay
    where ctc_pay.lcc_id = :lcc_id and
          pls.lps_id = ctc_pay.lps_id
    into :sum_pay_closed;

    select summ_row from dcl_get_row_sum(:sum_pay_closed, :lps_summ_plus_nds, :lcc_charges_common) into :lcc_charges;
    select summ_row from dcl_get_row_sum(:sum_pay_closed, :lps_summ_plus_nds, :lcc_montage_common) into :lcc_montage;
    select summ_row from dcl_get_row_sum(:sum_pay_closed, :lps_summ_plus_nds, :lcc_transport_common) into :lcc_transport;
    select summ_row from dcl_get_row_sum(:sum_pay_closed, :lps_summ_plus_nds, :lcc_update_sum_common) into :lcc_update_sum;

    select summ_row from dcl_get_row_sum(:shp_sum_nds, :lps_summ_plus_nds, :shp_sum_update) into :shp_sum_update_row;
    lcc_update_sum = lcc_update_sum + shp_sum_update_row;

    if ( lmn_percent != 100 ) then
    begin
      --lps_summ_plus_nds = lps_summ_plus_nds * lmn_percent / 100;
      lps_summ_eur = lps_summ_eur * lmn_percent / 100;
      lps_summ = lps_summ * lmn_percent / 100;
      lps_sum_transport = lps_sum_transport * lmn_percent / 100;
      lps_custom = lps_custom * lmn_percent / 100;
      lps_montage_time = lps_montage_time * lmn_percent / 100;
      summ_zak = summ_zak * lmn_percent / 100;

      sum_pay_closed = sum_pay_closed * lmn_percent / 100;
      lcc_charges = lcc_charges * lmn_percent / 100;
      lcc_montage = lcc_montage * lmn_percent / 100;
      lcc_transport = lcc_transport * lmn_percent / 100;
      lcc_update_sum = lcc_update_sum * lmn_percent / 100;

      montage_cost = montage_cost * lmn_percent / 100;
    end

    summ = lps_summ - lps_sum_transport - lps_custom - lcc_charges - lcc_montage - lcc_transport - lcc_update_sum/* - montage_cost*/;
    margin = summ - summ_zak;

    have_unblocked_prc = null;

    select
      coalesce(count(lps.lps_id), 0)
    from
      dcl_ctc_shp cshp,
      dcl_shp_list_produce lps,
      dcl_prc_list_produce lpc,
      dcl_produce_cost prc
    where
      cshp.lcc_id = :lcc_id and
      lps.shp_id = cshp.shp_id and
      lpc.lpc_id = lps.lpc_id and
      prc.prc_id = lpc.prc_id and
      prc.prc_block is null
    into :unblocked_prc_count;

    if ( unblocked_prc_count != 0 ) then
    begin
      have_unblocked_prc = 1;
    end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_MARGIN1 (DEP_ID_IN INTEGER,
USR_ID_IN INTEGER,
CTR_ID_IN INTEGER,
STF_ID_IN INTEGER,
RUT_ID_IN INTEGER,
DATE_BEGIN DATE,
DATE_END DATE,
CTC_BLOCK_IN SMALLINT)
RETURNS (LPS_ID INTEGER,
CTC_DATE DATE,
CTC_BLOCK SMALLINT,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
LPS_SUMM_EUR DECIMAL(15, 2),
LPS_SUMM DECIMAL(15, 2),
LPS_SUM_TRANSPORT DECIMAL(15, 2),
LPS_CUSTOM DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LCC_CHARGES DECIMAL(15, 2),
LCC_MONTAGE DECIMAL(15, 2),
LCC_TRANSPORT DECIMAL(15, 2),
LCC_UPDATE_SUM DECIMAL(15, 2),
LPS_MONTAGE_TIME DECIMAL(15, 1),
SUMM DECIMAL(15, 2),
SUMM_ZAK DECIMAL(15, 2),
MARGIN DECIMAL(15, 2),
USR_ID INTEGER,
USR_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
RUT_ID INTEGER,
RUT_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CON_ORIGINAL SMALLINT,
SPC_ORIGINAL SMALLINT,
SPC_GROUP_DELIVERY SMALLINT,
MONTAGE_COST DECIMAL(15, 2),
CUT_ID INTEGER,
CUT_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS,
HAVE_UNBLOCKED_PRC SMALLINT,
SHP_ORIGINAL SMALLINT)
AS 
begin
  for
    select lps_id,
           ctc_date,
           ctc_block,
           ctr_id,
           ctr_name,
           cut_id,
           cut_name,
           con_id,
           con_number,
           con_date,
           spc_id,
           spc_number,
           spc_date,
           spc_summ,
           cur_id,
           cur_name,
           stf_id,
           stf_name,
           shp_id,
           shp_number,
           shp_date,
           shp_original,
           lps_summ_eur,
           lps_summ,
           lps_sum_transport,
           lps_custom,
           lps_summ_plus_nds,
           lcc_charges,
           lcc_montage,
           lcc_transport,
           lcc_update_sum, 
           lps_montage_time,
           summ,
           summ_zak,
           margin,
           usr_id,
           usr_name,
           dep_id,
           dep_name,
           rut_id,
           rut_name,
           con_original,
           spc_original,
           spc_group_delivery,
           montage_cost,
           have_unblocked_prc
    from dcl_margin(:dep_id_in, :usr_id_in, :ctr_id_in, :stf_id_in, :rut_id_in, :date_begin, :date_end, :ctc_block_in)
    group by lps_id,
             ctc_date,
             ctc_block,
             ctr_id,
             ctr_name,
             cut_id,
             cut_name, 
             con_id,
             con_number,
             con_date,
             spc_id,
             spc_number,
             spc_date,
             spc_summ,
             cur_id,
             cur_name,
             stf_id,
             stf_name,
             shp_id,
             shp_number,
             shp_date,
             shp_original,
             lps_summ_eur,
             lps_summ,
             lps_sum_transport,
             lps_custom,
             lps_summ_plus_nds,
             lcc_charges,
             lcc_montage,
             lcc_transport,
             lcc_update_sum,
             lps_montage_time,
             summ,
             summ_zak,
             margin,
             usr_id,
             usr_name,
             dep_id,
             dep_name,
             rut_id,
             rut_name,
             con_original,
             spc_original,
             spc_group_delivery,
             montage_cost,
             have_unblocked_prc
    into :lps_id,
         :ctc_date,
         :ctc_block,
         :ctr_id,
         :ctr_name,
         :cut_id,
         :cut_name,
         :con_id,
         :con_number,
         :con_date,
         :spc_id,
         :spc_number,
         :spc_date,
         :spc_summ,
         :cur_id,
         :cur_name,
         :stf_id,
         :stf_name,
         :shp_id,
         :shp_number,
         :shp_date,
         :shp_original,
         :lps_summ_eur,
         :lps_summ,
         :lps_sum_transport,
         :lps_custom,
         :lps_summ_plus_nds,
         :lcc_charges,
         :lcc_montage,
         :lcc_transport,
         :lcc_update_sum,
         :lps_montage_time,
         :summ,
         :summ_zak,
         :margin,
         :usr_id,
         :usr_name,
         :dep_id,
         :dep_name,
         :rut_id,
         :rut_name,
         :con_original,
         :spc_original,
         :spc_group_delivery,
         :montage_cost,
         :have_unblocked_prc
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_MONTAGE_ADJUSTMENT_INSERT (STF_ID INTEGER,
MAD_MACHINE_TYPE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
RETURNS (MAD_ID INTEGER)
AS 
begin

  insert into dcl_montage_adjustment (
    stf_id,
    mad_machine_type,
    mad_complexity
  )
  values(
    :stf_id,
    :mad_machine_type,
    :mad_complexity
  )
  returning mad_id into :mad_id;

  suspend;
end ^

ALTER PROCEDURE DCL_MOVEMENT_LOAD (PRD_ID INTEGER,
STF_ID INTEGER,
KOEF DECIMAL(15, 5),
OPR_PARENT_ID_IN INTEGER)
RETURNS (SHP_ID INTEGER,
SHP_DATE DATE,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_PRODUCE_CNT DECIMAL(15, 2),
SHP_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
LPC_ID INTEGER,
PRC_ID INTEGER,
PRC_DATE DATE,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_PRODUCE_CNT DECIMAL(15, 2),
PRC_PRODUCE_CNT_REST DECIMAL(15, 2),
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
ASM_ID INTEGER,
DLR_ID INTEGER,
SPI_ID INTEGER,
TRN_ID INTEGER,
TRN_DATE DATE,
TRN_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
TRN_PRODUCE_CNT DECIMAL(15, 2),
TRN_PRODUCE_CNT_REST DECIMAL(15, 2),
DLR_MINSK SMALLINT,
OPR_ID INTEGER,
ORD_ID INTEGER,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
ORD_EXECUTED_DATE DATE,
ORD_PRODUCE_CNT DECIMAL(15, 2),
ORD_PRODUCE_CNT_EXECUTED DECIMAL(15, 2),
ORD_PRODUCE_CNT_REST DECIMAL(15, 2),
ORD_ANNUL SMALLINT)
AS 
declare variable APR_ID integer;
declare variable DRP_ID integer;
declare variable SIP_ID integer;
declare variable OPR_PARENT_ID integer;
declare variable PRD_ID_INNER integer;
declare variable OPR_COUNT decimal(15,2);
declare variable KOEF_INNER decimal(15,5);
declare variable SHP_COUNT integer;
declare variable ASM_TYPE smallint;
begin
  -- prc & shipping & chains
  for
    select lpc.lpc_id,
           prc.prc_id,
           prc.prc_date,
           prc.prc_number,
           lpc.lpc_count,
           lpc.lpc_count - (select coalesce(sum(lps_count), 0) from dcl_shp_list_produce where lpc_id = lpc.lpc_id),
           lpc.lpc_1c_number,
           lpc.asm_id,
           lpc.apr_id,
           lpc.drp_id,
           lpc.sip_id,
           lpc.opr_id
    from
      dcl_prc_list_produce lpc,
      dcl_produce_cost prc
    where
      prc.prc_id = lpc.prc_id and
      lpc.stf_id = :stf_id and
      lpc.prd_id = :prd_id
    order by prc_date
    into :lpc_id,
         :prc_id,
         :prc_date,
         :prc_number,
         :prc_produce_cnt,
         :prc_produce_cnt_rest,
         :lpc_1c_number,
         :asm_id,
         :apr_id,
         :drp_id,
         :sip_id,
         :opr_id
  do
  begin
    dlr_id = null;
    spi_id = null;
    trn_id = null;
    trn_number = null;
    trn_date = null;
    trn_produce_cnt = null;
    trn_produce_cnt_rest = null;
    dlr_minsk = null;
    ord_id = null;
    ord_date = null;
    ord_number = null;
    ord_executed_date = null;
    ord_produce_cnt = null;
    ord_produce_cnt_executed = null;
    ord_produce_cnt_rest = null;
    ord_annul = null;

    if (asm_id is not null) then -- first
    begin
      select asm.asm_id,
             asm.asm_id,
             asm.asm_number,
             asm.asm_date,
             asm.asm_count,
             (
              asm.asm_count -
              (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.asm_id = :asm_id ) -
              (
                select coalesce(sum(drp.drp_count), 0)
                from dcl_dlr_list_produce drp, dcl_delivery_request dlr
                where drp.asm_id = :asm_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
              )
             ),
             asm.asm_type
      from dcl_assemble asm
      where asm.asm_id = :asm_id
      into :asm_id,
           :trn_id,
           :trn_number,
           :trn_date,
           :trn_produce_cnt,
           :trn_produce_cnt_rest,
           :asm_type;

      if (asm_type = 1) then
      begin
        trn_produce_cnt_rest = 0;
      end
    end

    if (apr_id is not null) then -- second
    begin
      select asm.asm_id,
             asm.asm_number,
             asm.asm_date,
             apr.apr_id,
             apr.apr_count * asm.asm_count,
             (
              apr.apr_count * asm.asm_count -
              (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.apr_id = :apr_id ) -
              (
                select coalesce(sum(drp.drp_count), 0)
                from dcl_dlr_list_produce drp, dcl_delivery_request dlr
                where drp.apr_id = :apr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
              )
             ),
             asm_type
      from dcl_asm_list_produce apr,
           dcl_assemble asm
      where apr.apr_id = :apr_id and
            asm.asm_id = apr.asm_id
      into :asm_id,
           :trn_number,
           :trn_date,
           :trn_id,
           :trn_produce_cnt,
           :trn_produce_cnt_rest,
           :asm_type;

      if (asm_type = 0) then
      begin
        trn_produce_cnt_rest = 0;
      end

    end

    if (drp_id is not null) then
    begin
      select dlr.dlr_id,
             dlr.dlr_number,
             dlr.dlr_date,
             dlr.dlr_minsk,
             drp.drp_id,
             drp.drp_count
      from dcl_dlr_list_produce drp,
           dcl_delivery_request dlr
      where drp.drp_id = :drp_id and
            dlr.dlr_id = drp.dlr_id and
            (dlr.dlr_need_deliver is null or dlr.dlr_need_deliver = 0)
      into :dlr_id,
           :trn_number,
           :trn_date,
           :dlr_minsk,
           :trn_id,
           :trn_produce_cnt;
      if (dlr_minsk = 0) then
        begin
            select (drp.drp_count -
                (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.drp_id = :drp_id ) -
                (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.drp_id = :drp_id ))
            from dcl_dlr_list_produce drp,
                 dcl_delivery_request dlr
            where drp.drp_id = :drp_id and
                  dlr.dlr_id = drp.dlr_id
            into :trn_produce_cnt_rest;
        end
    end

    if (sip_id is not null) then
    begin
      select spi.spi_id,
             spi.spi_number,
             spi.spi_date,
             sip.sip_id,
             sip.sip_count,
            (sip.sip_count -
                (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.sip_id = :sip_id )
            )
      from dcl_spi_list_produce sip,
           dcl_specification_import spi
      where sip.sip_id = :sip_id and
            spi.spi_id = sip.spi_id
      into :spi_id,
           :trn_number,
           :trn_date,
           :trn_id,
           :trn_produce_cnt,
           :trn_produce_cnt_rest;
    end

    if (opr_id is null) then
    begin
      select opr_id from dcl_get_opr_id_by_lpc(:asm_id, :apr_id, :drp_id, :sip_id) into :opr_id;
    end

    if (opr_id is not null) then
    begin
      select
        ord.ord_id,
        ord.ord_date,
        ord.ord_number,
        ord.ord_executed_date,
        opr.opr_count,
        (  select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ),
        (
          (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ) -
          (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = :opr_id ) -
          (
            select coalesce(sum(drp.drp_count), 0)
            from dcl_dlr_list_produce drp, dcl_delivery_request dlr
            where drp.opr_id = :opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
           ) -
          (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = :opr_id ) -
          (select out_count from dcl_get_count_opr_used_in_asm(:opr_id) )
         ),
        ord.ord_annul
      from
        dcl_order ord,
        dcl_ord_list_produce opr
      where
        opr.opr_id = :opr_id and
        ord.ord_id = opr.ord_id
      into :ord_id,
           :ord_date,
           :ord_number,
           :ord_executed_date,
           :ord_produce_cnt,
           :ord_produce_cnt_executed,
           :ord_produce_cnt_rest,
           :ord_annul;
    end

    shp_id = null;
    shp_date = null;
    shp_number = null;
    shp_produce_cnt = null;
    shp_contractor = null;

    select count(lps_id) from dcl_shp_list_produce where lpc_id = :lpc_id into :shp_count;

    if (shp_count = 0) then -- no lines in shipping
    begin
      prc_produce_cnt = prc_produce_cnt * koef;
      prc_produce_cnt_rest = prc_produce_cnt_rest * koef;
      shp_produce_cnt = shp_produce_cnt * koef;
      trn_produce_cnt = trn_produce_cnt * koef;

      suspend;
    end
    else
    begin
      for
        select shp.shp_id,
               shp.shp_date,
               shp.shp_number,
               ctr.ctr_name,
               coalesce(sum(lps.lps_count), 0)
        from
          dcl_shp_list_produce lps,
          dcl_shipping shp,
          dcl_contractor ctr
        where
          shp.shp_id = lps.shp_id and
          lps.lpc_id = :lpc_id and
          ctr.ctr_id = shp.ctr_id
        group by 1, 2, 3, 4
        order by shp_date
        into :shp_id,
             :shp_date,
             :shp_number,
             :shp_contractor,
             :shp_produce_cnt
      do
      begin
        prc_produce_cnt = prc_produce_cnt * koef;
        prc_produce_cnt_rest = prc_produce_cnt_rest * koef;
        shp_produce_cnt = shp_produce_cnt * koef;
        trn_produce_cnt = trn_produce_cnt * koef;

        suspend;

        prc_produce_cnt = null;
        prc_produce_cnt_rest = null;
      end
    end
  end

  shp_id = null;
  shp_date = null;
  shp_number = null;
  shp_produce_cnt = null;
  shp_contractor = null;
  lpc_id = null;
  prc_id = null;
  prc_date = null;
  prc_number = null;
  prc_produce_cnt = null;
  prc_produce_cnt_rest = null;
  lpc_1c_number = null;
  asm_id = null;
  apr_id = null;
  drp_id = null;
  sip_id = null;
  opr_id = null;
  dlr_id = null;
  spi_id = null;
  trn_id = null;
  trn_number = null;
  trn_date = null;
  trn_produce_cnt = null;
  trn_produce_cnt_rest = null;
  dlr_minsk = null;
  ord_id = null;
  ord_date = null;
  ord_number = null;
  ord_executed_date = null;
  ord_produce_cnt = null;
  ord_produce_cnt_executed = null;
  ord_produce_cnt_rest = null;
  ord_annul = null;

  -- last transit doc is disassemble
  for
      select asm.asm_id,
             asm.asm_id,
             asm.asm_number,
             asm.asm_date,
             asm.asm_count,
             (
              asm.asm_count -
              (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.asm_id = asm.asm_id ) -
              (
                select coalesce(sum(drp.drp_count), 0)
                from dcl_dlr_list_produce drp, dcl_delivery_request dlr
                where drp.asm_id = asm.asm_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
              )
             ),
             asm.opr_id,
             asm.asm_type
      from dcl_assemble asm
      where asm.prd_id = :prd_id and
            asm.stf_id = :stf_id
            and
            (
              select count(lpc_id)
              from  dcl_prc_list_produce lpc
              where lpc.asm_id = asm.asm_id
            ) = 0
            and
            (
              select count(drp_id)
              from  dcl_dlr_list_produce drp,
                    dcl_delivery_request dlr
              where drp.asm_id = asm.asm_id and
                    dlr.dlr_id = drp.dlr_id and
                    dlr.dlr_annul is null
            ) = 0
      into :asm_id,
           :trn_id,
           :trn_number,
           :trn_date,
           :trn_produce_cnt,
           :trn_produce_cnt_rest,
           :opr_id,
           :asm_type
  do
  begin
    if (asm_type = 1) then
    begin
      trn_produce_cnt_rest = 0;
    end

    ord_id = null;
    ord_date = null;
    ord_number = null;
    ord_executed_date = null;
    ord_produce_cnt = null;
    ord_produce_cnt_executed = null;
    ord_produce_cnt_rest = null;
    ord_annul = null;

    if (opr_id is not null) then
    begin
      select
        ord.ord_id,
        ord.ord_date,
        ord.ord_number,
        ord.ord_executed_date,
        opr.opr_count,
        ( select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ),
        (
          (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ) -
          (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = :opr_id ) -
          (
            select coalesce(sum(drp.drp_count), 0)
            from dcl_dlr_list_produce drp, dcl_delivery_request dlr
            where drp.opr_id = :opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
          ) -
          (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = :opr_id ) -
          (select out_count from dcl_get_count_opr_used_in_asm(:opr_id) )
         ),
        ord.ord_annul
      from
        dcl_order ord,
        dcl_ord_list_produce opr
      where
        opr.opr_id = :opr_id and
        ord.ord_id = opr.ord_id
      into :ord_id,
           :ord_date,
           :ord_number,
           :ord_executed_date,
           :ord_produce_cnt,
           :ord_produce_cnt_executed,
           :ord_produce_cnt_rest,
           :ord_annul;
    end

    prc_produce_cnt = prc_produce_cnt * koef;
    prc_produce_cnt_rest = prc_produce_cnt_rest * koef;
    shp_produce_cnt = shp_produce_cnt * koef;
    trn_produce_cnt = trn_produce_cnt * koef;

    suspend;
  end

  shp_id = null;
  shp_date = null;
  shp_number = null;
  shp_produce_cnt = null;
  shp_contractor = null;
  lpc_id = null;
  prc_id = null;
  prc_date = null;
  prc_number = null;
  prc_produce_cnt = null;
  prc_produce_cnt_rest = null;
  lpc_1c_number = null;
  asm_id = null;
  apr_id = null;
  drp_id = null;
  sip_id = null;
  opr_id = null;
  dlr_id = null;
  spi_id = null;
  trn_id = null;
  trn_number = null;
  trn_date = null;
  trn_produce_cnt = null;
  trn_produce_cnt_rest = null;
  dlr_minsk = null;
  ord_id = null;
  ord_date = null;
  ord_number = null;
  ord_executed_date = null;
  ord_produce_cnt = null;
  ord_produce_cnt_executed = null;
  ord_produce_cnt_rest = null;
  ord_annul = null;

  -- last transit doc is assemble
  for
      select asm.asm_id,
             apr.apr_id,
             asm.asm_number,
             asm.asm_date,
             apr.apr_count * asm.asm_count,
             (
               apr.apr_count * asm.asm_count -
               (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.apr_id = apr.apr_id ) -
               (
                 select coalesce(sum(drp.drp_count), 0)
                 from dcl_dlr_list_produce drp, dcl_delivery_request dlr
                 where drp.apr_id = apr.apr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
               )
             ),
             apr.opr_id,
             asm.asm_type
      from dcl_asm_list_produce apr,
           dcl_assemble asm,
           dcl_ord_list_produce opr,
           dcl_order ord
      where apr.prd_id = :prd_id and
            asm.asm_id = apr.asm_id and
            opr.opr_id = apr.opr_id and
            ord.ord_id = opr.ord_id and
            ord.stf_id = :stf_id
            and
            (
              select count(lpc_id)
              from  dcl_prc_list_produce lpc
              where lpc.apr_id = apr.apr_id
            ) = 0
            and
            (
              select count(drp_id)
              from  dcl_dlr_list_produce drp,
                    dcl_delivery_request dlr
              where drp.apr_id = apr.apr_id and
                    dlr.dlr_id = drp.dlr_id and
                    dlr.dlr_annul is null
            ) = 0
      into :asm_id,
           :trn_id,
           :trn_number,
           :trn_date,
           :trn_produce_cnt,
           :trn_produce_cnt_rest,
           :opr_id,
           :asm_type
  do
  begin
    if (asm_type = 0) then
    begin
      trn_produce_cnt_rest = 0;
    end

    ord_id = null;
    ord_date = null;
    ord_number = null;
    ord_executed_date = null;
    ord_produce_cnt = null;
    ord_produce_cnt_executed = null;
    ord_produce_cnt_rest = null;
    ord_annul = null;

    if (opr_id is not null) then
    begin
      select
        ord.ord_id,
        ord.ord_date,
        ord.ord_number,
        ord.ord_executed_date,
        opr.opr_count,
        ( select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ),
        (
          (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ) -
          (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = :opr_id ) -
          (
            select coalesce(sum(drp.drp_count), 0)
            from dcl_dlr_list_produce drp, dcl_delivery_request dlr
            where drp.opr_id = :opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
          ) -
          (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = :opr_id ) -
          (select out_count from dcl_get_count_opr_used_in_asm(:opr_id) )
         ),
        ord.ord_annul
      from
        dcl_order ord,
        dcl_ord_list_produce opr
      where
        opr.opr_id = :opr_id and
        ord.ord_id = opr.ord_id
      into :ord_id,
           :ord_date,
           :ord_number,
           :ord_executed_date,
           :ord_produce_cnt,
           :ord_produce_cnt_executed,
           :ord_produce_cnt_rest,
           :ord_annul;
    end

    prc_produce_cnt = prc_produce_cnt * koef;
    prc_produce_cnt_rest = prc_produce_cnt_rest * koef;
    shp_produce_cnt = shp_produce_cnt * koef;
    trn_produce_cnt = trn_produce_cnt * koef;

    suspend;
  end



  shp_id = null;
  shp_date = null;
  shp_number = null;
  shp_produce_cnt = null;
  shp_contractor = null;
  lpc_id = null;
  prc_id = null;
  prc_date = null;
  prc_number = null;
  prc_produce_cnt = null;
  prc_produce_cnt_rest = null;
  lpc_1c_number = null;
  asm_id = null;
  apr_id = null;
  drp_id = null;
  sip_id = null;
  opr_id = null;
  dlr_id = null;
  spi_id = null;
  trn_id = null;
  trn_number = null;
  trn_date = null;
  trn_produce_cnt = null;
  trn_produce_cnt_rest = null;
  dlr_minsk = null;
  ord_id = null;
  ord_date = null;
  ord_number = null;
  ord_executed_date = null;
  ord_produce_cnt = null;
  ord_produce_cnt_executed = null;
  ord_produce_cnt_rest = null;
  ord_annul = null;


  -- last transit doc is specification import (from delivery request)
  for
      select spi.spi_id,
             spi.spi_number,
             spi.spi_date,
             sip.sip_id,
             sip.sip_count,
            (sip.sip_count -
                (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.sip_id = sip.sip_id )
            ),
             drp.opr_id
      from dcl_spi_list_produce sip,
           dcl_dlr_list_produce drp,
           dcl_specification_import spi
      where sip.prd_id = :prd_id and
            drp.drp_id = sip.drp_id and
            drp.stf_id = :stf_id and
            spi.spi_id = sip.spi_id
            and
            (
              select count(lpc_id)
              from  dcl_prc_list_produce lpc
              where lpc.sip_id = sip.sip_id
            ) = 0
            and
            (
              select count(drp_id)
              from  dcl_dlr_list_produce drp,
                    dcl_delivery_request dlr
              where drp.sip_id = sip.sip_id and
                    dlr.dlr_id = drp.dlr_id and
                    dlr.dlr_annul is null
            ) = 0
      into :spi_id,
           :trn_number,
           :trn_date,
           :trn_id,
           :trn_produce_cnt,
           :trn_produce_cnt_rest,
           :opr_id
  do
  begin
    ord_id = null;
    ord_date = null;
    ord_number = null;
    ord_executed_date = null;
    ord_produce_cnt = null;
    ord_produce_cnt_executed = null;
    ord_produce_cnt_rest = null;
    ord_annul = null;

    if (opr_id is not null) then
    begin
      select
        ord.ord_id,
        ord.ord_date,
        ord.ord_number,
        ord.ord_executed_date,
        opr.opr_count,
        ( select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ),
        (
          (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ) -
          (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = :opr_id ) -
          (
            select coalesce(sum(drp.drp_count), 0)
            from dcl_dlr_list_produce drp, dcl_delivery_request dlr
            where drp.opr_id = :opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
          ) -
          (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = :opr_id ) -
          (select out_count from dcl_get_count_opr_used_in_asm(:opr_id) )
         ),
        ord.ord_annul
      from
        dcl_order ord,
        dcl_ord_list_produce opr
      where
        opr.opr_id = :opr_id and
        ord.ord_id = opr.ord_id
      into :ord_id,
           :ord_date,
           :ord_number,
           :ord_executed_date,
           :ord_produce_cnt,
           :ord_produce_cnt_executed,
           :ord_produce_cnt_rest,
           :ord_annul;
    end

    prc_produce_cnt = prc_produce_cnt * koef;
    prc_produce_cnt_rest = prc_produce_cnt_rest * koef;
    shp_produce_cnt = shp_produce_cnt * koef;
    trn_produce_cnt = trn_produce_cnt * koef;

    suspend;
  end


  shp_id = null;
  shp_date = null;
  shp_number = null;
  shp_produce_cnt = null;
  shp_contractor = null;
  lpc_id = null;
  prc_id = null;
  prc_date = null;
  prc_number = null;
  prc_produce_cnt = null;
  prc_produce_cnt_rest = null;
  lpc_1c_number = null;
  asm_id = null;
  apr_id = null;
  drp_id = null;
  sip_id = null;
  opr_id = null;
  dlr_id = null;
  spi_id = null;
  trn_id = null;
  trn_number = null;
  trn_date = null;
  trn_produce_cnt = null;
  trn_produce_cnt_rest = null;
  dlr_minsk = null;
  ord_id = null;
  ord_date = null;
  ord_number = null;
  ord_executed_date = null;
  ord_produce_cnt = null;
  ord_produce_cnt_executed = null;
  ord_produce_cnt_rest = null;
  ord_annul = null;


  -- last transit doc is specification import (from order)
  for
      select spi.spi_id,
             spi.spi_number,
             spi.spi_date,
             sip.sip_id,
             sip.sip_count,
            (sip.sip_count -
                (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.sip_id = sip.sip_id )
            ),
             opr.opr_id
      from dcl_spi_list_produce sip,
           dcl_ord_list_produce opr,
           dcl_order ord,
           dcl_specification_import spi
      where sip.prd_id = :prd_id and
            opr.opr_id = sip.opr_id and
            ord.ord_id = opr.ord_id and
            ord.stf_id = :stf_id and
            spi.spi_id = sip.spi_id
            and
            (
              select count(lpc_id)
              from  dcl_prc_list_produce lpc
              where lpc.sip_id = sip.sip_id
            ) = 0
            and
            (
              select count(drp_id)
              from  dcl_dlr_list_produce drp,
                    dcl_delivery_request dlr
              where drp.sip_id = sip.sip_id and
                    dlr.dlr_id = drp.dlr_id and
                    dlr.dlr_annul is null
            ) = 0
      into :spi_id,
           :trn_number,
           :trn_date,
           :trn_id,
           :trn_produce_cnt,
           :trn_produce_cnt_rest,
           :opr_id
  do
  begin
    ord_id = null;
    ord_date = null;
    ord_number = null;
    ord_executed_date = null;
    ord_produce_cnt = null;
    ord_produce_cnt_executed = null;
    ord_produce_cnt_rest = null;
    ord_annul = null;

    if (opr_id is not null) then
    begin
      select
        ord.ord_id,
        ord.ord_date,
        ord.ord_number,
        ord.ord_executed_date,
        opr.opr_count,
        ( select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ),
        (
          (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ) -
          (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = :opr_id ) -
          (
            select coalesce(sum(drp.drp_count), 0)
            from dcl_dlr_list_produce drp, dcl_delivery_request dlr
            where drp.opr_id = :opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
          ) -
          (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = :opr_id ) -
          (select out_count from dcl_get_count_opr_used_in_asm(:opr_id) )
         ),
        ord.ord_annul
      from
        dcl_order ord,
        dcl_ord_list_produce opr
      where
        opr.opr_id = :opr_id and
        ord.ord_id = opr.ord_id
      into :ord_id,
           :ord_date,
           :ord_number,
           :ord_executed_date,
           :ord_produce_cnt,
           :ord_produce_cnt_executed,
           :ord_produce_cnt_rest,
           :ord_annul;
    end

    prc_produce_cnt = prc_produce_cnt * koef;
    prc_produce_cnt_rest = prc_produce_cnt_rest * koef;
    shp_produce_cnt = shp_produce_cnt * koef;
    trn_produce_cnt = trn_produce_cnt * koef;

    suspend;
  end

  shp_id = null;
  shp_date = null;
  shp_number = null;
  shp_produce_cnt = null;
  shp_contractor = null;
  lpc_id = null;
  prc_id = null;
  prc_date = null;
  prc_number = null;
  prc_produce_cnt = null;
  prc_produce_cnt_rest = null;
  lpc_1c_number = null;
  asm_id = null;
  apr_id = null;
  drp_id = null;
  sip_id = null;
  opr_id = null;
  dlr_id = null;
  spi_id = null;
  trn_id = null;
  trn_number = null;
  trn_date = null;
  trn_produce_cnt = null;
  trn_produce_cnt_rest = null;
  dlr_minsk = null;
  ord_id = null;
  ord_date = null;
  ord_number = null;
  ord_executed_date = null;
  ord_produce_cnt = null;
  ord_produce_cnt_executed = null;
  ord_produce_cnt_rest = null;
  ord_annul = null;


  -- last transit doc is delivery request
  for
      select dlr.dlr_id,
             dlr.dlr_number,
             dlr.dlr_date,
             dlr.dlr_minsk,
             drp.drp_id,
             drp.drp_count,
             drp.opr_id
      from dcl_dlr_list_produce drp,
           dcl_delivery_request dlr
      where drp.prd_id = :prd_id and
            drp.stf_id = :stf_id and
            dlr.dlr_id = drp.dlr_id and
            (dlr.dlr_need_deliver is null or dlr.dlr_need_deliver = 0)and
            dlr.dlr_annul is null
            and
            (
              select count(lpc_id)
              from  dcl_prc_list_produce lpc
              where lpc.drp_id = drp.drp_id
            ) = 0
            and
            (
              select count(sip_id)
              from  dcl_spi_list_produce sip
              where sip.drp_id = drp.drp_id
            ) = 0
      into :dlr_id,
           :trn_number,
           :trn_date,
           :dlr_minsk,
           :trn_id,
           :trn_produce_cnt,
           :opr_id
  do
  begin
  if (dlr_minsk = 0) then
        begin
            select (drp.drp_count -
                (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.drp_id = drp.drp_id ) -
                (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.drp_id = drp.drp_id ))
            from dcl_dlr_list_produce drp,
                 dcl_delivery_request dlr
            where drp.prd_id = :prd_id and
                drp.stf_id = :stf_id and
                dlr.dlr_id = drp.dlr_id and
                (dlr.dlr_need_deliver is null or dlr.dlr_need_deliver = 0) and
                dlr.dlr_annul is null and
                dlr.dlr_id=:dlr_id
            and
            (
              select count(lpc_id)
              from  dcl_prc_list_produce lpc
              where lpc.drp_id = drp.drp_id
            ) = 0
            and
            (
              select count(sip_id)
              from  dcl_spi_list_produce sip
              where sip.drp_id = drp.drp_id
            ) = 0
            into :trn_produce_cnt_rest;
        end

    ord_id = null;
    ord_date = null;
    ord_number = null;
    ord_executed_date = null;
    ord_produce_cnt = null;
    ord_produce_cnt_executed = null;
    ord_produce_cnt_rest = null;
    ord_annul = null;

    if (opr_id is not null) then
    begin
      select
        ord.ord_id,
        ord.ord_date,
        ord.ord_number,
        ord.ord_executed_date,
        opr.opr_count,
        ( select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ),
        (
          (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = :opr_id and exe.opr_fictive_executed is null ) -
          (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = :opr_id ) -
          (
            select coalesce(sum(drp.drp_count), 0)
            from dcl_dlr_list_produce drp, dcl_delivery_request dlr
            where drp.opr_id = :opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
          ) -
          (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = :opr_id ) -
          (select out_count from dcl_get_count_opr_used_in_asm(:opr_id) )
         ),
        ord.ord_annul
      from
        dcl_order ord,
        dcl_ord_list_produce opr
      where
        opr.opr_id = :opr_id and
        ord.ord_id = opr.ord_id
      into :ord_id,
           :ord_date,
           :ord_number,
           :ord_executed_date,
           :ord_produce_cnt,
           :ord_produce_cnt_executed,
           :ord_produce_cnt_rest,
           :ord_annul;
    end

    prc_produce_cnt = prc_produce_cnt * koef;
    prc_produce_cnt_rest = prc_produce_cnt_rest * koef;
    shp_produce_cnt = shp_produce_cnt * koef;
    trn_produce_cnt = trn_produce_cnt * koef;

    suspend;
  end


  shp_id = null;
  shp_date = null;
  shp_number = null;
  shp_produce_cnt = null;
  shp_contractor = null;
  lpc_id = null;
  prc_id = null;
  prc_date = null;
  prc_number = null;
  prc_produce_cnt = null;
  prc_produce_cnt_rest = null;
  lpc_1c_number = null;
  asm_id = null;
  apr_id = null;
  drp_id = null;
  sip_id = null;
  opr_id = null;
  dlr_id = null;
  spi_id = null;
  trn_id = null;
  trn_number = null;
  trn_date = null;
  trn_produce_cnt = null;
  trn_produce_cnt_rest = null;
  dlr_minsk = null;
  ord_id = null;
  ord_date = null;
  ord_number = null;
  ord_executed_date = null;
  ord_produce_cnt = null;
  ord_produce_cnt_executed = null;
  ord_produce_cnt_rest = null;
  ord_annul = null;

  -- last doc is order
  for
     select
        ord.ord_id,
        ord.ord_date,
        ord.ord_number,
        ord.ord_executed_date,
        opr.opr_count,
        ( select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ),
        (
          (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ) -
          (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id ) -
          (
            select coalesce(sum(drp.drp_count), 0)
            from dcl_dlr_list_produce drp, dcl_delivery_request dlr
            where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null
          ) -
          (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id ) -
          (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
         ),
        ord.ord_annul,
        opr.opr_parent_id
      from
        dcl_order ord,
        dcl_ord_list_produce opr
      where
        ord.ord_id = opr.ord_id and
        opr.prd_id = :prd_id and
        ord.stf_id = :stf_id
        and
        (
          select count(lpc_id)
          from  dcl_prc_list_produce lpc
          where lpc.opr_id = opr.opr_id
        ) = 0
        and
        (
          select count(asm_id)
          from  dcl_assemble asm
          where asm.opr_id = opr.opr_id
        ) = 0
        and
        (
          select count(apr_id)
          from  dcl_asm_list_produce apr
          where apr.opr_id = opr.opr_id
        ) = 0
        and
        (
          select count(sip_id)
          from  dcl_spi_list_produce sip
          where sip.opr_id = opr.opr_id
        ) = 0
        and
        (
          select count(drp_id)
          from  dcl_dlr_list_produce drp,
                dcl_delivery_request dlr
          where drp.opr_id = opr.opr_id and
                dlr.dlr_id = drp.dlr_id and
                dlr.dlr_annul is null
        ) = 0
        and ((:opr_parent_id_in is null and opr.opr_parent_id is null) or opr.opr_parent_id = :opr_parent_id_in)
      into :ord_id,
           :ord_date,
           :ord_number,
           :ord_executed_date,
           :ord_produce_cnt,
           :ord_produce_cnt_executed,
           :ord_produce_cnt_rest,
           :ord_annul,
           :opr_parent_id
  do
  begin
    shp_id = null;
    shp_date = null;
    shp_number = null;
    shp_produce_cnt = null;
    shp_contractor = null;
    lpc_id = null;
    prc_id = null;
    prc_date = null;
    prc_number = null;
    prc_produce_cnt = null;
    prc_produce_cnt_rest = null;
    lpc_1c_number = null;
    asm_id = null;
    apr_id = null;
    drp_id = null;
    sip_id = null;
    opr_id = null;
    dlr_id = null;
    spi_id = null;
    trn_id = null;
    trn_number = null;
    trn_date = null;
    trn_produce_cnt = null;
    trn_produce_cnt_rest = null;
    dlr_minsk = null;

    if (opr_parent_id is not null) then
    begin
      select prd_id, opr_count from dcl_ord_list_produce opr where opr.opr_id = :opr_parent_id into :prd_id_inner, :opr_count;
      koef_inner = 1;
      if (ord_produce_cnt is not null and ord_produce_cnt != 0) then
      begin
        koef_inner = ord_produce_cnt / opr_count;
      end
      for
        select
           prc_id,
           prc_date,
           prc_number,
           prc_produce_cnt,
           prc_produce_cnt_rest,
           lpc_1c_number,
           shp_id,
           shp_date,
           shp_number,
           shp_produce_cnt,
           shp_contractor,
           asm_id,
           dlr_id,
           spi_id,
           trn_id,
           trn_number,
           trn_date,
           trn_produce_cnt,
           trn_produce_cnt_rest,
           dlr_minsk,
           opr_id,
           ord_id,
           ord_date,
           ord_number,
           ord_executed_date,
           ord_produce_cnt,
           ord_produce_cnt_executed,
           ord_produce_cnt_rest,
           ord_annul
        from dcl_movement_load(:prd_id_inner, :stf_id, :koef_inner, :opr_parent_id) p
        where p.ord_id = :ord_id
        into
           :prc_id,
           :prc_date,
           :prc_number,
           :prc_produce_cnt,
           :prc_produce_cnt_rest,
           :lpc_1c_number,
           :shp_id,
           :shp_date,
           :shp_number,
           :shp_produce_cnt,
           :shp_contractor,
           :asm_id,
           :dlr_id,
           :spi_id,
           :trn_id,
           :trn_number,
           :trn_date,
           :trn_produce_cnt,
           :trn_produce_cnt_rest,
           :dlr_minsk,
           :opr_id,
           :ord_id,
           :ord_date,
           :ord_number,
           :ord_executed_date,
           :ord_produce_cnt,
           :ord_produce_cnt_executed,
           :ord_produce_cnt_rest,
           :ord_annul
      do
      begin
        prc_produce_cnt = prc_produce_cnt * koef;
        prc_produce_cnt_rest = prc_produce_cnt_rest * koef;
        shp_produce_cnt = shp_produce_cnt * koef;
        trn_produce_cnt = trn_produce_cnt * koef;
        ord_produce_cnt = ord_produce_cnt * koef_inner;
        ord_produce_cnt_rest = ord_produce_cnt_rest * koef_inner;
        ord_produce_cnt_executed = ord_produce_cnt_executed * koef_inner;
        suspend;
      end
    end
    else
    begin
      prc_produce_cnt = prc_produce_cnt * koef;
      prc_produce_cnt_rest = prc_produce_cnt_rest * koef;
      shp_produce_cnt = shp_produce_cnt * koef;
      trn_produce_cnt = trn_produce_cnt * koef;
      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_ORDERS_LOGISTICS (ORD_DATE_BEGIN DATE,
ORD_DATE_END DATE,
INCLUDE_EMPTY_DATES SMALLINT)
RETURNS (ORD_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
CONF_DATE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
CONF_NUM VARCHAR(200) CHARACTER SET UNICODE_FSS,
CONTACT_PERSON VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_DOC_TYPE_NUM VARCHAR(2000) CHARACTER SET UNICODE_FSS,
WEIGHT DECIMAL(15, 3),
"COMMENT" VARCHAR(3000) CHARACTER SET UNICODE_FSS,
INCLUDE_EMPTY_DATES_SORT SMALLINT,
CONF_DATE_SORT DATE,
HAVE_EMPTY_DATE_CONF SMALLINT,
ORD_RECEIVED_CONF_DATE DATE)
AS 
declare variable ORD_ID integer;
declare variable SHP_DOC_TYPE varchar(100);
declare variable SHP_DOC_NUMBER varchar(60);
declare variable ORD_DATE_CONF_ALL smallint;
declare variable ORD_READY_FOR_DELIV_DATE_ALL smallint;
declare variable OPR_ID integer;
declare variable STRDATE varchar(10);
declare variable LOCAL_CONF_DATE date;
declare variable OPR_COUNT decimal(15,2);
declare variable PTR_COUNT decimal(15,2);
declare variable PTR_ID_COUNT integer;
declare variable week varchar(10);
begin

  for
    select ord.ord_id,
           ord.ord_number,
           ctr.ctr_name,
           ord.ord_date_conf,
           ord.ord_date_conf,
           ord.ord_num_conf,
           (select sdt_name from dcl_shp_doc_type where sdt_id = ord.sdt_id) as shp_doc_type,
           ord.ord_shp_doc_number,
           ord.ord_date_conf_all,
           ord.ord_ready_for_deliv_date_all,
           (select cps_name from dcl_contact_person where cps_id = ord.spc_id) as contact_person,
           ord.ord_comment,
           ord.ord_received_conf_date
    from dcl_order ord,
         dcl_contractor ctr
    where
          ctr.ctr_id = ord.ctr_id and
          ord.ord_executed_date is null and
          ord.ord_annul is null and
          (
            (
              ord.ord_date_conf_all is not null and
              ( :ord_date_begin is null or ord.ord_date_conf >= :ord_date_begin ) and
              ( :ord_date_end is null or ord.ord_date_conf <= :ord_date_end )
            )
            or
            (
              ord.ord_date_conf_all is null and
              exists (
                select ptr_id
                from dcl_ord_list_produce opr,
                     dcl_production_term ptr
                where opr.ord_id = ord.ord_id and
                      ptr.opr_id = opr.opr_id and
                      ( :ord_date_begin is null or ptr.ptr_date >= :ord_date_begin ) and
                      ( :ord_date_end is null or ptr.ptr_date <= :ord_date_end )
              )
            )
            or
            (
              :include_empty_dates is not null and
              ord.ord_date_conf_all is null and
              (
                exists (
                  select opr_id
                  from dcl_ord_list_produce opr
                  where opr.ord_id = ord.ord_id and
                        opr.opr_count
                        !=
                        (
                          select sum(ptr.ptr_count)
                          from dcl_production_term ptr
                          where ptr.opr_id = opr.opr_id
                        )
                )
                or
                (
                  (
                    select count(ptr.ptr_id)
                    from  dcl_ord_list_produce opr,
                          dcl_production_term ptr
                    where opr.ord_id = ord.ord_id and
                          ptr.opr_id = opr.opr_id
                  ) = 0
                )
              )
            )
          )
    into  :ord_id,
          :ord_num,
          :contractor,
          :local_conf_date,
          :conf_date_sort,
          :conf_num,
          :shp_doc_type,
          :shp_doc_number,
          :ord_date_conf_all,
          :ord_ready_for_deliv_date_all,
          :contact_person,
          :comment,
          :ord_received_conf_date
  do
  begin
    for
      select opr_id,
             opr_count,
             (
               select sum(ptr.ptr_count)
               from dcl_production_term ptr
               where ptr.opr_id = opr.opr_id
             ),
             (
               select count(ptr.ptr_id)
               from dcl_production_term ptr
               where ptr.opr_id = opr.opr_id
             )
      from dcl_ord_list_produce opr
      where opr.ord_id = :ord_id and
            (
               :ord_date_conf_all is not null
               or
               (
                 :ord_date_conf_all is null and
                 exists (
                 select ptr_id
                  from dcl_production_term ptr
                  where ptr.opr_id = opr.opr_id and
                        ( :ord_date_begin is null or ptr.ptr_date >= :ord_date_begin ) and
                        ( :ord_date_end is null or ptr.ptr_date <= :ord_date_end )
                  )
               )
               or
               (
                 :include_empty_dates is not null and
                 :ord_date_conf_all is null and
                 (
                   opr_count
                   !=
                   (
                     select sum(ptr.ptr_count)
                     from dcl_production_term ptr
                     where ptr.opr_id = opr.opr_id
                   )
                   or
                   (
                     (
                       select count(ptr.ptr_id)
                       from dcl_production_term ptr
                       where ptr.opr_id = opr.opr_id
                     ) = 0
                   )
                 )
               )
            )
      into :opr_id,
           :opr_count,
           :ptr_count,
           :ptr_id_count
    do
    begin
      include_empty_dates_sort = null;
      shp_doc_type_num = null;
      conf_date = null;

      if ( ord_ready_for_deliv_date_all is not null ) then
      begin
        shp_doc_type_num = shp_doc_type || ' <b>' || shp_doc_number || '</b>';
      end
      else
      begin
        shp_doc_type_num = '';
        for
          select sdt.sdt_name,
                 rfs.rfs_number
          from   dcl_ready_for_shipping rfs,
                 dcl_shp_doc_type sdt
          where rfs.opr_id = :opr_id and
                sdt.sdt_id = rfs.sdt_id
          into :shp_doc_type,
               :shp_doc_number
        do
        begin
          shp_doc_type_num = shp_doc_type_num || shp_doc_type || ' <b>' || shp_doc_number || '</b><br>';
        end
      end
      select sum(rfs.rfs_weight) from dcl_ready_for_shipping rfs where rfs.opr_id = :opr_id into :weight;

      if ( ord_date_conf_all is not null ) then
      begin
        select strdate from date2str(:local_conf_date) into :strdate;
        select week_no from YearWeek(:local_conf_date) into :week;
        conf_date = '<b>' || week || ' KW</b><br>(' || strdate || ')';
      end
      else
      begin
        conf_date = '';
        conf_date_sort = null;
        for
          select ptr.ptr_date
          from   dcl_production_term ptr
          where ptr.opr_id = :opr_id and
                ( :ord_date_begin is null or ptr.ptr_date >= :ord_date_begin ) and
                ( :ord_date_end is null or ptr.ptr_date <= :ord_date_end )
          into :local_conf_date
        do
        begin
          if ( conf_date_sort is null ) then
          begin
            conf_date_sort = local_conf_date;
          end 
          if ( local_conf_date < conf_date_sort ) then
          begin
            conf_date_sort = local_conf_date;
          end

          select strdate from date2str(:local_conf_date) into :strdate;
          select week_no from YearWeek(:local_conf_date) into :week;
          conf_date = conf_date || '<b>' || week || ' KW</b><br>(' || strdate || ')<br>';
        end

        if ( include_empty_dates is not null and ( opr_count != ptr_count or ptr_id_count = 0 ) ) then
        begin
          conf_date = conf_date || '<b>CONF_DATE_IS_EMPTY</b>';
          include_empty_dates_sort = 1;
        end
      end

      select have_empty_date_conf from dcl_is_have_empty_date_conf(:ord_id, :opr_id, :ord_date_conf_all) into :have_empty_date_conf;

      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_ORDERS_STATISTICS (DATE_BEGIN DATE,
DATE_END DATE,
DEP_ID_IN INTEGER,
STF_ID_IN INTEGER,
CTR_ID_IN INTEGER,
CTR_ID_FOR_IN INTEGER)
RETURNS (STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
ORD_SUMM DECIMAL(15, 2),
ORD_SUMM_SENT_TO_PROD DECIMAL(15, 2),
ORD_SUMM_PART_EXECUTED DECIMAL(15, 2),
ORD_SUMM_EXECUTED DECIMAL(15, 2),
ORD_SUMM_EXECUTED_BEFORE DECIMAL(15, 2),
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
declare variable ORD_SENT_TO_PROD_DATE date;
declare variable ORD_EXECUTED_DATE date;
declare variable ORD_ID integer;
declare variable OPR_ID integer;
declare variable OPR_COUNT decimal(15,2);
declare variable OPR_COUNT_EXECUTED decimal(15,2);
declare variable OPR_SUMM decimal(15,2);
declare variable ORD_IN_ONE_SPEC smallint;
declare variable ORD_SUM_TOTAL decimal(15,2);
declare variable OPR_SUMM_ALL decimal(15,2);
declare variable OPR_MIN_DATE_EXECUTED date;
declare variable OPR_MAX_DATE_EXECUTED date;
declare variable ORD_DATE date;
begin
  for
    select stf.stf_id,
           stf.stf_name,
           ord.ord_id,
           ord.ord_date, 
           ord.ord_summ,
           cur.cur_id,
           cur.cur_name,
           ord.ord_sent_to_prod_date,
           ord.ord_executed_date,
           ord.ord_in_one_spec
    from   dcl_order ord,
           dcl_stuff_category stf,
           dcl_currency cur,
           dcl_user usr,
           dcl_department dep,
           dcl_user_language usr_lng
    where  stf.stf_id = ord.stf_id and
           (:stf_id_in is null or :stf_id_in = -1 or stf.stf_id = :stf_id_in ) and
           cur.cur_id = ord.cur_id and
           usr.usr_id = ord.usr_id_manager and
           dep.dep_id = usr.dep_id and
           (:dep_id_in is null or :dep_id_in = -1 or dep.dep_id = :dep_id_in ) and
           usr_lng.usr_id = usr.usr_id and
           usr_lng.lng_id = 1 and
           (
             (ord.ord_date >= :date_begin and ord.ord_date <= :date_end ) or
             (ord.ord_sent_to_prod_date >= :date_begin and ord.ord_sent_to_prod_date <= :date_end ) or
             (ord.ord_executed_date is null or (ord.ord_executed_date >= :date_begin and ord.ord_executed_date <= :date_end) )
           ) and
           (:ctr_id_in is null or :ctr_id_in = -1 or ord.ctr_id = :ctr_id_in ) and
           (
             :ctr_id_for_in is null or
             :ctr_id_for_in = -1 or
             ( ord.ctr_id_for = :ctr_id_for_in and ord.ord_in_one_spec is not null ) or
             ( ord.ord_in_one_spec is null and (select count(opr_id) from dcl_ord_list_produce where ord_id = ord.ord_id and ctr_id = :ctr_id_for_in ) > 0 )
           ) and
           ord.ord_annul is null
    into   :stf_id,
           :stf_name,
           :ord_id,
           :ord_date,
           :ord_summ,
           :cur_id,
           :cur_name,
           :ord_sent_to_prod_date,
           :ord_executed_date,
           :ord_in_one_spec
  do
  begin
    select sum(opr_summ) from dcl_ord_list_produce where ord_id = :ord_id into :opr_summ_all;

    if ( ord_in_one_spec is null and ctr_id_for_in is not null and ctr_id_for_in != -1 ) then --calculate part of order sum
    begin
      ord_sum_total = ord_summ; -- for clearness of calculation
      ord_summ = 0;
      for
          select opr_summ
          from dcl_ord_list_produce opr
          where opr.ord_id = :ord_id and
                opr.ctr_id = :ctr_id_for_in
          into :opr_summ
        do
        begin
          if ( opr_summ_all != 0 ) then
          begin
            ord_summ = ord_summ + ord_sum_total / opr_summ_all * opr_summ;
          end
        end
    end
    --in other case - take all sum for order (ord_summ)

    ord_summ_sent_to_prod = 0;
    if ( ord_sent_to_prod_date >= date_begin and ord_sent_to_prod_date <= date_end ) then
    begin
      ord_summ_sent_to_prod = ord_summ;
    end

    ord_summ_part_executed = 0;
    ord_summ_executed = 0;
    ord_summ_executed_before = 0;
    for
      select
        opr_id,
        opr_summ,
        opr_count
      from dcl_ord_list_produce opr,
           dcl_order ord
      where opr.ord_id = :ord_id and
            ord.ord_id = opr.ord_id and
            (:ctr_id_for_in is null or :ctr_id_for_in = -1 or opr.ctr_id = :ctr_id_for_in or ord.ctr_id_for = :ctr_id_for_in )
      into
        :opr_id,
        :opr_summ,
        :opr_count
    do
    begin
      select
        min(opr_date_executed),
        max(opr_date_executed)
      from dcl_opr_list_executed ord_ex,
           dcl_ord_list_produce opr,
           dcl_order ord
      where opr.ord_id = :ord_id and
            ord_ex.opr_id = opr.opr_id and
            ord.ord_id = opr.ord_id and
            (:ctr_id_for_in is null or :ctr_id_for_in = -1 or opr.ctr_id = :ctr_id_for_in or ord.ctr_id_for = :ctr_id_for_in )
      into
        :opr_min_date_executed,
        :opr_max_date_executed;

      if ( ord_sent_to_prod_date >= date_begin and ord_sent_to_prod_date <= date_end ) then
      begin

        if ( ord_executed_date is not null and
             opr_min_date_executed >= date_begin and opr_max_date_executed <= date_end
           ) then
        begin
          ord_summ_executed = ord_summ_executed + opr_summ;
        end

        if ( opr_min_date_executed < date_begin or opr_max_date_executed > date_end or ord_executed_date is null or ord_executed_date < date_begin or ord_executed_date > date_end ) then
        begin
          select coalesce(sum(exe.opr_count_executed), 0)
          from dcl_opr_list_executed exe
          where exe.opr_id = :opr_id and
                exe.opr_date_executed >= :date_begin and
                exe.opr_date_executed <= :date_end
          into :opr_count_executed;

          if (opr_count != 0) then
          begin
            ord_summ_part_executed = ord_summ_part_executed + opr_summ / opr_count * opr_count_executed;
          end
        end

      end

      if ( ord_sent_to_prod_date < date_begin ) then
      begin
        select coalesce(sum(exe.opr_count_executed), 0)
        from dcl_opr_list_executed exe
        where exe.opr_id = :opr_id and
              exe.opr_date_executed >= :date_begin and
              exe.opr_date_executed <= :date_end
        into :opr_count_executed;

        if (opr_count != 0) then
        begin
          ord_summ_executed_before = ord_summ_executed_before + opr_summ / opr_count * opr_count_executed;
        end
      end

    end

    if ( ord_date < date_begin or ord_date > date_end ) then
    begin
      ord_summ = 0;
    end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_ORDERS_UNEXECUTED RETURNS (STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
STF_NAME_SORT VARCHAR(150) CHARACTER SET UNICODE_FSS,
ORD_ID INTEGER,
ORD_DATE DATE,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_NUMBER_SORT VARCHAR(15) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRODUCE_FULL_NAME_SORT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CTN_NUMBER_SORT VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_COUNT DECIMAL(15, 2),
ORD_COUNT_EXECUTED DECIMAL(15, 2),
ORD_COUNT_UNEXECUTED DECIMAL(15, 2))
AS 
begin
  for
    select ord.ord_id,
           ord.ord_date, 
           ord.ord_number,
           opr.opr_count,
           (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id ),
           stf.stf_id,
           stf.stf_name,
           prd.prd_id,
           prd.prd_name,
           prd.prd_type,
           prd.prd_params,
           prd.prd_add_params,
           ctn.ctn_number
    from   dcl_order ord,
           dcl_ord_list_produce opr,
           dcl_stuff_category stf,
           dcl_produce prd,
           dcl_catalog_number ctn
    where  opr.ord_id = ord.ord_id and
           stf.stf_id = ord.stf_id and
           prd.prd_id = opr.prd_id and
           ctn.stf_id = ord.stf_id and
           ctn.prd_id = opr.prd_id and
           ord.ord_executed_date is null and
           ord.ord_sent_to_prod_date is not null and
           opr.opr_count > (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id )
    into   :ord_id,
           :ord_date,
           :ord_number,
           :ord_count,
           :ord_count_executed,
           :stf_id,
           :stf_name,
           :prd_id,
           :produce_name,
           :prd_type,
           :prd_params,
           :prd_add_params,
           :ctn_number
  do
  begin
    ord_count_unexecuted = ord_count - ord_count_executed;

    ord_number_sort = upper(ord_number);
    produce_full_name_sort = upper(produce_name || ' ' || prd_type || ' ' || prd_params || ' ' || prd_add_params);
    stf_name_sort = upper(stf_name);
    ctn_number_sort = upper(ctn_number);

    suspend;
  end
end ^

ALTER PROCEDURE DCL_ORDER_FILTER (ORD_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_CONTRACTOR_FOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_STUFF_CATEGORY_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
ORD_DATE_BEGIN_IN DATE,
ORD_DATE_END_IN DATE,
ORD_SUMM_MIN_IN DECIMAL(18, 2),
ORD_SUMM_MAX_IN DECIMAL(18, 2),
ORD_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
DEP_ID_IN INTEGER,
ORD_EXECUTED_IN SMALLINT,
ORD_READY_FOR_DELIV_IN SMALLINT,
SLN_SELLER_FOR_WHO_IN VARCHAR(100) CHARACTER SET UNICODE_FSS,
STATE_A SMALLINT,
STATE_3 SMALLINT,
STATE_B SMALLINT,
STATE_EXCLAMATION SMALLINT,
STATE_C SMALLINT,
ORD_NUM_CONF_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_ANNUL_NOT_SHOW SMALLINT,
CON_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPC_NUMBER VARCHAR(150) CHARACTER SET UNICODE_FSS)
RETURNS (ORD_ID INTEGER,
ORD_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
ORD_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_CONTRACTOR_FOR VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_SUMM DECIMAL(18, 2),
ORD_SENT_TO_PROD_DATE DATE,
ORD_RECEIVED_CONF_DATE DATE,
ORD_CONF_SENT_DATE DATE,
ORD_READY_FOR_DELIV_DATE DATE,
ORD_READY_FOR_DELIV SMALLINT,
ORD_EXECUTED_DATE DATE,
ORD_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_DEPARTMENT VARCHAR(100) CHARACTER SET UNICODE_FSS,
IS_WARN SMALLINT,
USR_ID_CREATE INTEGER,
ORD_BLOCK SMALLINT,
ORD_DATE_CONF DATE,
COUNT_DAY_CURR_MINUS_SENT INTEGER,
ORD_ANNUL SMALLINT,
ORD_NUM_CONF VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_ARRIVE_IN_LITHUANIA DATE,
DEP_ID INTEGER,
HAVE_EMPTY_DATE_CONF SMALLINT,
ORD_COMMENT_FLAG INTEGER,
ORD_SHIP_FROM_STOCK DATE,
ORD_LINK_TO_SPEC INTEGER)
AS 
declare variable SPC_DELIVERY_DATE date;
declare variable ORD_DATE_CONF_ALL smallint;
declare variable WARN_COUNT integer;
declare variable ORD_READY_FOR_DELIV_DATE_ALL smallint;
declare variable OPR_ID integer;
declare variable OPR_COUNT_EXECUTED decimal(15,2);
declare variable RFS_COUNT decimal(15,3);
declare variable RFS_COUNT_SUM decimal(15,2);
declare variable RFS_DATE date;
declare variable RFS_ARRIVE_IN_LITHUANIA date;
declare variable RFS_SHIP_FROM_STOCK date;
declare variable ORD_IN_ONE_SPEC smallint;
declare variable SPC_ID integer;
declare variable OPR_COUNT integer;
declare variable OPR_COUNT_WITH_SPEC integer;
begin
  ord_number_in = upper(ord_number_in);
  ord_contractor_in = upper(ord_contractor_in);
  ord_contractor_for_in = upper(ord_contractor_for_in);
  ord_stuff_category_in = upper(ord_stuff_category_in);
  ord_user_in = upper(ord_user_in);
  ord_num_conf_in = upper(ord_num_conf_in);
  sln_seller_for_who_in = upper(sln_seller_for_who_in);

  for
    select ord.ord_id,
           ord.ord_number,
           ord.ord_date,
           ctr.ctr_name,
           ord.ord_summ,
           ord.ord_sent_to_prod_date,
           ord.ord_received_conf_date,
           ord.ord_date_conf,
           (select spc.spc_delivery_date from dcl_con_list_spec spc where spc.spc_id = ord.spc_id),
           ord.ord_conf_sent_date,
           ord.ord_ready_for_deliv_date,
           ord.ord_executed_date,
           (select usr_surname || ' ' || usr_name from dcl_user_language  where usr_id = ord.usr_id_create and lng_id = 1),
           ord.usr_id_create,
           ord.ord_block,
           current_date - ord.ord_sent_to_prod_date,
           ord.ord_annul,
           ord.ord_num_conf,
           ord.ord_date_conf_all,
           ord.ord_ready_for_deliv_date_all,
           ord.ord_ship_from_stock,
           ord.ord_arrive_in_lithuania,
           ord.ord_in_one_spec,
           ord.spc_id,
           strlen(ord.ord_comment)
    from dcl_order ord,
         dcl_contractor ctr
    where
          ctr.ctr_id = ord.ctr_id
     and  ( :ord_annul_not_show is null or ( :ord_annul_not_show is not null and ord_annul is null )  )
     and  ( :ord_contractor_in is null or :ord_contractor_in like '' or (select upper(ctr.ctr_name) from dcl_contractor ctr where ctr_id=ord.ctr_id) like('%' || :ord_contractor_in || '%') )
     and  (
            ( :ord_contractor_for_in is null ) or
            ( :ord_contractor_for_in like '') or
            ( ord.ord_in_one_spec is not null and (select upper(ctr1.ctr_name) from dcl_contractor ctr1 where ctr_id = ord.ctr_id_for) like('%' || :ord_contractor_for_in || '%') ) or
            ( ord.ord_in_one_spec is null and (select count(opr.opr_id) from dcl_ord_list_produce opr where opr.ord_id = ord.ord_id and (select upper(ctr1.ctr_name) from dcl_contractor ctr1 where ctr_id = opr.ctr_id) like('%' || :ord_contractor_for_in || '%') ) > 0 )
          )
     and  ( :ord_stuff_category_in is null or :ord_stuff_category_in like '' or (select upper(stf.stf_name) from dcl_stuff_category stf where stf_id=ord.stf_id) like('%' || :ord_stuff_category_in || '%') )
     and  ( :ord_executed_in is null or ( :ord_executed_in = 1 and ord_executed_date is not null ) or ( :ord_executed_in = 0 and ord_executed_date is null ) )
     and  (( :ord_num_conf_in is not null and :ord_num_conf_in not like '' ) or ( :state_a is null ) or ( :state_a = 1 and ord_sent_to_prod_date is not null and ord_received_conf_date is null ) )
     and  (( :ord_num_conf_in is not null and :ord_num_conf_in not like '' ) or ( :state_3 is null ) or ( :state_3 = 1 and ( current_date - ord_sent_to_prod_date > 3 ) and ord_received_conf_date is null ) )
     and  (( :ord_num_conf_in is not null and :ord_num_conf_in not like '' ) or ( :state_b is null ) or ( :state_b = 1 and ord_received_conf_date is not null and ord_conf_sent_date is null ) )
     and  (( :ord_num_conf_in is not null and :ord_num_conf_in not like '' ) or ( :state_c is null ) or ( :state_c = 1 and ord_conf_sent_date is not null and ord_executed_date is null ) )
     and  ( :ord_date_begin_in is null or ord_date >=:ord_date_begin_in )
     and  ( :ord_date_end_in is null or ord_date <=:ord_date_end_in )
     and  ( :ord_summ_min_in is null or ord_summ >=:ord_summ_min_in )
     and  ( :ord_summ_max_in is null or ord_summ <=:ord_summ_max_in )
     and  ( :ord_user_in is null or :ord_user_in like '' or (select upper(usr.usr_surname || ' ' || usr.usr_name) from dcl_user_language usr where usr_id = ord.usr_id_create and lng_id = 1) like('%' || :ord_user_in || '%') )
     and  ( :dep_id_in is null or :dep_id_in = -1 or (select dep_id from dcl_user  where usr_id = ord.usr_id_create) = :dep_id_in )
     and  ( :ord_number_in is null or :ord_number_in like '' or upper(ord.ord_number) like('%' || :ord_number_in || '%') )
     and  ( :ord_num_conf_in is null or :ord_num_conf_in like '' or upper(ord.ord_num_conf) like('%' || :ord_num_conf_in || '%') )
     and  ( :con_number is null or :con_number like ''
          or ( ord.ord_in_one_spec is not null and exists(select 1 from dcl_con_list_spec spc left join dcl_contract con on spc.con_id=con.con_id
                                                                  where ord.spc_id = spc.spc_id and upper(con.con_number) like upper(:con_number)))
          or (ord.ord_in_one_spec is null and exists(select 1 from dcl_ord_list_produce opr left join dcl_con_list_spec spc on opr.spc_id = spc.spc_id
                left join dcl_contract con on spc.con_id = con.con_id where opr.ord_id = ord.ord_id and upper(con.con_number) like upper(:con_number))))
     and  (:spc_number is null or :spc_number like ''
          or ( ord.ord_in_one_spec is not null and exists(select 1 from dcl_con_list_spec spc
                                                                  where ord.spc_id = spc.spc_id and upper(spc.spc_number) like upper(:spc_number)))
          or (ord.ord_in_one_spec is null and exists(select 1 from dcl_ord_list_produce opr left join dcl_con_list_spec spc on opr.spc_id = spc.spc_id
                                                            where opr.ord_id = ord.ord_id and upper(spc.spc_number) like upper(:spc_number))))
     and  ( :sln_seller_for_who_in is null or :sln_seller_for_who_in like '' or ( (select upper(sln.sln_name) from dcl_seller sln where sln_id = ord.sln_id_for_who) like('%' || :sln_seller_for_who_in || '%') ))
    into  :ord_id,
          :ord_number,
          :ord_date,
          :ord_contractor,
          :ord_summ,
          :ord_sent_to_prod_date,
          :ord_received_conf_date,
          :ord_date_conf,
          :spc_delivery_date,
          :ord_conf_sent_date,
          :ord_ready_for_deliv_date,
          :ord_executed_date,
          :ord_user,
          :usr_id_create,
          :ord_block,
          :count_day_curr_minus_sent,
          :ord_annul,
          :ord_num_conf,
          :ord_date_conf_all,
          :ord_ready_for_deliv_date_all,
          :ord_ship_from_stock,
          :ord_arrive_in_lithuania,
          :ord_in_one_spec,
          :spc_id,
          :ord_comment_flag
  do
  begin
    if ( ord_ready_for_deliv_date_all is null and ord_ready_for_deliv_date is null ) then --searsh ord_ready_for_deliv_date in dcl_ready_for_shipping
    begin
      for
        select
          opr.opr_id,
          exe.opr_count_executed
        from dcl_ord_list_produce opr,
             dcl_opr_list_executed exe
        where opr.ord_id = :ord_id and
              exe.opr_id = opr.opr_id
        into
          :opr_id,
          :opr_count_executed
      do
      begin
        rfs_count_sum = 0;
        for
          select
            rfs_count,
            rfs_date,
            rfs_ship_from_stock,
            rfs_arrive_in_lithuania
          from dcl_ready_for_shipping
          where opr_id = :opr_id
          order by rfs_date
          into
            :rfs_count,
            :rfs_date,
            :rfs_ship_from_stock,
            :rfs_arrive_in_lithuania
        do
        begin
          rfs_count_sum = rfs_count_sum + rfs_count;
          if ( rfs_count_sum > opr_count_executed ) then
          begin
            if ( ord_ready_for_deliv_date is null ) then
            begin
              ord_ready_for_deliv_date = rfs_date;
            end
            if ( rfs_date < ord_ready_for_deliv_date ) then
            begin
              ord_ready_for_deliv_date = rfs_date;
            end
            if ( ord_arrive_in_lithuania is null ) then
            begin
              ord_arrive_in_lithuania = rfs_arrive_in_lithuania;
            end
            if ( rfs_arrive_in_lithuania < ord_arrive_in_lithuania ) then
            begin
              ord_arrive_in_lithuania = rfs_arrive_in_lithuania;
            end
            if ( ord_ship_from_stock is null ) then
            begin
              ord_ship_from_stock = rfs_ship_from_stock;
            end
            if ( rfs_ship_from_stock < ord_ship_from_stock ) then
            begin
              ord_ship_from_stock = rfs_ship_from_stock;
            end
            break;
          end
        end
      end
    end
    ord_ready_for_deliv = null;
    if ( ord_ready_for_deliv_in is not null ) then
    begin
      if ( ord_ready_for_deliv_date is not null ) then
      begin
        ord_ready_for_deliv = 1;
      end
    end
    if ( ord_executed_date is null ) then
    begin
      is_warn = null;
      if ( ord_date_conf is not null or ord_date_conf_all is not null ) then
      begin
        select is_warn from dcl_is_warm_by_delivery_date(:ord_date_conf, :spc_delivery_date) into :is_warn;
      end
      if ( ord_date_conf is null and ord_date_conf_all is null ) then
      begin
        warn_count = 0;
        select count(ptr_id)
        from dcl_ord_list_produce opr,
             dcl_production_term ptr
        where opr.ord_id = :ord_id and
              ptr.opr_id = opr.opr_id and
              ( select is_warn from dcl_is_warm_by_delivery_date(ptr.ptr_date, :spc_delivery_date) ) is not null
        into :warn_count;
        if ( warn_count > 0 ) then
        begin
          is_warn = 1;
        end
      end
    end
    else
    begin
      is_warn = null;
    end
    if (
         state_exclamation is null or
         ( :ord_num_conf_in is not null and :ord_num_conf_in not like '' ) or
         ( state_exclamation = 1 and is_warn = 1 )
       ) then
    begin
      select contractors from dcl_get_contractor_for_for_ord(:ord_id, '<br>') into :ord_contractor_for;
      dep_id = null;
      ord_department = null;
      select dep_id from dcl_user where usr_id = :usr_id_create into :dep_id;
      select dep_name from dcl_department where dep_id = :dep_id into :ord_department;
      select have_empty_date_conf from dcl_is_have_empty_date_conf(:ord_id, null, :ord_date_conf_all) into :have_empty_date_conf;

      if (:ord_in_one_spec is not null) then
      begin
        if (spc_id is null) then
        begin
          ord_link_to_spec = 1;
        end
        else
        begin
          ord_link_to_spec = 3;
        end
      end
      else
      begin
        select count(opr_id) from dcl_ord_list_produce where ord_id = :ord_id into :opr_count;
        select count(opr_id) from dcl_ord_list_produce where ord_id = :ord_id and spc_id is not null into :opr_count_with_spec;

        if (opr_count_with_spec = 0) then
        begin
          ord_link_to_spec = 1;
        end
        else if (opr_count_with_spec = opr_count) then
        begin
          ord_link_to_spec = 3;
        end
        else
        begin
          ord_link_to_spec = 2;
        end
      end

      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_ORDER_INSERT (ORD_DATE DATE,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
BLN_ID INTEGER,
CTR_ID INTEGER,
CPS_ID INTEGER,
ORD_CONCERNING VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_PREAMBLE VARCHAR(1000) CHARACTER SET UNICODE_FSS,
TRM_ID INTEGER,
ORD_ADDR VARCHAR(256) CHARACTER SET UNICODE_FSS,
ORD_PAY_CONDITION VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_DELIVERY_TERM VARCHAR(300) CHARACTER SET UNICODE_FSS,
ORD_ADD_INFO VARCHAR(5000) CHARACTER SET UNICODE_FSS,
USR_ID_DIRECTOR INTEGER,
USR_ID_LOGIST INTEGER,
USR_ID_DIRECTOR_RB INTEGER,
USR_ID_CHIEF_DEP INTEGER,
USR_ID_MANAGER INTEGER,
CTR_ID_FOR INTEGER,
SPC_ID INTEGER,
STF_ID INTEGER,
ORD_SENT_TO_PROD_DATE DATE,
ORD_RECEIVED_CONF_DATE DATE,
ORD_NUM_CONF VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_DATE_CONF DATE,
ORD_CONF_SENT_DATE DATE,
ORD_READY_FOR_DELIV_DATE DATE,
ORD_EXECUTED_DATE DATE,
ORD_BLOCK SMALLINT,
ORD_SUMM DECIMAL(15, 2),
ORD_DELIVERY_COST_BY VARCHAR(50) CHARACTER SET UNICODE_FSS,
ORD_DELIVERY_COST DECIMAL(15, 2),
ORD_DONOT_CALCULATE_NETTO SMALLINT,
CUR_ID INTEGER,
ORD_INCLUDE_NDS SMALLINT,
ORD_NDS_RATE DECIMAL(15, 2),
SLN_ID_FOR_WHO INTEGER,
SLN_ID INTEGER,
ORD_DISCOUNT_ALL SMALLINT,
ORD_DISCOUNT DECIMAL(15, 2),
ORD_COUNT_ITOG_FLAG SMALLINT,
ORD_ADD_REDUCTION_FLAG SMALLINT,
ORD_ADD_REDUCTION DECIMAL(15, 2),
ORD_ADD_RED_PRE_PAY_FLAG SMALLINT,
ORD_ADD_RED_PRE_PAY DECIMAL(15, 2),
ORD_ALL_INCLUDE_IN_SPEC SMALLINT,
ORD_ANNUL SMALLINT,
ORD_IN_ONE_SPEC SMALLINT,
ORD_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
ORD_COMMENT_COVERING_LETTER VARCHAR(1000) CHARACTER SET UNICODE_FSS,
ORD_DATE_CONF_ALL SMALLINT,
ORD_READY_FOR_DELIV_DATE_ALL SMALLINT,
SDT_ID INTEGER,
ORD_SHP_DOC_NUMBER VARCHAR(60) CHARACTER SET UNICODE_FSS,
ORD_BY_GUARANTY SMALLINT,
ORD_SHIP_FROM_STOCK DATE,
ORD_ARRIVE_IN_LITHUANIA DATE,
ORD_PRINT_SCALE INTEGER,
ORD_LETTER_SCALE INTEGER,
ORD_LOGIST_SIGNATURE SMALLINT,
ORD_DIRECTOR_RB_SIGNATURE SMALLINT,
ORD_CHIEF_DEP_SIGNATURE SMALLINT,
ORD_MANAGER_SIGNATURE SMALLINT)
RETURNS (ORD_ID INTEGER)
AS 
begin

  insert into dcl_order (
      ord_number,
      ord_date,
      bln_id,
      ctr_id,
      cps_id,
      ord_concerning,
      ord_preamble,
      ord_delivery_term,
      ord_pay_condition,
      ord_addr,
      trm_id,
      ord_add_info,
      usr_id_director,
      usr_id_logist,
      usr_id_director_rb,
      usr_id_chief_dep,
      usr_id_manager,
      ctr_id_for,
      spc_id,
      stf_id,
      ord_sent_to_prod_date,
      ord_received_conf_date,
      ord_num_conf,
      ord_date_conf,
      ord_conf_sent_date,
      ord_ready_for_deliv_date,
      ord_executed_date,
      ord_block,
      ord_summ,
      ord_delivery_cost_by,
      ord_delivery_cost,
      ord_donot_calculate_netto,
      cur_id,
      ord_include_nds,
      ord_nds_rate,
      sln_id_for_who,
      sln_id,
      ord_discount_all,
      ord_discount,
      ord_count_itog_flag,
      ord_add_reduction_flag,
      ord_add_reduction,
      ord_add_red_pre_pay_flag,
      ord_add_red_pre_pay,
      ord_all_include_in_spec,
      ord_annul,
      ord_in_one_spec,
      ord_comment,
      ord_comment_covering_letter,
      ord_date_conf_all,
      ord_ready_for_deliv_date_all,
      sdt_id,
      ord_shp_doc_number,
      ord_by_guaranty,
      ord_ship_from_stock,
      ord_arrive_in_lithuania,
      ord_print_scale,
      ord_letter_scale,
      ord_logist_signature,
      ord_director_rb_signature,
      ord_chief_dep_signature,
      ord_manager_signature
    )
    values (
      :ord_number,
      :ord_date,
      :bln_id,
      :ctr_id,
      :cps_id,
      :ord_concerning,
      :ord_preamble,
      :ord_delivery_term,
      :ord_pay_condition,
      :ord_addr,
      :trm_id,
      :ord_add_info,
      :usr_id_director,
      :usr_id_logist,
      :usr_id_director_rb,
      :usr_id_chief_dep,
      :usr_id_manager,
      :ctr_id_for,
      :spc_id,
      :stf_id,
      :ord_sent_to_prod_date,
      :ord_received_conf_date,
      :ord_num_conf,
      :ord_date_conf,
      :ord_conf_sent_date,
      :ord_ready_for_deliv_date,
      :ord_executed_date,
      :ord_block,
      :ord_summ,
      :ord_delivery_cost_by,
      :ord_delivery_cost,
      :ord_donot_calculate_netto,
      :cur_id,
      :ord_include_nds,
      :ord_nds_rate,
      :sln_id_for_who,
      :sln_id,
      :ord_discount_all,
      :ord_discount,
      :ord_count_itog_flag,
      :ord_add_reduction_flag,
      :ord_add_reduction,
      :ord_add_red_pre_pay_flag,
      :ord_add_red_pre_pay,
      :ord_all_include_in_spec,
      :ord_annul,
      :ord_in_one_spec,
      :ord_comment,
      :ord_comment_covering_letter,
      :ord_date_conf_all,
      :ord_ready_for_deliv_date_all,
      :sdt_id,
      :ord_shp_doc_number,
      :ord_by_guaranty,
      :ord_ship_from_stock,
      :ord_arrive_in_lithuania,
      :ord_print_scale,
      :ord_letter_scale,
      :ord_logist_signature,
      :ord_director_rb_signature,
      :ord_chief_dep_signature,
      :ord_manager_signature
    )
    returning ord_id into :ord_id;

  suspend;
end ^

ALTER PROCEDURE DCL_ORDER_LOAD_CONTRACT (ORD_ID INTEGER)
RETURNS (CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
declare variable SPC_ID integer;
begin
  con_number = null;
  con_date = null;
  cur_name = null;

  select spc_id from dcl_order where ord_id = :ord_id into spc_id;
  if ( spc_id is not null ) then
  begin
    select 
      con.con_number,
      con.con_date,
      cur.cur_name
    from dcl_con_list_spec spc,
         dcl_contract con,
         dcl_currency cur
    where spc.spc_id = :spc_id and
          con.con_id = spc.con_id and
          cur.cur_id = con.cur_id
    into
      :con_number,
      :con_date,
      :cur_name
    ;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_ORD_LIST_PRD_LOAD_PARENT (OPR_PARENT_ID_IN INTEGER)
RETURNS (OPR_ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
OPR_COUNT_EXECUTED INTEGER)
AS 
begin
  for
    select
      opr_id
    from
      dcl_ord_list_produce opr
    where opr.opr_parent_id = :opr_parent_id_in
    order by opr_id
    into
      :opr_id
  do
  begin
    select
      opr_id,
      prd_id,
      stf_id,
      opr_count_executed
    from dcl_ord_list_produce_load(:opr_id)
    into
      :opr_id,
      :prd_id,
      :stf_id,
      :opr_count_executed
    ;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_ORD_LIST_PRODUCES_LOAD (ORD_ID_IN INTEGER,
CLONE SMALLINT)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
OPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
OPR_COUNT DECIMAL(15, 2),
OPR_PRICE_BRUTTO DECIMAL(15, 2),
OPR_DISCOUNT DECIMAL(15, 2),
OPR_PRICE_NETTO DECIMAL(15, 2),
OPR_SUMM DECIMAL(15, 2),
OPR_USE_PREV_NUMBER CHAR(1) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
OPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
DRP_PRICE DECIMAL(15, 2),
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
OPR_COUNT_OCCUPIED DECIMAL(15, 2),
OPR_OCCUPIED INTEGER,
SPECIFICATION_NUMBERS VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_PARENT_ID INTEGER,
OPR_HAVE_DEPEND SMALLINT,
DRP_MAX_EXTRA SMALLINT,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
SLN_IS_RESIDENT SMALLINT)
AS 
declare variable PRD_BLOCK smallint;
begin
  ord_id = ord_id_in;

  for
    select
      opr_id
    from
      dcl_ord_list_produce opr
    where opr.ord_id = :ord_id_in
    order by opr_id
    into
      :opr_id
  do
  begin
    select
      opr_id,
      ord_id,
      opr_produce_name,
      opr_catalog_num,
      opr_count,
      opr_price_brutto,
      opr_discount,
      opr_price_netto,
      opr_summ,
      opr_use_prev_number,
      prd_id,
      prd_block,
      opr_count_executed,
      opr_comment,
      drp_price,
      ctr_id,
      ctr_name,
      con_id,
      con_number,
      spc_id,
      spc_number,
      stf_id,
      opr_count_occupied,
      opr_occupied,
      specification_numbers,
      opr_parent_id,
      opr_have_depend,
      drp_max_extra,
      sln_id,
      sln_name,
      sln_is_resident
    from dcl_ord_list_produce_load(:opr_id)
    into
      :opr_id,
      :ord_id,
      :opr_produce_name,
      :opr_catalog_num,
      :opr_count,
      :opr_price_brutto,
      :opr_discount,
      :opr_price_netto,
      :opr_summ,
      :opr_use_prev_number,
      :prd_id,
      :prd_block,
      :opr_count_executed,
      :opr_comment,
      :drp_price,
      :ctr_id,
      :ctr_name,
      :con_id,
      :con_number,
      :spc_id,
      :spc_number,
      :stf_id,
      :opr_count_occupied,
      :opr_occupied,
      :specification_numbers,
      :opr_parent_id,
      :opr_have_depend,
      :drp_max_extra,
      :sln_id,
      :sln_name,
      :sln_is_resident
    ;

    if ( clone is null or prd_block is null ) then
    begin
      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_ORD_LIST_PRODUCE_INSERT (ORD_ID INTEGER,
OPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
OPR_COUNT DECIMAL(15, 2),
OPR_PRICE_BRUTTO DECIMAL(15, 2),
OPR_DISCOUNT DECIMAL(15, 2),
OPR_PRICE_NETTO DECIMAL(15, 2),
OPR_SUMM DECIMAL(15, 2),
OPR_USE_PREV_NUMBER CHAR(1) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
DRP_PRICE DECIMAL(15, 2),
CTR_ID INTEGER,
SPC_ID INTEGER,
OPR_PARENT_ID INTEGER,
OPR_HAVE_DEPEND SMALLINT,
DRP_MAX_EXTRA SMALLINT)
RETURNS (OPR_ID INTEGER)
AS 
begin

  insert into dcl_ord_list_produce (
      ord_id,
      opr_produce_name,
      opr_catalog_num,
      opr_count,
      opr_price_brutto,
      opr_discount,
      opr_price_netto,
      opr_summ,
      opr_use_prev_number,
      prd_id,
      opr_comment,
      drp_price,
      ctr_id,
      spc_id,
      opr_parent_id,
      opr_have_depend,
      drp_max_extra
  )
  values (
      :ord_id,
      :opr_produce_name,
      :opr_catalog_num,
      :opr_count,
      :opr_price_brutto,
      :opr_discount,
      :opr_price_netto,
      :opr_summ,
      :opr_use_prev_number,
      :prd_id,
      :opr_comment,
      :drp_price,
      :ctr_id,
      :spc_id,
      :opr_parent_id,
      :opr_have_depend,
      :drp_max_extra
  )
  returning opr_id into :opr_id;

  suspend;
end ^

ALTER PROCEDURE DCL_ORD_LIST_PRODUCE_LOAD (OPR_ID_IN INTEGER)
RETURNS (OPR_ID INTEGER,
ORD_ID INTEGER,
OPR_PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_CATALOG_NUM VARCHAR(50) CHARACTER SET UNICODE_FSS,
OPR_COUNT DECIMAL(15, 2),
OPR_PRICE_BRUTTO DECIMAL(15, 2),
OPR_DISCOUNT DECIMAL(15, 2),
OPR_PRICE_NETTO DECIMAL(15, 2),
OPR_SUMM DECIMAL(15, 2),
OPR_USE_PREV_NUMBER CHAR(1) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
PRD_BLOCK SMALLINT,
OPR_COUNT_EXECUTED DECIMAL(15, 2),
OPR_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS,
DRP_PRICE DECIMAL(15, 2),
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE VARCHAR(10) CHARACTER SET UNICODE_FSS,
SPC_DELIVERY_DATE DATE,
STF_ID INTEGER,
OPR_COUNT_OCCUPIED DECIMAL(15, 2),
OPR_OCCUPIED INTEGER,
SPECIFICATION_NUMBERS VARCHAR(1000) CHARACTER SET UNICODE_FSS,
OPR_PARENT_ID INTEGER,
OPR_HAVE_DEPEND SMALLINT,
DRP_MAX_EXTRA SMALLINT,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
SLN_IS_RESIDENT SMALLINT)
AS 
declare variable SPI_NUMBER varchar(100);
begin
  opr_id = null;
  ord_id = null;
  opr_produce_name = null;
  opr_catalog_num = null;
  opr_count = null;
  opr_price_brutto = null;
  opr_discount = null;
  opr_price_netto = null;
  opr_summ = null;
  opr_use_prev_number = null;
  prd_id = null;
  prd_block = null;
  opr_count_executed = null;
  opr_comment = null;
  drp_price = null;
  ctr_id = null;
  ctr_name = null;
  con_id = null;
  con_number = null;
  con_date = null;
  cur_name = null;
  spc_id = null;
  spc_number = null;
  spc_date = null;
  spc_delivery_date = null;
  stf_id = null;
  opr_count_occupied = null;
  opr_occupied = null;
  specification_numbers = '';
  opr_parent_id = null;
  opr_have_depend = null;
  drp_max_extra = null;

  select
    opr.opr_id,
    opr.ord_id,
    opr.opr_produce_name,
    opr.opr_catalog_num,
    opr.opr_count,
    opr.opr_price_brutto,
    opr.opr_discount,
    opr.opr_price_netto,
    opr.opr_summ,
    opr.opr_use_prev_number,
    opr.prd_id,
    (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id and exe.opr_fictive_executed is null ),
    opr.opr_comment,
    opr.drp_price,
    opr.ctr_id,
    (select ctr_name from dcl_contractor where ctr_id = opr.ctr_id),
    opr.spc_id,
    ord.stf_id,
    (
      (select coalesce(sum(drp.drp_count), 0) from dcl_dlr_list_produce drp, dcl_delivery_request dlr where drp.opr_id = opr.opr_id and dlr.dlr_id = drp.dlr_id and dlr.dlr_annul is null)
      +
      (select coalesce(sum(lpc.lpc_count), 0) from dcl_prc_list_produce lpc where lpc.opr_id = opr.opr_id)
      +
      (select coalesce(sum(sip.sip_count), 0) from dcl_spi_list_produce sip where sip.opr_id = opr.opr_id)
      +
      (select out_count from dcl_get_count_opr_used_in_asm(opr.opr_id) )
    ),
    (select opr_id from DCL_OCCUPIED_ORD_PRODUCE_V where opr_id = opr.opr_id),
    opr.opr_parent_id,
    opr.opr_have_depend,
    opr.drp_max_extra
  from dcl_ord_list_produce opr,
       dcl_order ord
  where opr.opr_id = :opr_id_in and
        ord.ord_id = opr.ord_id
  into
    :opr_id,
    :ord_id,
    :opr_produce_name,
    :opr_catalog_num,
    :opr_count,
    :opr_price_brutto,
    :opr_discount,
    :opr_price_netto,
    :opr_summ,
    :opr_use_prev_number,
    :prd_id,
    :opr_count_executed,
    :opr_comment,
    :drp_price,
    :ctr_id,
    :ctr_name,
    :spc_id,
    :stf_id,
    :opr_count_occupied,
    :opr_occupied,
    :opr_parent_id,
    :opr_have_depend,
    :drp_max_extra
  ;

  if ( spc_id is not null ) then
  begin
    select 
      spc.spc_number,
      spc.spc_date,
      spc.spc_delivery_date,
      con.con_id,
      con.con_number,
      con.con_date,
      cur.cur_name,
      con.sln_id,
      sln.sln_name,
      sln.sln_is_resident
    from dcl_con_list_spec spc,
         dcl_contract con,
         dcl_currency cur,
         dcl_seller sln
    where spc.spc_id = :spc_id and
          con.con_id = spc.con_id and
          cur.cur_id = con.cur_id and
          sln.sln_id = con.sln_id
    into
      :spc_number,
      :spc_date,
      :spc_delivery_date,
      :con_id,
      :con_number,
      :con_date,
      :cur_name,
      :sln_id,
      :sln_name,
      :sln_is_resident
    ;
  end

  for
    select distinct(spi.spi_number)
    from dcl_spi_list_produce sip,
         dcl_specification_import spi
    where sip.opr_id = :opr_id and
          spi.spi_id = sip.spi_id
    into :spi_number
  do
  begin
    specification_numbers = specification_numbers || spi_number || ', ';
  end

  if ( prd_id is not null ) then
  begin
    select prd_block from dcl_produce where prd_id = :prd_id into :prd_block;
  end

  suspend;
end ^

ALTER PROCEDURE DCL_ORD_MESSAGES_LOAD (USR_ID_IN INTEGER)
RETURNS (ORM_ID INTEGER,
ORM_CREATE_DATE TIMESTAMP,
ORM_MESSAGE VARCHAR(256) CHARACTER SET UNICODE_FSS,
CTR_NAME VARCHAR(2000) CHARACTER SET UNICODE_FSS)
AS 
declare variable ORD_ID integer;
declare variable PRC_ID integer;
declare variable ORD_ALL_INCLUDE_IN_SPEC smallint;
declare variable CTR_NAME_LOCAL varchar(200);
declare variable SIP_ID integer;
declare variable ORD_ID_LOCAL integer;
begin
  for
    select
      ord_id,
      prc_id, 
      orm_id,
      orm_create_date,
      orm_message
    from
      dcl_ord_message orm
    where orm.usr_id = :usr_id_in
    order by orm_create_date descending
    into
      :ord_id,
      :prc_id,
      :orm_id,
      :orm_create_date,
      :orm_message
  do
  begin
    ctr_name = '';

    if (prc_id is null) then
    begin
        select ord_all_include_in_spec from dcl_order where ord_id = :ord_id into :ord_all_include_in_spec;
        if (ord_all_include_in_spec is not null) then
        begin
            select ctr.ctr_name
            from   dcl_order ord,
                   dcl_contractor ctr
            where  ord.ord_id = :ord_id and
                   ord.ctr_id_for is not null and
                   ctr.ctr_id = ord.ctr_id_for
            into :ctr_name;
        end
        else
        begin
            for
                select ctr.ctr_name
                from   dcl_ord_list_produce opr,
                       dcl_contractor ctr
                where  opr.ord_id = :ord_id and
                       opr.ctr_id is not null and
                       ctr.ctr_id = opr.ctr_id
                into   :ctr_name_local
            do
            begin
                if(position (ctr_name_local, ctr_name) = 0) then ctr_name = :ctr_name || :ctr_name_local || ', ';
            end
        end
    end
    else
    begin
        for
            select sip_id
            from   dcl_prc_list_produce
            where  prc_id = :prc_id and
                   sip_id is not null
            into  :sip_id
        do
        begin
            for
                select ctr_name,
                       ord_id
                from dcl_spi_list_produce_load(:sip_id)
                into   :ctr_name_local,
                       :ord_id_local
            do
            begin
                if (ord_id_local is not null and ord_id_local = :ord_id and ord_id_local is not null) then
                begin
                    if(position (ctr_name_local, ctr_name) = 0) then ctr_name = :ctr_name || :ctr_name_local || ', ';
                end
            end
        end
    end

    if (char_length(ctr_name) > 2 ) then
      begin
        ctr_name = substring(ctr_name from 1 for char_length(ctr_name) - 2);
      end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_OUTGOING_LETTER_FILTER (OTL_NUMBER_IN VARCHAR(15) CHARACTER SET UNICODE_FSS,
OTL_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
OTL_DATE_BEGIN_IN DATE,
OTL_DATE_END_IN DATE,
OTL_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
SLN_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (OTL_ID INTEGER,
OTL_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
OTL_DATE DATE,
OTL_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
ATTACH_IDX INTEGER)
AS 
declare variable OTL_ATTACH_COUNT integer;
begin
  otl_number_in = upper(otl_number_in);
  otl_contractor_in = upper(otl_contractor_in);
  otl_user_in = upper(otl_user_in);
  sln_seller_in = upper(sln_seller_in);

  for
    select otl.otl_id,
           otl.otl_number,
           otl.otl_date,
           ctr.ctr_name
    from dcl_outgoing_letter otl,
         dcl_contractor ctr
    where
          ctr.ctr_id = otl.ctr_id
     and  ( :otl_date_begin_in is null or otl_date >= :otl_date_begin_in )
     and  ( :otl_date_end_in is null or otl_date <= :otl_date_end_in )
     and  ( :otl_number_in is null or :otl_number_in like '' or upper(otl.otl_number) like('%' || :otl_number_in || '%') )
     and  ( :otl_contractor_in is null or :otl_contractor_in like '' or upper(ctr.ctr_name) like('%' || :otl_contractor_in || '%') )
     and  ( :otl_user_in is null or :otl_user_in like '' or (select upper(usr.usr_surname || ' ' || usr.usr_name) from dcl_user_language usr where usr_id = otl.usr_id_create and lng_id = 1) like('%' || :otl_user_in || '%') )
     and  ( :sln_seller_in is null or :sln_seller_in like '' or ( (select upper(sln.sln_name) from dcl_seller sln where sln_id = otl.sln_id) like('%' || :sln_seller_in || '%') ))
    order by otl_date descending, otl_number descending
    into  :otl_id,
          :otl_number,
          :otl_date,
          :otl_contractor
  do
  begin
    select count(*) from dcl_attachment where att_parent_id = :otl_id and att_parent_table='DCL_OUTGOING_LETTER' into :otl_attach_count;

    attach_idx = null;
    if ( otl_attach_count = 0 ) then
    begin
     attach_idx = 1;
    end
    if ( otl_attach_count > 0 ) then
    begin
     attach_idx = 6;
    end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_OUTGOING_LETTER_INSERT (OTL_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
OTL_DATE DATE,
SLN_ID INTEGER,
CTR_ID INTEGER,
CPS_ID INTEGER,
OTL_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
RETURNS (OTL_ID INTEGER)
AS 
begin

  insert into dcl_outgoing_letter (
     otl_number,
     otl_date,
     sln_id,
     ctr_id,
     cps_id,
     otl_comment
    )
    values (
     :otl_number,
     :otl_date,
     :sln_id,
     :ctr_id,
     :cps_id,
     :otl_comment
   )
   returning otl_id into :otl_id;

  suspend;
end ^

ALTER PROCEDURE DCL_OUTGOING_LETTER_LOAD (OTL_ID INTEGER)
RETURNS (USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
OTL_CREATE_DATE TIMESTAMP,
OTL_EDIT_DATE TIMESTAMP,
OTL_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
OTL_DATE DATE,
SLN_ID INTEGER,
SLN_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CPS_ID INTEGER,
CPS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
OTL_COMMENT VARCHAR(5000) CHARACTER SET UNICODE_FSS)
AS 
begin
  select otl.usr_id_create,
         otl.usr_id_edit,
         otl.otl_create_date,
         otl.otl_edit_date,
         otl.otl_number,
         otl.otl_date,
         otl.sln_id,
         sln.sln_name,
         otl.ctr_id,
         ctr.ctr_name,
         otl.cps_id,
         cps.cps_name,
         otl.otl_comment
  from   dcl_outgoing_letter otl
         left join dcl_contact_person cps on cps.cps_id = otl.cps_id,
         dcl_contractor ctr,
         dcl_seller sln
  where otl.otl_id = :otl_id and
        ctr.ctr_id = otl.ctr_id and
        sln.sln_id = otl.sln_id
  into  :usr_id_create,
        :usr_id_edit,
        :otl_create_date,
        :otl_edit_date,
        :otl_number,
        :otl_date,
        :sln_id,
        :sln_name,
        :ctr_id,
        :ctr_name,
        :cps_id,
        :cps_name,
        :otl_comment
  ;

  suspend;
end ^

ALTER PROCEDURE DCL_PAYMENT_FILTER (PAY_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
PAY_CONTRACTOR_ID_IN INTEGER,
PAY_DATE_BEGIN_IN DATE,
PAY_DATE_END_IN DATE,
PAY_SUMM_MIN_IN DECIMAL(15, 2),
PAY_SUMM_MAX_IN DECIMAL(15, 2),
PAY_BLOCK_IN SMALLINT,
CUR_ID_IN INTEGER,
PAY_CLOSED_IN INTEGER,
PAY_ACCOUNT_IN VARCHAR(35) CHARACTER SET UNICODE_FSS)
RETURNS (PAY_ID INTEGER,
PAY_DATE DATE,
PAY_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
PAY_SUMM DECIMAL(15, 2),
PAY_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PAY_BLOCK SMALLINT,
USR_ID_CREATE INTEGER,
PAY_ACCOUNT VARCHAR(35) CHARACTER SET UNICODE_FSS,
PAY_COURSE DECIMAL(15, 6),
PAY_SUMM_EUR DECIMAL(15, 2),
DOUBLE_ACCOUNT SMALLINT,
DOUBLE_CONTRACTORS VARCHAR(800) CHARACTER SET UNICODE_FSS,
PAY_COURSE_NBRB DECIMAL(15, 6),
PAY_SUMM_EUR_NBRB DECIMAL(15, 2),
PAY_COMMENT VARCHAR(500) CHARACTER SET UNICODE_FSS)
AS 
declare variable CHECK_PAY_ID integer;
declare variable CTR_ID integer;
begin
  pay_contractor_in = upper(pay_contractor_in);
  pay_account_in = upper(pay_account_in);

  for
    select pay_id,
           pay_date,
           ctr_id,
           (select ctr_name from dcl_contractor  where ctr_id = pay.ctr_id),
           pay_account,
           pay_summ,
           (select cur_name from dcl_currency  where cur_id = pay.cur_id),
           pay_course,
           pay_block,
           usr_id_create,
           pay_course_nbrb,
           pay_comment
    from dcl_payment pay
    where
          ( :pay_contractor_in is null or :pay_contractor_in like '' or ( :pay_contractor_id_in = -2 and pay.ctr_id is null ) or ( (select upper(ctr.ctr_name) from dcl_contractor ctr where ctr_id=pay.ctr_id) like('%' || :pay_contractor_in || '%') ))
     and  ( :cur_id_in is null or cur_id = :cur_id_in )
     and  ( :pay_date_begin_in is null or pay_date >=:pay_date_begin_in )
     and  ( :pay_date_end_in is null or pay_date <=:pay_date_end_in )
     and  ( :pay_summ_min_in is null or pay_summ >=:pay_summ_min_in )
     and  ( :pay_summ_max_in is null or pay_summ <=:pay_summ_max_in )
     and  ( :pay_account_in is null or :pay_account_in like '' or upper(pay.pay_account) like('%' || :pay_account_in || '%') )
    order by pay_date descending
    into  :pay_id,
          :pay_date,
          :ctr_id,
          :pay_contractor,
          :pay_account,
          :pay_summ,
          :pay_currency,
          :pay_course,
          :pay_block,
          :usr_id_create,
          :pay_course_nbrb,
          :pay_comment
  do
  begin
    if (pay_course != 0) then
    begin
      pay_summ_eur = pay_summ / pay_course;
    end
    else
    begin
      pay_summ_eur = 0;
    end

    if (pay_course_nbrb != 0) then
    begin
      pay_summ_eur_nbrb = pay_summ / pay_course_nbrb;
    end
    else
    begin
      pay_summ_eur_nbrb = 0;
    end

    if ( (:pay_block_in = 1 and pay_block is null) or ( pay_block_in is null )  ) then
    begin
        double_account = null;
        double_contractors = null;
        select ctr_double_account from dcl_contractor where ctr_id = :ctr_id into :double_account;
        if ( double_account is not null ) then
        begin
          select contractors from dcl_get_double_contractor(:ctr_id, :pay_account) into :double_contractors;
          if ( double_contractors = '' ) then
          begin
            double_account = null;
          end
        end

        if ( :pay_closed_in = 0 ) then
        begin
          suspend;
        end
        else
        begin

          check_pay_id = null;
          select is_pay_closed from dcl_is_pay_closed(:pay_id) into :check_pay_id;

          if ( :pay_closed_in = 1 ) then
          begin
            if ( :check_pay_id is not null ) then
            begin
              suspend;
            end
          end

          if ( :pay_closed_in = -1 ) then
          begin
            if ( :check_pay_id is null ) then
            begin
              suspend;
            end
          end

        end
    end
  end
end ^

ALTER PROCEDURE DCL_PAYMENT_INSERT (PAY_DATE DATE,
PAY_ACCOUNT VARCHAR(35) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CUR_ID INTEGER,
PAY_BLOCK SMALLINT,
PAY_SUMM DECIMAL(15, 2),
PAY_COURSE DECIMAL(15, 6),
PAY_COMMENT VARCHAR(500) CHARACTER SET UNICODE_FSS,
PAY_COURSE_NBRB DECIMAL(15, 6),
PAY_COURSE_NBRB_DATE DATE)
RETURNS (PAY_ID INTEGER)
AS 
begin

  insert into dcl_payment (
      pay_date,
      pay_account,
      ctr_id,
      cur_id,
      pay_block,
      pay_summ,
      pay_course,
      pay_comment,
      pay_course_nbrb,
      pay_course_nbrb_date
  )
  values (
      :pay_date,
      :pay_account,
      :ctr_id,
      :cur_id,
      :pay_block,
      :pay_summ,
      :pay_course,
      :pay_comment,
      :pay_course_nbrb,
      :pay_course_nbrb_date
  )
  returning pay_id into :pay_id;

  suspend;
end ^

ALTER PROCEDURE DCL_PAY_MESSAGES_LOAD (USR_ID_IN INTEGER)
RETURNS (PMS_ID INTEGER,
PMS_CREATE_DATE TIMESTAMP,
PMS_MESSAGE VARCHAR(1024) CHARACTER SET UNICODE_FSS,
PMS_SUM DECIMAL(15, 2),
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
PMS_PERCENT DECIMAL(15, 2),
PMS_UPDATED SMALLINT,
CUR_ID INTEGER,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
begin
  for
    select
      pms_id,
      pms_create_date,
      pms_message,
      pms_sum,
      ctr_id,
      pms_percent,
      pms_updated,
      cur_id
    from
      dcl_pay_message pms
    where pms.usr_id = :usr_id_in
    order by pms_create_date descending
    into
      :pms_id,
      :pms_create_date,
      :pms_message,
      :pms_sum,
      :ctr_id,
      :pms_percent,
      :pms_updated,
      :cur_id
  do
  begin
    ctr_name = null;
    if (ctr_id is not null) then
    begin
      select ctr_name from dcl_contractor where ctr_id = :ctr_id into :ctr_name;
    end

    cur_name = null;
    if (cur_id is not null) then
    begin
      select cur_name from dcl_currency where cur_id = :cur_id into :cur_name;
    end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_PRC_LIST_PRODUCES_LOAD (PRC_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRC_ID INTEGER,
LPC_PRODUCE_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
LPC_COUNT DECIMAL(15, 2),
LPC_COST_ONE_LTL DECIMAL(15, 2),
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
LPC_COST_ONE DECIMAL(15, 2),
LPC_WEIGHT DECIMAL(15, 3),
LPC_SUMM DECIMAL(15, 2),
LPC_SUM_TRANSPORT DECIMAL(15, 2),
LPC_CUSTOM DECIMAL(15, 2),
LPC_PERCENT VARCHAR(12) CHARACTER SET UNICODE_FSS,
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_ID INTEGER,
DRP_ID INTEGER,
SIP_ID INTEGER,
APR_ID INTEGER,
ASM_ID INTEGER,
LPC_OCCUPIED INTEGER,
USR_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
USR_CODE VARCHAR(3) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
SPI_ID INTEGER,
DLR_ID INTEGER,
NO_ROUND SMALLINT)
AS 
begin
  prc_id = prc_id_in;

  for
    select
      lpc_id
    from
      dcl_prc_list_produce lpc
    where lpc.prc_id = :prc_id_in
    order by lpc_id
    into
      :lpc_id
  do
  begin
    select
      lpc_id,
      prc_id,
      lpc_produce_name,
      stf_id,
      stf_name,
      usr_id,
      lpc_count,
      lpc_cost_one_ltl,
      lpc_cost_one_by,
      lpc_price_list_by,
      lpc_cost_one,
      lpc_weight,
      lpc_summ,
      lpc_sum_transport,
      lpc_custom,
      lpc_percent,
      lpc_1c_number,
      prs_id,
      prs_name,
      prd_id,
      opr_id,
      drp_id,
      sip_id,
      apr_id,
      asm_id,
      dep_id,
      dep_name,
      lpc_comment,
      spi_id,
      dlr_id,
      no_round
    from dcl_prc_list_produce_load(:lpc_id)
    into
      :lpc_id,
      :prc_id,
      :lpc_produce_name,
      :stf_id,
      :stf_name,
      :usr_id,
      :lpc_count,
      :lpc_cost_one_ltl,
      :lpc_cost_one_by,
      :lpc_price_list_by,
      :lpc_cost_one,
      :lpc_weight,
      :lpc_summ,
      :lpc_sum_transport,
      :lpc_custom,
      :lpc_percent,
      :lpc_1c_number,
      :prs_id,
      :prs_name,
      :prd_id,
      :opr_id,
      :drp_id,
      :sip_id,
      :apr_id,
      :asm_id,
      :dep_id,
      :dep_name,
      :lpc_comment,
      :spi_id,
      :dlr_id,
      :no_round
    ;

    lpc_occupied = null;
    select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_V where lpc_id = :lpc_id into :lpc_occupied;
    if ( lpc_occupied is null ) then
    begin
      select lpc_id from DCL_OCCUPIED_PRC_PRODUCE_CPR_V where lpc_id = :lpc_id into :lpc_occupied;
    end

    usr_name = null;
    usr_code = null;
    if ( usr_id is not null ) then
    begin
      select usr_lng.usr_surname || ' ' || usr_lng.usr_name,
             usr.usr_code
      from   dcl_user_language usr_lng,
             dcl_user usr
      where  usr_lng.usr_id = :usr_id and lng_id = 1 and
             usr.usr_id = usr_lng.usr_id
      into   :usr_name,
             :usr_code;
    end

    suspend;
  end
end ^

ALTER PROCEDURE DCL_PRC_LIST_PRODUCE_LOAD (LPC_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRC_ID INTEGER,
PRC_DATE DATE,
LPC_PRODUCE_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
LPC_COUNT DECIMAL(15, 2),
LPC_COST_ONE_LTL DECIMAL(15, 2),
LPC_COST_ONE_BY DECIMAL(15, 2),
LPC_PRICE_LIST_BY DECIMAL(15, 2),
LPC_COST_ONE DECIMAL(15, 2),
LPC_WEIGHT DECIMAL(15, 3),
LPC_SUMM DECIMAL(15, 2),
LPC_SUM_TRANSPORT DECIMAL(15, 2),
LPC_CUSTOM DECIMAL(15, 2),
LPC_PERCENT VARCHAR(12) CHARACTER SET UNICODE_FSS,
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
OPR_ID INTEGER,
DRP_ID INTEGER,
SIP_ID INTEGER,
APR_ID INTEGER,
ASM_ID INTEGER,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
SPI_ID INTEGER,
DLR_ID INTEGER,
NO_ROUND SMALLINT)
AS 
begin
  lpc_id = null;
  prc_id = null;
  prc_date = null;
  lpc_produce_name = null;
  stf_id = null;
  stf_name = null;
  usr_id = null;
  lpc_count = null;
  lpc_cost_one_ltl = null;
  lpc_cost_one_by = null;
  lpc_price_list_by = null;
  lpc_cost_one = null;
  lpc_weight = null;
  lpc_summ = null;
  lpc_sum_transport = null;
  lpc_custom = null;
  lpc_percent = null;
  lpc_1c_number = null;
  prs_id = null;
  prs_name = null;
  prd_id = null;
  opr_id = null;
  drp_id = null;
  sip_id = null;
  apr_id = null;
  asm_id = null;
  dep_id = null;
  dep_name = null;
  lpc_comment = null;
  spi_id = null;
  dlr_id = null;
  no_round = null;

  select
    lpc.lpc_id,
    lpc.prc_id,
    prc.prc_date, 
    lpc.lpc_produce_name,
    lpc.stf_id,
    stf.stf_name,
    lpc.usr_id,
    lpc.lpc_count,
    lpc.lpc_cost_one_ltl,
    lpc.lpc_cost_one_by,
    lpc.lpc_price_list_by,
    lpc.lpc_cost_one,
    lpc.lpc_weight,
    lpc.lpc_summ,
    lpc.lpc_sum_transport,
    lpc.lpc_custom,
    lpc.lpc_percent,
    lpc.lpc_1c_number,
    lpc.prs_id,
    prs.prs_name,
    lpc.prd_id,
    lpc.opr_id,
    lpc.drp_id,
    lpc.sip_id,
    lpc.apr_id,
    lpc.asm_id,
    lpc.dep_id,
    lpc.lpc_comment
  from dcl_prc_list_produce lpc,
       dcl_stuff_category stf,
       dcl_purpose prs,
       dcl_produce_cost prc
  where lpc_id = :lpc_id_in and
        stf.stf_id = lpc.stf_id and
        prs.prs_id = lpc.prs_id and
        prc.prc_id = lpc.prc_id
  into
    :lpc_id,
    :prc_id,
    :prc_date,
    :lpc_produce_name,
    :stf_id,
    :stf_name,
    :usr_id,
    :lpc_count,
    :lpc_cost_one_ltl,
    :lpc_cost_one_by,
    :lpc_price_list_by,
    :lpc_cost_one,
    :lpc_weight,
    :lpc_summ,
    :lpc_sum_transport,
    :lpc_custom,
    :lpc_percent,
    :lpc_1c_number,
    :prs_id,
    :prs_name,
    :prd_id,
    :opr_id,
    :drp_id,
    :sip_id,
    :apr_id,
    :asm_id,
    :dep_id,
    :lpc_comment
  ;

  if ( dep_id is not null ) then
  begin
    select dep_name from dcl_department where dep_id = :dep_id into :dep_name;
  end

  if ( sip_id is not null ) then
  begin
    select spi_id from dcl_spi_list_produce where sip_id = :sip_id into :spi_id;
  end

  if ( drp_id is not null ) then
  begin
    select dlr_id from dcl_dlr_list_produce where drp_id = :drp_id into :dlr_id;
  end

  select cur_no_round from dcl_currency cur where cur.cur_name like 'BYN' into :no_round;

  suspend;
end ^

ALTER PROCEDURE DCL_PROCESS_OPR_UNEXECUTED (ORD_ID INTEGER,
ORD_EXECUTED_DATE DATE)
AS 
declare variable OPR_ID integer;
declare variable OPR_COUNT_EXECUTED decimal(15,2);
begin
  if (ord_executed_date is null) then
  begin
    select cast('NOW' as date) from rdb$database into :ord_executed_date;
  end
  for
    select
      opr.opr_id,
      opr.opr_count - (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id )
    from dcl_ord_list_produce opr
    where opr.ord_id = :ord_id and
          ( opr.opr_count - (select coalesce(sum(exe.opr_count_executed), 0) from dcl_opr_list_executed exe where exe.opr_id = opr.opr_id ) > 0 )
    into
      :opr_id,
      :opr_count_executed
  do
  begin
    insert into dcl_opr_list_executed (opr_id, opr_count_executed, opr_date_executed, opr_fictive_executed)
    values (:opr_id, :opr_count_executed, :ord_executed_date, 1);
  end
end ^

ALTER PROCEDURE DCL_PRODUCE_COST_FILTER (PRC_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_ROUTE_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRC_DATE_BEGIN_IN DATE,
PRC_DATE_END_IN DATE,
NUMBER_1C_IN VARCHAR(12) CHARACTER SET UNICODE_FSS,
PRC_BLOCK_IN SMALLINT)
RETURNS (PRC_ID INTEGER,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_ROUTE VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRC_DATE DATE,
PRC_BLOCK SMALLINT,
USR_ID_CREATE INTEGER)
AS 
declare variable lpc_count integer;
begin
  prc_number_in = upper(prc_number_in);
  prc_route_in = upper(prc_route_in);
  number_1c_in = upper(number_1c_in);

  for
    select prc_id,
           prc_number,
           prc_date,
           (select rut_name from dcl_route where rut_id = prc.rut_id) as prc_route,
           prc_block,
           usr_id_create
           from dcl_produce_cost prc
    where
          ( :prc_route_in is null or (select upper(rut.rut_name) from dcl_route rut where rut_id = prc.rut_id) like('%' || :prc_route_in || '%') )
     and  ( :prc_date_begin_in is null or prc_date >=:prc_date_begin_in )
     and  ( :prc_date_end_in is null or prc_date <=:prc_date_end_in )
     and  ( :prc_number_in is null or :prc_number_in like '' or upper(prc.prc_number) like('%' || :prc_number_in || '%') )
     and  ( :prc_block_in is null or ( :prc_block_in = 1 and prc_block is null ))
    order by prc_date descending
    into  :prc_id,
          :prc_number,
          :prc_date,
          :prc_route,
          :prc_block,
          :usr_id_create
  do
  begin
    if ( number_1c_in is null or number_1c_in like '' ) then
    begin
      suspend;
    end
    else
    begin
      select count(lpc_id) from dcl_prc_list_produce where prc_id = :prc_id and upper(lpc_1c_number) like('%' || :number_1c_in || '%') into :lpc_count;
      if ( lpc_count != 0 ) then
      begin
        suspend;
      end
    end
  end
end ^

ALTER PROCEDURE DCL_PRODUCE_COST_INSERT (PRC_DATE DATE,
RUT_ID INTEGER,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
PRC_BLOCK SMALLINT,
PRC_SUM_TRANSPORT DECIMAL(15, 2),
PRC_WEIGHT DECIMAL(15, 2),
PRC_COURSE_LTL_EUR DECIMAL(15, 4))
RETURNS (PRC_ID INTEGER)
AS 
begin

  insert into dcl_produce_cost (
      prc_number,
      prc_date,
      rut_id,
      prc_block,
      prc_sum_transport,
      prc_weight,
      prc_course_ltl_eur
  )
  values (
      :prc_number,
      :prc_date,
      :rut_id,
      :prc_block,
      :prc_sum_transport,
      :prc_weight,
      :prc_course_ltl_eur
  )
  returning prc_id into :prc_id;

  suspend;
end ^

ALTER PROCEDURE DCL_PRODUCE_COST_REPORT (DATE_BEGIN DATE,
DATE_END DATE,
ONLY_BLOCK SMALLINT)
RETURNS (PRC_ID INTEGER,
PRC_DATE DATE,
PRC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
ROUTE VARCHAR(150) CHARACTER SET UNICODE_FSS,
WEIGHT DECIMAL(15, 3),
TRANSPORT DECIMAL(15, 2),
CUSTOM DECIMAL(15, 2))
AS 
begin
  for
    select prc.prc_id,
           prc.prc_date,
           prc.prc_number,
           prc.prc_weight,
           rut.rut_name
      from dcl_produce_cost prc,
           dcl_route rut
      where prc.prc_date >= :date_begin and
            prc.prc_date <= :date_end and
            rut.rut_id = prc.rut_id and
            (:only_block is null or prc.prc_block = :only_block )
      into :prc_id,
           :prc_date,
           :prc_number,
           :weight,
           :route
    do
    begin
      select sum(lpc.lpc_sum_transport),
             sum(lpc.lpc_custom)
      from dcl_prc_list_produce lpc
      where lpc.prc_id = :prc_id
      into
        :transport,
        :custom
      ;

      suspend;
    end
end ^

ALTER PROCEDURE DCL_PRODUCE_COST_REPORT_SUM (DATE_BEGIN DATE,
DATE_END DATE,
ONLY_BLOCK SMALLINT)
RETURNS (PRC_DATE DATE,
WEIGHT DECIMAL(15, 3),
TRANSPORT DECIMAL(15, 2),
CUSTOM DECIMAL(15, 2))
AS 
declare variable lt_begin timestamp;
declare variable lt_end timestamp;
begin
  for
    select
      t_begin,
      t_end
    from
      DCL_GET_TIMESTAMP_BREAKDOWN(:date_begin, :date_end, 'MONTH')
    into
      :lt_begin,
      :lt_end
  do
  begin
    prc_date = :lt_begin;

    select sum(weight),
           sum(transport),
           sum(custom)
    from dcl_produce_cost_report(:lt_begin, :lt_end, :only_block)
    into :weight,
         :transport,
         :custom
    ;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_PRODUCE_IN_SPC_IMPORT (PRD_ID INTEGER)
RETURNS (SPC_IMPORT_COUNT_ONE SMALLINT)
AS 
declare variable SPI_ID integer;
declare variable ITERATOR integer;
declare variable SPI_ARRIVE integer;
begin
  spc_import_count_one = 0;
  iterator = 0;

  for
    select
      distinct spi.spi_id
    from
      dcl_specification_import spi,
      dcl_spi_list_produce sip
    where
      sip.prd_id = :prd_id and
      spi.spi_id = sip.spi_id
    into :spi_id
  do
  begin
    iterator = iterator + 1;
  end

  if (iterator = 0) then
  begin
    spc_import_count_one = 1;
  end
  else if (iterator = 1) then
  begin
    select spi_arrive from dcl_specification_import spi where spi.spi_id = :spi_id into :spi_arrive;
    if (spi_arrive is null) then
    begin
      spc_import_count_one = 1;
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_SAVE_CFC_ECO_MSG (ECONOMIST_ROLE_ID INTEGER,
ULN_URL VARCHAR(64) CHARACTER SET UNICODE_FSS,
ULN_PARAMETERS VARCHAR(128) CHARACTER SET UNICODE_FSS,
ULN_TEXT VARCHAR(500) CHARACTER SET UNICODE_FSS,
ULN_MENU_ID VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
begin
  delete from dcl_user_link uln where uln.uln_url = :uln_url and uln.uln_parameters = :uln_parameters;

  insert into dcl_user_link (usr_id, uln_url, uln_parameters, uln_text, uln_menu_id)
  select usr_id, :uln_url, :uln_parameters, :uln_text, :uln_menu_id
  from dcl_user_role usr_role
  where
    usr_role.rol_id = :economist_role_id;

end ^

ALTER PROCEDURE DCL_SAVE_CFC_MESSAGES (CFC_ID INTEGER,
CTR_ID INTEGER,
MSG VARCHAR(256) CHARACTER SET UNICODE_FSS)
AS 
declare variable USR_ID_CREATE integer;
declare variable USR_ID_PLACE integer;
begin
   select usr_id_create, usr_id_place from dcl_cond_for_contract where cfc_id = :cfc_id into :usr_id_create, :usr_id_place;
   insert into dcl_cfc_message (cfc_id, usr_id, ccm_message, ctr_id) values (:cfc_id, :usr_id_create, :msg, :ctr_id);
   if ( usr_id_create != usr_id_place ) then
   begin
     insert into dcl_cfc_message (cfc_id, usr_id, ccm_message, ctr_id) values (:cfc_id, :usr_id_place, :msg, :ctr_id);
   end
end ^

ALTER PROCEDURE DCL_SAVE_CONTRACT_MESSAGES (CON_ID INTEGER,
SPC_ID INTEGER,
CTR_ID INTEGER,
MSG VARCHAR(256) CHARACTER SET UNICODE_FSS)
AS 
declare variable USR_ID integer;
begin
  if (spc_id is not null) then
  begin
    select usr_id from dcl_con_list_spec where spc_id = :spc_id into :usr_id;
    insert into dcl_con_message (spc_id, usr_id, cms_message, ctr_id) values (:spc_id, :usr_id, :msg, :ctr_id);
  end
  if (con_id is not null) then
  begin
    for
      select
        distinct usr_id
      from dcl_con_list_spec
      where con_id = :con_id
      into
        :usr_id
    do
    begin
      insert into dcl_con_message (con_id, usr_id, cms_message, ctr_id) values (:con_id, :usr_id, :msg, :ctr_id);
    end
  end
end ^

ALTER PROCEDURE DCL_SAVE_ORD_MESSAGES (ORD_ID INTEGER,
PRC_ID INTEGER,
MANAGER_ROLE_ID INTEGER,
MSG VARCHAR(256) CHARACTER SET UNICODE_FSS)
AS 
declare variable USR_ID_CREATE integer;
declare variable DEP_ID integer;
declare variable USR_CHIEF_DEP smallint;
declare variable USER_COUNT integer;
declare variable USR_CHIEF_ID integer;
begin
  select usr_id_create from dcl_order where ord_id = :ord_id into :usr_id_create;

  select count(usr_id) from dcl_user_role u where u.usr_id = :usr_id_create and u.rol_id = :manager_role_id into :user_count;

  if (user_count > 0) then -- else - user is not manager
  begin
    select dep_id, usr_chief_dep from dcl_user where usr_id = :usr_id_create into :dep_id, :usr_chief_dep;

    insert into dcl_ord_message (usr_id, orm_message, ord_id, prc_id) values (:usr_id_create, :msg, :ord_id, :prc_id);
    -- is chief (message only to this person)
    -- is manager (message and for chief )
    if (usr_chief_dep is null) then
    begin
      for
        select usr_id
        from dcl_user
        where dep_id = :dep_id and usr_chief_dep = 1 and usr_no_login is null
        into :usr_chief_id
      do
      begin
        if (usr_id_create != usr_chief_id) then
        begin
          insert into dcl_ord_message (usr_id, orm_message, ord_id, prc_id) values (:usr_chief_id, :msg, :ord_id, :prc_id);
        end
      end
    end
  end
end ^

ALTER PROCEDURE DCL_SAVE_PAYMENT_MESSAGES (PAY_ID INTEGER,
MANAGER_ROLE_ID INTEGER,
MSG_RECEIVED_PAYMENT VARCHAR(50) CHARACTER SET UNICODE_FSS,
MSG_RECEIVED_PAYMENT_BY_CON VARCHAR(50) CHARACTER SET UNICODE_FSS,
MSG_FROM VARCHAR(10) CHARACTER SET UNICODE_FSS,
MSG_SPEC VARCHAR(20) CHARACTER SET UNICODE_FSS,
MSG_COMMENT VARCHAR(250) CHARACTER SET UNICODE_FSS)
AS 
declare variable CTR_ID integer;
declare variable PAY_SUMM decimal(15,2);
declare variable PAY_SUM_COUNT integer;
declare variable PAY_BLOCK smallint;
declare variable LPS_SUMM decimal(15,2);
declare variable SPC_NUMBER varchar(50);
declare variable CON_NUMBER varchar(50);
declare variable USR_ID integer;
declare variable SPC_DATE date;
declare variable CON_DATE date;
declare variable SPC_DATE_STR varchar(10);
declare variable CON_DATE_STR varchar(10);
declare variable PMS_PERCENT decimal(15,2);
declare variable LPS_ALL_SUM decimal(15,2);
declare variable CUR_ID integer;
declare variable SPC_SUM decimal(15,2);
declare variable CONTRACTOR_USER_COUNT integer;
declare variable USR_ID1 integer;
begin
  update dcl_pay_message pms set pms.pms_check_for_delete = 1 where pms.pay_id = :pay_id;

  select ctr_id,
         pay_summ,
         pay_block,
         cur_id
  from dcl_payment
  where pay_id = :pay_id
  into :ctr_id,
       :pay_summ,
       :pay_block,
       :cur_id;

  if (ctr_id is null ) then
  begin
    insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, cur_id)
      select :pay_id, usr_id, :msg_received_payment || coalesce(:msg_comment, ''), :pay_summ, :cur_id from dcl_user_role usr_role where usr_role.rol_id = :manager_role_id;
  end
  else
  begin
    contractor_user_count = 0;
    select
      count(ctr_usr.usr_id)
    from
      dcl_contractor_user ctr_usr,
      dcl_user_role usr_role
    where ctr_usr.ctr_id = coalesce(:ctr_id, -1) and
          ctr_usr.usr_id = usr_role.usr_id and
          usr_role.rol_id = :manager_role_id
    into :contractor_user_count;

    select count(lps_id) from dcl_pay_list_summ where pay_id = :pay_id into :pay_sum_count;
    if ( pay_sum_count = 0 and contractor_user_count > 0 ) then
    begin
      for
        select usr_id
        from dcl_user_role usr_role
        where
          usr_role.rol_id = :manager_role_id and
          usr_role.usr_id in (select usr_id from dcl_contractor_user cu where cu.ctr_id = :ctr_id)
        into :usr_id1
      do
      begin
        insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, cur_id)
          values (:pay_id, :usr_id1, :msg_received_payment || coalesce(:msg_comment, ''), :pay_summ, :ctr_id, :cur_id);

        insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, cur_id)
          select :pay_id, us.usr_id, :msg_received_payment || coalesce(:msg_comment, ''), :pay_summ, :ctr_id, :cur_id
          from dcl_user_setting us,
               dcl_user usr
          where usr.usr_id = us.usr_id and
                us.ust_name = 'userShowPaymentByAllDep' and us.ust_value is not null and
                us.usr_id != :usr_id1 and
                usr.dep_id = (select dep.dep_id from dcl_department dep, dcl_user usr1 where usr1.usr_id = :usr_id1 and dep.dep_id = usr1.dep_id);
      end
    end
    else if ( pay_sum_count = 0 and contractor_user_count = 0 ) then
    begin
      for
        select usr_id
        from dcl_user_role usr_role where usr_role.rol_id = :manager_role_id
        into :usr_id1
      do
      begin
        insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, cur_id, pms_no_curator)
          values( :pay_id, :usr_id1, :msg_received_payment || coalesce(:msg_comment, ''), :pay_summ, :ctr_id, :cur_id, 1 );

        insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, cur_id, pms_no_curator)
          select :pay_id, us.usr_id, :msg_received_payment || coalesce(:msg_comment, ''), :pay_summ, :ctr_id, :cur_id, 1
          from dcl_user_setting us,
               dcl_user usr
          where usr.usr_id = us.usr_id and
                us.ust_name = 'userShowPaymentByAllDep' and us.ust_value is not null and
                us.usr_id != :usr_id1 and
                usr.dep_id = (select dep.dep_id from dcl_department dep, dcl_user usr1 where usr1.usr_id = :usr_id1 and dep.dep_id = usr1.dep_id);
      end
    end
    else
    begin
      if (pay_block is not null) then
      begin
        for
          select lps.lps_summ,
                 spc.spc_number,
                 spc.spc_date,
                 spc.usr_id,
                 spc.spc_summ,
                 con.con_number,
                 con.con_date
          from dcl_pay_list_summ lps,
               dcl_con_list_spec spc,
               dcl_contract con
          where lps.pay_id = :pay_id
                and spc.spc_id = lps.spc_id
                and con.con_id = spc.con_id
          into :lps_summ,
               :spc_number,
               :spc_date,
               :usr_id,
               :spc_sum,
               :con_number,
               :con_date
        do
        begin
          pms_percent = 0;
          if (spc_sum != 0) then
          begin
            pms_percent = lps_summ / spc_sum * 100;
          end
          select strdate from date2str(:spc_date) into :spc_date_str;
          select strdate from date2str(:con_date) into :con_date_str;

          for
            select usr_id
            from dcl_user_role usr_role
            where
              usr_role.rol_id = :manager_role_id and
              usr_role.usr_id = :usr_id
            into :usr_id1
          do
          begin
            insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, pms_percent, cur_id)
              values( :pay_id, :usr_id1, :msg_received_payment_by_con || ' ' || :con_number || ' ' || :msg_from || ' ' || :con_date_str || ' ' || :msg_spec || ' ' || :spc_number || ' ' || :msg_from || ' ' || :spc_date_str || coalesce(:msg_comment, ''), :lps_summ, :ctr_id, :pms_percent, :cur_id);

            insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, pms_percent, cur_id)
              select :pay_id, us.usr_id, :msg_received_payment_by_con || ' ' || :con_number || ' ' || :msg_from || ' ' || :con_date_str || ' ' || :msg_spec || ' ' || :spc_number || ' ' || :msg_from || ' ' || :spc_date_str || coalesce(:msg_comment, ''), :lps_summ, :ctr_id, :pms_percent, :cur_id
              from dcl_user_setting us,
                   dcl_user usr
              where usr.usr_id = us.usr_id and
                    us.ust_name = 'userShowPaymentByAllDep' and us.ust_value is not null and
                    us.usr_id != :usr_id1 and
                    usr.dep_id = (select dep.dep_id from dcl_department dep, dcl_user usr1 where usr1.usr_id = :usr_id1 and dep.dep_id = usr1.dep_id);
          end
        end
      end
      else
      begin
        lps_all_sum = 0;
        for
          select lps.lps_summ,
                 spc.spc_number,
                 spc.spc_date,
                 spc.usr_id,
                 spc.spc_summ,
                 con.con_number,
                 con.con_date
          from dcl_pay_list_summ lps,
               dcl_con_list_spec spc,
               dcl_contract con
          where lps.pay_id = :pay_id
                and spc.spc_id = lps.spc_id
                and con.con_id = spc.con_id
          into :lps_summ,
               :spc_number,
               :spc_date,
               :usr_id,
               :spc_sum,
               :con_number,
               :con_date
        do
        begin
          pms_percent = 0;
          if (spc_sum != 0) then
          begin
            pms_percent = lps_summ / spc_sum * 100;
          end
          select strdate from date2str(:spc_date) into :spc_date_str;
          select strdate from date2str(:con_date) into :con_date_str;

          for
            select usr_id
            from dcl_user_role usr_role
            where
              usr_role.rol_id = :manager_role_id and
              usr_role.usr_id = :usr_id
            into :usr_id1
          do
          begin
            insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, pms_percent, cur_id)
              values( :pay_id, :usr_id1, :msg_received_payment_by_con || ' ' || :con_number || ' ' || :msg_from || ' ' || :con_date_str || ' ' || :msg_spec || ' ' || :spc_number || ' ' || :msg_from || ' ' || :spc_date_str || coalesce(:msg_comment, ''), :lps_summ, :ctr_id, :pms_percent, :cur_id );

            insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, pms_percent, cur_id)
              select :pay_id, us.usr_id, :msg_received_payment_by_con || ' ' || :con_number || ' ' || :msg_from || ' ' || :con_date_str || ' ' || :msg_spec || ' ' || :spc_number || ' ' || :msg_from || ' ' || :spc_date_str || coalesce(:msg_comment, ''), :lps_summ, :ctr_id, :pms_percent, :cur_id
              from dcl_user_setting us,
                   dcl_user usr
              where usr.usr_id = us.usr_id and
                    us.ust_name = 'userShowPaymentByAllDep' and us.ust_value is not null and
                    us.usr_id != :usr_id1 and
                    usr.dep_id = (select dep.dep_id from dcl_department dep, dcl_user usr1 where usr1.usr_id = :usr_id1 and dep.dep_id = usr1.dep_id);
          end

          lps_all_sum = lps_all_sum + lps_summ;
        end

        for
          select usr_id
          from dcl_user_role usr_role
          where
            usr_role.rol_id = :manager_role_id and
            usr_role.usr_id in (select usr_id from dcl_contractor_user cu where cu.ctr_id = :ctr_id)
          into :usr_id1
        do
        begin
          insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, cur_id)
            values ( :pay_id, :usr_id1, :msg_received_payment || coalesce(:msg_comment, ''), :lps_all_sum, :ctr_id, :cur_id );

          insert into dcl_pay_message (pay_id, usr_id, pms_message, pms_sum, ctr_id, cur_id)
            select :pay_id, us.usr_id, :msg_received_payment || coalesce(:msg_comment, ''), :lps_all_sum, :ctr_id, :cur_id
            from dcl_user_setting us,
                 dcl_user usr
            where usr.usr_id = us.usr_id and
                  us.ust_name = 'userShowPaymentByAllDep' and us.ust_value is not null and
                  us.usr_id != :usr_id1 and
                  usr.dep_id = (select dep.dep_id from dcl_department dep, dcl_user usr1 where usr1.usr_id = :usr_id1 and dep.dep_id = usr1.dep_id);
        end
      end
    end
  end

  update
    dcl_pay_message pms
  set
    pms.pms_updated = 1
  where
    pms.usr_id in ( select usr_id from dcl_pay_message where pay_id = :pay_id and pms_check_for_delete = 1 )
    and pms.pms_check_for_delete is null
  ;

  delete from dcl_pay_message pms where pms.pms_check_for_delete = 1;
end ^

ALTER PROCEDURE DCL_SERIAL_NUMBER_FILTER (PRD_ID_IN INTEGER,
SERIAL_NUMBER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (LPS_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
MAD_COMPLEXITY VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
begin
  serial_number_in = upper(serial_number_in);

  for
    select lps.lps_id,
           lps.lps_serial_num,
           lps.lps_year_out,
           (select stf_name from dcl_stuff_category stf where stf.stf_id = lps.stf_id) as stf_name,
           mad.mad_complexity
    from dcl_prc_list_produce lpc,
         dcl_shp_list_produce lps,
         dcl_catalog_number ctn
         left join dcl_montage_adjustment mad on mad.mad_id = ctn.mad_id
    where lpc.prd_id = :prd_id_in and
          lps.lpc_id = lpc.lpc_id and
          ctn.prd_id = :prd_id_in and
          ctn.stf_id = lps.stf_id and
          ( :serial_number_in is null or :serial_number_in like '' or upper(lps.lps_serial_num) like '%' || :serial_number_in || '%' )
    into  :lps_id,
          :lps_serial_num,
          :lps_year_out,
          :stf_name,
          :mad_complexity
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_SHIPPING_FILTER (SHP_NUMBER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_CONTRACTOR_IN VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_DATE_BEGIN_IN DATE,
SHP_DATE_END_IN DATE,
SHP_SUMM_MIN_IN DECIMAL(15, 2),
SHP_SUMM_MAX_IN DECIMAL(15, 2),
SHP_BLOCK_IN SMALLINT,
SHP_CLOSED_IN INTEGER,
CUR_ID_IN INTEGER,
SLN_SELLER_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_SUMM_PLUS_NDS DECIMAL(15, 2),
SHP_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
SHP_BLOCK SMALLINT,
USR_ID_CREATE INTEGER,
COUNT_DAY INTEGER,
SHP_DATE_EXPIRATION DATE,
SHP_SUMM DECIMAL(15, 2),
PAY_SUMM DECIMAL(15, 2),
NOT_SHOW_MSG SMALLINT,
SHP_CLOSED SMALLINT,
USR_ID_LIST VARCHAR(500) CHARACTER SET UNICODE_FSS,
DEP_ID_LIST VARCHAR(500) CHARACTER SET UNICODE_FSS)
AS 
declare variable SPC_ID integer;
begin
  shp_number_in = upper(shp_number_in);
  shp_contractor_in = upper(shp_contractor_in);
  sln_seller_in = upper(sln_seller_in);

  for
    select shp_id,
           shp_number,
           shp_date,
           (select ctr_name from dcl_contractor  where ctr_id = shp.ctr_id),
           shp_summ_plus_nds,
           (select cur_name from dcl_currency  where cur_id = shp.cur_id),
           shp_block,
           shp.usr_id_create,
           (select count_day from dcl_get_count_day((select cast('NOW' as date) from rdb$database), shp.shp_date_expiration)),
           shp_date_expiration,
           spc_id
    from dcl_shipping shp
    where
          ( :shp_contractor_in is null or (select upper(ctr.ctr_name) from dcl_contractor ctr where ctr_id=shp.ctr_id) like('%' || :shp_contractor_in || '%') )
     and  ( :cur_id_in is null or cur_id = :cur_id_in )
     and  ( :shp_block_in is null or shp_block = :shp_block_in )
     and  ( :shp_date_begin_in is null or shp_date >= :shp_date_begin_in )
     and  ( :shp_date_end_in is null or shp_date <= :shp_date_end_in )
     and  ( :shp_summ_min_in is null or shp_summ_plus_nds >= :shp_summ_min_in )
     and  ( :shp_summ_max_in is null or shp_summ_plus_nds <= :shp_summ_max_in )
     and  ( :shp_number_in is null or ( upper(shp.shp_number) like('%' || :shp_number_in || '%')) )
     and  (
            :sln_seller_in is null or
            :sln_seller_in like '' or
            (
              (
                select upper(sln.sln_name)
                from dcl_seller sln,
                     dcl_contract con,
                     dcl_con_list_spec spc
                where sln.sln_id = con.sln_id
                      and con.con_id = spc.con_id
                      and spc.spc_id = shp.spc_id
              ) like('%' || :sln_seller_in || '%')
            )
          )
    order by shp_date descending
    into  :shp_id,
          :shp_number,
          :shp_date,
          :shp_contractor,
          :shp_summ_plus_nds,
          :shp_currency,
          :shp_block,
          :usr_id_create,
          :count_day,
          :shp_date_expiration,
          :spc_id
  do
  begin
    select usr_id_list,
           dep_id_list
    from dcl_get_usr_id_list_shp(:shp_id, :spc_id)
    into :usr_id_list,
         :dep_id_list
    ;

    not_show_msg = null;
    select is_shp_closed from dcl_is_shp_closed(:shp_id) into :shp_closed;

    if ( shp_closed_in = 0 ) then
    begin
      suspend;
    end
    else
    begin
      if ( shp_closed_in = 1 ) then
      begin
        if ( shp_closed is not null ) then
        begin
          suspend;
        end
      end --if 1

      if ( shp_closed_in = -1 ) then
      begin
        if ( shp_closed is null ) then
        begin
          if ( spc_id is not null ) then
          begin
            select sum(shp.shp_summ_plus_nds) from dcl_shipping shp where shp.spc_id = :spc_id into :shp_summ;
            select sum(pls.lps_summ) from dcl_pay_list_summ pls where pls.spc_id = :spc_id into :pay_summ;
            if ( :shp_summ <= :pay_summ ) then
            begin
              not_show_msg = 1;
            end
          end

          suspend;
        end
      end -- if ( :shp_closed_in = -1 )

    end

  end
end ^

ALTER PROCEDURE DCL_SHIPPING_GOODS (DATE_IN DATE,
USR_ID_IN INTEGER,
DEP_ID_IN INTEGER,
DATE_TO_IN DATE,
STF_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
PRD_ID INTEGER,
PRODUCE_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
USR_ID INTEGER,
USR_NAME VARCHAR(41) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
DEP_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS,
UNIT VARCHAR(15) CHARACTER SET UNICODE_FSS,
LPC_COUNT DECIMAL(15, 2),
LPC_COUNT_FREE DECIMAL(15, 2),
SHP_DATE DATE,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
LESS_3_MONTH DECIMAL(15, 2),
MONTH_3_6 DECIMAL(15, 2),
MONTH_6_9 DECIMAL(15, 2),
MONTH_9_12 DECIMAL(15, 2),
MORE_12_MONTH DECIMAL(15, 2),
LPC_COUNT_FREE_TO DECIMAL(15, 2),
LESS_3_MONTH_TO DECIMAL(15, 2),
MONTH_3_6_TO DECIMAL(15, 2),
MONTH_6_9_TO DECIMAL(15, 2),
MONTH_9_12_TO DECIMAL(15, 2),
MORE_12_MONTH_TO DECIMAL(15, 2),
DEBT_SUMM DECIMAL(15, 2),
DEBT_CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PURPOSE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
LPC_1C_NUMBER VARCHAR(12) CHARACTER SET UNICODE_FSS,
LPC_COMMENT VARCHAR(1000) CHARACTER SET UNICODE_FSS,
USR_SHIPPING VARCHAR(41) CHARACTER SET UNICODE_FSS,
PRODUCE_NAME_SORT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
STF_NAME_SORT VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
declare variable need_suspend integer;
declare variable sum_eur decimal(15,2);
declare variable sum_eur_to decimal(15,2);
declare variable shp_id integer;
declare variable lmn_usr_id integer;
declare variable stf_id integer;
declare variable date_check date;
declare variable lmn_percent decimal(3,0);
declare variable sum_other_charges decimal(15,2);
declare variable lpc_cost_one decimal(15,2);
begin
  if ( date_to_in is null ) then
  begin
    date_check = :date_in;
  end
  else
  begin
    date_check = :date_to_in;
  end

  for
    select
      shp.shp_id,
      shp.shp_date,
      ctr.ctr_name,
      cur.cur_name
    from dcl_shipping shp,
         dcl_contractor ctr,
         dcl_currency cur
    where
      shp.shp_date <= :date_check and
      shp.shp_summ_plus_nds > 0 and
      (
        shp.spc_id is null
        or
        not exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
      ) and
      ctr.ctr_id = shp.ctr_id and
      cur.cur_id = shp.cur_id
    into
      :shp_id,
      :shp_date,
      :ctr_name,
      :debt_currency
  do
  begin
    for
      select
        coalesce (lps.lps_count, 0),
        lps.lps_summ_plus_nds,
        lmn.usr_id,
        lmn.lmn_percent,
        lpc.lpc_id,
        lpc.lpc_count,
        lpc.lpc_sum_transport + lpc.lpc_custom,
        lpc.lpc_cost_one,
        lpc.lpc_1c_number,
        lpc.lpc_comment,
        stf.stf_id,
        stf.stf_name,
        prs.prs_name,
        lpc.prd_id,
        lpc.usr_id,
        lpc.dep_id
      from dcl_shp_list_produce lps,
           dcl_prc_list_produce lpc,
           dcl_lps_list_manager lmn,
           dcl_stuff_category stf,
           dcl_purpose prs
      where
        lps.shp_id = :shp_id and
        lps.lpc_id = lpc.lpc_id and
        lmn.lps_id = lps.lps_id and
        stf.stf_id = lpc.stf_id and
        prs.prs_id = lpc.prs_id and
        lpc.lpc_count != 0 and
        coalesce (lps.lps_count, 0) != 0 and
        (:stf_id_in is null or :stf_id_in = -1 or :stf_id_in = stf.stf_id )
      into
        :lpc_count_free,
        :debt_summ,
        :lmn_usr_id,
        :lmn_percent,
        :lpc_id,
        :lpc_count,
        :sum_other_charges,
        :lpc_cost_one,
        :lpc_1c_number,
        :lpc_comment,
        :stf_id,
        :stf_name,
        :purpose,
        :prd_id,
        :usr_id,
        :dep_id
    do
    begin
      if ( lmn_percent != 100 ) then
      begin
        debt_summ = debt_summ * lmn_percent / 100;
      end

      if ( lmn_usr_id is not null ) then
      begin
        select usr_lng_shp.usr_surname || ' ' || usr_lng_shp.usr_name
        from dcl_user_language usr_lng_shp
        where usr_lng_shp.usr_id = :lmn_usr_id and
              usr_lng_shp.lng_id = 1
        into :usr_shipping;
      end

      select
        prd.prd_name,
        prd.prd_type,
        prd.prd_params,
        prd.prd_add_params,
        (
          select ctn.ctn_number
          from dcl_catalog_number ctn
          where ctn.stf_id = :stf_id and
                ctn.prd_id = prd.prd_id
        ),
        unt.unt_name
      from  dcl_produce prd,
            dcl_unit_language unt
      where prd.prd_id = :prd_id and
            unt.unt_id = prd.unt_id and
            unt.lng_id = 1
      into
        :produce_name,
        :prd_type,
        :prd_params,
        :prd_add_params,
        :ctn_number,
        :unit
      ;

      need_suspend = 1;
      if ( usr_id_in is null or usr_id_in = -1 ) then
      begin
        need_suspend = 1;
      end
      else
      begin
        if ( usr_id_in != usr_id or usr_id is null  ) then
        begin
          need_suspend = 0;
        end
      end

      usr_name = null;
      dep_name = null;
      if ( need_suspend = 1 and usr_id is not null ) then
      begin
        select
           usr_lng.usr_surname || ' ' || usr_lng.usr_name
        from dcl_user_language usr_lng
        where usr_lng.usr_id = :usr_id and
              usr_lng.lng_id = 1
        into :usr_name;
      end

      if ( need_suspend = 1 and dep_id_in is null or dep_id_in = -1 ) then
      begin
        need_suspend = 1;
      end
      else
      begin
        if ( dep_id_in != dep_id or dep_id is null ) then
        begin
          need_suspend = 0;
        end
      end

      if ( need_suspend = 1 and dep_id is not null ) then
      begin
        select dep_name from dcl_department where dep_id = :dep_id into :dep_name;
      end

      if ( date_to_in is not null ) then
      begin
        lpc_count_free_to = lpc_count_free;
        if ( shp_date > date_in ) then
        begin
          lpc_count_free = 0;
        end

        if ( lpc_count_free = 0 and lpc_count_free_to = 0 ) then
        begin
          need_suspend = 0;
        end
      end

      if ( need_suspend = 1 ) then
      begin
        less_3_month = 0;
        month_3_6 = 0;
        month_6_9 = 0;
        month_9_12 = 0;
        more_12_month = 0;

        sum_eur = ( lpc_cost_one + sum_other_charges / lpc_count ) * lpc_count_free;
        if ( lmn_percent != 100 ) then
        begin
          sum_eur = sum_eur * lmn_percent / 100;
        end

        if ( shp_date >= addday(date_in, -30 * 1) ) then
        begin
          less_3_month = sum_eur;
        end
        else
        begin
          if ( shp_date >= addday(date_in, -30 * 2) ) then
          begin
            month_3_6 = sum_eur;
          end
          else
          begin
            if ( shp_date >= addday(date_in, -30 * 3) ) then
            begin
              month_6_9 = sum_eur;
            end
            else
            begin
              if ( shp_date >= addday(date_in, -30 * 6) ) then
              begin
                month_9_12 = sum_eur;
              end
              else
              begin
                more_12_month = sum_eur;
              end
            end
          end
        end

        if ( date_to_in is not null ) then
        begin
          less_3_month_to = 0;
          month_3_6_to = 0;
          month_6_9_to = 0;
          month_9_12_to = 0;
          more_12_month_to = 0;

          sum_eur_to = ( lpc_cost_one + sum_other_charges / lpc_count ) * lpc_count_free_to;
          if ( lmn_percent != 100 ) then
          begin
            sum_eur_to = sum_eur_to * lmn_percent / 100;
          end

          if ( shp_date >= addday(date_to_in, -30 * 1) ) then
          begin
            less_3_month_to = sum_eur_to;
          end
          else
          begin
            if ( shp_date >= addday(date_to_in, -30 * 2) ) then
            begin
              month_3_6_to = sum_eur_to;
            end
            else
            begin
              if ( shp_date >= addday(date_to_in, -30 * 3) ) then
              begin
                month_6_9_to = sum_eur_to;
              end
              else
              begin
                if ( shp_date >= addday(date_to_in, -30 * 6) ) then
                begin
                  month_9_12_to = sum_eur_to;
                end
                else
                begin
                  more_12_month_to = sum_eur_to;
                end
              end
            end
          end
        end

        produce_name_sort = upper(produce_name || ' ' || prd_type || ' ' || prd_params || ' ' || prd_add_params);
        stf_name_sort = upper(stf_name);
        suspend;
      end -- if ( need_suspend = 1 )
    end -- for 2
  end --for
end ^

ALTER PROCEDURE DCL_SHIPPING_INSERT (SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_DATE_EXPIRATION DATE,
SPC_ID INTEGER,
SHP_SUMM_PLUS_NDS DECIMAL(15, 2),
CUR_ID INTEGER,
CTR_ID INTEGER,
SHP_LETTER1_DATE DATE,
SHP_LETTER2_DATE DATE,
SHP_LETTER3_DATE DATE,
SHP_COMPLAINT_IN_COURT_DATE DATE,
SHP_COMMENT VARCHAR(3000) CHARACTER SET UNICODE_FSS,
SHP_MONTAGE SMALLINT,
SHP_SERIAL_NUM_YEAR_OUT SMALLINT,
CTR_ID_WHERE INTEGER,
CON_ID_WHERE INTEGER,
SHP_NOTICE_DATE DATE,
SHP_SUMM_TRANSPORT DECIMAL(15, 2),
SHP_ORIGINAL SMALLINT,
SHP_SUM_UPDATE DECIMAL(15, 2))
RETURNS (SHP_ID INTEGER)
AS 
begin

  insert into dcl_shipping (
    shp_number,
    shp_date,
    shp_date_expiration,
    spc_id,
    shp_summ_plus_nds,
    cur_id,
    ctr_id,
    shp_letter1_date,
    shp_letter2_date,
    shp_letter3_date,
    shp_complaint_in_court_date,
    shp_comment,
    shp_montage,
    shp_serial_num_year_out,
    ctr_id_where,
    con_id_where,
    shp_notice_date,
    shp_summ_transport,
    shp_original,
    shp_sum_update
  )
  values (
    :shp_number,
    :shp_date,
    :shp_date_expiration,
    :spc_id,
    :shp_summ_plus_nds,
    :cur_id,
    :ctr_id,
    :shp_letter1_date,
    :shp_letter2_date,
    :shp_letter3_date,
    :shp_complaint_in_court_date,
    :shp_comment,
    :shp_montage,
    :shp_serial_num_year_out,
    :ctr_id_where,
    :con_id_where,
    :shp_notice_date,
    :shp_summ_transport,
    :shp_original,
    :shp_sum_update
  )
  returning shp_id into :shp_id;

  suspend;
end ^

ALTER PROCEDURE DCL_SHIPPING_REPORT (DATE_BEGIN DATE,
DATE_END DATE,
CTR_ID INTEGER,
NOT_INCLUDE_ZERO SMALLINT,
INCLUDE_TYPE SMALLINT)
RETURNS (SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_PRD_COUNT INTEGER,
SHP_SUMM_PLUS_NDS DECIMAL(15, 2),
SHP_SUM_NR DECIMAL(15, 2),
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SHP_CLOSED INTEGER,
CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
PRD_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_ID INTEGER,
LPS_COUNT DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LPS_SUMM_OUT_NDS DECIMAL(15, 2),
LPS_SUMM_OUT_NDS_EUR DECIMAL(15, 2),
LPS_SUMM_ZAK DECIMAL(15, 2),
MANAGER_ID INTEGER,
MANAGER VARCHAR(500) CHARACTER SET UNICODE_FSS,
DEPARTMENT VARCHAR(500) CHARACTER SET UNICODE_FSS,
LPS_SUM_TRANSPORT DECIMAL(15, 2),
LPS_CUSTOM DECIMAL(15, 2),
COUNTRY VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare variable SPC_ID integer;
declare variable SPC_NDS_RATE decimal(15,2);
declare variable NEED_SUSPEND smallint;
declare variable TEMPORARY_F float;
declare variable SHP_CUT_ID integer;
declare variable MANAGER_LOCAL varchar(50);
declare variable DEPARTMENT_LOCAL varchar(100);
declare variable EUR_CUR_ID integer;
declare variable EUR_CRT_RATE decimal(15,2);
declare variable CUR_ID integer;
declare variable CRT_RATE decimal(15,2);
begin
   select cur_id from dcl_currency where cur_name = 'EUR' into :eur_cur_id;

  for
    select shp.shp_id,
           shp.shp_number,
           shp.shp_date,
           shp.shp_summ_plus_nds - coalesce((select sum(lps.lps_summ_plus_nds) from dcl_shp_list_produce lps where lps.shp_id = shp.shp_id), 0),
           ctr.ctr_name,
           ctr.cut_id,
           shp.spc_id,
           shp.shp_summ_plus_nds,
           cur.cur_id,
           cur.cur_name
    from dcl_shipping shp,
         dcl_contractor ctr,
         dcl_currency cur
    where
          shp_date >= :date_begin and shp_date <= :date_end
          and ( :ctr_id is null or :ctr_id = -1 or shp.ctr_id = :ctr_id )
          and ctr.ctr_id = shp.ctr_id
          and cur.cur_id = shp.cur_id
    into  :shp_id,
          :shp_number,
          :shp_date,
          :shp_sum_nr,
          :shp_contractor,
          :shp_cut_id,
          :spc_id,
          :shp_summ_plus_nds,
          :cur_id,
          :currency
  do
  begin
    shp_closed = null;
    select shp_id from dcl_ctc_shp where shp_id = :shp_id into :shp_closed;

    country = null;
    select cut_name from dcl_country where cut_id = :shp_cut_id into :country;

    need_suspend = null;
    if ( include_type = 1 or include_type = 2 ) then
    begin
      if ( (shp_closed is not null and include_type = 1) or (shp_closed is null and include_type = 2) ) then
      begin
        need_suspend = 1;
      end
    end
    else
    begin
      need_suspend = 1;
    end

    if ( need_suspend = 1 ) then
    begin
      con_number = null;
      con_date = null;
      spc_number = null;
      spc_date = null;
      spc_summ = null;
      spc_nds_rate = null;
      lps_count = null;
      lps_summ_plus_nds = null;
      lps_summ_zak = null;
      lps_sum_transport = null;
      lps_custom = null;
      lps_summ_out_nds = null;
      lps_summ_out_nds_eur = null;

      select con.con_number,
             con.con_date,
             spc.spc_number,
             spc.spc_date,
             spc.spc_summ,
             spc.spc_nds_rate
      from   dcl_contract con,
             dcl_con_list_spec spc
      where  spc.spc_id = :spc_id and
             con.con_id = spc.con_id
      into   :con_number,
             :con_date,
             :spc_number,
             :spc_date,
             :spc_summ,
             :spc_nds_rate;

      select count(lps.lps_id) from dcl_shp_list_produce lps where shp_id = :shp_id into :shp_prd_count;
      if ( :not_include_zero is null or ( :not_include_zero is not null and :shp_summ_plus_nds != 0 ) ) then
      begin
        for
          select lps.lps_id,
                 lpc.prd_id,
                 lpc.stf_id,
                 (
                   select stf.stf_name
                   from dcl_stuff_category stf
                   where stf.stf_id = lpc.stf_id
                 ),
                 lps.lps_count,
                 lps.lps_summ_plus_nds,
                 lpc.lpc_cost_one * lps.lps_count,
                 lpc.lpc_sum_transport / lpc.lpc_count * lps.lps_count,
                 lpc.lpc_custom / lpc.lpc_count * lps.lps_count
          from dcl_shp_list_produce lps,
               dcl_prc_list_produce lpc
          where shp_id = :shp_id
                and lpc.lpc_id = lps.lpc_id
          into :lps_id,
               :prd_id,
               :stf_id,
               :stf_name,
               :lps_count,
               :lps_summ_plus_nds,
               :lps_summ_zak,
               :lps_sum_transport,
               :lps_custom
        do
        begin
          prd_name = null;
          prd_type = null;
          prd_params = null;
          prd_add_params = null;
          ctn_number = null;

          select prd.prd_name,
                 prd.prd_type,
                 prd.prd_params,
                 prd.prd_add_params,
                 (
                   select ctn.ctn_number
                   from dcl_catalog_number ctn
                   where ctn.stf_id = :stf_id and
                         ctn.prd_id = prd.prd_id
                 )
          from dcl_produce prd
          where prd.prd_id = :prd_id
          into :prd_name,
               :prd_type,
               :prd_params,
               :prd_add_params,
               :ctn_number;

          manager_id = null;
          department = '';
          manager = '';
          for
            select distinct usr_lng.usr_surname || ' ' || usr_lng.usr_name
            from dcl_lps_list_manager lmn,
                 dcl_user_language usr_lng
            where lmn.lps_id = :lps_id and
                  usr_lng.usr_id = lmn.usr_id and
                  usr_lng.lng_id = 1
          into :manager_local
          do
          begin
            manager = manager || manager_local || ' ';
          end

          for
            select distinct dep.dep_name
            from dcl_lps_list_manager lmn,
                 dcl_user usr,
                 dcl_department dep
            where lmn.lps_id = :lps_id and
                  usr.usr_id = lmn.usr_id and
                  dep.dep_id = usr.dep_id
          into :department_local
          do
          begin
            department = department || department_local || ' ';
          end

          lps_summ_out_nds = 0;
          if ( spc_nds_rate is not null ) then
          begin
            lps_summ_out_nds = lps_summ_plus_nds / ( (cast (100 as DECIMAL(15,2))) + spc_nds_rate ) * (cast (100 as DECIMAL(15,2)));
          end

          lps_summ_out_nds_eur = 0;
          select crt_rate from dcl_currency_rate_for_date(:eur_cur_id, :shp_date) into :eur_crt_rate;
          if ( eur_cur_id = cur_id ) then
          begin
           lps_summ_out_nds_eur = lps_summ_out_nds;
          end
          else if ( currency = 'BYN' ) then
          begin
           lps_summ_out_nds_eur = lps_summ_out_nds / eur_crt_rate;
          end
          else
          begin
            select crt_rate from dcl_currency_rate_for_date(:cur_id, :shp_date) into :crt_rate;
            temporary_f = lps_summ_out_nds * crt_rate / eur_crt_rate;
            lps_summ_out_nds_eur = temporary_f;
          end

          suspend;
        end
      end

      if (
           ( not_include_zero is null and :shp_summ_plus_nds = 0 ) or
           ( :shp_summ_plus_nds != 0 and :shp_prd_count = 0 )
         ) then
      begin
        lps_id = null;
        prd_id = null;
        prd_name = null;
        prd_type = null;
        prd_params = null;
        prd_add_params = null;
        ctn_number = null;
        stf_id = null;
        stf_name = null;
        lps_count = null;
        lps_summ_plus_nds = null;
        lps_summ_zak = null;
        lps_sum_transport = null;
        lps_custom = null;
        lps_summ_out_nds = null;
        lps_summ_out_nds_eur = null;
        manager_id = null;
        manager = null;
        department = null;

        suspend;
      end

    end --if need_suspend
  end
end ^

ALTER PROCEDURE DCL_SHIPPING_REPORT_USER (DATE_BEGIN DATE,
DATE_END DATE,
USR_ID INTEGER,
DEP_ID INTEGER,
CTR_ID INTEGER,
NOT_INCLUDE_ZERO SMALLINT,
INCLUDE_TYPE SMALLINT)
RETURNS (SHP_ID INTEGER,
SHP_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SHP_DATE DATE,
SHP_CONTRACTOR VARCHAR(200) CHARACTER SET UNICODE_FSS,
SHP_PRD_COUNT INTEGER,
SHP_SUMM_PLUS_NDS DECIMAL(15, 2),
SHP_SUM_NR DECIMAL(15, 2),
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SHP_CLOSED SMALLINT,
CURRENCY VARCHAR(10) CHARACTER SET UNICODE_FSS,
PRD_ID INTEGER,
PRD_NAME VARCHAR(1000) CHARACTER SET UNICODE_FSS,
PRD_TYPE VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
PRD_ADD_PARAMS VARCHAR(200) CHARACTER SET UNICODE_FSS,
CTN_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
LPS_ID INTEGER,
LPS_COUNT DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LPS_SUMM_OUT_NDS DECIMAL(15, 2),
LPS_SUMM_OUT_NDS_EUR DECIMAL(15, 2),
LPS_SUMM_ZAK DECIMAL(15, 2),
MANAGER_ID INTEGER,
MANAGER VARCHAR(50) CHARACTER SET UNICODE_FSS,
DEPARTMENT VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_SUM_TRANSPORT DECIMAL(15, 2),
LPS_CUSTOM DECIMAL(15, 2),
COUNTRY VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare variable SPC_ID integer;
declare variable SPC_NDS_RATE decimal(15,2);
declare variable NEED_SUSPEND smallint;
declare variable LMN_PERCENT decimal(3,0);
declare variable TEMPORARY_F float;
declare variable SHP_CUT_ID integer;
declare variable EUR_CUR_ID integer;
declare variable EUR_CRT_RATE decimal(15,2);
declare variable CUR_ID integer;
declare variable CRT_RATE decimal(15,2);
begin
  select cur_id from dcl_currency where cur_name = 'EUR' into :eur_cur_id;

  for
    select shp.shp_id,
           shp.shp_number,
           shp.shp_date,
           shp.shp_summ_plus_nds - (select sum(lps.lps_summ_plus_nds) from dcl_shp_list_produce lps where lps.shp_id = shp.shp_id),
           ctr.ctr_name,
           ctr.cut_id,
           shp.spc_id
    from dcl_shipping shp,
         dcl_contractor ctr
    where
          shp_date >= :date_begin and shp_date <= :date_end
          and ( :ctr_id is null or :ctr_id = -1 or shp.ctr_id = :ctr_id )
          and ctr.ctr_id = shp.ctr_id
          and
          exists
          (
            select shp_id
            from dcl_shp_usr_dep_v v
            where v.shp_id = shp.shp_id
                  and ( :usr_id is null or :usr_id = -1 or v.usr_id = :usr_id )
                  and ( :dep_id is null or :dep_id = -1 or v.dep_id = :dep_id )
          )
    into  :shp_id,
          :shp_number,
          :shp_date,
          :shp_sum_nr,
          :shp_contractor,
          :shp_cut_id,
          :spc_id
  do
  begin
    shp_closed = null;
    select shp_id from dcl_ctc_shp where shp_id = :shp_id into :shp_closed;

    country = null;
    select cut_name from dcl_country where cut_id = :shp_cut_id into :country;

    need_suspend = null;
    if ( include_type = 1 or include_type = 2 ) then
    begin
      if ( (shp_closed is not null and include_type = 1) or (shp_closed is null and include_type = 2) ) then
      begin
        need_suspend = 1;
      end
    end
    else
    begin
      need_suspend = 1;
    end

    if ( need_suspend = 1 ) then
    begin
      con_number = null;
      con_date = null;
      spc_number = null;
      spc_date = null;
      spc_summ = null;
      spc_nds_rate = null;
      currency = null;

      select con.con_number,
             con.con_date,
             cur.cur_id,
             cur.cur_name,
             spc.spc_number,
             spc.spc_date,
             spc.spc_summ,
             spc.spc_nds_rate
      from   dcl_contract con,
             dcl_con_list_spec spc,
             dcl_currency cur
      where  spc.spc_id = :spc_id and
             con.con_id = spc.con_id and
             cur.cur_id = con.cur_id
      into   :con_number,
             :con_date,
             :cur_id,
             :currency,
             :spc_number,
             :spc_date,
             :spc_summ,
             :spc_nds_rate;

      select count(lps.lps_id), sum(lps.lps_summ_plus_nds) from dcl_shp_list_produce lps where shp_id = :shp_id into :shp_prd_count, :shp_summ_plus_nds;
      if ( :not_include_zero is null or ( :not_include_zero is not null and :shp_prd_count != 0 and :shp_summ_plus_nds != 0 ) ) then
      begin
        for
          select lps.lps_id,
                 lpc.prd_id,
                 lpc.stf_id,
                 (
                   select stf.stf_name
                   from dcl_stuff_category stf
                   where stf.stf_id = lpc.stf_id
                 ),
                 lps.lps_count,
                 lps.lps_summ_plus_nds,
                 lpc.lpc_cost_one * lps.lps_count,
                 lpc.lpc_sum_transport / lpc.lpc_count * lps.lps_count,
                 lpc.lpc_custom / lpc.lpc_count * lps.lps_count,
                 lmn.usr_id,
                 (
                   select usr_lng_shp.usr_surname || ' ' || usr_lng_shp.usr_name
                   from dcl_user_language usr_lng_shp
                   where usr_lng_shp.usr_id = lmn.usr_id and
                   usr_lng_shp.lng_id = 1
                 ),
                 lmn.lmn_percent
          from dcl_shp_list_produce lps,
               dcl_lps_list_manager lmn,
               dcl_prc_list_produce lpc
          where shp_id = :shp_id
                and lpc.lpc_id = lps.lpc_id
                and lmn.lps_id = lps.lps_id
                and ( :usr_id is null or :usr_id = -1 or lmn.usr_id = :usr_id )
                and ( :dep_id is null or :dep_id = -1 or lmn.usr_id in ( select usr_id from dcl_user where dep_id = :dep_id ) )
          into :lps_id,
               :prd_id,
               :stf_id,
               :stf_name,
               :lps_count,
               :lps_summ_plus_nds,
               :lps_summ_zak,
               :lps_sum_transport,
               :lps_custom,
               :manager_id,
               :manager,
               :lmn_percent
        do
        begin
          prd_name = null;
          prd_type = null;
          prd_params = null;
          prd_add_params = null;
          ctn_number = null;

          select prd.prd_name,
                 prd.prd_type,
                 prd.prd_params,
                 prd.prd_add_params,
                 (
                   select ctn.ctn_number
                   from dcl_catalog_number ctn
                   where ctn.stf_id = :stf_id and
                         ctn.prd_id = prd.prd_id
                 )
          from dcl_produce prd
          where prd.prd_id = :prd_id
          into :prd_name,
               :prd_type,
               :prd_params,
               :prd_add_params,
               :ctn_number;

          department = null;
          select dep.dep_name
          from dcl_user usr,
               dcl_department dep
          where usr.usr_id = :manager_id and
                dep.dep_id = usr.dep_id
          into :department;

          if ( lmn_percent != 100 ) then
          begin
            lps_count = lps_count * lmn_percent / 100;
            lps_summ_plus_nds = lps_summ_plus_nds * lmn_percent / 100;
            lps_summ_zak = lps_summ_zak * lmn_percent / 100;
            lps_sum_transport = lps_sum_transport * lmn_percent / 100;
            lps_custom = lps_custom * lmn_percent / 100;
          end

          lps_summ_out_nds = 0;
          if ( spc_nds_rate is not null ) then
          begin
            lps_summ_out_nds = lps_summ_plus_nds / ( (cast (100 as DECIMAL(15,2))) + spc_nds_rate ) * (cast (100 as DECIMAL(15,2)));
          end

          lps_summ_out_nds_eur = 0;
          select crt_rate from dcl_currency_rate_for_date(:eur_cur_id, :shp_date) into :eur_crt_rate;
          if ( eur_cur_id = cur_id ) then
          begin
           lps_summ_out_nds_eur = lps_summ_out_nds;
          end
          else if ( currency = 'BYR' ) then
          begin
           lps_summ_out_nds_eur = lps_summ_out_nds / eur_crt_rate;
          end
          else if ( currency = 'BYN' ) then
          begin
           lps_summ_out_nds_eur = lps_summ_out_nds / eur_crt_rate;
          end
          else
          begin
            select crt_rate from dcl_currency_rate_for_date(:cur_id, :shp_date) into :crt_rate;
            temporary_f = lps_summ_out_nds * crt_rate / eur_crt_rate;
            lps_summ_out_nds_eur = temporary_f;
          end

          suspend;
        end
      end

      if (
           :not_include_zero is null and :shp_prd_count = 0 and
           ( :usr_id is null or :usr_id = -1 ) and
           ( :dep_id is null or :dep_id = -1 )
         ) then
      begin
        lps_id = null;
        prd_id = null;
        prd_name = null;
        prd_type = null;
        prd_params = null;
        prd_add_params = null;
        ctn_number = null;
        stf_id = null;
        stf_name = null;
        lps_count = null;
        manager_id = null;
        manager = null;
        department = null;

        suspend;
      end
    end --if need_suspend
  end
end ^

ALTER PROCEDURE DCL_SHP_LIST_PRODUCE_INSERT (SHP_ID INTEGER,
STF_ID INTEGER,
LPC_ID INTEGER,
LPS_COUNT DECIMAL(15, 2),
LPS_SUMM_PLUS_NDS DECIMAL(15, 2),
LPS_ENTER_IN_USE_DATE DATE,
LPS_MONTAGE_TIME DECIMAL(15, 1),
LPS_MONTAGE_OFF SMALLINT,
LPS_SERIAL_NUM VARCHAR(100) CHARACTER SET UNICODE_FSS,
LPS_YEAR_OUT VARCHAR(30) CHARACTER SET UNICODE_FSS,
LPR_ID INTEGER)
RETURNS (LPS_ID INTEGER)
AS 
begin

  insert into dcl_shp_list_produce(
    shp_id,
    stf_id,
    lpc_id,
    lps_count,
    lps_summ_plus_nds,
    lps_enter_in_use_date,
    lps_montage_time,
    lps_montage_off,
    lps_serial_num,
    lps_year_out,
    lpr_id
  )
  values(
    :shp_id,
    :stf_id,
    :lpc_id,
    :lps_count,
    :lps_summ_plus_nds,
    :lps_enter_in_use_date,
    :lps_montage_time,
    :lps_montage_off,
    :lps_serial_num,
    :lps_year_out,
    :lpr_id
  )
  returning lps_id into :lps_id;

  suspend;
end ^

ALTER PROCEDURE DCL_SIP_DEPENDED_LINES (OPR_ID INTEGER,
DRP_ID INTEGER)
RETURNS (ID INTEGER,
PRD_ID INTEGER,
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
PRD_COUNT DECIMAL(15, 2),
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE)
AS 
declare variable ASM_ID integer;
declare variable APR_ID integer;
declare variable OPR_ID_LOCAL integer;
begin
  id = null;
  prd_id = null;
  stf_id = null;
  stf_name = null;
  prd_count = null;
  ord_number = null;
  ord_date = null;

  asm_id = null;
  apr_id = null;
  opr_id_local = null;

  -- before selecting from assemple
  if ( drp_id is not null ) then
  begin
    select
      asm_id,
      apr_id,
      opr_id,
      ord_number,
      ord_date
    from dcl_dlr_list_produce_load(:drp_id)
    into
      :asm_id,
      :apr_id,
      :opr_id_local,
      :ord_number,
      :ord_date
    ;
  end
  else
  begin
    opr_id_local = :opr_id;
  end

  if ( opr_id_local is not null ) then
  begin
    for
      select
        prc.opr_id,
        prc.prd_id,
        prc.stf_id,
        stf.stf_name,
        prc.opr_count_executed
      from dcl_ord_list_prd_load_parent(:opr_id_local) prc,
           dcl_stuff_category stf
      where stf.stf_id = prc.stf_id
      into
        :id,
        :prd_id,
        :stf_id,
        :stf_name,
        :prd_count
    do
    begin
      suspend;
    end
  end

  if ( asm_id is not null ) then
  begin
    for
      select
        -1,
        apr.prd_id,
        asm.stf_id,
        stf.stf_name,
        apr.apr_count
      from dcl_assemble asm,
           dcl_asm_list_produce apr,
           dcl_stuff_category stf
      where asm.asm_id = :asm_id and
            apr.asm_id = asm.asm_id and
            stf.stf_id = asm.stf_id
      into
        :id,
        :prd_id,
        :stf_id,
        :stf_name,
        :prd_count
    do
    begin
      suspend;
    end
  end

  if ( apr_id is not null ) then
  begin
    for
      select
        -1,
        apr.prd_id,
        asm.stf_id,
        stf.stf_name,
        apr.apr_count
      from dcl_asm_list_produce apr,
           dcl_assemble asm,
           dcl_stuff_category stf
      where apr.apr_id = :apr_id and
            asm.asm_id = apr.asm_id and
            stf.stf_id = asm.stf_id
      into
        :id,
        :prd_id,
        :stf_id,
        :stf_name,
        :prd_count
    do
    begin
      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_SPECIFICATION_IMPORT_FILTER (SPI_NUMBER_IN VARCHAR(20) CHARACTER SET UNICODE_FSS,
SPI_DATE_BEGIN_IN DATE,
SPI_DATE_END_IN DATE,
SPI_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (SPI_ID INTEGER,
SPI_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPI_DATE DATE,
SPI_ARRIVE SMALLINT,
SPI_USERS VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SPI_COST DECIMAL(15, 2),
SPI_SEND_DATE DATE)
AS 
begin
  spi_number_in = upper(spi_number_in);
  spi_user_in = upper(spi_user_in);
  for
    select spi_id,
           spi_number,
           spi_date,
           spi_arrive,
           (select users from dcl_get_usr_for_spec_imp(:spi_id)) as spi_users,
           spi_cost,
           spi_send_date
    from dcl_specification_import spi
    where
          (( :spi_date_begin_in is null ) or ( spi_date >=:spi_date_begin_in ))
     and  (( :spi_date_end_in is null ) or ( spi_date <=:spi_date_end_in ))
     and  (( :spi_number_in is null ) or ( :spi_number_in like '' ) or ( upper(spi.spi_number) like('%' || :spi_number_in || '%') ))
     and  (( :spi_user_in is null ) or ( :spi_user_in like '' )  or ((select upper(users) from dcl_get_usr_for_spec_imp(spi.spi_id))  like('%' || :spi_user_in || '%') ))
    order by spi_date descending, spi_number descending
    into  :spi_id,
          :spi_number,
          :spi_date,
          :spi_arrive,
          :spi_users,
          :spi_cost,
          :spi_send_date
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_SPECIFICATION_IMPORT_INSERT (SPI_DATE DATE,
SPI_NUMBER VARCHAR(100) CHARACTER SET UNICODE_FSS,
SPI_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
SPI_COURSE DECIMAL(15, 4),
SPI_KOEFF DECIMAL(15, 3),
SPI_ARRIVE SMALLINT,
SPI_COST DECIMAL(15, 2))
RETURNS (SPI_ID INTEGER)
AS 
begin

  insert into dcl_specification_import (
    spi_number,
    spi_date,
    spi_comment,
    spi_course,
    spi_koeff,
    spi_arrive,
    spi_cost
  )
  values (
    :spi_number,
    :spi_date,
    :spi_comment,
    :spi_course,
    :spi_koeff,
    :spi_arrive,
    :spi_cost
  )
  returning spi_id into :spi_id;

  suspend;
end ^

ALTER PROCEDURE DCL_SPI_COUNT_BY_PRD_ID_SPI_ID (PRD_ID INTEGER,
STF_ID INTEGER,
ORD_ID INTEGER,
SPI_ID INTEGER)
RETURNS (TRN_PRODUCE_COUNT DECIMAL(15, 2))
AS 
declare variable OPR_ID integer;
declare variable DRP_ID integer;
declare variable SIP_COUNT decimal(15,2);
declare variable ORD_ID_LOCAL integer;
declare variable APR_ID integer;
begin
  trn_produce_count = 0;

  for
    select
      sip.opr_id,
      sip.drp_id,
      sip.sip_count
    from
      dcl_spi_list_produces_load(:spi_id, null) sip
    where
      sip.stf_id = :stf_id and
      sip.prd_id = :prd_id and
      ( :ord_id is not null or ( :ord_id is null and opr_id is null )) -- cut manual enter
    into :opr_id,
         :drp_id,
         :sip_count
  do
  begin
    -- the sequence is important
    if ( drp_id is not null ) then
    begin
      select opr_id,
             apr_id
      from dcl_dlr_list_produce_load(:drp_id)
      where :ord_id is not null or ( :ord_id is null and opr_id is null ) -- cut manual enter
      into :opr_id,
           :apr_id;
    end

    if ( apr_id is not null ) then
    begin
      select
        opr.opr_id
      from
        dcl_ord_list_produce opr,
        dcl_assemble asm,
        dcl_asm_list_produce apr
      where opr.opr_id = asm.opr_id and
            asm.asm_id = apr.asm_id and
            apr.apr_id = :apr_id
      into
        :opr_id
      ;
    end

    if ( ord_id is not null and opr_id is not null ) then
    begin
      select ord_id from dcl_ord_list_produce where opr_id = :opr_id into :ord_id_local;
      if ( ord_id = ord_id_local ) then
      begin
        trn_produce_count = trn_produce_count + :sip_count;
      end
    end
    else if ( ord_id is null ) then
    begin
      trn_produce_count = trn_produce_count + :sip_count;
    end
  end

  suspend;
end ^

ALTER PROCEDURE DCL_SPI_LIST_PRODUCES_LOAD (SPI_ID_IN INTEGER,
USR_ID INTEGER)
RETURNS (SPI_ID INTEGER,
SIP_ID INTEGER,
DRP_ID INTEGER,
OPR_ID INTEGER,
PRD_ID INTEGER,
SIP_PRICE DECIMAL(15, 2),
SIP_COUNT DECIMAL(15, 2),
SIP_WEIGHT DECIMAL(15, 3),
SIP_PERCENT DECIMAL(15, 2),
SIP_COST DECIMAL(15, 2),
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SIP_OCCUPIED INTEGER,
DRP_PRICE DECIMAL(15, 2),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
DLR_ORD_NOT_FORM SMALLINT,
COUNT_DAY INTEGER,
HAVE_DEPEND SMALLINT,
ORD_ID INTEGER,
DRP_MAX_EXTRA SMALLINT,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_DELIVERY_DATE DATE,
SPC_ADD_PAY_COND VARCHAR(5000) CHARACTER SET UNICODE_FSS,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS,
PAY_PERSENT DECIMAL(15, 2))
AS 
declare variable DEP_ID integer;
declare variable NEED_SUSPEND smallint;
declare variable DOC_COUNT integer;
declare variable SPC_ID integer;
declare variable SPC_SUM decimal(15,2);
declare variable PAY_SUM decimal(15,2);
begin
  spi_id = spi_id_in;

  for
    select
      sip_id
    from
      dcl_spi_list_produce sip
    where sip.spi_id = :spi_id_in
    order by sip_id
    into
      :sip_id
  do
  begin
    select
      spi_id,
      drp_id,
      opr_id,
      prd_id,
      sip_price,
      sip_count,
      sip_weight,
      sip_percent,
      sip_cost,
      prs_id,
      prs_name,
      sip_occupied,
      drp_price,
      stf_id,
      stf_name,
      ctr_id,
      ctr_name,
      ord_id, 
      ord_number,
      ord_date,
      dlr_ord_not_form,
      count_day,
      spc_id, 
      spc_number,
      spc_date,
      spc_delivery_date,
      con_number,
      con_date,
      cur_name,
      have_depend,
      drp_max_extra
    from
      dcl_spi_list_produce_load(:sip_id)
    into
      :spi_id,
      :drp_id,
      :opr_id,
      :prd_id,
      :sip_price,
      :sip_count,
      :sip_weight,
      :sip_percent,
      :sip_cost,
      :prs_id,
      :prs_name,
      :sip_occupied,
      :drp_price,
      :stf_id,
      :stf_name,
      :ctr_id,
      :ctr_name,
      :ord_id,
      :ord_number,
      :ord_date,
      :dlr_ord_not_form,
      :count_day,
      :spc_id, 
      :spc_number,
      :spc_date,
      :spc_delivery_date,
      :con_number,
      :con_date,
      :cur_name,
      :have_depend,
      :drp_max_extra
    ;

    need_suspend = 1;
    if ( usr_id is not null ) then
    begin
      dep_id = null;
      select dep_id from dcl_user where usr_id = :usr_id into :dep_id;

      doc_count = 0;
      if ( opr_id is not null ) then
      begin
        select count(ord.ord_id)
        from dcl_order ord,
             dcl_ord_list_produce opr
        where opr.opr_id = :opr_id and
              ord.ord_id = opr.ord_id and
              coalesce(:dep_id, -1) = ( select dep_id from dcl_user where usr_id = ord.usr_id_create )
        into :doc_count;
      end

      if ( doc_count = 0 and drp_id is not null ) then
      begin
        select count(dlr.dlr_id)
        from dcl_delivery_request dlr,
             dcl_dlr_list_produce drp
        where drp.drp_id = :drp_id and
              dlr.dlr_id = drp.dlr_id and
              (
                dlr.usr_id_create = coalesce(:usr_id, -1) or
                coalesce(:dep_id, -1) = ( select dep_id from dcl_user where usr_id = dlr.usr_id_create )
              )
        into :doc_count;
      end

      if ( doc_count = 0 ) then
      begin
        need_suspend = null;
      end
    end

    if ( need_suspend is not null ) then
    begin
      spc_add_pay_cond = null;
      spc_sum = null;

      select spc_add_pay_cond, spc_summ from dcl_con_list_spec where spc_id = :spc_id into :spc_add_pay_cond, :spc_sum;
      pay_persent = 0;
      if (spc_sum != 0) then
      begin
        select sum(lps_summ) from dcl_pay_list_summ where spc_id = :spc_id into :pay_sum;

        pay_persent = pay_sum / spc_sum * 100;
      end

      suspend;
    end
  end
end ^

ALTER PROCEDURE DCL_SPI_LIST_PRODUCE_LOAD (SIP_ID_IN INTEGER)
RETURNS (SIP_ID INTEGER,
SPI_ID INTEGER,
DRP_ID INTEGER,
OPR_ID INTEGER,
PRD_ID INTEGER,
SIP_PRICE DECIMAL(15, 2),
SIP_COUNT DECIMAL(15, 2),
SIP_WEIGHT DECIMAL(15, 3),
SIP_PERCENT DECIMAL(15, 2),
SIP_COST DECIMAL(15, 2),
PRS_ID INTEGER,
PRS_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SIP_OCCUPIED INTEGER,
DRP_PRICE DECIMAL(15, 2),
STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
ORD_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
ORD_DATE DATE,
DLR_ORD_NOT_FORM SMALLINT,
COUNT_DAY INTEGER,
HAVE_DEPEND SMALLINT,
ORD_ID INTEGER,
DRP_MAX_EXTRA SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_DELIVERY_DATE DATE,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
declare variable ORD_ID_LOCAL integer;
declare variable SPI_DATE date;
begin
  sip_id = null;
  spi_id = null;
  drp_id = null;
  opr_id = null;
  prd_id = null;
  sip_price = null;
  sip_count = null;
  sip_weight = null;
  sip_percent = null;
  sip_cost = null;
  prs_id = null;
  prs_name = null;
  sip_occupied = null;
  drp_price = null;
  stf_id = null;
  stf_name = null;
  ctr_id = null;
  ctr_name = null;
  ord_number = null;
  ord_date = null;
  ord_id = null;
  dlr_ord_not_form = null;
  count_day = null;
  have_depend = null;
  drp_max_extra = null;
  spc_id = null;
  spc_number = null;
  spc_date = null;
  spc_delivery_date = null;
  con_number = null;
  con_date = null;
  cur_name = null;

  select
      sip.sip_id, 
      sip.spi_id,
      sip.drp_id,
      sip.opr_id,
      sip.prd_id,
      sip.sip_price,
      sip.sip_count,
      sip.sip_weight,
      sip.sip_percent,
      sip.sip_cost,
      sip.prs_id,
      prs.prs_name,
      (select sip_id from DCL_OCCUPIED_SPI_PRODUCE_V where sip_id = sip.sip_id)
  from
      dcl_spi_list_produce sip,
      dcl_purpose prs
  where sip.sip_id = :sip_id_in and
        prs.prs_id = sip.prs_id
  into
      :sip_id, 
      :spi_id,
      :drp_id,
      :opr_id,
      :prd_id,
      :sip_price,
      :sip_count,
      :sip_weight,
      :sip_percent,
      :sip_cost,
      :prs_id,
      :prs_name,
      :sip_occupied
  ;

  if ( drp_id is not null ) then
  begin
    select
      drp_price,
      stf_id,
      stf_name,
      ctr_id,
      ctr_name,
      ord_id,
      ord_number,
      ord_date,
      dlr_ord_not_form,
      drp_have_depend,
      drp_max_extra,
      spc_id,
      opr_id
    from dcl_dlr_list_produce_load(:drp_id)
    into
      :drp_price,
      :stf_id,
      :stf_name,
      :ctr_id,
      :ctr_name,
      :ord_id,
      :ord_number,
      :ord_date,
      :dlr_ord_not_form,
      :have_depend,
      :drp_max_extra,
      :spc_id,
      :opr_id
    ;

    if ( spc_id is not null ) then
    begin
      select
        spc.spc_id,
        spc.spc_number,
        spc.spc_date,
        spc.spc_delivery_date,
        con.con_number,
        con.con_date,
        cur.cur_name
      from
        dcl_con_list_spec spc,
        dcl_contract con,
        dcl_currency cur
      where spc.spc_id = :spc_id and
            con.con_id = spc.con_id and
            cur.cur_id = con.cur_id
      into
        :spc_id, 
        :spc_number,
        :spc_date,
        :spc_delivery_date,
        :con_number,
        :con_date,
        :cur_name
      ;

      opr_id = null;
    end
  end

  if ( opr_id is not null ) then
  begin
    select
      ord_id, 
      drp_price,
      drp_max_extra,
      opr_have_depend
    from dcl_ord_list_produce_load(:opr_id)
    into
      :ord_id_local,
      :drp_price,
      :drp_max_extra,
      :have_depend
    ;

    select
      ctr_id,
      ctr_name,
      spc_id,
      spc_number,
      spc_date,
      spc_delivery_date,
      con_number,
      con_date,
      cur_name
    from get_contractor_for_for_opr_id(:opr_id)
    into
      :ctr_id,
      :ctr_name,
      :spc_id,
      :spc_number,
      :spc_date,
      :spc_delivery_date,
      :con_number,
      :con_date,
      :cur_name
    ;

    select
      stf_id,
      (select stf_name from dcl_stuff_category where stf_id = ord.stf_id),
      ord_id, 
      ord_number,
      ord_date
    from dcl_order ord
    where ord_id = :ord_id_local
    into
      :stf_id,
      :stf_name,
      :ord_id,
      :ord_number,
      :ord_date
    ;
  end

  if ( spc_delivery_date is not null ) then
  begin
    select spi_date from dcl_specification_import where spi_id = :spi_id into :spi_date;
    select count_day from dcl_get_count_day(:spi_date, :spc_delivery_date) into :count_day;
  end

  -- ???????????????????????? ???????????? ???? ???????????? ???? ????????????, ??.??. ?????????? ????????????????.
  select opr_id from dcl_spi_list_produce sip where sip.sip_id = :sip_id_in into :opr_id;

  suspend;
end ^

ALTER PROCEDURE DCL_STUFF_CATEGORY_FILTER (STF_NAME_IN VARCHAR(150) CHARACTER SET UNICODE_FSS,
MONTAGE SMALLINT)
RETURNS (STF_ID INTEGER,
STF_NAME VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
declare variable stf_name_filter varchar(150);
begin
  stf_name_in = upper(stf_name_in);

  for
    select
      upper(stf.stf_name) as stf_name_filter,
      stf_id,
      stf_name
    from dcl_stuff_category stf
    where ( :stf_name_in is null or :stf_name_in like '' or upper(stf.stf_name) like('%' || :stf_name_in || '%' ) ) and
          ( :montage = 0 or ( :montage = 1 and stf.stf_show_in_montage is not null ) )
    order by stf_name_filter
  into
    :stf_name_filter,
    :stf_id,
    :stf_name
  do
  begin
    suspend;
  end

end ^

ALTER PROCEDURE DCL_TIMEBOARD_FILTER (TMB_DATE_IN DATE,
TMB_USER_IN VARCHAR(50) CHARACTER SET UNICODE_FSS)
RETURNS (TMB_ID INTEGER,
TMB_DATE DATE,
TMB_USER VARCHAR(50) CHARACTER SET UNICODE_FSS,
TMB_CHECKED SMALLINT)
AS 
begin
  tmb_user_in = upper(tmb_user_in);

  for
    select tmb_id,
           tmb_date,
           (select usr_surname || ' ' || usr_name from dcl_user_language  where usr_id = tmb.usr_id and lng_id = 1),
           tmb_checked
    from dcl_timeboard tmb
    where
          ( :tmb_date_in is null or tmb_date = :tmb_date_in )
     and  ( :tmb_user_in is null or :tmb_user_in like '' or (select upper(usr.usr_surname || ' ' || usr.usr_name) from dcl_user_language usr where usr_id = tmb.usr_id and lng_id = 1) like('%' || :tmb_user_in || '%') )
    order by tmb_date descending
    into  :tmb_id,
          :tmb_date,
          :tmb_user,
          :tmb_checked
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_TIMEBOARD_INSERT (USR_ID INTEGER,
TMB_DATE DATE,
TMB_CHECKED SMALLINT)
RETURNS (TMB_ID INTEGER)
AS 
begin

  insert into dcl_timeboard (
     usr_id,
     tmb_date,
     tmb_checked
    )
    values (
     :usr_id,
     :tmb_date,
     :tmb_checked
   )
   returning tmb_id into :tmb_id;

  suspend;
end ^

ALTER PROCEDURE DCL_TIMEBOARD_LOAD (TMB_ID INTEGER)
RETURNS (USR_ID INTEGER,
TMB_DATE DATE,
TMB_CHECKED SMALLINT,
USR_ID_CREATE INTEGER,
USR_ID_EDIT INTEGER,
TMB_CREATE_DATE TIMESTAMP,
TMB_EDIT_DATE TIMESTAMP,
TMB_CHECKED_DATE TIMESTAMP,
USR_ID_CHECKED INTEGER)
AS 
begin

  select tmb.usr_id_create,
         tmb.usr_id_edit,
         tmb.tmb_create_date,
         tmb.tmb_edit_date,
         tmb.usr_id,
         tmb.tmb_date,
         tmb.tmb_checked,
         tmb.tmb_checked_date,
         tmb.usr_id_checked
  from dcl_timeboard tmb
  where  tmb.tmb_id = :tmb_id
  into   :usr_id_create,
         :usr_id_edit,
         :tmb_create_date,
         :tmb_edit_date,
         :usr_id,
         :tmb_date,
         :tmb_checked,
         :tmb_checked_date,
         :usr_id_checked
  ;

  suspend;
end ^

ALTER PROCEDURE DCL_TIMEBOARD_LOAD_CHECK_IDX (USR_ID INTEGER,
TMB_DATE DATE)
RETURNS (TMB_ID INTEGER)
AS 
begin

  select tmb.tmb_id
  from dcl_timeboard tmb
  where  tmb.usr_id = :usr_id and
         tmb.tmb_date = :tmb_date
  into   :tmb_id
  ;

  suspend;
end ^

ALTER PROCEDURE DCL_TMB_LIST_WORKS_LOAD (TMB_ID_IN INTEGER)
RETURNS (TBW_ID INTEGER,
TMB_ID INTEGER,
TBW_DATE DATE,
TBW_FROM TIME,
TBW_TO TIME,
TBW_HOURS_UPDATE DECIMAL(15, 2),
CRQ_ID INTEGER,
TBW_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID INTEGER,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_DELIVER SMALLINT)
AS 
begin
  tmb_id = tmb_id_in;

  for
    select
      tbw_id
    from
      dcl_tmb_list_work tbw
    where tbw.tmb_id = :tmb_id_in
    order by tbw_date
    into
      :tbw_id
  do
  begin
    select
      tbw_id,
      tmb_id,
      tbw_date,
      tbw_from,
      tbw_to,
      tbw_hours_update,
      crq_id,
      tbw_comment,
      crq_number,
      crq_request_type_id,
      ctr_id,
      ctr_name,
      crq_equipment,
      crq_deliver
    from dcl_tmb_list_work_load(:tbw_id)
    into
      :tbw_id,
      :tmb_id,
      :tbw_date,
      :tbw_from,
      :tbw_to,
      :tbw_hours_update,
      :crq_id,
      :tbw_comment,
      :crq_number,
      :crq_request_type_id,
      :ctr_id,
      :ctr_name,
      :crq_equipment,
      :crq_deliver
    ;

    suspend;
  end
end ^

ALTER PROCEDURE DCL_TMB_LIST_WORK_LOAD (TBW_ID_IN INTEGER)
RETURNS (TBW_ID INTEGER,
TMB_ID INTEGER,
TBW_DATE DATE,
TBW_FROM TIME,
TBW_TO TIME,
TBW_HOURS_UPDATE DECIMAL(15, 2),
CRQ_ID INTEGER,
TBW_COMMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_NUMBER VARCHAR(15) CHARACTER SET UNICODE_FSS,
CRQ_REQUEST_TYPE_ID INTEGER,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CRQ_EQUIPMENT VARCHAR(2000) CHARACTER SET UNICODE_FSS,
CRQ_DELIVER SMALLINT)
AS 
begin
  tbw_id = null;
  tmb_id = null;
  tbw_date = null;
  tbw_from = null;
  tbw_to = null;
  tbw_hours_update = null;
  crq_id = null;
  tbw_comment = null;
  crq_number = null;
  crq_request_type_id = null;
  ctr_id = null;
  ctr_name = null;
  crq_equipment = null;
  crq_deliver = null;

  select
    tbw.tbw_id,
    tbw.tmb_id,
    tbw.tbw_date,
    tbw.tbw_from,
    tbw.tbw_to,
    tbw.tbw_hours_update,
    tbw.crq_id,
    tbw.tbw_comment
  from dcl_tmb_list_work tbw
  where tbw.tbw_id = :tbw_id_in
  into
    :tbw_id,
    :tmb_id,
    :tbw_date,
    :tbw_from,
    :tbw_to,
    :tbw_hours_update,
    :crq_id,
    :tbw_comment
  ;

  select
    crq_number, 
    crq_request_type_id,
    ctr_id,
    crq_equipment,
    crq_deliver
  from dcl_contractor_request_load(:crq_id)
  into
    :crq_number,
    :crq_request_type_id,
    :ctr_id,
    :crq_equipment,
    :crq_deliver
  ;

  select ctr_name from dcl_contractor where ctr_id = :ctr_id into :ctr_name;

  suspend;
end ^

ALTER PROCEDURE DCL_UNCLOSED_SPEC RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CON_ORIGINAL SMALLINT,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_SUMM DECIMAL(15, 2),
SPC_GROUP_DELIVERY SMALLINT,
SPC_ORIGINAL SMALLINT,
PAY_SUM DECIMAL(15, 2),
SHP_SUM DECIMAL(15, 2),
HAVE_UNBLOCKED_PRC SMALLINT)
AS 
declare variable UNBLOCKED_PRC_COUNT integer;
declare variable SHP_ID integer;
declare variable GET_SPEC smallint;
begin
  for
    select
      ctr.ctr_id,
      ctr.ctr_name,
      con.con_id,
      con.con_number,
      con.con_date,
      con.con_original,
      spc.spc_id,
      spc.spc_number,
      spc.spc_date,
      spc.spc_summ,
      spc.spc_group_delivery,
      spc.spc_original
    from dcl_contractor ctr,
         dcl_contract con,
         dcl_con_list_spec spc
    where ctr.ctr_id = con.ctr_id and
          con.con_id = spc.con_id
    order by spc_id
    into
      :ctr_id,
      :ctr_name,
      :con_id,
      :con_number,
      :con_date,
      :con_original,
      :spc_id,
      :spc_number,
      :spc_date,
      :spc_summ,
      :spc_group_delivery,
      :spc_original
  do
  begin
    have_unblocked_prc = null;

    if ( spc_group_delivery is not null ) then
    begin
      get_spec = null;
      for
        select
          shp.shp_id
        from
           dcl_shipping shp
        where shp.spc_id = :spc_id and
              not exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
        into :shp_id
      do
      begin
        get_spec = 1;

        select
          coalesce(count(lps.lps_id), 0)
        from
          dcl_shipping shp,
          dcl_shp_list_produce lps,
          dcl_prc_list_produce lpc,
          dcl_produce_cost prc
        where
          shp.spc_id = :spc_id and
          lps.shp_id = :shp_id and
          lpc.lpc_id = lps.lpc_id and
          prc.prc_id = lpc.prc_id and
          prc.prc_block is null
        into :unblocked_prc_count;

        if ( unblocked_prc_count != 0 ) then
        begin
          have_unblocked_prc = 1;
          break;
        end
      end
    end
    else
    begin
      get_spec = 1;
      for
        select
          shp.shp_id
        from
           dcl_shipping shp
        where shp.spc_id = :spc_id and
              not exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
        into :shp_id
      do
      begin
        select
          coalesce(count(lps.lps_id), 0)
        from
          dcl_shipping shp,
          dcl_shp_list_produce lps,
          dcl_prc_list_produce lpc,
          dcl_produce_cost prc
        where
          shp.spc_id = :spc_id and
          lps.shp_id = :shp_id and
          lpc.lpc_id = lps.lpc_id and
          prc.prc_id = lpc.prc_id and
          prc.prc_block is null
        into :unblocked_prc_count;

        if ( unblocked_prc_count != 0 ) then
        begin
          have_unblocked_prc = 1;
          break;
        end
      end
    end

    if ( get_spec = 1 ) then
    begin
      select dNVL(cast(sum(lps.lps_summ) as double precision), 0)
      from dcl_pay_list_summ lps,
           dcl_payment pay
      where lps.spc_id = :spc_id and
            pay.pay_id = lps.pay_id and
            lps.lps_summ != 0 and
            pay.pay_block = 1 and
            not exists ( select distinct lps_id from dcl_ctc_pay where lps_id = lps.lps_id )
      into :pay_sum;

      select dNVL(cast(sum(lps.lps_summ_plus_nds) as double precision), 0)
      from dcl_shp_list_produce lps,
           dcl_shipping shp
      where shp.spc_id = :spc_id and
            lps.shp_id = shp.shp_id and
            lps.lps_summ_plus_nds != 0 and
            shp.shp_block = 1 and
            not exists ( select distinct shp_id from dcl_ctc_shp where shp_id = shp.shp_id )
      into :shp_sum;

      if ( spc_summ = pay_sum and spc_summ = shp_sum and spc_summ > 0 ) then
      begin
        suspend;
      end
      else
      begin
        if ( spc_group_delivery is not null and ( spc_summ >= pay_sum or spc_summ >= shp_sum ) and pay_sum != 0 and shp_sum != 0 ) then
        begin
          suspend;
        end
      end
    end
  end
end ^

ALTER PROCEDURE DCL_UNIT_INSERT (IS_ACCEPTABLE_FOR_CPR CHAR(1) CHARACTER SET UNICODE_FSS)
RETURNS (UNT_ID INTEGER)
AS 
begin

  insert into dcl_unit (
    unt_id, is_acceptable_for_cpr
  )
  values (
    null, :is_acceptable_for_cpr
  )
  returning unt_id into :unt_id;

  suspend;

end ^

ALTER PROCEDURE DCL_UNIT_PACK (UNT_NAME_FROM VARCHAR(150) CHARACTER SET UNICODE_FSS,
UNT_NAME_TO VARCHAR(150) CHARACTER SET UNICODE_FSS)
AS 
DECLARE VARIABLE UNT_ID_FROM INTEGER;
DECLARE VARIABLE UNT_ID_TO INTEGER;
begin
  unt_id_from = null;
  select unt_id from dcl_unit_language unt where unt_name = :unt_name_from and unt.lng_id = 1 into :unt_id_from;
  unt_id_to = null;
  select unt_id from dcl_unit_language unt where unt_name = :unt_name_to and unt.lng_id = 1 into :unt_id_to;

  if ( unt_id_from is not null and unt_id_to is not null ) then
  begin
    update dcl_produce prd set prd.unt_id = :unt_id_to where prd.unt_id = :unt_id_from;
    delete from dcl_unit where unt_id = :unt_id_from;
  end
end ^

ALTER PROCEDURE DCL_UPDATE_DELIVERY_DATE (SPC_ID INTEGER)
AS 
declare variable SPC_SUMM decimal(15,2);
declare variable SPC_PERCENT_OR_SUM smallint;
declare variable SPC_DELIVERY_PERCENT decimal(15,2);
declare variable SPC_DELIVERY_SUM decimal(15,2);
declare variable SPC_DELIVERY_DATE date;
declare variable SPC_ADDITIONAL_DAYS_COUNT integer;
declare variable PAYED_DATE date;
begin
  select spc_summ,
         spc_percent_or_sum,
         spc_delivery_percent,
         spc_delivery_sum,
         spc_delivery_date,
         spc_additional_days_count
  from dcl_con_list_spec spc
  where spc.spc_id = :spc_id
  into   :spc_summ,
         :spc_percent_or_sum,
         :spc_delivery_percent,
         :spc_delivery_sum,
         :spc_delivery_date,
         :spc_additional_days_count;

  if ( spc_additional_days_count is not null ) then
  begin
    select
        payed_date
      from
        dcl_get_payed_date(
          :spc_id,
          :spc_summ,
          :spc_percent_or_sum,
          :spc_delivery_percent,
          :spc_delivery_sum
        )
    into :payed_date;

    if (payed_date is not null and spc_delivery_date is null) then
    begin
      spc_delivery_date = addday(:payed_date, :spc_additional_days_count);
      update dcl_con_list_spec set spc_delivery_date = :spc_delivery_date where spc_id = :spc_id;
    end

    if (payed_date is null and spc_delivery_date is not null) then
    begin
      update dcl_con_list_spec set spc_delivery_date = null where spc_id = :spc_id;
    end
  end
end ^

ALTER PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_CTR (OLD_CTR_ID INTEGER,
NEW_CTR_ID INTEGER)
AS 
declare variable acc_index smallint;
declare variable acc_id integer;
declare variable usr_id integer;
declare variable usr_count integer;
begin
  select max(acc_index) from dcl_account where ctr_id = :new_ctr_id into :acc_index;
  acc_index = acc_index + 1;
  for
    select acc_id
    from dcl_account
    where ctr_id = :old_ctr_id
    into :acc_id
  do
  begin
    insert into dcl_account(
        ctr_id,
        acc_name,
        acc_account,
        cur_id,
        acc_index
    )
    select :new_ctr_id,
           '',
           acc_account,
           cur_id,
           :acc_index
    from dcl_account where acc_id = :acc_id;
    
    acc_index = acc_index + 1;
  end
  delete from dcl_account where ctr_id = :old_ctr_id;

  for
    select usr_id
    from dcl_contractor_user
    where ctr_id = :old_ctr_id
    into :usr_id
  do
  begin
    select count(ctr_id) from dcl_contractor_user where ctr_id = :new_ctr_id and usr_id = :usr_id into :usr_count;
    if ( usr_count = 0 ) then --not exist for this user and contractor
    begin
      insert into dcl_contractor_user (
          ctr_id,
          usr_id
      )
      values (
          :new_ctr_id,
          :usr_id
      );
    end
  end
  delete from dcl_contractor_user where ctr_id = :old_ctr_id;

  update dcl_contact_person set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;

  update dcl_commercial_proposal set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_cond_for_contract set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_contract set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_contractor_request set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_contractor_request set ctr_id_other = :new_ctr_id where ctr_id_other = :old_ctr_id;
  update dcl_dlr_list_produce set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_order set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_order set ctr_id_for = :new_ctr_id where ctr_id_for = :old_ctr_id;
  update dcl_ord_list_produce set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_outgoing_letter set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_payment set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_prc_ctr_for_calcstate set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_shipping set ctr_id = :new_ctr_id where ctr_id = :old_ctr_id;
  update dcl_shipping set ctr_id_where = :new_ctr_id where ctr_id_where = :old_ctr_id;

  delete from dcl_contractor where ctr_id = :old_ctr_id;
end ^

ALTER PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_CUT (OLD_CUT_ID INTEGER,
NEW_CUT_ID INTEGER)
AS 
begin
  update dcl_contractor set cut_id = :new_cut_id where cut_id = :old_cut_id;

  delete from dcl_country where cut_id = :old_cut_id;
end ^

ALTER PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_PRD (OLD_PRD_ID INTEGER,
NEW_PRD_ID INTEGER)
AS 
declare variable ctn_id integer;
declare variable stf_id integer;
declare variable test_count integer;
begin
  update dcl_asm_list_produce set prd_id = :new_prd_id where prd_id = :old_prd_id;
  update dcl_assemble set prd_id = :new_prd_id where prd_id = :old_prd_id;
  update dcl_cfc_list_produce set prd_id = :new_prd_id where prd_id = :old_prd_id;
  update dcl_contractor_request set prd_id = :new_prd_id where prd_id = :old_prd_id;
  update dcl_cpr_list_produce set prd_id = :new_prd_id where prd_id = :old_prd_id;
  update dcl_dlr_list_produce set prd_id = :new_prd_id where prd_id = :old_prd_id;
  update dcl_ord_list_produce set prd_id = :new_prd_id where prd_id = :old_prd_id;
  update dcl_prc_list_produce set prd_id = :new_prd_id where prd_id = :old_prd_id;
  update dcl_spi_list_produce set prd_id = :new_prd_id where prd_id = :old_prd_id;
  for
    select ctn_id,
           stf_id
    from dcl_catalog_number
    where prd_id = :old_prd_id
    into   :ctn_id,
           :stf_id
  do
  begin
    select count(ctn_id) from dcl_catalog_number where prd_id = :new_prd_id and stf_id = :stf_id into :test_count;
    if ( test_count = 0 ) then
    begin
      update dcl_catalog_number set prd_id = :new_prd_id where ctn_id = :ctn_id;
    end
  end
  update dcl_attachment att set att.att_parent_id = :new_prd_id where att.att_parent_id = :old_prd_id and att.att_parent_table = 'DCL_PRODUCE';
  insert into DCL_CUS_CODE_HISTORY(cus_code, prd_id,date_created) select CUS_CODE, :new_prd_id, date_created from DCL_CUS_CODE_HISTORY where prd_id=:old_prd_id;
  delete from dcl_cus_code_history where prd_id = :old_prd_id;
  delete from dcl_produce where prd_id = :old_prd_id;
end ^

ALTER PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_STF (OLD_STF_ID INTEGER,
NEW_STF_ID INTEGER)
AS 
begin
  update dcl_assemble set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_catalog_number set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_cfc_list_produce set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_contractor_request set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_cpr_list_produce set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_cpr_transport set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_dlr_list_produce set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_montage_adjustment set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_order set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_prc_list_produce set stf_id = :new_stf_id where stf_id = :old_stf_id;
  update dcl_shp_list_produce set stf_id = :new_stf_id where stf_id = :old_stf_id;

  delete from dcl_stuff_category where stf_id = :old_stf_id;
end ^

ALTER PROCEDURE DCL_UPDATE_USER_BLOCK (USR_ID INTEGER,
USR_BLOCK SMALLINT)
AS 
begin
  update dcl_user set usr_block = :usr_block where usr_id = :usr_id;
  if ( usr_block is not null ) then
  begin
    delete from dcl_user_role where usr_id = :usr_id;
  end
end ^

ALTER PROCEDURE DCL_USER_ACTIONS (USR_ID INTEGER)
RETURNS (ACT_ID INTEGER,
ACT_SYSTEM_NAME VARCHAR(100) CHARACTER SET UNICODE_FSS)
AS 
begin
  for
    select act.act_id,
           act.act_system_name
    from dcl_user_role ur,
         dcl_action_role ar,
         dcl_action act
    where ur.usr_id = :usr_id and
          ar.rol_id = ur.rol_id and
          act.act_id = ar.act_id and
          act.act_check_access is not null
    into :act_id,
         :act_system_name
  do
  begin
    suspend;
  end
end ^

ALTER PROCEDURE DCL_USER_FILTER (USR_NAME_IN VARCHAR(50) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
RESPONS_PERSON SMALLINT)
RETURNS (USR_ID INTEGER,
USR_NAME VARCHAR(50) CHARACTER SET UNICODE_FSS)
AS 
declare variable usr_name_filter varchar(50);
begin
  usr_name_in = upper(usr_name_in);

  for
    select
      upper(usr_lng.usr_surname || ' ' || usr_lng.usr_name) as user_sort,
      usr.usr_id,
      usr_surname || ' ' || usr_name as "usr_name"
    from dcl_user_language usr_lng,
         dcl_user usr
    where lng_id = 1 and
          usr.usr_id = usr_lng.usr_id and
          ( :dep_id is null or usr.dep_id = :dep_id  ) and
          ( :respons_person is null or :respons_person = 0 or usr.usr_respons_person = :respons_person ) and
          ( :usr_name_in is null or :usr_name_in like '' or  ( (upper(usr_lng.usr_surname || ' ' || usr_lng.usr_name) ) like ('%' || :usr_name_in || '%') ) )
    order by user_sort
  into
    :usr_name_filter,
    :usr_id,
    :usr_name
  do
  begin
    suspend;
  end

end ^

ALTER PROCEDURE DCL_USER_FILTER_FULL (DEP_NAME_IN VARCHAR(100) CHARACTER SET UNICODE_FSS)
RETURNS (USR_ID INTEGER,
USR_NAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
USR_SURNAME VARCHAR(20) CHARACTER SET UNICODE_FSS,
USR_POSITION VARCHAR(60) CHARACTER SET UNICODE_FSS,
USR_CODE VARCHAR(3) CHARACTER SET UNICODE_FSS,
USR_LOGIN VARCHAR(8) CHARACTER SET UNICODE_FSS,
USR_DEPARTMENT VARCHAR(100) CHARACTER SET UNICODE_FSS,
USR_PHONE VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_BLOCK SMALLINT,
USR_RESPONS_PERSON SMALLINT,
USR_NO_LOGIN SMALLINT,
USR_CHIEF_DEP SMALLINT,
USR_FAX VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_EMAIL VARCHAR(100) CHARACTER SET UNICODE_FSS,
ROLES VARCHAR(300) CHARACTER SET UNICODE_FSS)
AS 
declare variable USR_BLOCK_SORT smallint;
declare variable ROL_NAME varchar(32);
begin
  dep_name_in = upper(dep_name_in);

  for
    select
      coalesce(usr_block, 0),
      usr_id,
      (select usr_name from dcl_user_language where usr_id = usr.usr_id and lng_id = 1),
      (select usr_surname from dcl_user_language where usr_id = usr.usr_id and lng_id = 1),
      (select usr_position from dcl_user_language where usr_id = usr.usr_id and lng_id = 1),
      usr_code,
      usr_login,
      (select dep_name from dcl_department d where dep_id = usr.dep_id),
      usr_phone,
      usr_block,
      usr_respons_person,
      usr_no_login,
      usr_chief_dep,
      usr_fax,
      usr_email
    from dcl_user usr
    where ( :dep_name_in is null or :dep_name_in like '' or (select upper(dep.dep_name) from dcl_department dep where dep_id=(select dep_id from dcl_user where usr_id = usr.usr_id)) like('%' || :dep_name_in || '%') )
    order by 1, 4
    into
      :usr_block_sort,
      :usr_id,
      :usr_name,
      :usr_surname,
      :usr_position,
      :usr_code,
      :usr_login,
      :usr_department,
      :usr_phone,
      :usr_block,
      :usr_respons_person,
      :usr_no_login,
      :usr_chief_dep,
      :usr_fax,
      :usr_email
  do
  begin
    roles = '';

    for
      select
        rol.rol_name
      from
        dcl_role rol,
        dcl_user_role usr_rol
      where
        usr_rol.usr_id = :usr_id and
        rol.rol_id = usr_rol.rol_id
      into :rol_name
    do
    begin
      roles = roles || :rol_name || '<br>';
    end

    suspend;
  end

end ^

ALTER PROCEDURE DCL_USER_INSERT (USR_CODE VARCHAR(3) CHARACTER SET UNICODE_FSS,
USR_LOGIN VARCHAR(8) CHARACTER SET UNICODE_FSS,
USR_PASSWD VARCHAR(64) CHARACTER SET UNICODE_FSS,
DEP_ID INTEGER,
USR_PHONE VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_BLOCK SMALLINT,
USR_RESPONS_PERSON SMALLINT,
USR_NO_LOGIN SMALLINT,
USR_CHIEF_DEP SMALLINT,
USR_FAX VARCHAR(50) CHARACTER SET UNICODE_FSS,
USR_EMAIL VARCHAR(100) CHARACTER SET UNICODE_FSS,
USR_LOCAL_ENTRY SMALLINT,
USR_INTERNET_ENTRY SMALLINT)
RETURNS (USR_ID INTEGER)
AS 
begin
  insert into dcl_user (
    usr_code,
    usr_login,
    usr_passwd,
    usr_phone,
    dep_id,
    usr_block,
    usr_respons_person,
    usr_no_login,
    usr_chief_dep,
    usr_fax,
    usr_email,
    usr_local_entry,
    usr_internet_entry
  )
  values (
    :usr_code,
    :usr_login,
    :usr_passwd,
    :usr_phone,
    :dep_id,
    :usr_block,
    :usr_respons_person,
    :usr_no_login,
    :usr_chief_dep,
    :usr_fax,
    :usr_email,
    :usr_local_entry,
    :usr_internet_entry
  )
  returning usr_id into :usr_id;

  suspend;
end ^

ALTER PROCEDURE DCL_YEARWEEK (D DATE)
RETURNS (WEEK_NO VARCHAR(8) CHARACTER SET UNICODE_FSS,
WEEK_NO_ONLY SMALLINT,
YEAR_NO_ONLY SMALLINT)
AS 
DECLARE VARIABLE W INTEGER; /* week number */
DECLARE VARIABLE Y INTEGER; /* year the week belongs to */
DECLARE VARIABLE LI_DAY_NUM INTEGER;
DECLARE VARIABLE LI_DAY_OF_WEEK INTEGER;
DECLARE VARIABLE LI_LAST_DAY_OF_YEAR INTEGER;
BEGIN
  Y = EXTRACT(YEAR FROM D);

  LI_DAY_NUM = EXTRACT(YEARDAY FROM D) + 1;
  LI_DAY_OF_WEEK = EXTRACT(WEEKDAY FROM D-1) + 1;
  W = (LI_DAY_NUM + 6 + (7 - LI_DAY_OF_WEEK)) / 7;

  LI_LAST_DAY_OF_YEAR = EXTRACT(WEEKDAY FROM (D - EXTRACT(DAY FROM D) + 31));
  IF (W=53 AND 4>LI_LAST_DAY_OF_YEAR) THEN BEGIN
    Y = Y + 1;
    W = 1;
  END

  -- If the data like 02.01.2010 actually it is week 53 of the year 2009
  IF ((W = 1) AND (EXTRACT(WEEKDAY FROM (D - EXTRACT(DAY FROM D))) > 3)) THEN BEGIN
    D = D - EXTRACT(DAY FROM D);
    LI_DAY_NUM = EXTRACT(YEARDAY FROM D) + 1;
    LI_DAY_OF_WEEK = EXTRACT(WEEKDAY FROM D-1) + 1;
    W = (LI_DAY_NUM + 6 + (7 - LI_DAY_OF_WEEK)) / 7;
    Y = EXTRACT(YEAR FROM D);
  END

  /* This is just formatting; you may prefer to make W and Y return parameters instead. */
  IF (W<10) THEN
    WEEK_NO = '0';
  ELSE
    WEEK_NO = '';
  WEEK_NO = Y || '/' || WEEK_NO || W;
  WEEK_NO_ONLY = W;
  YEAR_NO_ONLY = Y;

  SUSPEND;
END ^

ALTER PROCEDURE GET_CONTEXT RETURNS (USR_ID INTEGER)
AS 
begin
  select rdb$get_context('USER_SESSION', 'user_id') from rdb$database into usr_id;
  suspend;
end ^

ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_APR_ID (APR_ID INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
declare variable opr_id integer;
begin
  ctr_id = null;
  ctr_name = null;
  spc_id = null;
  spc_number = null;
  spc_date = null;
  con_id = null;
  con_number = null;
  con_date = null;

  if ( apr_id is not null ) then
  begin
    select asm.opr_id
    from dcl_assemble asm,
         dcl_asm_list_produce apr
    where asm.asm_id = apr.asm_id and
          apr.apr_id = :apr_id
    into :opr_id;

    select ctr_id,
           ctr_name,
           spc_id,
           spc_number,
           spc_date,
           con_id,
           con_number,
           con_date
    from get_contractor_for_for_opr_id(:opr_id)
    into :ctr_id,
         :ctr_name,
         :spc_id,
         :spc_number,
         :spc_date,
         :con_id,
         :con_number,
         :con_date;
  end

  suspend;
end ^

ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_DRP_ID (DRP_ID INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
declare variable OPR_ID integer;
declare variable APR_ID integer;
begin
  ctr_id = null;
  ctr_name = null;
  spc_id = null;
  spc_number = null;
  spc_date = null;
  con_id = null;
  con_number = null;
  con_date = null;

  /*
  select opr_id, apr_id from dcl_dlr_list_produce where drp_id = :drp_id into :opr_id, :apr_id;

  if ( opr_id is not null ) then
  begin
    select spc_id,
           spc_number,
           spc_date,
           con_id,
           con_number,
           con_date
    from get_contractor_for_for_opr_id(:opr_id)
    into :spc_id,
         :spc_number,
         :spc_date,
         :con_id,
         :con_number,
         :con_date;
  end

  if ( apr_id is not null ) then
  begin
    select spc_id,
           spc_number,
           spc_date,
           con_id,
           con_number,
           con_date
    from get_contractor_for_for_apr_id(:apr_id)
    into :spc_id,
         :spc_number,
         :spc_date,
         :con_id,
         :con_number,
         :con_date;
  end
  */

  --last call take :ctr_name field from dcl_dlr_list_produce table
  if ( drp_id is not null ) then
  begin
    select ctr.ctr_id, 
           ctr.ctr_name,
           drp.spc_id
    from dcl_contractor ctr,
         dcl_dlr_list_produce drp
    where ctr.ctr_id = drp.ctr_id and
          drp.drp_id = :drp_id
    into  :ctr_id, 
          :ctr_name,
          :spc_id;

    if (spc_id is not null) then
    begin
      select spc.spc_id,
             spc.spc_number,
             spc.spc_date,
             con.con_id,
             con.con_number,
             con.con_date
      from dcl_con_list_spec spc,
           dcl_contract con
      where spc.spc_id = :spc_id and
            con.con_id = spc.con_id
      into :spc_id,
           :spc_number,
           :spc_date,
           :con_id,
           :con_number,
           :con_date;
    end
  end

  suspend;
end ^

ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_LPC_ID (LPC_ID_IN INTEGER)
RETURNS (LPC_ID INTEGER,
CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
declare variable opr_id integer;
declare variable drp_id integer;
declare variable sip_id integer;
declare variable apr_id integer;
begin
  ctr_id = null;
  ctr_name = null;
  spc_id = null;
  spc_number = null;
  spc_date = null;
  con_id = null;
  con_number = null;
  con_date = null;
  lpc_id = :lpc_id_in;

  select opr_id, drp_id, sip_id, apr_id from dcl_prc_list_produce where lpc_id = :lpc_id_in into :opr_id, :drp_id, :sip_id, :apr_id;

  if ( opr_id is not null ) then
  begin
    select ctr_id, 
           ctr_name,
           spc_id,
           spc_number,
           spc_date,
           con_id,
           con_number,
           con_date
    from get_contractor_for_for_opr_id(:opr_id)
    into :ctr_id,
         :ctr_name,
         :spc_id,
         :spc_number,
         :spc_date,
         :con_id,
         :con_number,
         :con_date;
  end

  if ( drp_id is not null ) then
  begin
    select ctr_id,
           ctr_name,
           spc_id, 
           spc_number,
           spc_date,
           con_id,
           con_number,
           con_date
    from get_contractor_for_for_drp_id(:drp_id)
    into :ctr_id,
         :ctr_name,
         :spc_id,
         :spc_number,
         :spc_date,
         :con_id, 
         :con_number,
         :con_date;
  end

  if ( sip_id is not null ) then
  begin
    select ctr_id,
           ctr_name,
           spc_id, 
           spc_number,
           spc_date,
           con_id,
           con_number,
           con_date
    from get_contractor_for_for_sip_id(:sip_id)
    into :ctr_id,
         :ctr_name,
         :spc_id,
         :spc_number,
         :spc_date,
         :con_id, 
         :con_number,
         :con_date;
  end

  if ( apr_id is not null ) then
  begin
    select ctr_id,
           ctr_name,
           spc_id, 
           spc_number,
           spc_date,
           con_id,
           con_number,
           con_date
    from get_contractor_for_for_apr_id(:apr_id)
    into :ctr_id,
         :ctr_name,
         :spc_id,
         :spc_number,
         :spc_date,
         :con_id, 
         :con_number,
         :con_date;
  end

  suspend;
end ^

ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_OPR_ID (OPR_ID INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
SPC_DELIVERY_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE,
CUR_NAME VARCHAR(10) CHARACTER SET UNICODE_FSS)
AS 
declare variable ORD_ID integer;
declare variable ORD_IN_ONE_SPEC smallint;
begin
  ctr_id = null;
  ctr_name = null;
  spc_id = null;
  spc_number = null;
  spc_date = null;
  spc_delivery_date = null;
  con_id = null;
  con_number = null;
  con_date = null;
  cur_name = null;

  if ( opr_id is not null ) then
  begin
    select
      ord.ord_id,
      ord.ord_in_one_spec
    from dcl_order ord,
         dcl_ord_list_produce opr
    where opr.opr_id = :opr_id and
          ord.ord_id = opr.ord_id
    into
      :ord_id,
      :ord_in_one_spec;

    if ( ord_in_one_spec is not null ) then
    begin
      select
        ord.ctr_id_for,
        ctr.ctr_name
      from
        dcl_contractor ctr,
        dcl_order ord
      where ctr.ctr_id = ord.ctr_id_for and
            ord.ord_id = :ord_id
      into
        :ctr_id,
        :ctr_name;

      select spc.spc_id,
             spc.spc_number,
             spc.spc_date,
             spc.spc_delivery_date,
             con.con_id,
             con.con_number,
             con.con_date,
             cur.cur_name
      from dcl_contract con,
           dcl_con_list_spec spc,
           dcl_order ord,
           dcl_ord_list_produce opr,
           dcl_currency cur
      where con.con_id = spc.con_id and
            spc.spc_id = ord.spc_id and
            ord.ord_id = opr.ord_id and
            opr.opr_id = :opr_id and
            cur.cur_id = con.cur_id
      into :spc_id,
           :spc_number,
           :spc_date,
           :spc_delivery_date,
           :con_id,
           :con_number,
           :con_date,
           :cur_name
        ;
    end
    else
    begin
      select
        opr.ctr_id,
        ctr.ctr_name
      from
        dcl_contractor ctr,
        dcl_ord_list_produce opr
      where ctr.ctr_id = opr.ctr_id and
            opr.opr_id = :opr_id
      into
        :ctr_id,
        :ctr_name;

      select spc.spc_id,
             spc.spc_number,
             spc.spc_date,
             spc.spc_delivery_date,
             con.con_id,
             con.con_number,
             con.con_date,
             cur.cur_name
      from dcl_contract con,
           dcl_con_list_spec spc,
           dcl_ord_list_produce opr,
           dcl_currency cur
      where con.con_id = spc.con_id and
            spc.spc_id = opr.spc_id and
            opr.opr_id = :opr_id and
            cur.cur_id = con.cur_id
      into :spc_id,
           :spc_number,
           :spc_date,
           :spc_delivery_date,
           :con_id,
           :con_number,
           :con_date,
           :cur_name
        ;
    end
  end

  suspend;
end ^

ALTER PROCEDURE GET_CONTRACTOR_FOR_FOR_SIP_ID (SIP_ID INTEGER)
RETURNS (CTR_ID INTEGER,
CTR_NAME VARCHAR(200) CHARACTER SET UNICODE_FSS,
SPC_ID INTEGER,
SPC_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
SPC_DATE DATE,
CON_ID INTEGER,
CON_NUMBER VARCHAR(50) CHARACTER SET UNICODE_FSS,
CON_DATE DATE)
AS 
declare variable opr_id integer;
declare variable drp_id integer;
begin
  ctr_id = null;
  ctr_name = null;
  spc_id = null;
  spc_number = null;
  spc_date = null;
  con_id = null;
  con_number = null;
  con_date = null;

  select opr_id, drp_id from dcl_spi_list_produce where sip_id = :sip_id into :opr_id, :drp_id;

  if ( opr_id is not null ) then
  begin
    select ctr_id,
           ctr_name,
           spc_id,
           spc_number,
           spc_date,
           con_id,
           con_number,
           con_date
    from get_contractor_for_for_opr_id(:opr_id)
    into :ctr_id,
         :ctr_name,
         :spc_id,
         :spc_number,
         :spc_date,
         :con_id,
         :con_number,
         :con_date;
  end

  if ( drp_id is not null ) then
  begin
    select ctr_id,
           ctr_name,
           spc_id,
           spc_number,
           spc_date,
           con_id,
           con_number,
           con_date
    from get_contractor_for_for_drp_id(:drp_id)
    into :ctr_id,
         :ctr_name,
         :spc_id,
         :spc_number,
         :spc_date,
         :con_id,
         :con_number,
         :con_date;
  end

  suspend;
end ^

ALTER PROCEDURE GET_PRC_DATES_ON_STORAGE (CTR_ID INTEGER,
CON_ID INTEGER,
SPC_ID INTEGER)
RETURNS (DATES_FOR_PRODUCE_ON_STORAGE VARCHAR(200) CHARACTER SET UNICODE_FSS)
AS 
declare variable prc_date date;
declare variable str_date varchar(20);
begin
  dates_for_produce_on_storage = '';
  for
    select distinct prc.prc_date
    from dcl_prc_list_produce lpc,
         dcl_prc_ctr_for_calcstate prc_ctr,
         dcl_produce_cost prc
    where prc_ctr.lpc_id = lpc.lpc_id and
          prc.prc_id = prc_ctr.prc_id and
          prc_ctr.ctr_id = :ctr_id and
          ( prc_ctr.con_id = :con_id or ( :con_id is null and prc_ctr.con_id is null ) ) and
          ( prc_ctr.spc_id = :spc_id or ( :spc_id is null and prc_ctr.spc_id is null ) ) and
          lpc.lpc_count > (
                            select  coalesce (sum(lps.lps_count), 0)
                            from dcl_shp_list_produce lps
                            where lps.lpc_id = lpc.lpc_id
                          )
    order by prc.prc_date
    into :prc_date
  do
  begin
    str_date = '';
    select strdate from date2str(:prc_date) into :str_date;
    dates_for_produce_on_storage = :dates_for_produce_on_storage || :str_date || '<br>';
  end

  suspend;
end ^

ALTER PROCEDURE MAINTENANCE_SELECTIVITY AS 
declare variable s varchar(200);
BEGIN 
  FOR select RDB$INDEX_NAME FROM RDB$INDICES INTO :S DO
  BEGIN
    S = 'SET statistics INDEX ' || s || ';';
    EXECUTE STATEMENT :s;
  END

  SUSPEND;
END ^

ALTER PROCEDURE MIGRATE_TO_CUSTOM_CODE_HISTORY AS 
declare prc_date date;
declare spi_date date;
declare cpr_date date;
declare prd_id integer;
declare cus_code varchar(10);
declare min_date date;
declare curr_date date;
begin
select cast('Now' as date) from rdb$database into :curr_date;
for select prd_id, cus_code from DCL_PRODUCE into :prd_id, :cus_code do
begin

    if(cus_code is not null) then begin
                                    select min(pc.prc_date) from DCL_PRODUCE_COST pc join DCL_PRC_LIST_PRODUCE lpc on lpc.PRC_ID=pc.PRC_ID
                                                                                     where lpc.prd_id=:prd_id into :prc_date;
                                    select min(cp.CPR_DATE) from DCL_COMMERCIAL_PROPOSAL cp join DCL_CPR_LIST_PRODUCE lcp on lcp.CPR_ID=cp.CPR_ID
                                                                                            where lcp.PRD_ID=:prd_id and lcp.cus_id is null into :cpr_date;
                                    select min(sp.SPI_DATE) from DCL_SPECIFICATION_IMPORT sp join DCL_SPI_LIST_PRODUCE lsp on lsp.SPI_ID=sp.SPI_ID
                                                                                             where lsp.PRD_ID=:prd_id into :spi_date;

                                    if(prc_date is  null) then prc_date = cast('01.01.2100' as date);
                                    if(cpr_date is  null) then cpr_date = cast('01.01.2100' as date);
                                    if(spi_date is  null) then spi_date =  cast('01.01.2100' as date);


                                    min_date = minvalue(:prc_date, :spi_date, :cpr_date);
                                    if(min_date is not null) then insert into DCL_CUS_CODE_HISTORY(prd_id, cus_code, date_created) values(:prd_id, :cus_code, :min_date);
                                                             else insert into DCL_CUS_CODE_HISTORY(prd_id, cus_code, date_created) values(:prd_id, :cus_code, :curr_date);
                                  end
end
end ^

ALTER PROCEDURE SET_CONTEXT (USER_ID INTEGER)
AS 
begin
  RDB$SET_CONTEXT('USER_SESSION', 'user_id', user_id);
end ^

ALTER PROCEDURE YEARWEEK (D DATE)
RETURNS (WEEK_NO VARCHAR(8) CHARACTER SET UNICODE_FSS)
AS 
declare variable w integer;
BEGIN
  D = D - EXTRACT(WEEKDAY FROM D-1) + 3;  /* move to thursday */

  W = (EXTRACT(YEARDAY FROM D) - EXTRACT(WEEKDAY FROM D-1) + 7) / 7e0;
  WEEK_NO = W;

  SUSPEND;
END ^

SET TERM ; ^
COMMIT WORK;
SET AUTODDL ON;
SET TERM ^ ;

/* Triggers only will work for SQL triggers */
CREATE TRIGGER DCL_1C_NUMBER_HISTORY_TRIGGER FOR DCL_1C_NUMBER_HISTORY 
ACTIVE BEFORE INSERT POSITION 1 
AS
BEGIN
    if (new.id is null ) then
    begin
    new.id = gen_id (DCL_1C_NUMBER_HISTORY_GENERATOR, 1);
    end
END ^

CREATE TRIGGER DCL_ACCOUNT_BI0 FOR DCL_ACCOUNT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
DECLARE VARIABLE CTR_ID INTEGER;
DECLARE VARIABLE DOUBLE_ACCOUNT INTEGER;
begin
  IF (NEW.acc_ID IS NULL) THEN
    NEW.acc_ID = GEN_ID(GEN_DCL_ACCOUNT_ID, 1);
  ELSE
  BEGIN
    ID = GEN_ID(GEN_DCL_ACCOUNT_ID, 1);
    IF ( ID < NEW.acc_ID ) THEN
    BEGIN
      ID = GEN_ID(GEN_DCL_ACCOUNT_ID, NEW.acc_ID - ID);
    END
  END

  if ( new.acc_account is not null ) then
  begin
    select count(acc_id)
    from dcl_account acc
    where acc.acc_account = new.acc_account and
          acc.ctr_id != new.ctr_id
    into :double_account;

    if ( double_account > 0 ) then
    begin
      for
        select ctr_id
        from dcl_contractor ctr,
             dcl_account acc
        where acc.ctr_id = ctr.ctr_id and
              acc.acc_account = new.acc_account and
              ctr.ctr_double_account is null
        into :ctr_id
      do
      begin
        update dcl_contractor set ctr_double_account = 1 where ctr_id = :ctr_id;
      end
    end
  end
end ^

CREATE TRIGGER DCL_ACCOUNT_BU0 FOR DCL_ACCOUNT 
ACTIVE BEFORE UPDATE POSITION 0 
AS
DECLARE VARIABLE CTR_ID INTEGER;
DECLARE VARIABLE DOUBLE_ACCOUNT INTEGER;
begin
  if ( old.acc_account is not null ) then
  begin
    select count(ctr_id)
    from dcl_contractor ctr
    where ctr.ctr_id != old.ctr_id and
          ctr.ctr_double_account is not null
    into :double_account;

    if ( double_account = 1 ) then
    begin
      select ctr_id
      from dcl_contractor ctr
      where ctr.ctr_id != old.ctr_id and
            ctr.ctr_double_account is not null
      into :ctr_id;

      update dcl_contractor set ctr_double_account = null where ctr_id = :ctr_id;
    end
  end

  if ( new.acc_account is not null ) then
  begin
    select count(acc_id)
    from dcl_account acc
    where acc.acc_account = new.acc_account and
          acc.ctr_id != new.ctr_id
    into :double_account;

    if ( double_account > 0 ) then
    begin
      for
        select ctr_id
        from dcl_contractor ctr,
             dcl_account acc
        where acc.ctr_id = ctr.ctr_id and
              acc.acc_account = new.acc_account and
              ctr.ctr_double_account is null
        into :ctr_id
      do
      begin
        update dcl_contractor set ctr_double_account = 1 where ctr_id = :ctr_id;
      end
    end
  end
end ^

CREATE TRIGGER DCL_ACCOUNT_BD0 FOR DCL_ACCOUNT 
ACTIVE BEFORE DELETE POSITION 0 
AS
DECLARE VARIABLE CTR_ID INTEGER;
DECLARE VARIABLE DOUBLE_ACCOUNT INTEGER;
begin
  if ( old.acc_account is not null ) then
  begin
    select count(ctr_id)
    from dcl_contractor ctr
    where ctr.ctr_id != old.ctr_id and
          ctr.ctr_double_account is not null
    into :double_account;

    if ( double_account = 1 ) then
    begin
      select ctr_id
      from dcl_contractor ctr
      where ctr.ctr_id != old.ctr_id and
            ctr.ctr_double_account is not null
      into :ctr_id;

      update dcl_contractor set ctr_double_account = null where ctr_id = :ctr_id;
    end
  end
end ^

CREATE TRIGGER DCL_ACTION_BI0 FOR DCL_ACTION 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.ACT_ID IS NULL) THEN
    NEW.ACT_ID = GEN_ID(GEN_DCL_ACTION_ID, 1);
  ELSE
  BEGIN
    ID = GEN_ID(GEN_DCL_ACTION_ID, 1);
    IF ( ID < NEW.ACT_ID ) THEN
    BEGIN
      ID = GEN_ID(GEN_DCL_ACTION_ID, NEW.ACT_ID - ID);
    END
  END
end ^

CREATE TRIGGER DCL_ASM_LIST_PRODUCE_BI0 FOR DCL_ASM_LIST_PRODUCE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.APR_ID IS NULL) THEN
    NEW.APR_ID = GEN_ID(GEN_DCL_ASM_LIST_PRODUCE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_ASM_LIST_PRODUCE_ID, 1);
        IF ( ID < NEW.APR_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_ASM_LIST_PRODUCE_ID, NEW.APR_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_ASSEMBLE_BI0 FOR DCL_ASSEMBLE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.ASM_ID IS NULL) THEN
    NEW.ASM_ID = GEN_ID(gen_dcl_assemble_id, 1);
  ELSE
    BEGIN
        ID = GEN_ID(gen_dcl_assemble_id, 1);
        IF ( ID < NEW.ASM_ID ) THEN
        BEGIN
          ID = GEN_ID(gen_dcl_assemble_id, NEW.ASM_ID - ID);
        END
    END
  new.asm_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.asm_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_ASSEMBLE_BU0 FOR DCL_ASSEMBLE 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.asm_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_ATTACHMENT_BIO FOR DCL_ATTACHMENT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.ATT_ID IS NULL) THEN
    NEW.ATT_ID = GEN_ID(GEN_DCL_ATTACHMENT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_ATTACHMENT_ID, 1);
        IF ( ID < NEW.ATT_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_ATTACHMENT_ID, NEW.ATT_ID - ID);
        END
    END

  NEW.att_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id;
  if ( new.usr_id is null ) then
  begin
    select usr_id from dcl_user where usr_code = '000' into new.usr_id;
  end
end ^

CREATE TRIGGER DCL_BLANK_BI0 FOR DCL_BLANK 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.BLN_ID IS NULL) THEN
    NEW.BLN_ID = GEN_ID(GEN_DCL_BLANK_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_BLANK_ID, 1);
        IF ( ID < NEW.BLN_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_BLANK_ID, NEW.BLN_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_BLANK_IMAGE_BI0 FOR DCL_BLANK_IMAGE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.BIM_ID IS NULL) THEN
    NEW.BIM_ID = GEN_ID(GEN_DCL_BLANK_IMAGE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_BLANK_IMAGE_ID, 1);
        IF ( ID < NEW.BIM_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_BLANK_IMAGE_ID, NEW.BIM_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CATALOG_NUMBER_BIO FOR DCL_CATALOG_NUMBER 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CTN_ID IS NULL) THEN
    NEW.CTN_ID = GEN_ID(GEN_DCL_CATALOG_NUMBER_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CATALOG_NUMBER_ID, 1);
        IF ( ID < NEW.CTN_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CATALOG_NUMBER_ID, NEW.CTN_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CATALOG_NUMBER_BU0 FOR DCL_CATALOG_NUMBER 
ACTIVE AFTER UPDATE POSITION 0 
AS
begin
  update dcl_assemble set stf_id = new.stf_id where stf_id = old.stf_id and stf_id != new.stf_id and prd_id = old.prd_id;
  update dcl_cfc_list_produce set stf_id = new.stf_id where stf_id = old.stf_id and stf_id != new.stf_id and prd_id = old.prd_id;
  update dcl_cpr_list_produce set stf_id = new.stf_id where stf_id = old.stf_id and stf_id != new.stf_id and prd_id = old.prd_id;
  update dcl_dlr_list_produce set stf_id = new.stf_id where stf_id = old.stf_id and stf_id != new.stf_id and prd_id = old.prd_id;
  update dcl_prc_list_produce set stf_id = new.stf_id where stf_id = old.stf_id and stf_id != new.stf_id and prd_id = old.prd_id;
end ^

CREATE TRIGGER DCL_CATEGORY_BIO FOR DCL_CATEGORY 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CAT_ID IS NULL) THEN
    NEW.CAT_ID = GEN_ID(GEN_DCL_CATEGORY_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CATEGORY_ID, 1);
        IF ( ID < NEW.CAT_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CATEGORY_ID, NEW.CAT_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CFC_LIST_PRODUCE_BI0 FOR DCL_CFC_LIST_PRODUCE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CCP_ID IS NULL) THEN
    NEW.CCP_ID = GEN_ID(GEN_DCL_CFC_LIST_PRODUCE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CFC_LIST_PRODUCE_ID, 1);
        IF ( ID < NEW.CCP_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CFC_LIST_PRODUCE_ID, NEW.CCP_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CFC_MESSAGE_BI0 FOR DCL_CFC_MESSAGE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CCM_ID IS NULL) THEN
    NEW.CCM_ID = GEN_ID(GEN_DCL_CFC_MESSAGE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CFC_MESSAGE_ID, 1);
        IF ( ID < NEW.CCM_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CFC_MESSAGE_ID, NEW.CCM_ID - ID);
        END
    END

  new.ccm_create_date = CURRENT_TIMESTAMP;
end ^

CREATE TRIGGER DCL_COMMERCIAL_PROPOSAL_BI0 FOR DCL_COMMERCIAL_PROPOSAL 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CPR_ID IS NULL) THEN
    NEW.CPR_ID = GEN_ID(GEN_DCL_COMMERCIAL_PROPOSAL_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_COMMERCIAL_PROPOSAL_ID, 1);
        IF ( ID < NEW.CPR_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_COMMERCIAL_PROPOSAL_ID, NEW.CPR_ID - ID);
        END
    END
  new.cpr_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.cpr_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_COMMERCIAL_PROPOSAL_AI0 FOR DCL_COMMERCIAL_PROPOSAL 
ACTIVE AFTER INSERT POSITION 0 
AS
declare variable usr_count integer;
begin
  select count(usr_id) from dcl_contractor_user t where t.usr_id = new.usr_id_create and t.ctr_id = new.ctr_id into :usr_count;
  if (usr_count = 0) then
  begin
    insert into dcl_contractor_user (ctr_id, usr_id) values (new.ctr_id, new.usr_id_create);
  end
end ^

CREATE TRIGGER DCL_COMMERCIAL_PROPOSAL_BU0 FOR DCL_COMMERCIAL_PROPOSAL 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.cpr_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_COND_FOR_CONTRACT_BI0 FOR DCL_COND_FOR_CONTRACT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CFC_ID IS NULL) THEN
    NEW.CFC_ID = GEN_ID(GEN_DCL_COND_FOR_CONTRACT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_COND_FOR_CONTRACT_ID, 1);
        IF ( ID < NEW.CFC_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_COND_FOR_CONTRACT_ID, NEW.CFC_ID - ID);
        END
    END

  new.cfc_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.cfc_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
  if ( new.cfc_place is not null ) then
  begin
    new.cfc_place_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_place;
  end
  if ( new.cfc_execute is not null ) then
  begin
    new.cfc_execute_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_execute;
  end
end ^

CREATE TRIGGER DCL_COND_FOR_CONTRACT_AI0 FOR DCL_COND_FOR_CONTRACT 
ACTIVE AFTER INSERT POSITION 0 
AS
declare variable usr_count integer;
begin
  select count(usr_id) from dcl_contractor_user t where t.usr_id = new.usr_id_create and t.ctr_id = new.ctr_id into :usr_count;
  if (usr_count = 0) then
  begin
    insert into dcl_contractor_user (ctr_id, usr_id) values (new.ctr_id, new.usr_id_create);
  end
end ^

CREATE TRIGGER DCL_COND_FOR_CONTRACT_BU0 FOR DCL_COND_FOR_CONTRACT 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.cfc_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;

  if ( new.cfc_place is not null and old.cfc_place is null ) then --  
  begin
    new.cfc_place_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_place;
  end
  if ( old.cfc_place is not null and new.cfc_place is null ) then --  
  begin
    new.cfc_place_date = null;
    new.usr_id_place = null;
  end

  if ( new.cfc_execute is not null and old.cfc_execute is null ) then
  begin
    new.cfc_execute_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_execute;
  end

  if ( new.cfc_annul is not null and old.cfc_annul is null ) then --  
  begin
    new.cfc_edit_annul_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_edit_annul;
  end
  if ( new.cfc_annul is null and old.cfc_annul is not null ) then --  
  begin
    new.cfc_edit_annul_date = null;
    new.usr_id_edit_annul = null;
  end
end ^

CREATE TRIGGER DCL_COND_FOR_CONTRACT_BD0 FOR DCL_COND_FOR_CONTRACT 
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  delete from dcl_attachment att where att.att_parent_id = old.cfc_id and att.att_parent_table = 'DCL_COND_FOR_CONTRACT';
end ^

CREATE TRIGGER DCL_CONTACT_PERSON_BI0 FOR DCL_CONTACT_PERSON 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CPS_ID IS NULL) THEN
    NEW.CPS_ID = GEN_ID(GEN_DCL_CONTACT_PERSON_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CONTACT_PERSON_ID, 1);
        IF ( ID < NEW.CPS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CONTACT_PERSON_ID, NEW.CPS_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CONTRACT_BI0 FOR DCL_CONTRACT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CON_ID IS NULL) THEN
    NEW.CON_ID = GEN_ID(GEN_DCL_CONTRACT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CONTRACT_ID, 1);
        IF ( ID < NEW.CON_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CONTRACT_ID, NEW.CON_ID - ID);
        END
    END

  new.con_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.con_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_CONTRACT_BU0 FOR DCL_CONTRACT 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.con_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_CONTRACT_BD0 FOR DCL_CONTRACT 
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  delete from dcl_attachment att where att.att_parent_id = old.con_id and att.att_parent_table = 'DCL_CONTRACT';
end ^

CREATE TRIGGER DCL_CONTRACTOR_BI0 FOR DCL_CONTRACTOR 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CTR_ID IS NULL) THEN
    NEW.CTR_ID = GEN_ID(GEN_DCL_CONTRACTOR_ID, 1);
  ELSE
  BEGIN
    ID = GEN_ID(GEN_DCL_CONTRACTOR_ID, 1);
    IF ( ID < NEW.CTR_ID ) THEN
    BEGIN
      ID = GEN_ID(GEN_DCL_CONTRACTOR_ID, NEW.CTR_ID - ID);
    END
  END

  new.ctr_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.ctr_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_CONTRACTOR_BU0 FOR DCL_CONTRACTOR 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.ctr_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_CONTRACTOR_REQUEST_BI0 FOR DCL_CONTRACTOR_REQUEST 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CRQ_ID IS NULL) THEN
    NEW.CRQ_ID = GEN_ID(GEN_DCL_CONTRACTOR_REQUEST_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CONTRACTOR_REQUEST_ID, 1);
        IF ( ID < NEW.CRQ_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CONTRACTOR_REQUEST_ID, NEW.CRQ_ID - ID);
        END
    END
    NEW.crq_create_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_create;
    NEW.crq_edit_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_CONTRACTOR_REQUEST_BU0 FOR DCL_CONTRACTOR_REQUEST 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  NEW.crq_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_CONTRACTOR_REQUEST_BD0 FOR DCL_CONTRACTOR_REQUEST 
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  delete from dcl_attachment att where att.att_parent_id = old.crq_id and att.att_parent_table = 'DCL_CONTRACTOR_REQUEST';
end ^

CREATE TRIGGER DCL_CONTRACT_CLOSED_BI0 FOR DCL_CONTRACT_CLOSED 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CTC_ID IS NULL) THEN
    NEW.CTC_ID = GEN_ID(GEN_DCL_CONTRACT_CLOSED_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CONTRACT_CLOSED_ID, 1);
        IF ( ID < NEW.CTC_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CONTRACT_CLOSED_ID, NEW.CTC_ID - ID);
        END
    END
    select max(ctc_number) from DCL_CONTRACT_CLOSED into NEW.ctc_number;
    if (NEW.ctc_number is null) then
    begin
        NEW.ctc_number = 0;
    end
    new.ctc_number = NEW.ctc_number + 1;
    new.ctc_create_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_create;
    new.ctc_edit_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_CONTRACT_CLOSED_BU0 FOR DCL_CONTRACT_CLOSED 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.ctc_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_CON_LIST_SPEC_BI0 FOR DCL_CON_LIST_SPEC 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.SPC_ID IS NULL) THEN
    NEW.SPC_ID = GEN_ID(GEN_DCL_CON_LIST_SPEC_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CON_LIST_SPEC_ID, 1);
        IF ( ID < NEW.SPC_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CON_LIST_SPEC_ID, NEW.SPC_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CON_LIST_SPEC_BD0 FOR DCL_CON_LIST_SPEC 
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  delete from dcl_attachment att where att.att_parent_id = old.spc_id and att.att_parent_table = 'DCL_CON_LIST_SPEC';
end ^

CREATE TRIGGER DCL_CON_MESSAGE_BI0 FOR DCL_CON_MESSAGE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CMS_ID IS NULL) THEN
    NEW.CMS_ID = GEN_ID(GEN_DCL_CON_MESSAGE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CON_MESSAGE_ID, 1);
        IF ( ID < NEW.CMS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CON_MESSAGE_ID, NEW.CMS_ID - ID);
        END
    END

  new.cms_create_date = CURRENT_TIMESTAMP;
end ^

CREATE TRIGGER DCL_COUNTRY_BI0 FOR DCL_COUNTRY 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CUT_ID IS NULL) THEN
    NEW.CUT_ID = GEN_ID(GEN_DCL_COUNTRY_ID, 1);
  ELSE
  BEGIN
    ID = GEN_ID(GEN_DCL_COUNTRY_ID, 1);
    IF ( ID < NEW.CUT_ID ) THEN
    BEGIN
      ID = GEN_ID(GEN_DCL_COUNTRY_ID, NEW.CUT_ID - ID);
    END
  END

  new.cut_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.cut_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_COUNTRY_BU0 FOR DCL_COUNTRY 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.cut_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_CPR_LIST_PRODUCE_BI0 FOR DCL_CPR_LIST_PRODUCE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.LPR_ID IS NULL) THEN
    NEW.LPR_ID = GEN_ID(GEN_DCL_CPR_LIST_PRODUCE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CPR_LIST_PRODUCE_ID, 1);
        IF ( ID < NEW.LPR_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CPR_LIST_PRODUCE_ID, NEW.LPR_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CPR_TRANSPORT_BI0 FOR DCL_CPR_TRANSPORT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.TRN_ID IS NULL) THEN
    NEW.TRN_ID = GEN_ID(GEN_DCL_CPR_TRANSPORT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CPR_TRANSPORT_ID, 1);
        IF ( ID < NEW.TRN_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CPR_TRANSPORT_ID, NEW.TRN_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CRQ_PRINT_BI0 FOR DCL_CRQ_PRINT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CRP_ID IS NULL) THEN
    NEW.CRP_ID = GEN_ID(GEN_DCL_CRQ_PRINT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CRQ_PRINT_ID, 1);
        IF ( ID < NEW.CRP_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CRQ_PRINT_ID, NEW.CRP_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CRQ_STAGE_BI0 FOR DCL_CRQ_STAGE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CRS_ID IS NULL) THEN
    NEW.CRS_ID = GEN_ID(GEN_DCL_CRQ_STAGE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CRQ_STAGE_ID, 1);
        IF ( ID < NEW.CRS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CRQ_STAGE_ID, NEW.CRS_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CTC_LIST_BI0 FOR DCL_CTC_LIST 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.LCC_ID IS NULL) THEN
    NEW.LCC_ID = GEN_ID(GEN_DCL_CTC_LIST_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CTC_LIST_ID, 1);
        IF ( ID < NEW.LCC_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CTC_LIST_ID, NEW.LCC_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CTC_LIST_AD0 FOR DCL_CTC_LIST 
ACTIVE AFTER DELETE POSITION 0 
AS
declare variable con_id integer;
begin
  update dcl_con_list_spec spc set
    spc.spc_executed = null
  where
    spc_id = old.spc_id and
    spc.spc_executed is not null;

  select con_id from dcl_con_list_spec where spc_id = old.spc_id into :con_id;
  update dcl_contract set con_executed = null where con_id = :con_id;
end ^

CREATE TRIGGER DCL_CURRENCY_BIO FOR DCL_CURRENCY 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CUR_ID IS NULL) THEN
    NEW.CUR_ID = GEN_ID(GEN_DCL_CURRENCY_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CURRENCY_ID, 1);
        IF ( ID < NEW.CUR_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CURRENCY_ID, NEW.CUR_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_CURRENCY_RATE_BI0 FOR DCL_CURRENCY_RATE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CRT_ID IS NULL) THEN
    NEW.CRT_ID = GEN_ID(GEN_DCL_CURRENCY_RATE_ID, 1);
  ELSE
  BEGIN
    ID = GEN_ID(GEN_DCL_CURRENCY_RATE_ID, 1);
    IF ( ID < NEW.CRT_ID ) THEN
    BEGIN
      ID = GEN_ID(GEN_DCL_CURRENCY_RATE_ID, NEW.CRT_ID - ID);
    END
  END
end ^

CREATE TRIGGER DCL_CUSTOM_CODE_BI0 FOR DCL_CUSTOM_CODE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.CUS_ID IS NULL) THEN
    NEW.CUS_ID = GEN_ID(GEN_DCL_CUSTOME_CODE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_CUSTOME_CODE_ID, 1);
        IF ( ID < NEW.CUS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_CUSTOME_CODE_ID, NEW.CUS_ID - ID);
        END
    END
    NEW.cus_create_date = CURRENT_TIMESTAMP;
    NEW.cus_edit_date = CURRENT_TIMESTAMP;
end ^

CREATE TRIGGER DCL_CUSTOM_CODE_BU0 FOR DCL_CUSTOM_CODE 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  NEW.cus_edit_date = CURRENT_TIMESTAMP;
end ^

CREATE TRIGGER DCL_CUSTOM_CODE_AU0 FOR DCL_CUSTOM_CODE 
ACTIVE AFTER UPDATE POSITION 0 
AS
begin
  if (new.cus_code != old.cus_code) then
  begin
    update dcl_produce prd set prd.cus_code = new.cus_code where prd.cus_code = old.cus_code;
  end
end ^

CREATE TRIGGER DCL_CUS_CODE_HISTORY_TRIGGER FOR DCL_CUS_CODE_HISTORY 
ACTIVE BEFORE INSERT POSITION 1 
AS
BEGIN
    if (new.id is null ) then
    begin
    new.id = gen_id (DCL_CUS_CODE_HISTORY_GENERATOR, 1);
    end
END ^

CREATE TRIGGER DCL_DELIVERY_REQUEST_BI0 FOR DCL_DELIVERY_REQUEST 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.DLR_ID IS NULL) THEN
    NEW.DLR_ID = GEN_ID(GEN_DCL_DELIVERY_REQUEST_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_DELIVERY_REQUEST_ID, 1);
        IF ( ID < NEW.DLR_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_DELIVERY_REQUEST_ID, NEW.DLR_ID - ID);
        END
    END

  new.dlr_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.dlr_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
  if ( new.dlr_place_request is not null ) then
  begin
    new.dlr_place_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_place;
  end
end ^

CREATE TRIGGER DCL_DELIVERY_REQUEST_BU0 FOR DCL_DELIVERY_REQUEST 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.dlr_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
  if ( new.dlr_place_request is not null and old.dlr_place_request is null ) then
  begin
    new.dlr_place_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_place;
  end
end ^

CREATE TRIGGER DCL_DEPARTMENT_BI0 FOR DCL_DEPARTMENT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.DEP_ID IS NULL) THEN
    NEW.DEP_ID = GEN_ID(GEN_DCL_DEPARTMENT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_DEPARTMENT_ID, 1);
        IF ( ID < NEW.DEP_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_DEPARTMENT_ID, NEW.DEP_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_DLR_LIST_PRODUCE_BI0 FOR DCL_DLR_LIST_PRODUCE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.DRP_ID IS NULL) THEN
    NEW.DRP_ID = GEN_ID(GEN_DCL_DLR_LIST_PRODUCE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_DLR_LIST_PRODUCE_ID, 1);
        IF ( ID < NEW.DRP_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_DLR_LIST_PRODUCE_ID, NEW.DRP_ID - ID);
        END
    END

  if ( new.asm_id is not null ) then
  begin
    update dcl_assemble asm set asm.asm_block = 1 where asm.asm_id = new.asm_id;
  end
  if ( new.apr_id is not null ) then
  begin
    update dcl_assemble asm set asm.asm_block = 1 where asm.asm_id = (select asm_id from dcl_asm_list_produce where apr_id = new.apr_id);
  end
end ^

CREATE TRIGGER DCL_DLR_LIST_PRODUCE_BU0 FOR DCL_DLR_LIST_PRODUCE 
ACTIVE BEFORE UPDATE POSITION 0 
AS
declare variable asm_count integer;
declare variable apr_count integer;
declare variable asm_id_old integer;
begin
  if ( new.asm_id != old.asm_id or ( new.asm_id is null and old.asm_id is not null ) ) then
  begin
    asm_count = 0;
    select count(asm_id) from dcl_prc_list_produce where asm_id = old.asm_id into :asm_count;
    if ( asm_count = 0 ) then
    begin
      select count(asm_id) from dcl_dlr_list_produce where asm_id = old.asm_id and drp_id != old.drp_id into :asm_count;
    end
    if ( asm_count = 0 ) then
    begin
      update dcl_assemble asm set asm.asm_block = null where asm.asm_id = old.asm_id;
    end
  end
  if ( new.apr_id != old.apr_id or ( new.apr_id is null and old.apr_id is not null ) ) then
  begin
    apr_count = 0;
    select asm_id from dcl_asm_list_produce where apr_id = old.apr_id into :asm_id_old;
    select count(apr_id) from dcl_prc_list_produce where apr_id in ( select apr_id from dcl_asm_list_produce where asm_id = :asm_id_old ) into :apr_count;
    if ( apr_count = 0 ) then
    begin
      select count(apr_id) from dcl_dlr_list_produce where apr_id in ( select apr_id from dcl_asm_list_produce where asm_id = :asm_id_old ) and drp_id != old.drp_id into :apr_count;
    end
    if ( apr_count = 0 ) then
    begin
      update dcl_assemble asm set asm.asm_block = null where asm.asm_id = :asm_id_old;
    end
  end

  if ( new.asm_id is not null ) then
  begin
    update dcl_assemble asm set asm.asm_block = 1 where asm.asm_id = new.asm_id;
  end
  if ( new.apr_id is not null ) then
  begin
    update dcl_assemble asm set asm.asm_block = 1 where asm.asm_id = (select asm_id from dcl_asm_list_produce where apr_id = new.apr_id);
  end
end ^

CREATE TRIGGER DCL_DLR_LIST_PRODUCE_BD0 FOR DCL_DLR_LIST_PRODUCE 
ACTIVE BEFORE DELETE POSITION 0 
AS
declare variable asm_count integer;
declare variable apr_count integer;
declare variable asm_id_old integer;
begin
  if ( old.asm_id is not null ) then
  begin
    asm_count = 0;
    select count(asm_id) from dcl_prc_list_produce where asm_id = old.asm_id into :asm_count;
    if ( asm_count = 0 ) then
    begin
      select count(asm_id) from dcl_dlr_list_produce where asm_id = old.asm_id and drp_id != old.drp_id into :asm_count;
    end
    if ( asm_count = 0 ) then
    begin
      update dcl_assemble asm set asm.asm_block = null where asm.asm_id = old.asm_id;
    end
  end
  if ( old.apr_id is not null ) then
  begin
    apr_count = 0;
    select asm_id from dcl_asm_list_produce where apr_id = old.apr_id into :asm_id_old;
    select count(apr_id) from dcl_prc_list_produce where apr_id in ( select apr_id from dcl_asm_list_produce where asm_id = :asm_id_old ) into :apr_count;
    if ( apr_count = 0 ) then
    begin
      select count(apr_id) from dcl_dlr_list_produce where apr_id in ( select apr_id from dcl_asm_list_produce where asm_id = :asm_id_old ) and drp_id != old.drp_id into :apr_count;
    end
    if ( apr_count = 0 ) then
    begin
      update dcl_assemble asm set asm.asm_block = null where asm.asm_id = :asm_id_old;
    end
  end
end ^

CREATE TRIGGER DCL_FIELD_COMMENT_BI0 FOR DCL_FIELD_COMMENT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.FCM_ID IS NULL) THEN
    NEW.FCM_ID = GEN_ID(GEN_DCL_FIELD_COMMENT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_FIELD_COMMENT_ID, 1);
        IF ( ID < NEW.FCM_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_FIELD_COMMENT_ID, NEW.FCM_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_FILES_PATH_BI0 FOR DCL_FILES_PATH 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.FLP_ID IS NULL) THEN
    NEW.FLP_ID = GEN_ID(GEN_DCL_FILES_PATH_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_FILES_PATH_ID, 1);
        IF ( ID < NEW.FLP_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_FILES_PATH_ID, NEW.FLP_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_INF_MESSAGE_BI0 FOR DCL_INF_MESSAGE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.INM_ID IS NULL) THEN
    NEW.INM_ID = GEN_ID(GEN_DCL_INF_MESSAGE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_INF_MESSAGE_ID, 1);
        IF ( ID < NEW.INM_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_INF_MESSAGE_ID, NEW.INM_ID - ID);
        END
    END

  new.inm_create_date = CURRENT_TIMESTAMP;
end ^

CREATE TRIGGER DCL_INSTRUCTION_BI0 FOR DCL_INSTRUCTION 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.INS_ID IS NULL) THEN
    NEW.INS_ID = GEN_ID(GEN_DCL_INSTRUCTION_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_INSTRUCTION_ID, 1);
        IF ( ID < NEW.INS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_INSTRUCTION_ID, NEW.INS_ID - ID);
        END
    END
    new.ins_create_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_create;
    new.ins_edit_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_INSTRUCTION_BU0 FOR DCL_INSTRUCTION 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.ins_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_INSTRUCTION_BD0 FOR DCL_INSTRUCTION 
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  delete from dcl_attachment att where att.att_parent_id = old.ins_id and att.att_parent_table = 'DCL_INSTRUCTION';
end ^

CREATE TRIGGER DCL_INSTRUCTION_TYPE_BI0 FOR DCL_INSTRUCTION_TYPE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.IST_ID IS NULL) THEN
    NEW.IST_ID = GEN_ID(GEN_DCL_INSTRUCTION_TYPE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_INSTRUCTION_TYPE_ID, 1);
        IF ( ID < NEW.IST_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_INSTRUCTION_TYPE_ID, NEW.IST_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_LANGUAGE_BI0 FOR DCL_LANGUAGE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.LNG_ID IS NULL) THEN
    NEW.LNG_ID = GEN_ID(GEN_DCL_LANGUAGE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_LANGUAGE_ID, 1);
        IF ( ID < NEW.LNG_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_LANGUAGE_ID, NEW.LNG_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_LOG_BI0 FOR DCL_LOG 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.LOG_ID IS NULL) THEN
    NEW.LOG_ID = GEN_ID(GEN_DCL_LOG_ID, 1);
  ELSE
  BEGIN
    ID = GEN_ID(GEN_DCL_LOG_ID, 1);
    IF ( ID < NEW.LOG_ID ) THEN
    BEGIN
      ID = GEN_ID(GEN_DCL_LOG_ID, NEW.LOG_ID - ID);
    END
  END

  new.log_time = CURRENT_TIMESTAMP;
  if ( new.usr_id is null ) then
  begin
    select usr_id from get_context into new.usr_id;
  end
end ^

CREATE TRIGGER DCL_LPS_LIST_MANAGER_BI0 FOR DCL_LPS_LIST_MANAGER 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.LMN_ID IS NULL) THEN
    NEW.LMN_ID = GEN_ID(GEN_DCL_LPS_LIST_MANAGER_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_LPS_LIST_MANAGER_ID, 1);
        IF ( ID < NEW.LMN_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_LPS_LIST_MANAGER_ID, NEW.LMN_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_MONTAGE_ADJUSTMENT_BIO FOR DCL_MONTAGE_ADJUSTMENT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.MAD_ID IS NULL) THEN
    NEW.MAD_ID = GEN_ID(GEN_DCL_MONTAGE_ADJUSTMENT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_MONTAGE_ADJUSTMENT_ID, 1);
        IF ( ID < NEW.MAD_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_MONTAGE_ADJUSTMENT_ID, NEW.MAD_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_MONTAGE_ADJUSTMENT_H_BIO FOR DCL_MONTAGE_ADJUSTMENT_H 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.MADH_ID IS NULL) THEN
    NEW.MADH_ID = GEN_ID(GEN_DCL_MONTAGE_ADJUSTMENT_H_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_MONTAGE_ADJUSTMENT_H_ID, 1);
        IF ( ID < NEW.MADH_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_MONTAGE_ADJUSTMENT_H_ID, NEW.MADH_ID - ID);
        END
    END

  NEW.MAD_MECH_TOTAL = (NEW.MAD_MECH_WORK_TARIFF * (NEW.MAD_MECH_WORK_RULE_MONTAGE + NEW.MAD_MECH_WORK_RULE_ADJUSTMENT)) + ( NEW.MAD_MECH_ROAD_TARIFF * NEW.MAD_MECH_ROAD_RULE );
  NEW.MAD_EL_TOTAL = (NEW.MAD_EL_WORK_TARIFF * (NEW.MAD_EL_WORK_RULE_MONTAGE + NEW.MAD_EL_WORK_RULE_ADJUSTMENT)) + ( NEW.MAD_EL_ROAD_TARIFF * NEW.MAD_EL_ROAD_RULE );
end ^

CREATE TRIGGER DCL_MONTAGE_ADJUSTMENT_H_BU0 FOR DCL_MONTAGE_ADJUSTMENT_H 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  NEW.MAD_MECH_TOTAL = (NEW.MAD_MECH_WORK_TARIFF * (NEW.MAD_MECH_WORK_RULE_MONTAGE + NEW.MAD_MECH_WORK_RULE_ADJUSTMENT)) + ( NEW.MAD_MECH_ROAD_TARIFF * NEW.MAD_MECH_ROAD_RULE );
  NEW.MAD_EL_TOTAL = (NEW.MAD_EL_WORK_TARIFF * (NEW.MAD_EL_WORK_RULE_MONTAGE + NEW.MAD_EL_WORK_RULE_ADJUSTMENT)) + ( NEW.MAD_EL_ROAD_TARIFF * NEW.MAD_EL_ROAD_RULE );
end ^

CREATE TRIGGER DCL_ORDER_BI0 FOR DCL_ORDER 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.ord_ID IS NULL) THEN
    NEW.ord_ID = GEN_ID(GEN_DCL_ORDER_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_ORDER_ID, 1);
        IF ( ID < NEW.ord_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_ORDER_ID, NEW.ORD_ID - ID);
        END
    END
  new.ord_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.ord_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_ORDER_AI0 FOR DCL_ORDER 
ACTIVE AFTER INSERT POSITION 0 
AS
declare variable usr_count integer;
begin
  if (new.ctr_id_for is not null) then
  begin
    select count(usr_id) from dcl_contractor_user t where t.usr_id = new.usr_id_create and t.ctr_id = new.ctr_id_for into :usr_count;
    if (usr_count = 0) then
    begin
      insert into dcl_contractor_user (ctr_id, usr_id) values (new.ctr_id_for, new.usr_id_create);
    end
  end
end ^

CREATE TRIGGER DCL_ORDER_BU0 FOR DCL_ORDER 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.ord_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_ORDER_BD0 FOR DCL_ORDER 
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  delete from dcl_attachment att where att.att_parent_id = old.ord_id and att.att_parent_table = 'DCL_ORDER';
end ^

CREATE TRIGGER DCL_ORD_LIST_PAYMENT_BI0 FOR DCL_ORD_LIST_PAYMENT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.ORP_ID IS NULL) THEN
    NEW.ORP_ID = GEN_ID(GEN_DCL_ORD_LIST_PAYMENT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_ORD_LIST_PAYMENT_ID, 1);
        IF ( ID < NEW.ORP_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_ORD_LIST_PAYMENT_ID, NEW.ORP_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_ORD_LIST_PAY_SUM_BI0 FOR DCL_ORD_LIST_PAY_SUM 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.OPS_ID IS NULL) THEN
    NEW.OPS_ID = GEN_ID(GEN_DCL_ORD_LIST_PAY_SUM_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_ORD_LIST_PAY_SUM_ID, 1);
        IF ( ID < NEW.OPS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_ORD_LIST_PAY_SUM_ID, NEW.OPS_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_ORD_LIST_PRODUCE_BI0 FOR DCL_ORD_LIST_PRODUCE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.OPR_ID IS NULL) THEN
    NEW.OPR_ID = GEN_ID(GEN_DCL_ORD_LIST_PRODUCE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_ORD_LIST_PRODUCE_ID, 1);
        IF ( ID < NEW.OPR_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_ORD_LIST_PRODUCE_ID, NEW.OPR_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_ORD_LIST_PRODUCE_AI0 FOR DCL_ORD_LIST_PRODUCE 
ACTIVE AFTER INSERT POSITION 0 
AS
declare variable usr_count integer;
declare variable usr_id integer;
begin
  if (new.ctr_id is not null) then
  begin
    select usr_id from get_context into :usr_id;
    select count(usr_id) from dcl_contractor_user t where t.usr_id = :usr_id and t.ctr_id = new.ctr_id into :usr_count;
    if (usr_count = 0) then
    begin
      insert into dcl_contractor_user (ctr_id, usr_id) values (new.ctr_id, :usr_id);
    end
  end
end ^

CREATE TRIGGER DCL_ORD_MESSAGE_BI0 FOR DCL_ORD_MESSAGE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.ORM_ID IS NULL) THEN
    NEW.ORM_ID = GEN_ID(GEN_DCL_ORD_MESSAGE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_ORD_MESSAGE_ID, 1);
        IF ( ID < NEW.ORM_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_ORD_MESSAGE_ID, NEW.ORM_ID - ID);
        END
    END

  new.orm_create_date = CURRENT_TIMESTAMP;
end ^

CREATE TRIGGER DCL_OUTGOING_LETTER_BI0 FOR DCL_OUTGOING_LETTER 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.OTL_ID IS NULL) THEN
    NEW.OTL_ID = GEN_ID(GEN_DCL_OUTGOING_LETTER_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_OUTGOING_LETTER_ID, 1);
        IF ( ID < NEW.OTL_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_OUTGOING_LETTER_ID, NEW.OTL_ID - ID);
        END
    END

  new.otl_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.otl_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_OUTGOING_LETTER_BU0 FOR DCL_OUTGOING_LETTER 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.otl_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_OUTGOING_LETTER_BD0 FOR DCL_OUTGOING_LETTER 
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  delete from dcl_attachment att where att.att_parent_id = old.otl_id and att.att_parent_table = 'DCL_OUTGOING_LETTER';
end ^

CREATE TRIGGER DCL_PAYMENT_BI0 FOR DCL_PAYMENT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.PAY_ID IS NULL) THEN
    NEW.PAY_ID = GEN_ID(GEN_DCL_PAYMENT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_PAYMENT_ID, 1);
        IF ( ID < NEW.PAY_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_PAYMENT_ID, NEW.PAY_ID - ID);
        END
    END

  new.pay_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.pay_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_PAYMENT_BU0 FOR DCL_PAYMENT 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.pay_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_PAY_LIST_SUMM_BI0 FOR DCL_PAY_LIST_SUMM 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.LPS_ID IS NULL) THEN
    NEW.LPS_ID = GEN_ID(GEN_DCL_PAY_LIST_SUMM_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_PAY_LIST_SUMM_ID, 1);
        IF ( ID < NEW.LPS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_PAY_LIST_SUMM_ID, NEW.LPS_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_PAY_MESSAGE_BI0 FOR DCL_PAY_MESSAGE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.PMS_ID IS NULL) THEN
    NEW.PMS_ID = GEN_ID(GEN_DCL_PAY_MESSAGE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_PAY_MESSAGE_ID, 1);
        IF ( ID < NEW.PMS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_PAY_MESSAGE_ID, NEW.PMS_ID - ID);
        END
    END

  new.pms_create_date = CURRENT_TIMESTAMP;
end ^

CREATE TRIGGER DCL_PRC_LIST_PRODUCE_BI0 FOR DCL_PRC_LIST_PRODUCE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.LPC_ID IS NULL) THEN
    NEW.LPC_ID = GEN_ID(GEN_DCL_PRC_LIST_PRODUCE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_PRC_LIST_PRODUCE_ID, 1);
        IF ( ID < NEW.LPC_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_PRC_LIST_PRODUCE_ID, NEW.LPC_ID - ID);
        END
    END

  if ( new.asm_id is not null ) then
  begin
    update dcl_assemble asm set asm.asm_block = 1 where asm.asm_id = new.asm_id;
  end
  if ( new.apr_id is not null ) then
  begin
    update dcl_assemble asm set asm.asm_block = 1 where asm.asm_id = (select asm_id from dcl_asm_list_produce where apr_id = new.apr_id);
  end
end ^

CREATE TRIGGER DCL_PRC_LIST_PRODUCE_AI0 FOR DCL_PRC_LIST_PRODUCE 
ACTIVE AFTER INSERT POSITION 0 
AS
declare variable ctr_id integer;
declare variable con_id integer;
declare variable spc_id integer;
begin
  select ctr_id,
         con_id,
         spc_id
  from get_contractor_for_for_lpc_id(new.lpc_id)
  into :ctr_id,
       :con_id,
       :spc_id;

  if ( ctr_id is not null ) then
  begin
    insert into dcl_prc_ctr_for_calcstate(
         lpc_id,
         prc_id,
         ctr_id,
         con_id,
         spc_id
    )
    values(
         new.lpc_id,
         new.prc_id,
         :ctr_id,
         :con_id,
         :spc_id
    );
  end
end ^

CREATE TRIGGER DCL_PRC_LIST_PRODUCE_BU0 FOR DCL_PRC_LIST_PRODUCE 
ACTIVE BEFORE UPDATE POSITION 0 
AS
declare variable asm_count integer;
declare variable apr_count integer;
declare variable asm_id_old integer;
begin
  if ( new.asm_id != old.asm_id or ( new.asm_id is null and old.asm_id is not null ) ) then
  begin
    asm_count = 0;
    select count(asm_id) from dcl_dlr_list_produce where asm_id = old.asm_id into :asm_count;
    if ( asm_count = 0 ) then
    begin
      select count(asm_id) from dcl_prc_list_produce where asm_id = old.asm_id and lpc_id != old.lpc_id into :asm_count;
    end
    if ( asm_count = 0 ) then
    begin
      update dcl_assemble asm set asm.asm_block = null where asm.asm_id = old.asm_id;
    end
  end
  if ( new.apr_id != old.apr_id or ( new.apr_id is null and old.apr_id is not null ) ) then
  begin
    apr_count = 0;
    select asm_id from dcl_asm_list_produce where apr_id = old.apr_id into :asm_id_old;
    select count(apr_id) from dcl_dlr_list_produce where apr_id in ( select apr_id from dcl_asm_list_produce where asm_id = :asm_id_old ) into :apr_count;
    if ( apr_count = 0 ) then
    begin
      select count(apr_id) from dcl_prc_list_produce where apr_id in ( select apr_id from dcl_asm_list_produce where asm_id = :asm_id_old ) and lpc_id != old.lpc_id into :apr_count;
    end
    if ( apr_count = 0 ) then
    begin
      update dcl_assemble asm set asm.asm_block = null where asm.asm_id = :asm_id_old;
    end
  end

  if ( new.asm_id is not null ) then
  begin
    update dcl_assemble asm set asm.asm_block = 1 where asm.asm_id = new.asm_id;
  end
  if ( new.apr_id is not null ) then
  begin
    update dcl_assemble asm set asm.asm_block = 1 where asm.asm_id = (select asm_id from dcl_asm_list_produce where apr_id = new.apr_id);
  end
end ^

CREATE TRIGGER DCL_PRC_LIST_PRODUCE_AU0 FOR DCL_PRC_LIST_PRODUCE 
ACTIVE AFTER UPDATE POSITION 0 
AS
declare variable ctr_id integer;
declare variable con_id integer;
declare variable spc_id integer;
begin
  update dcl_shp_list_produce set stf_id = new.stf_id where lpc_id = old.lpc_id and (stf_id is null or stf_id != new.stf_id);

  select ctr_id,
         con_id,
         spc_id
  from get_contractor_for_for_lpc_id(old.lpc_id)
  into :ctr_id,
       :con_id,
       :spc_id;
  if ( ctr_id is not null ) then
  begin
    update dcl_prc_ctr_for_calcstate prc_ctr
    set prc_ctr.ctr_id = :ctr_id, prc_ctr.con_id = :con_id, prc_ctr.spc_id = :spc_id
    where
      prc_ctr.lpc_id = old.lpc_id;
  end
  else
  begin
    delete from dcl_prc_ctr_for_calcstate prc_ctr where prc_ctr.lpc_id = old.lpc_id;
  end
end ^

CREATE TRIGGER DCL_PRC_LIST_PRODUCE_BD0 FOR DCL_PRC_LIST_PRODUCE 
ACTIVE BEFORE DELETE POSITION 0 
AS
declare variable asm_count integer;
declare variable apr_count integer;
declare variable asm_id_old integer;
begin
  if ( old.asm_id is not null ) then
  begin
    asm_count = 0;
    select count(asm_id) from dcl_dlr_list_produce where asm_id = old.asm_id into :asm_count;
    if ( asm_count = 0 ) then
    begin
      select count(asm_id) from dcl_prc_list_produce where asm_id = old.asm_id and lpc_id != old.lpc_id into :asm_count;
    end
    if ( asm_count = 0 ) then
    begin
      update dcl_assemble asm set asm.asm_block = null where asm.asm_id = old.asm_id;
    end
  end
  if ( old.apr_id is not null ) then
  begin
    apr_count = 0;
    select asm_id from dcl_asm_list_produce where apr_id = old.apr_id into :asm_id_old;
    select count(apr_id) from dcl_dlr_list_produce where apr_id in ( select apr_id from dcl_asm_list_produce where asm_id = :asm_id_old ) into :apr_count;
    if ( apr_count = 0 ) then
    begin
      select count(apr_id) from dcl_prc_list_produce where apr_id in ( select apr_id from dcl_asm_list_produce where asm_id = :asm_id_old ) and lpc_id != old.lpc_id into :apr_count;
    end
    if ( apr_count = 0 ) then
    begin
      update dcl_assemble asm set asm.asm_block = null where asm.asm_id = :asm_id_old;
    end
  end
end ^

CREATE TRIGGER DCL_PRODUCE_BIO FOR DCL_PRODUCE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.PRD_ID IS NULL) THEN
    NEW.PRD_ID = GEN_ID(GEN_DCL_PRODUCE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_PRODUCE_ID, 1);
        IF ( ID < NEW.PRD_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_PRODUCE_ID, NEW.PRD_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_PRODUCE_BD0 FOR DCL_PRODUCE 
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  delete from dcl_attachment att where att.att_parent_id = old.prd_id and att.att_parent_table = 'DCL_PRODUCE';
end ^

CREATE TRIGGER DCL_PRODUCE_COST_BI0 FOR DCL_PRODUCE_COST 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.PRC_ID IS NULL) THEN
    NEW.PRC_ID = GEN_ID(GEN_DCL_PRODUCE_COST_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_PRODUCE_COST_ID, 1);
        IF ( ID < NEW.PRC_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_PRODUCE_COST_ID, NEW.PRC_ID - ID);
        END
    END

  new.prc_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.prc_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_PRODUCE_COST_BU0 FOR DCL_PRODUCE_COST 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.prc_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_PRODUCTION_TERM_BI0 FOR DCL_PRODUCTION_TERM 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.PTR_ID IS NULL) THEN
    NEW.PTR_ID = GEN_ID(GEN_DCL_PRODUCTION_TERM_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_PRODUCTION_TERM_ID, 1);
        IF ( ID < NEW.PTR_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_PRODUCTION_TERM_ID, NEW.PTR_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_PURCHASE_PURPOSE_BI0 FOR DCL_PURCHASE_PURPOSE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.PPS_ID IS NULL) THEN
    NEW.PPS_ID = GEN_ID(GEN_DCL_purchase_PURPOSE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_purchase_PURPOSE_ID, 1);
        IF ( ID < NEW.PPS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_purchase_PURPOSE_ID, NEW.PPS_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_PURPOSE_BI0 FOR DCL_PURPOSE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.PRS_ID IS NULL) THEN
    NEW.PRS_ID = GEN_ID(GEN_DCL_PURPOSE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_PURPOSE_ID, 1);
        IF ( ID < NEW.PRS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_PURPOSE_ID, NEW.PRS_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_RATE_NDS_BI0 FOR DCL_RATE_NDS 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.RTN_ID IS NULL) THEN
    NEW.RTN_ID = GEN_ID(GEN_DCL_RATE_NDS_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_RATE_NDS_ID, 1);
        IF ( ID < NEW.RTN_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_RATE_NDS_ID, NEW.RTN_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_READY_FOR_SHIPPING_BI0 FOR DCL_READY_FOR_SHIPPING 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.RFS_ID IS NULL) THEN
    NEW.RFS_ID = GEN_ID(GEN_DCL_READY_FOR_SHIPPING_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_READY_FOR_SHIPPING_ID, 1);
        IF ( ID < NEW.RFS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_READY_FOR_SHIPPING_ID, NEW.RFS_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_REPUTATION_BI0 FOR DCL_REPUTATION 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.RPT_ID IS NULL) THEN
    NEW.RPT_ID = GEN_ID(GEN_DCL_REPUTATION_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_REPUTATION_ID, 1);
        IF ( ID < NEW.RPT_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_REPUTATION_ID, NEW.RPT_ID - ID);
        END
    END

  if ( new.rpt_default_in_ctc = 1 ) then
  begin
    update dcl_reputation rpt set rpt.rpt_default_in_ctc = null where rpt.rpt_id != new.rpt_id and rpt.rpt_default_in_ctc = 1;
  end
end ^

CREATE TRIGGER DCL_REPUTATION_BU0 FOR DCL_REPUTATION 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  if ( new.rpt_default_in_ctc = 1 ) then
  begin
    update dcl_reputation rpt set rpt.rpt_default_in_ctc = null where rpt.rpt_id != old.rpt_id and rpt.rpt_default_in_ctc = 1;
  end
end ^

CREATE TRIGGER DCL_ROLE_BIO FOR DCL_ROLE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.ROL_ID IS NULL) THEN
    NEW.ROL_ID = GEN_ID(GEN_DCL_ROLE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_ROLE_ID, 1);
        IF ( ID < NEW.ROL_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_ROLE_ID, NEW.ROL_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_ROUTE_BI0 FOR DCL_ROUTE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.RUT_ID IS NULL) THEN
    NEW.RUT_ID = GEN_ID(GEN_DCL_ROUTE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_ROUTE_ID, 1);
        IF ( ID < NEW.RUT_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_ROUTE_ID, NEW.RUT_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_SELLER_BI0 FOR DCL_SELLER 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.SLN_ID IS NULL) THEN
    NEW.SLN_ID = GEN_ID(GEN_DCL_SELLER_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_SELLER_ID, 1);
        IF ( ID < NEW.SLN_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_SELLER_ID, NEW.SLN_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_SETTING_BI0 FOR DCL_SETTING 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.STN_ID IS NULL) THEN
    NEW.STN_ID = GEN_ID(GEN_DCL_SETTING_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_SETTING_ID, 1);
        IF ( ID < NEW.STN_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_SETTING_ID, NEW.STN_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_SHIPPING_BI0 FOR DCL_SHIPPING 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.SHP_ID IS NULL) THEN
    NEW.SHP_ID = GEN_ID(GEN_DCL_SHIPPING_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_SHIPPING_ID, 1);
        IF ( ID < NEW.SHP_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_SHIPPING_ID, NEW.SHP_ID - ID);
        END
    END

  new.shp_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.shp_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_SHIPPING_BU0 FOR DCL_SHIPPING 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.shp_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_SHP_DOC_TYPE_BI0 FOR DCL_SHP_DOC_TYPE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.SDT_ID IS NULL) THEN
    NEW.SDT_ID = GEN_ID(GEN_DCL_SHP_DOC_TYPE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_SHP_DOC_TYPE_ID, 1);
        IF ( ID < NEW.SDT_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_SHP_DOC_TYPE_ID, NEW.SDT_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_SHP_LIST_PRODUCE_BI0 FOR DCL_SHP_LIST_PRODUCE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
DECLARE VARIABLE sh_date DATE;
begin
  IF (NEW.LPS_ID IS NULL) THEN
    NEW.LPS_ID = GEN_ID(GEN_DCL_SHP_LIST_PRODUCE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_SHP_LIST_PRODUCE_ID, 1);
        IF ( ID < NEW.LPS_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_SHP_LIST_PRODUCE_ID, NEW.LPS_ID - ID);
        END
    END

  select shp_date from dcl_shipping where shp_id = new.shp_id into :sh_date;
  new.shp_date = sh_date;
end ^

CREATE TRIGGER DCL_SHP_LIST_PRODUCE_AI0 FOR DCL_SHP_LIST_PRODUCE 
ACTIVE AFTER INSERT POSITION 0 
AS
begin
  /* Trigger text */
  update dcl_prc_list_produce set stf_id = new.stf_id where lpc_id = new.lpc_id and ( stf_id != new.stf_id or stf_id is null ) and new.stf_id is not null;
  --update dcl_shp_list_produce set stf_id = new.stf_id where lpc_id = new.lpc_id and lps_id != new.lps_id and ( stf_id != new.stf_id or stf_id is null ) and new.stf_id is not null;
end ^

CREATE TRIGGER DCL_SHP_LIST_PRODUCE_BU0 FOR DCL_SHP_LIST_PRODUCE 
ACTIVE BEFORE UPDATE POSITION 0 
AS
DECLARE VARIABLE sh_date DATE;
begin
  select shp_date from dcl_shipping where shp_id = new.shp_id into :sh_date;
  new.shp_date = sh_date;
end ^

CREATE TRIGGER DCL_SHP_LIST_PRODUCE_AU0 FOR DCL_SHP_LIST_PRODUCE 
ACTIVE AFTER UPDATE POSITION 0 
AS
begin
  /* Trigger text */
  update dcl_prc_list_produce set stf_id = new.stf_id where lpc_id = old.lpc_id and ( stf_id != new.stf_id or stf_id is null ) and new.stf_id is not null;
end ^

CREATE TRIGGER DCL_SPC_LIST_PAYMENT_BI0 FOR DCL_SPC_LIST_PAYMENT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.SPP_ID IS NULL) THEN
    NEW.SPP_ID = GEN_ID(GEN_DCL_SPC_LIST_PAYMENT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_SPC_LIST_PAYMENT_ID, 1);
        IF ( ID < NEW.SPP_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_SPC_LIST_PAYMENT_ID, NEW.SPP_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_SPECIFICATION_IMPORT_BI0 FOR DCL_SPECIFICATION_IMPORT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.SPI_ID IS NULL) THEN
    NEW.SPI_ID = GEN_ID(GEN_DCL_SPECIFICATION_IMPORT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_SPECIFICATION_IMPORT_ID, 1);
        IF ( ID < NEW.SPI_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_SPECIFICATION_IMPORT_ID, NEW.SPI_ID - ID);
        END
    END

  new.spi_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.spi_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_SPECIFICATION_IMPORT_BU0 FOR DCL_SPECIFICATION_IMPORT 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.spi_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
end ^

CREATE TRIGGER DCL_SPI_LIST_PRODUCE_BI0 FOR DCL_SPI_LIST_PRODUCE 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.SIP_ID IS NULL) THEN
    NEW.SIP_ID = GEN_ID(GEN_DCL_SPI_LIST_PRODUCE_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_SPI_LIST_PRODUCE_ID, 1);
        IF ( ID < NEW.SIP_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_SPI_LIST_PRODUCE_ID, NEW.SIP_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_STUFF_CATEGORY_BI0 FOR DCL_STUFF_CATEGORY 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.STF_ID IS NULL) THEN
    NEW.STF_ID = GEN_ID(GEN_DCL_STUFF_CATEGORY_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_STUFF_CATEGORY_ID, 1);
        IF ( ID < NEW.STF_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_STUFF_CATEGORY_ID, NEW.STF_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_TERM_INCO_BI0 FOR DCL_TERM_INCO 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.TRM_ID IS NULL) THEN
    NEW.TRM_ID = GEN_ID(GEN_DCL_TERM_INCO_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_TERM_INCO_ID, 1);
        IF ( ID < NEW.TRM_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_TERM_INCO_ID, NEW.TRM_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_TEST_BI0 FOR DCL_TEST 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.TST_ID IS NULL) THEN
    NEW.TST_ID = GEN_ID(GEN_DCL_TEST_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_TEST_ID, 1);
        IF ( ID < NEW.TST_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_TEST_ID, NEW.TST_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_TIMEBOARD_BI0 FOR DCL_TIMEBOARD 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.TMB_ID IS NULL) THEN
    NEW.TMB_ID = GEN_ID(GEN_DCL_TIMEBOARD_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_TIMEBOARD_ID, 1);
        IF ( ID < NEW.TMB_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_TIMEBOARD_ID, NEW.TMB_ID - ID);
        END
    END

  new.tmb_create_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_create;
  new.tmb_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
  if ( new.tmb_checked is not null ) then
  begin
    new.tmb_checked_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_checked;
  end
end ^

CREATE TRIGGER DCL_TIMEBOARD_BU0 FOR DCL_TIMEBOARD 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.tmb_edit_date = CURRENT_TIMESTAMP;
  select usr_id from get_context into new.usr_id_edit;
  if ( new.tmb_checked is not null and old.tmb_checked is null ) then
  begin
    new.tmb_checked_date = CURRENT_TIMESTAMP;
    select usr_id from get_context into new.usr_id_checked;
  end
end ^

CREATE TRIGGER DCL_TMB_LIST_WORK_BI0 FOR DCL_TMB_LIST_WORK 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.TBW_ID IS NULL) THEN
    NEW.TBW_ID = GEN_ID(GEN_DCL_TMB_LIST_WORK_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_TMB_LIST_WORK_ID, 1);
        IF ( ID < NEW.TBW_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_TMB_LIST_WORK_ID, NEW.TBW_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_UNIT_BI0 FOR DCL_UNIT 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.UNT_ID IS NULL) THEN
    NEW.UNT_ID = GEN_ID(GEN_DCL_UNIT_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_UNIT_ID, 1);
        IF ( ID < NEW.UNT_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_UNIT_ID, NEW.UNT_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_USER_BI0 FOR DCL_USER 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.USR_ID IS NULL) THEN
    NEW.USR_ID = GEN_ID(GEN_DCL_USER_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_USER_ID, 1);
        IF ( ID < NEW.USR_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_USER_ID, NEW.USR_ID - ID);
        END
    END
end ^

CREATE TRIGGER DCL_USER_LINK_BI0 FOR DCL_USER_LINK 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.ULN_ID IS NULL) THEN
    NEW.ULN_ID = GEN_ID(GEN_DCL_USER_LINK_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_USER_LINK_ID, 1);
        IF ( ID < NEW.ULN_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_USER_LINK_ID, NEW.ULN_ID - ID);
        END
    END

  new.uln_create_date = CURRENT_TIMESTAMP;
end ^

CREATE TRIGGER DCL_USER_SETTING_BI0 FOR DCL_USER_SETTING 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE ID INTEGER;
begin
  IF (NEW.UST_ID IS NULL) THEN
    NEW.UST_ID = GEN_ID(GEN_DCL_USER_SETTING_ID, 1);
  ELSE
    BEGIN
        ID = GEN_ID(GEN_DCL_USER_SETTING_ID, 1);
        IF ( ID < NEW.UST_ID ) THEN
        BEGIN
          ID = GEN_ID(GEN_DCL_USER_SETTING_ID, NEW.UST_ID - ID);
        END
    END
end ^


SET TERM ; ^
COMMIT WORK;

/* Grant permissions for this database */
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_1C_NUMBER_HISTORY TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ACCOUNT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ACTION TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ACTION_ROLE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ASM_LIST_PRODUCE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ASSEMBLE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ATTACHMENT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_BLANK TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_BLANK_IMAGE TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_CATALOG_NUMBER TO USER ALK;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CATALOG_NUMBER TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CATEGORY TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CFC_LIST_PRODUCE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CFC_MESSAGE TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_COMMERCIAL_PROPOSAL TO USER ALK;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_COMMERCIAL_PROPOSAL TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_COND_FOR_CONTRACT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CONTACT_PERSON TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CONTACT_PERSON_USER TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CONTRACT TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_CONTRACTOR TO USER ALK;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CONTRACTOR TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_CONTRACTOR_REQUEST TO USER ALK;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CONTRACTOR_REQUEST TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CONTRACTOR_USER TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CONTRACT_CLOSED TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CON_LIST_SPEC TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CON_MESSAGE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_COUNTRY TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_CPR_LIST_PRODUCE TO USER ALK;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CPR_LIST_PRODUCE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CPR_TRANSPORT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CRQ_ORD_LINK TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CRQ_PRINT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CRQ_STAGE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CTC_LIST TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CTC_PAY TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CTC_SHP TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CURRENCY TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CURRENCY_RATE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CUSTOM_CODE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CUSTOM_CODE_V TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_CUS_CODE_HISTORY TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_DELIVERY_REQUEST TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_DEPARTMENT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_DLR_LIST_PRODUCE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_FIELD_COMMENT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_FILES_PATH TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_INF_MESSAGE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_INSTRUCTION TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_INSTRUCTION_TYPE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_LANGUAGE TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_LNT_ACCOUNT TO USER ALK;
GRANT SELECT ON DCL_LNT_PRODUCE TO USER ALK;
GRANT SELECT ON DCL_LNT_SERVICE TO USER ALK;
GRANT SELECT ON DCL_LNT_SERVICE TO VIEW DCL_LNT_SERVICE;
GRANT SELECT ON DCL_LNT_SERVICE_CONTRACT TO USER ALK;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_LOG TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_LPS_LIST_MANAGER TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_MONTAGE_ADJUSTMENT TO USER ALK;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_MONTAGE_ADJUSTMENT TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_MONTAGE_ADJUSTMENT_H TO USER ALK;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_MONTAGE_ADJUSTMENT_H TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_APR_PRODUCE_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_APR_PRODUCE_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_ASM_PRODUCE_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_ASM_PRODUCE_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_CONTRACTOR_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_CONTRACTOR_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_CONTRACT_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_CONTRACT_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_COUNTRY_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_COUNTRY_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_DLR_PRODUCE_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_DLR_PRODUCE_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_ORD_PRODUCE_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_ORD_PRODUCE_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_PRC_PRODUCE_CPR_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_PRC_PRODUCE_CPR_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_PRC_PRODUCE_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_PRC_PRODUCE_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_ROUTE_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_ROUTE_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_SELLER_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_SELLER_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_SHP_DOC_TYPE_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_SHP_DOC_TYPE_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_SPEC_IN_PAY_SHP_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_SPEC_IN_PAY_SHP_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_SPEC_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_SPEC_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_SPI_PRODUCE_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_SPI_PRODUCE_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OCCUPIED_STUFF_CATEGORY_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_OCCUPIED_STUFF_CATEGORY_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OPR_LIST_EXECUTED TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ORDER TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ORD_LIST_PAYMENT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ORD_LIST_PAY_SUM TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ORD_LIST_PRODUCE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ORD_MESSAGE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_OUTGOING_LETTER TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PAYMENT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PAY_LIST_SUMM TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PAY_MESSAGE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PRC_CTR_FOR_CALCSTATE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PRC_LIST_PRODUCE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PRODUCE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PRODUCE_COST TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PRODUCE_COST_CUSTOM TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PRODUCE_LANGUAGE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PRODUCTION_TERM TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PURCHASE_PURPOSE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_PURPOSE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_RATE_NDS TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_READY_FOR_SHIPPING TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_REPUTATION TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_RESTS_IN_MINSK_TEMPORARY TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ROLE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_ROUTE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_SELLER TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_SETTING TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_SHIPPING TO USER ALP;
GRANT DELETE, INSERT, UPDATE, REFERENCES ON DCL_SHIPPING TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_SHP_DOC_TYPE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_SHP_LIST_PRODUCE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_SHP_USR_DEP_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_SHP_USR_DEP_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_SPC_LIST_PAYMENT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_SPECIFICATION_IMPORT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_SPEC_IN_CTC_V TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_SPEC_IN_CTC_V TO VIEW DCL_LNT_SERVICE;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_SPI_LIST_PRODUCE TO USER ALP WITH GRANT OPTION;
GRANT SELECT ON DCL_STUFF_CATEGORY TO USER ALK;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_STUFF_CATEGORY TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_TERM_INCO TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_TEST TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_TIMEBOARD TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_TMB_LIST_WORK TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_UNIT TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_UNIT_LANGUAGE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_USER TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_USER_LANGUAGE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_USER_LINK TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_USER_ROLE TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_USER_SETTING TO USER ALP WITH GRANT OPTION;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON DCL_YEAR_NUM TO USER ALP WITH GRANT OPTION;
GRANT EXECUTE ON PROCEDURE CHECKUSERMESSAGESONDELETE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DATE2STR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ADD_INFO_SERVICE_GUARANTEE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ASM_COUNT_BY_PRD_ID_ASM_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ASM_LIST_PRODUCES_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ASM_LIST_PRODUCE_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ASSEMBLE_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ASSEMBLE_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ASSEMBLE_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_BEGIN_OF_NEXT_WEEK TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_BLANKS_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_BLANK_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_BLANK_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CALCULATION_STATE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CALCULATION_STATE_DEBET TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CAN_SPC_BLOCK TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CFC_MESSAGES_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CFC_PRODUCES_SELECT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CLOSED_RECORD_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CLOSE_CONTRACT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CLOSE_RESERVED_IN_CPR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_COMMERCIAL_PROPOSAL_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_COMMERCIAL_PROPOSAL_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_COND_FOR_CONTRACT_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_COND_FOR_CONTRACT_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTACT_PERSON_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACTOR_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACTOR_FILTER_FULL TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACTOR_FOR_CC_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACTOR_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACTOR_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACTOR_REQUEST_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACTOR_REQUEST_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACTOR_REQUEST_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACTS_CLOSED_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACT_CLOSED_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACT_CLOSED_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACT_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACT_FOR_CC_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACT_FOR_CONTRACTOR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CONTRACT_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CON_LIST_SPECS_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CON_LIST_SPEC_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CON_LIST_SPEC_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CON_MESSAGES_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_COUNTRY_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CPR_LIST_PRODUCES_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CPR_LIST_PRODUCE_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CPR_TRANSPORTS_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CPR_TRANSPORT_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CURRENCY_RATE_FOR_DATE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CURRENCY_RATE_MIN_DATE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CURRENT_WORKS_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CURRENT_WORK_ADD_INFO TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_CUSTOM_CODE_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DECODE_ID_LIST TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DELETE_CONTRACT_CLOSED TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DELETE_DUPLICATE_CTN TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DELIVERY_REQUEST_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DELIVERY_REQUEST_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DEPARTMENT_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DLR_COUNT_BY_PRD_ID_DLR_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DLR_LIST_PRODUCES_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DLR_LIST_PRODUCE_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_DRP_DEPENDED_LINES TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_EQUIPMENT_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_EQUIPMENT_FOR_PRODUCE_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_EQUIPMENT_GUARANTY_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_EQUIPMENT_PNP_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_1C_BY_PRC_ID_PRD_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ASM_LIST_FOR_ORD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ASM_NUM_DATE_FOR_ORD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ATT_COUNT_FOR_SPC TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_BLANK_IMAGES_IN_STR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_CATEGORIES_FOR_TREE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_CHILD_CATEGORIES TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_CIRC_AND_REST_FOR_PRD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_CONTRACTORS_FOR_FOR_ORD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_CONTRACTOR_FOR_FOR_ORD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_CON_NUM_FOR_DLR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_COUNT_DAY TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_COUNT_OPR_USED_IN_ASM TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_COUNT_REST_DRP TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_CRQ_DELIVER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_CTN_NUM_LIST_BY_PRD_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_CUSTOMER_FOR_DLR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_DECODE_RESTS_IN_MINSK TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_DOUBLE_CONTRACTOR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_DOUBLE_PRODUCES TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_MANAGERS_BY_SHP_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_MANAGER_LIST_BY_SHP_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_NUM TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_OCCUPIED_SHP_POS TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_OPR_ID_BY_LPC TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_OPR_ID_FROM_ASM TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ORD_CUST_INFO_FOR_ASM TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ORD_ID_BY_LPC TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ORD_INFO_FOR_ASM TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ORD_NUM_DATE_FOR_DLR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_PAYED_DATE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_PRC_LIST_FOR_ORD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_PRC_NUM_DATE_FOR_DRP TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_PRC_NUM_DATE_FOR_ORD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_PRC_NUM_DATE_FOR_SIP TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_PRODUCES_FOR_CAT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_PRODUCT_LIST_BY_SHP_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_RESERVED_COUNT_FOR_CPR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_RESERVED_INFO TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_ASM_FOR_DLR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_ASM_FOR_PRC TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_DRP_FOR_PRC TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_DRP_FOR_SPI TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_INFO_FROM_ORDER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_LPC_FOR_CPR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_LPC_FOR_LPR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_LPC_FOR_SHP TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_OPR_FOR_ASM TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_OPR_FOR_DLR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_OPR_FOR_PRC TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_OPR_FOR_SPI TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_SIP_FOR_DLR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_REST_SIP_FOR_PRC TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ROW_SUM TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ROW_SUMM_EUR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_ROW_SUMM_OUT_NDS TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_SPC_PAY_EXPIRATION TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_SPI_LIST_FOR_ORD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_SPI_NUM_DATE_FOR_DRP TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_SPI_NUM_DATE_FOR_ORD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_SUM_OUT_NDS_EUR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_SUM_OUT_NDS_EUR_PART TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_TIMESTAMP_BREAKDOWN TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_TREE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_USER_FOR_CONTRACT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_USR_DEP_LIST_CON TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_USR_FOR_SPEC_IMP TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GET_USR_ID_LIST_SHP TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GOODS_CIRCULATION TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_GOODS_REST TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_INSTRUCTION_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_INSTRUCTION_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_INSTRUCTION_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_IS_HAVE_EMPTY_DATE_CONF TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_IS_PAY_CLOSED TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_IS_SHP_CLOSED TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_IS_WARM_BY_DELIVERY_DATE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_LOG_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_LOG_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_LOG_INSERT_BY_ACT_SYS_NAME TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_MARGIN TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_MARGIN1 TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_MONTAGE_ADJUSTMENT_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_MOVEMENT_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORDERS_LOGISTICS TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORDERS_STATISTICS TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORDERS_UNEXECUTED TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORDER_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORDER_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORDER_LOAD_CONTRACT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORD_LIST_PRD_LOAD_PARENT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORD_LIST_PRODUCES_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORD_LIST_PRODUCE_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_ORD_LIST_PRODUCE_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_OUTGOING_LETTER_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_OUTGOING_LETTER_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_OUTGOING_LETTER_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PAYMENT_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PAYMENT_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PAY_MESSAGES_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PRC_LIST_PRODUCES_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PRC_LIST_PRODUCE_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PROCESS_OPR_UNEXECUTED TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PRODUCE_COST_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PRODUCE_COST_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PRODUCE_COST_REPORT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PRODUCE_COST_REPORT_SUM TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_PRODUCE_IN_SPC_IMPORT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SAVE_CFC_ECO_MSG TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SAVE_CFC_MESSAGES TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SAVE_CONTRACT_MESSAGES TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SAVE_ORD_MESSAGES TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SAVE_PAYMENT_MESSAGES TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SERIAL_NUMBER_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SHIPPING_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SHIPPING_GOODS TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SHIPPING_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SHIPPING_REPORT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SHIPPING_REPORT_USER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SHP_LIST_PRODUCE_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SIP_DEPENDED_LINES TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SPECIFICATION_IMPORT_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SPECIFICATION_IMPORT_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SPI_COUNT_BY_PRD_ID_SPI_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SPI_LIST_PRODUCES_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_SPI_LIST_PRODUCE_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_STUFF_CATEGORY_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_TIMEBOARD_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_TIMEBOARD_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_TIMEBOARD_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_TIMEBOARD_LOAD_CHECK_IDX TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_TMB_LIST_WORKS_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_TMB_LIST_WORK_LOAD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_UNCLOSED_SPEC TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_UNIT_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_UNIT_PACK TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_UPDATE_DELIVERY_DATE TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_CTR TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_CUT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_PRD TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_UPDATE_DEP_DOCS_FOR_STF TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_UPDATE_USER_BLOCK TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_USER_ACTIONS TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_USER_FILTER TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_USER_FILTER_FULL TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_USER_INSERT TO USER ALP;
GRANT EXECUTE ON PROCEDURE DCL_YEARWEEK TO USER ALP;
GRANT EXECUTE ON PROCEDURE GET_CONTEXT TO USER ALP;
GRANT EXECUTE ON PROCEDURE GET_CONTRACTOR_FOR_FOR_APR_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE GET_CONTRACTOR_FOR_FOR_DRP_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE GET_CONTRACTOR_FOR_FOR_LPC_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE GET_CONTRACTOR_FOR_FOR_OPR_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE GET_CONTRACTOR_FOR_FOR_SIP_ID TO USER ALP;
GRANT EXECUTE ON PROCEDURE GET_PRC_DATES_ON_STORAGE TO USER ALP;
GRANT EXECUTE ON PROCEDURE MAINTENANCE_SELECTIVITY TO USER ALP;
GRANT EXECUTE ON PROCEDURE MIGRATE_TO_CUSTOM_CODE_HISTORY TO USER ALP;
GRANT EXECUTE ON PROCEDURE SET_CONTEXT TO USER ALP;
GRANT EXECUTE ON PROCEDURE YEARWEEK TO USER ALP;
GRANT EXECUTE ON FUNCTION ADDDAY TO PUBLIC;
GRANT EXECUTE ON FUNCTION ADDHOUR TO PUBLIC;
GRANT EXECUTE ON FUNCTION ADDMONTH TO PUBLIC;
GRANT EXECUTE ON FUNCTION ADDSECOND TO PUBLIC;
GRANT EXECUTE ON FUNCTION ADDWEEK TO PUBLIC;
GRANT EXECUTE ON FUNCTION ADDYEAR TO PUBLIC;
GRANT EXECUTE ON FUNCTION DNVL TO PUBLIC;
GRANT EXECUTE ON FUNCTION FLOOR TO PUBLIC;
GRANT EXECUTE ON FUNCTION INVL TO PUBLIC;
GRANT EXECUTE ON FUNCTION MOD TO PUBLIC;
GRANT EXECUTE ON FUNCTION STRLEN TO PUBLIC;
GRANT EXECUTE ON FUNCTION SUBSTR TO PUBLIC;
GRANT USAGE ON SEQUENCE DCL_1C_NUMBER_HISTORY_GENERATOR TO PUBLIC;
GRANT USAGE ON SEQUENCE DCL_CUS_CODE_HISTORY_GENERATOR TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ACCOUNT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ACTION_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ASM_LIST_PRODUCE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ASSEMBLE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ATTACHMENT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_BLANK_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_BLANK_IMAGE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CATALOG_NUMBER_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CATEGORY_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CFC_LIST_PRODUCE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CFC_MESSAGE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_COMMERCIAL_PROPOSAL_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_COMMON_BLANK_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_COMMON_BLANK_LIGHT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_COND_FOR_CONTRACT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CONTACT_PERSON_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CONTRACTOR_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CONTRACTOR_REQUEST_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CONTRACT_CLOSED_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CONTRACT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CON_LIST_SPEC_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CON_MESSAGE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_COUNTRY_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CPR_LIST_PRODUCE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CPR_TRANSPORT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CRQ_PRINT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CRQ_STAGE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CTC_LIST_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CURRENCY_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CURRENCY_RATE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_CUSTOME_CODE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_DELIVERY_REQUEST_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_DEPARTMENT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_DLR_LIST_PRODUCE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_FIELD_COMMENT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_FILES_PATH_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_INF_MESSAGE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_INSTRUCTION_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_INSTRUCTION_TYPE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_LANGUAGE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_LETTERHEAD_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_LOG_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_LPS_LIST_MANAGER_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_MONTAGE_ADJUSTMENT_H_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_MONTAGE_ADJUSTMENT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ORDER_BLANK_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ORDER_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ORD_LIST_PAYMENT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ORD_LIST_PAY_SUM_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ORD_LIST_PRODUCE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ORD_MESSAGE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_OUTGOING_LETTER_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_PAYMENT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_PAY_LIST_SUMM_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_PAY_MESSAGE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_PRC_LIST_PRODUCE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_PRODUCE_COST_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_PRODUCE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_PRODUCTION_TERM_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_PURCHASE_PURPOSE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_PURPOSE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_RATE_NDS_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_READY_FOR_SHIPPING_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_REPUTATION_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ROLE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_ROUTE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_SELLER_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_SETTING_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_SHIPPING_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_SHP_DOC_TYPE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_SHP_LIST_PRODUCE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_SPC_LIST_PAYMENT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_SPECIFICATION_IMPORT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_SPI_LIST_PRODUCE_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_STUFF_CATEGORY_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_TERM_INCO_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_TEST_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_TIMEBOARD_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_TMB_LIST_WORK_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_UNIT_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_USER_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_USER_LINK_ID TO PUBLIC;
GRANT USAGE ON SEQUENCE GEN_DCL_USER_SETTING_ID TO PUBLIC;

/* Comments for database objects. */
COMMENT ON TABLE        DCL_PRC_LIST_PRODUCE IS '   " - "';
